function db(o,s){for(var l=0;l<s.length;l++){const r=s[l];if(typeof r!="string"&&!Array.isArray(r)){for(const d in r)if(d!=="default"&&!(d in o)){const u=Object.getOwnPropertyDescriptor(r,d);u&&Object.defineProperty(o,d,u.get?u:{enumerable:!0,get:()=>r[d]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))r(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function l(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerPolicy&&(u.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?u.credentials="include":d.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(d){if(d.ep)return;d.ep=!0;const u=l(d);fetch(d.href,u)}})();function cd(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function ub(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var s=o.default;if(typeof s=="function"){var l=function r(){var d=!1;try{d=this instanceof r}catch{}return d?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};l.prototype=s.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(o).forEach(function(r){var d=Object.getOwnPropertyDescriptor(o,r);Object.defineProperty(l,r,d.get?d:{enumerable:!0,get:function(){return o[r]}})}),l}var kc={exports:{}},Un={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xf;function hb(){if(xf)return Un;xf=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function l(r,d,u){var m=null;if(u!==void 0&&(m=""+u),d.key!==void 0&&(m=""+d.key),"key"in d){u={};for(var x in d)x!=="key"&&(u[x]=d[x])}else u=d;return d=u.ref,{$$typeof:o,type:r,key:m,ref:d!==void 0?d:null,props:u}}return Un.Fragment=s,Un.jsx=l,Un.jsxs=l,Un}var bf;function mb(){return bf||(bf=1,kc.exports=hb()),kc.exports}var a=mb(),Mc={exports:{}},Ue={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vf;function fb(){if(vf)return Ue;vf=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),m=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),_=Symbol.iterator;function S(w){return w===null||typeof w!="object"?null:(w=_&&w[_]||w["@@iterator"],typeof w=="function"?w:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O=Object.assign,T={};function z(w,A,I){this.props=w,this.context=A,this.refs=T,this.updater=I||N}z.prototype.isReactComponent={},z.prototype.setState=function(w,A){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,A,"setState")},z.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function L(){}L.prototype=z.prototype;function j(w,A,I){this.props=w,this.context=A,this.refs=T,this.updater=I||N}var q=j.prototype=new L;q.constructor=j,O(q,z.prototype),q.isPureReactComponent=!0;var y=Array.isArray;function M(){}var k={H:null,A:null,T:null,S:null},te=Object.prototype.hasOwnProperty;function ue(w,A,I){var K=I.ref;return{$$typeof:o,type:w,key:A,ref:K!==void 0?K:null,props:I}}function de(w,A){return ue(w.type,A,w.props)}function ve(w){return typeof w=="object"&&w!==null&&w.$$typeof===o}function ie(w){var A={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(I){return A[I]})}var pe=/\/+/g;function be(w,A){return typeof w=="object"&&w!==null&&w.key!=null?ie(""+w.key):A.toString(36)}function H(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(M,M):(w.status="pending",w.then(function(A){w.status==="pending"&&(w.status="fulfilled",w.value=A)},function(A){w.status==="pending"&&(w.status="rejected",w.reason=A)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function U(w,A,I,K,ee){var ne=typeof w;(ne==="undefined"||ne==="boolean")&&(w=null);var me=!1;if(w===null)me=!0;else switch(ne){case"bigint":case"string":case"number":me=!0;break;case"object":switch(w.$$typeof){case o:case s:me=!0;break;case b:return me=w._init,U(me(w._payload),A,I,K,ee)}}if(me)return ee=ee(w),me=K===""?"."+be(w,0):K,y(ee)?(I="",me!=null&&(I=me.replace(pe,"$&/")+"/"),U(ee,A,I,"",function(St){return St})):ee!=null&&(ve(ee)&&(ee=de(ee,I+(ee.key==null||w&&w.key===ee.key?"":(""+ee.key).replace(pe,"$&/")+"/")+me)),A.push(ee)),1;me=0;var ke=K===""?".":K+":";if(y(w))for(var $e=0;$e<w.length;$e++)K=w[$e],ne=ke+be(K,$e),me+=U(K,A,I,ne,ee);else if($e=S(w),typeof $e=="function")for(w=$e.call(w),$e=0;!(K=w.next()).done;)K=K.value,ne=ke+be(K,$e++),me+=U(K,A,I,ne,ee);else if(ne==="object"){if(typeof w.then=="function")return U(H(w),A,I,K,ee);throw A=String(w),Error("Objects are not valid as a React child (found: "+(A==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.")}return me}function D(w,A,I){if(w==null)return w;var K=[],ee=0;return U(w,K,"","",function(ne){return A.call(I,ne,ee++)}),K}function R(w){if(w._status===-1){var A=w._result;A=A(),A.then(function(I){(w._status===0||w._status===-1)&&(w._status=1,w._result=I)},function(I){(w._status===0||w._status===-1)&&(w._status=2,w._result=I)}),w._status===-1&&(w._status=0,w._result=A)}if(w._status===1)return w._result.default;throw w._result}var E=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var A=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(A))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)},V={map:D,forEach:function(w,A,I){D(w,function(){A.apply(this,arguments)},I)},count:function(w){var A=0;return D(w,function(){A++}),A},toArray:function(w){return D(w,function(A){return A})||[]},only:function(w){if(!ve(w))throw Error("React.Children.only expected to receive a single React element child.");return w}};return Ue.Activity=p,Ue.Children=V,Ue.Component=z,Ue.Fragment=l,Ue.Profiler=d,Ue.PureComponent=j,Ue.StrictMode=r,Ue.Suspense=g,Ue.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Ue.__COMPILER_RUNTIME={__proto__:null,c:function(w){return k.H.useMemoCache(w)}},Ue.cache=function(w){return function(){return w.apply(null,arguments)}},Ue.cacheSignal=function(){return null},Ue.cloneElement=function(w,A,I){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var K=O({},w.props),ee=w.key;if(A!=null)for(ne in A.key!==void 0&&(ee=""+A.key),A)!te.call(A,ne)||ne==="key"||ne==="__self"||ne==="__source"||ne==="ref"&&A.ref===void 0||(K[ne]=A[ne]);var ne=arguments.length-2;if(ne===1)K.children=I;else if(1<ne){for(var me=Array(ne),ke=0;ke<ne;ke++)me[ke]=arguments[ke+2];K.children=me}return ue(w.type,ee,K)},Ue.createContext=function(w){return w={$$typeof:m,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:u,_context:w},w},Ue.createElement=function(w,A,I){var K,ee={},ne=null;if(A!=null)for(K in A.key!==void 0&&(ne=""+A.key),A)te.call(A,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(ee[K]=A[K]);var me=arguments.length-2;if(me===1)ee.children=I;else if(1<me){for(var ke=Array(me),$e=0;$e<me;$e++)ke[$e]=arguments[$e+2];ee.children=ke}if(w&&w.defaultProps)for(K in me=w.defaultProps,me)ee[K]===void 0&&(ee[K]=me[K]);return ue(w,ne,ee)},Ue.createRef=function(){return{current:null}},Ue.forwardRef=function(w){return{$$typeof:x,render:w}},Ue.isValidElement=ve,Ue.lazy=function(w){return{$$typeof:b,_payload:{_status:-1,_result:w},_init:R}},Ue.memo=function(w,A){return{$$typeof:f,type:w,compare:A===void 0?null:A}},Ue.startTransition=function(w){var A=k.T,I={};k.T=I;try{var K=w(),ee=k.S;ee!==null&&ee(I,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(M,E)}catch(ne){E(ne)}finally{A!==null&&I.types!==null&&(A.types=I.types),k.T=A}},Ue.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Ue.use=function(w){return k.H.use(w)},Ue.useActionState=function(w,A,I){return k.H.useActionState(w,A,I)},Ue.useCallback=function(w,A){return k.H.useCallback(w,A)},Ue.useContext=function(w){return k.H.useContext(w)},Ue.useDebugValue=function(){},Ue.useDeferredValue=function(w,A){return k.H.useDeferredValue(w,A)},Ue.useEffect=function(w,A){return k.H.useEffect(w,A)},Ue.useEffectEvent=function(w){return k.H.useEffectEvent(w)},Ue.useId=function(){return k.H.useId()},Ue.useImperativeHandle=function(w,A,I){return k.H.useImperativeHandle(w,A,I)},Ue.useInsertionEffect=function(w,A){return k.H.useInsertionEffect(w,A)},Ue.useLayoutEffect=function(w,A){return k.H.useLayoutEffect(w,A)},Ue.useMemo=function(w,A){return k.H.useMemo(w,A)},Ue.useOptimistic=function(w,A){return k.H.useOptimistic(w,A)},Ue.useReducer=function(w,A,I){return k.H.useReducer(w,A,I)},Ue.useRef=function(w){return k.H.useRef(w)},Ue.useState=function(w){return k.H.useState(w)},Ue.useSyncExternalStore=function(w,A,I){return k.H.useSyncExternalStore(w,A,I)},Ue.useTransition=function(){return k.H.useTransition()},Ue.version="19.2.0",Ue}var yf;function dd(){return yf||(yf=1,Mc.exports=fb()),Mc.exports}var F=dd();const pb=cd(F);var Uc={exports:{}},Fn={},Fc={exports:{}},Lc={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jf;function gb(){return jf||(jf=1,(function(o){function s(U,D){var R=U.length;U.push(D);e:for(;0<R;){var E=R-1>>>1,V=U[E];if(0<d(V,D))U[E]=D,U[R]=V,R=E;else break e}}function l(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var D=U[0],R=U.pop();if(R!==D){U[0]=R;e:for(var E=0,V=U.length,w=V>>>1;E<w;){var A=2*(E+1)-1,I=U[A],K=A+1,ee=U[K];if(0>d(I,R))K<V&&0>d(ee,I)?(U[E]=ee,U[K]=R,E=K):(U[E]=I,U[A]=R,E=A);else if(K<V&&0>d(ee,R))U[E]=ee,U[K]=R,E=K;else break e}}return D}function d(U,D){var R=U.sortIndex-D.sortIndex;return R!==0?R:U.id-D.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;o.unstable_now=function(){return u.now()}}else{var m=Date,x=m.now();o.unstable_now=function(){return m.now()-x}}var g=[],f=[],b=1,p=null,_=3,S=!1,N=!1,O=!1,T=!1,z=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;function q(U){for(var D=l(f);D!==null;){if(D.callback===null)r(f);else if(D.startTime<=U)r(f),D.sortIndex=D.expirationTime,s(g,D);else break;D=l(f)}}function y(U){if(O=!1,q(U),!N)if(l(g)!==null)N=!0,M||(M=!0,ie());else{var D=l(f);D!==null&&H(y,D.startTime-U)}}var M=!1,k=-1,te=5,ue=-1;function de(){return T?!0:!(o.unstable_now()-ue<te)}function ve(){if(T=!1,M){var U=o.unstable_now();ue=U;var D=!0;try{e:{N=!1,O&&(O=!1,L(k),k=-1),S=!0;var R=_;try{t:{for(q(U),p=l(g);p!==null&&!(p.expirationTime>U&&de());){var E=p.callback;if(typeof E=="function"){p.callback=null,_=p.priorityLevel;var V=E(p.expirationTime<=U);if(U=o.unstable_now(),typeof V=="function"){p.callback=V,q(U),D=!0;break t}p===l(g)&&r(g),q(U)}else r(g);p=l(g)}if(p!==null)D=!0;else{var w=l(f);w!==null&&H(y,w.startTime-U),D=!1}}break e}finally{p=null,_=R,S=!1}D=void 0}}finally{D?ie():M=!1}}}var ie;if(typeof j=="function")ie=function(){j(ve)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,be=pe.port2;pe.port1.onmessage=ve,ie=function(){be.postMessage(null)}}else ie=function(){z(ve,0)};function H(U,D){k=z(function(){U(o.unstable_now())},D)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(U){U.callback=null},o.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<U?Math.floor(1e3/U):5},o.unstable_getCurrentPriorityLevel=function(){return _},o.unstable_next=function(U){switch(_){case 1:case 2:case 3:var D=3;break;default:D=_}var R=_;_=D;try{return U()}finally{_=R}},o.unstable_requestPaint=function(){T=!0},o.unstable_runWithPriority=function(U,D){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var R=_;_=U;try{return D()}finally{_=R}},o.unstable_scheduleCallback=function(U,D,R){var E=o.unstable_now();switch(typeof R=="object"&&R!==null?(R=R.delay,R=typeof R=="number"&&0<R?E+R:E):R=E,U){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=R+V,U={id:b++,callback:D,priorityLevel:U,startTime:R,expirationTime:V,sortIndex:-1},R>E?(U.sortIndex=R,s(f,U),l(g)===null&&U===l(f)&&(O?(L(k),k=-1):O=!0,H(y,R-E))):(U.sortIndex=V,s(g,U),N||S||(N=!0,M||(M=!0,ie()))),U},o.unstable_shouldYield=de,o.unstable_wrapCallback=function(U){var D=_;return function(){var R=_;_=D;try{return U.apply(this,arguments)}finally{_=R}}}})(Lc)),Lc}var Nf;function xb(){return Nf||(Nf=1,Fc.exports=gb()),Fc.exports}var $c={exports:{}},Ut={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _f;function bb(){if(_f)return Ut;_f=1;var o=dd();function s(g){var f="https://react.dev/errors/"+g;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var b=2;b<arguments.length;b++)f+="&args[]="+encodeURIComponent(arguments[b])}return"Minified React error #"+g+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var r={d:{f:l,r:function(){throw Error(s(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},d=Symbol.for("react.portal");function u(g,f,b){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:p==null?null:""+p,children:g,containerInfo:f,implementation:b}}var m=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function x(g,f){if(g==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Ut.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Ut.createPortal=function(g,f){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(s(299));return u(g,f,null,b)},Ut.flushSync=function(g){var f=m.T,b=r.p;try{if(m.T=null,r.p=2,g)return g()}finally{m.T=f,r.p=b,r.d.f()}},Ut.preconnect=function(g,f){typeof g=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,r.d.C(g,f))},Ut.prefetchDNS=function(g){typeof g=="string"&&r.d.D(g)},Ut.preinit=function(g,f){if(typeof g=="string"&&f&&typeof f.as=="string"){var b=f.as,p=x(b,f.crossOrigin),_=typeof f.integrity=="string"?f.integrity:void 0,S=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;b==="style"?r.d.S(g,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:p,integrity:_,fetchPriority:S}):b==="script"&&r.d.X(g,{crossOrigin:p,integrity:_,fetchPriority:S,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Ut.preinitModule=function(g,f){if(typeof g=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var b=x(f.as,f.crossOrigin);r.d.M(g,{crossOrigin:b,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&r.d.M(g)},Ut.preload=function(g,f){if(typeof g=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var b=f.as,p=x(b,f.crossOrigin);r.d.L(g,b,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Ut.preloadModule=function(g,f){if(typeof g=="string")if(f){var b=x(f.as,f.crossOrigin);r.d.m(g,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:b,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else r.d.m(g)},Ut.requestFormReset=function(g){r.d.r(g)},Ut.unstable_batchedUpdates=function(g,f){return g(f)},Ut.useFormState=function(g,f,b){return m.H.useFormState(g,f,b)},Ut.useFormStatus=function(){return m.H.useHostTransitionStatus()},Ut.version="19.2.0",Ut}var wf;function vb(){if(wf)return $c.exports;wf=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(s){console.error(s)}}return o(),$c.exports=bb(),$c.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sf;function yb(){if(Sf)return Fn;Sf=1;var o=xb(),s=dd(),l=vb();function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var i=2;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function m(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function x(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(u(e)!==e)throw Error(r(188))}function f(e){var t=e.alternate;if(!t){if(t=u(e),t===null)throw Error(r(188));return t!==e?null:e}for(var i=e,n=t;;){var c=i.return;if(c===null)break;var h=c.alternate;if(h===null){if(n=c.return,n!==null){i=n;continue}break}if(c.child===h.child){for(h=c.child;h;){if(h===i)return g(c),e;if(h===n)return g(c),t;h=h.sibling}throw Error(r(188))}if(i.return!==n.return)i=c,n=h;else{for(var v=!1,C=c.child;C;){if(C===i){v=!0,i=c,n=h;break}if(C===n){v=!0,n=c,i=h;break}C=C.sibling}if(!v){for(C=h.child;C;){if(C===i){v=!0,i=h,n=c;break}if(C===n){v=!0,n=h,i=c;break}C=C.sibling}if(!v)throw Error(r(189))}}if(i.alternate!==n)throw Error(r(190))}if(i.tag!==3)throw Error(r(188));return i.stateNode.current===i?e:t}function b(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=b(e),t!==null)return t;e=e.sibling}return null}var p=Object.assign,_=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),N=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),L=Symbol.for("react.consumer"),j=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),ue=Symbol.for("react.activity"),de=Symbol.for("react.memo_cache_sentinel"),ve=Symbol.iterator;function ie(e){return e===null||typeof e!="object"?null:(e=ve&&e[ve]||e["@@iterator"],typeof e=="function"?e:null)}var pe=Symbol.for("react.client.reference");function be(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===pe?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case O:return"Fragment";case z:return"Profiler";case T:return"StrictMode";case y:return"Suspense";case M:return"SuspenseList";case ue:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case N:return"Portal";case j:return e.displayName||"Context";case L:return(e._context.displayName||"Context")+".Consumer";case q:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case k:return t=e.displayName||null,t!==null?t:be(e.type)||"Memo";case te:t=e._payload,e=e._init;try{return be(e(t))}catch{}}return null}var H=Array.isArray,U=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R={pending:!1,data:null,method:null,action:null},E=[],V=-1;function w(e){return{current:e}}function A(e){0>V||(e.current=E[V],E[V]=null,V--)}function I(e,t){V++,E[V]=e.current,e.current=t}var K=w(null),ee=w(null),ne=w(null),me=w(null);function ke(e,t){switch(I(ne,t),I(ee,e),I(K,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?$m(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=$m(t),e=Bm(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}A(K),I(K,e)}function $e(){A(K),A(ee),A(ne)}function St(e){e.memoizedState!==null&&I(me,e);var t=K.current,i=Bm(t,e.type);t!==i&&(I(ee,e),I(K,i))}function Q(e){ee.current===e&&(A(K),A(ee)),me.current===e&&(A(me),On._currentValue=R)}var P,he;function ce(e){if(P===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||"",he=-1<i.stack.indexOf(`
    at`)?" (<anonymous>)":-1<i.stack.indexOf("@")?"@unknown:0:0":""}return`
`+P+e+he}var we=!1;function Ne(e,t){if(!e||we)return"";we=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(ae){var W=ae}Reflect.construct(e,[],re)}else{try{re.call()}catch(ae){W=ae}e.call(re.prototype)}}else{try{throw Error()}catch(ae){W=ae}(re=e())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(ae){if(ae&&W&&typeof ae.stack=="string")return[ae.stack,W.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=n.DetermineComponentFrameRoot(),v=h[0],C=h[1];if(v&&C){var B=v.split(`
`),Z=C.split(`
`);for(c=n=0;n<B.length&&!B[n].includes("DetermineComponentFrameRoot");)n++;for(;c<Z.length&&!Z[c].includes("DetermineComponentFrameRoot");)c++;if(n===B.length||c===Z.length)for(n=B.length-1,c=Z.length-1;1<=n&&0<=c&&B[n]!==Z[c];)c--;for(;1<=n&&0<=c;n--,c--)if(B[n]!==Z[c]){if(n!==1||c!==1)do if(n--,c--,0>c||B[n]!==Z[c]){var se=`
`+B[n].replace(" at new "," at ");return e.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",e.displayName)),se}while(1<=n&&0<=c);break}}}finally{we=!1,Error.prepareStackTrace=i}return(i=e?e.displayName||e.name:"")?ce(i):""}function Ve(e,t){switch(e.tag){case 26:case 27:case 5:return ce(e.type);case 16:return ce("Lazy");case 13:return e.child!==t&&t!==null?ce("Suspense Fallback"):ce("Suspense");case 19:return ce("SuspenseList");case 0:case 15:return Ne(e.type,!1);case 11:return Ne(e.type.render,!1);case 1:return Ne(e.type,!0);case 31:return ce("Activity");default:return""}}function nt(e){try{var t="",i=null;do t+=Ve(e,i),i=e,e=e.return;while(e);return t}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var pt=Object.prototype.hasOwnProperty,Yt=o.unstable_scheduleCallback,na=o.unstable_cancelCallback,Je=o.unstable_shouldYield,X=o.unstable_requestPaint,oe=o.unstable_now,ge=o.unstable_getCurrentPriorityLevel,je=o.unstable_ImmediatePriority,De=o.unstable_UserBlockingPriority,Me=o.unstable_NormalPriority,$=o.unstable_LowPriority,fe=o.unstable_IdlePriority,Te=o.log,Ce=o.unstable_setDisableYieldValue,lt=null,Ie=null;function ht(e){if(typeof Te=="function"&&Ce(e),Ie&&typeof Ie.setStrictMode=="function")try{Ie.setStrictMode(lt,e)}catch{}}var xe=Math.clz32?Math.clz32:Qt,Fe=Math.log,xa=Math.LN2;function Qt(e){return e>>>=0,e===0?32:31-(Fe(e)/xa|0)|0}var ze=256,Ze=262144,ba=4194304;function va(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ki(e,t,i){var n=e.pendingLanes;if(n===0)return 0;var c=0,h=e.suspendedLanes,v=e.pingedLanes;e=e.warmLanes;var C=n&134217727;return C!==0?(n=C&~h,n!==0?c=va(n):(v&=C,v!==0?c=va(v):i||(i=C&~e,i!==0&&(c=va(i))))):(C=n&~h,C!==0?c=va(C):v!==0?c=va(v):i||(i=n&~e,i!==0&&(c=va(i)))),c===0?0:t!==0&&t!==c&&(t&h)===0&&(h=c&-c,i=t&-t,h>=i||h===32&&(i&4194048)!==0)?t:c}function ya(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Jp(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yd(){var e=ba;return ba<<=1,(ba&62914560)===0&&(ba=4194304),e}function jr(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Gs(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Zp(e,t,i,n,c,h){var v=e.pendingLanes;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=i,e.entangledLanes&=i,e.errorRecoveryDisabledLanes&=i,e.shellSuspendCounter=0;var C=e.entanglements,B=e.expirationTimes,Z=e.hiddenUpdates;for(i=v&~i;0<i;){var se=31-xe(i),re=1<<se;C[se]=0,B[se]=-1;var W=Z[se];if(W!==null)for(Z[se]=null,se=0;se<W.length;se++){var ae=W[se];ae!==null&&(ae.lane&=-536870913)}i&=~re}n!==0&&jd(e,n,0),h!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=h&~(v&~t))}function jd(e,t,i){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-xe(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|i&261930}function Nd(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-xe(i),c=1<<n;c&t|e[n]&t&&(e[n]|=t),i&=~c}}function _d(e,t){var i=t&-t;return i=(i&42)!==0?1:Nr(i),(i&(e.suspendedLanes|t))!==0?0:i}function Nr(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function _r(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function wd(){var e=D.p;return e!==0?e:(e=window.event,e===void 0?32:df(e.type))}function Sd(e,t){var i=D.p;try{return D.p=e,t()}finally{D.p=i}}var Xa=Math.random().toString(36).slice(2),At="__reactFiber$"+Xa,Bt="__reactProps$"+Xa,Xi="__reactContainer$"+Xa,wr="__reactEvents$"+Xa,Wp="__reactListeners$"+Xa,eg="__reactHandles$"+Xa,Cd="__reactResources$"+Xa,Vs="__reactMarker$"+Xa;function Sr(e){delete e[At],delete e[Bt],delete e[wr],delete e[Wp],delete e[eg]}function Ji(e){var t=e[At];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Xi]||i[At]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Ym(e);e!==null;){if(i=e[At])return i;e=Ym(e)}return t}e=i,i=e.parentNode}return null}function Zi(e){if(e=e[At]||e[Xi]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function Ys(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(r(33))}function Wi(e){var t=e[Cd];return t||(t=e[Cd]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function zt(e){e[Vs]=!0}var Ed=new Set,zd={};function _i(e,t){es(e,t),es(e+"Capture",t)}function es(e,t){for(zd[e]=t,e=0;e<t.length;e++)Ed.add(t[e])}var tg=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Td={},Ad={};function ag(e){return pt.call(Ad,e)?!0:pt.call(Td,e)?!1:tg.test(e)?Ad[e]=!0:(Td[e]=!0,!1)}function Gn(e,t,i){if(ag(t))if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+i)}}function Vn(e,t,i){if(i===null)e.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+i)}}function Aa(e,t,i,n){if(n===null)e.removeAttribute(i);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(i);return}e.setAttributeNS(t,i,""+n)}}function la(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Dd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ig(e,t,i){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var c=n.get,h=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(v){i=""+v,h.call(this,v)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(v){i=""+v},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Cr(e){if(!e._valueTracker){var t=Dd(e)?"checked":"value";e._valueTracker=ig(e,t,""+e[t])}}function Od(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=Dd(e)?e.checked?"true":"false":e.value),e=n,e!==i?(t.setValue(e),!0):!1}function Yn(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var sg=/[\n"\\]/g;function ra(e){return e.replace(sg,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Er(e,t,i,n,c,h,v,C){e.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?e.type=v:e.removeAttribute("type"),t!=null?v==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+la(t)):e.value!==""+la(t)&&(e.value=""+la(t)):v!=="submit"&&v!=="reset"||e.removeAttribute("value"),t!=null?zr(e,v,la(t)):i!=null?zr(e,v,la(i)):n!=null&&e.removeAttribute("value"),c==null&&h!=null&&(e.defaultChecked=!!h),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?e.name=""+la(C):e.removeAttribute("name")}function Rd(e,t,i,n,c,h,v,C){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(e.type=h),t!=null||i!=null){if(!(h!=="submit"&&h!=="reset"||t!=null)){Cr(e);return}i=i!=null?""+la(i):"",t=t!=null?""+la(t):i,C||t===e.value||(e.value=t),e.defaultValue=t}n=n??c,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=C?e.checked:!!n,e.defaultChecked=!!n,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(e.name=v),Cr(e)}function zr(e,t,i){t==="number"&&Yn(e.ownerDocument)===e||e.defaultValue===""+i||(e.defaultValue=""+i)}function ts(e,t,i,n){if(e=e.options,t){t={};for(var c=0;c<i.length;c++)t["$"+i[c]]=!0;for(i=0;i<e.length;i++)c=t.hasOwnProperty("$"+e[i].value),e[i].selected!==c&&(e[i].selected=c),c&&n&&(e[i].defaultSelected=!0)}else{for(i=""+la(i),t=null,c=0;c<e.length;c++){if(e[c].value===i){e[c].selected=!0,n&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function kd(e,t,i){if(t!=null&&(t=""+la(t),t!==e.value&&(e.value=t),i==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=i!=null?""+la(i):""}function Md(e,t,i,n){if(t==null){if(n!=null){if(i!=null)throw Error(r(92));if(H(n)){if(1<n.length)throw Error(r(93));n=n[0]}i=n}i==null&&(i=""),t=i}i=la(t),e.defaultValue=i,n=e.textContent,n===i&&n!==""&&n!==null&&(e.value=n),Cr(e)}function as(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var ng=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ud(e,t,i){var n=t.indexOf("--")===0;i==null||typeof i=="boolean"||i===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,i):typeof i!="number"||i===0||ng.has(t)?t==="float"?e.cssFloat=i:e[t]=(""+i).trim():e[t]=i+"px"}function Fd(e,t,i){if(t!=null&&typeof t!="object")throw Error(r(62));if(e=e.style,i!=null){for(var n in i)!i.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var c in t)n=t[c],t.hasOwnProperty(c)&&i[c]!==n&&Ud(e,c,n)}else for(var h in t)t.hasOwnProperty(h)&&Ud(e,h,t[h])}function Tr(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),rg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Qn(e){return rg.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Da(){}var Ar=null;function Dr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var is=null,ss=null;function Ld(e){var t=Zi(e);if(t&&(e=t.stateNode)){var i=e[Bt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Er(e,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll('input[name="'+ra(""+t)+'"][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var c=n[Bt]||null;if(!c)throw Error(r(90));Er(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<i.length;t++)n=i[t],n.form===e.form&&Od(n)}break e;case"textarea":kd(e,i.value,i.defaultValue);break e;case"select":t=i.value,t!=null&&ts(e,!!i.multiple,t,!1)}}}var Or=!1;function $d(e,t,i){if(Or)return e(t,i);Or=!0;try{var n=e(t);return n}finally{if(Or=!1,(is!==null||ss!==null)&&(Ml(),is&&(t=is,e=ss,ss=is=null,Ld(t),e)))for(t=0;t<e.length;t++)Ld(e[t])}}function Qs(e,t){var i=e.stateNode;if(i===null)return null;var n=i[Bt]||null;if(n===null)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(r(231,t,typeof i));return i}var Oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rr=!1;if(Oa)try{var Ks={};Object.defineProperty(Ks,"passive",{get:function(){Rr=!0}}),window.addEventListener("test",Ks,Ks),window.removeEventListener("test",Ks,Ks)}catch{Rr=!1}var Ja=null,kr=null,Kn=null;function Bd(){if(Kn)return Kn;var e,t=kr,i=t.length,n,c="value"in Ja?Ja.value:Ja.textContent,h=c.length;for(e=0;e<i&&t[e]===c[e];e++);var v=i-e;for(n=1;n<=v&&t[i-n]===c[h-n];n++);return Kn=c.slice(e,1<n?1-n:void 0)}function Xn(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Jn(){return!0}function Id(){return!1}function It(e){function t(i,n,c,h,v){this._reactName=i,this._targetInst=c,this.type=n,this.nativeEvent=h,this.target=v,this.currentTarget=null;for(var C in e)e.hasOwnProperty(C)&&(i=e[C],this[C]=i?i(h):h[C]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Jn:Id,this.isPropagationStopped=Id,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Jn)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Jn)},persist:function(){},isPersistent:Jn}),t}var wi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zn=It(wi),Xs=p({},wi,{view:0,detail:0}),og=It(Xs),Mr,Ur,Js,Wn=p({},Xs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lr,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Js&&(Js&&e.type==="mousemove"?(Mr=e.screenX-Js.screenX,Ur=e.screenY-Js.screenY):Ur=Mr=0,Js=e),Mr)},movementY:function(e){return"movementY"in e?e.movementY:Ur}}),qd=It(Wn),cg=p({},Wn,{dataTransfer:0}),dg=It(cg),ug=p({},Xs,{relatedTarget:0}),Fr=It(ug),hg=p({},wi,{animationName:0,elapsedTime:0,pseudoElement:0}),mg=It(hg),fg=p({},wi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),pg=It(fg),gg=p({},wi,{data:0}),Pd=It(gg),xg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=vg[e])?!!t[e]:!1}function Lr(){return yg}var jg=p({},Xs,{key:function(e){if(e.key){var t=xg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Xn(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?bg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lr,charCode:function(e){return e.type==="keypress"?Xn(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Xn(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ng=It(jg),_g=p({},Wn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hd=It(_g),wg=p({},Xs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lr}),Sg=It(wg),Cg=p({},wi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Eg=It(Cg),zg=p({},Wn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tg=It(zg),Ag=p({},wi,{newState:0,oldState:0}),Dg=It(Ag),Og=[9,13,27,32],$r=Oa&&"CompositionEvent"in window,Zs=null;Oa&&"documentMode"in document&&(Zs=document.documentMode);var Rg=Oa&&"TextEvent"in window&&!Zs,Gd=Oa&&(!$r||Zs&&8<Zs&&11>=Zs),Vd=" ",Yd=!1;function Qd(e,t){switch(e){case"keyup":return Og.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Kd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ns=!1;function kg(e,t){switch(e){case"compositionend":return Kd(t);case"keypress":return t.which!==32?null:(Yd=!0,Vd);case"textInput":return e=t.data,e===Vd&&Yd?null:e;default:return null}}function Mg(e,t){if(ns)return e==="compositionend"||!$r&&Qd(e,t)?(e=Bd(),Kn=kr=Ja=null,ns=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Gd&&t.locale!=="ko"?null:t.data;default:return null}}var Ug={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ug[e.type]:t==="textarea"}function Jd(e,t,i,n){is?ss?ss.push(n):ss=[n]:is=n,t=ql(t,"onChange"),0<t.length&&(i=new Zn("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Ws=null,en=null;function Fg(e){Rm(e,0)}function el(e){var t=Ys(e);if(Od(t))return e}function Zd(e,t){if(e==="change")return t}var Wd=!1;if(Oa){var Br;if(Oa){var Ir="oninput"in document;if(!Ir){var eu=document.createElement("div");eu.setAttribute("oninput","return;"),Ir=typeof eu.oninput=="function"}Br=Ir}else Br=!1;Wd=Br&&(!document.documentMode||9<document.documentMode)}function tu(){Ws&&(Ws.detachEvent("onpropertychange",au),en=Ws=null)}function au(e){if(e.propertyName==="value"&&el(en)){var t=[];Jd(t,en,e,Dr(e)),$d(Fg,t)}}function Lg(e,t,i){e==="focusin"?(tu(),Ws=t,en=i,Ws.attachEvent("onpropertychange",au)):e==="focusout"&&tu()}function $g(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return el(en)}function Bg(e,t){if(e==="click")return el(t)}function Ig(e,t){if(e==="input"||e==="change")return el(t)}function qg(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Kt=typeof Object.is=="function"?Object.is:qg;function tn(e,t){if(Kt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var c=i[n];if(!pt.call(t,c)||!Kt(e[c],t[c]))return!1}return!0}function iu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function su(e,t){var i=iu(e);e=0;for(var n;i;){if(i.nodeType===3){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=iu(i)}}function nu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?nu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function lu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Yn(e.document);t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Yn(e.document)}return t}function qr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Pg=Oa&&"documentMode"in document&&11>=document.documentMode,ls=null,Pr=null,an=null,Hr=!1;function ru(e,t,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Hr||ls==null||ls!==Yn(n)||(n=ls,"selectionStart"in n&&qr(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),an&&tn(an,n)||(an=n,n=ql(Pr,"onSelect"),0<n.length&&(t=new Zn("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=ls)))}function Si(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var rs={animationend:Si("Animation","AnimationEnd"),animationiteration:Si("Animation","AnimationIteration"),animationstart:Si("Animation","AnimationStart"),transitionrun:Si("Transition","TransitionRun"),transitionstart:Si("Transition","TransitionStart"),transitioncancel:Si("Transition","TransitionCancel"),transitionend:Si("Transition","TransitionEnd")},Gr={},ou={};Oa&&(ou=document.createElement("div").style,"AnimationEvent"in window||(delete rs.animationend.animation,delete rs.animationiteration.animation,delete rs.animationstart.animation),"TransitionEvent"in window||delete rs.transitionend.transition);function Ci(e){if(Gr[e])return Gr[e];if(!rs[e])return e;var t=rs[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in ou)return Gr[e]=t[i];return e}var cu=Ci("animationend"),du=Ci("animationiteration"),uu=Ci("animationstart"),Hg=Ci("transitionrun"),Gg=Ci("transitionstart"),Vg=Ci("transitioncancel"),hu=Ci("transitionend"),mu=new Map,Vr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vr.push("scrollEnd");function ja(e,t){mu.set(e,t),_i(t,[e])}var tl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},oa=[],os=0,Yr=0;function al(){for(var e=os,t=Yr=os=0;t<e;){var i=oa[t];oa[t++]=null;var n=oa[t];oa[t++]=null;var c=oa[t];oa[t++]=null;var h=oa[t];if(oa[t++]=null,n!==null&&c!==null){var v=n.pending;v===null?c.next=c:(c.next=v.next,v.next=c),n.pending=c}h!==0&&fu(i,c,h)}}function il(e,t,i,n){oa[os++]=e,oa[os++]=t,oa[os++]=i,oa[os++]=n,Yr|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function Qr(e,t,i,n){return il(e,t,i,n),sl(e)}function Ei(e,t){return il(e,null,null,t),sl(e)}function fu(e,t,i){e.lanes|=i;var n=e.alternate;n!==null&&(n.lanes|=i);for(var c=!1,h=e.return;h!==null;)h.childLanes|=i,n=h.alternate,n!==null&&(n.childLanes|=i),h.tag===22&&(e=h.stateNode,e===null||e._visibility&1||(c=!0)),e=h,h=h.return;return e.tag===3?(h=e.stateNode,c&&t!==null&&(c=31-xe(i),e=h.hiddenUpdates,n=e[c],n===null?e[c]=[t]:n.push(t),t.lane=i|536870912),h):null}function sl(e){if(50<Sn)throw Sn=0,sc=null,Error(r(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var cs={};function Yg(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xt(e,t,i,n){return new Yg(e,t,i,n)}function Kr(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ra(e,t){var i=e.alternate;return i===null?(i=Xt(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&65011712,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i.refCleanup=e.refCleanup,i}function pu(e,t){e.flags&=65011714;var i=e.alternate;return i===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=i.childLanes,e.lanes=i.lanes,e.child=i.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=i.memoizedProps,e.memoizedState=i.memoizedState,e.updateQueue=i.updateQueue,e.type=i.type,t=i.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function nl(e,t,i,n,c,h){var v=0;if(n=e,typeof e=="function")Kr(e)&&(v=1);else if(typeof e=="string")v=Zx(e,i,K.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ue:return e=Xt(31,i,t,c),e.elementType=ue,e.lanes=h,e;case O:return zi(i.children,c,h,t);case T:v=8,c|=24;break;case z:return e=Xt(12,i,t,c|2),e.elementType=z,e.lanes=h,e;case y:return e=Xt(13,i,t,c),e.elementType=y,e.lanes=h,e;case M:return e=Xt(19,i,t,c),e.elementType=M,e.lanes=h,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case j:v=10;break e;case L:v=9;break e;case q:v=11;break e;case k:v=14;break e;case te:v=16,n=null;break e}v=29,i=Error(r(130,e===null?"null":typeof e,"")),n=null}return t=Xt(v,i,t,c),t.elementType=e,t.type=n,t.lanes=h,t}function zi(e,t,i,n){return e=Xt(7,e,n,t),e.lanes=i,e}function Xr(e,t,i){return e=Xt(6,e,null,t),e.lanes=i,e}function gu(e){var t=Xt(18,null,null,0);return t.stateNode=e,t}function Jr(e,t,i){return t=Xt(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var xu=new WeakMap;function ca(e,t){if(typeof e=="object"&&e!==null){var i=xu.get(e);return i!==void 0?i:(t={value:e,source:t,stack:nt(t)},xu.set(e,t),t)}return{value:e,source:t,stack:nt(t)}}var ds=[],us=0,ll=null,sn=0,da=[],ua=0,Za=null,Ca=1,Ea="";function ka(e,t){ds[us++]=sn,ds[us++]=ll,ll=e,sn=t}function bu(e,t,i){da[ua++]=Ca,da[ua++]=Ea,da[ua++]=Za,Za=e;var n=Ca;e=Ea;var c=32-xe(n)-1;n&=~(1<<c),i+=1;var h=32-xe(t)+c;if(30<h){var v=c-c%5;h=(n&(1<<v)-1).toString(32),n>>=v,c-=v,Ca=1<<32-xe(t)+c|i<<c|n,Ea=h+e}else Ca=1<<h|i<<c|n,Ea=e}function Zr(e){e.return!==null&&(ka(e,1),bu(e,1,0))}function Wr(e){for(;e===ll;)ll=ds[--us],ds[us]=null,sn=ds[--us],ds[us]=null;for(;e===Za;)Za=da[--ua],da[ua]=null,Ea=da[--ua],da[ua]=null,Ca=da[--ua],da[ua]=null}function vu(e,t){da[ua++]=Ca,da[ua++]=Ea,da[ua++]=Za,Ca=t.id,Ea=t.overflow,Za=e}var Dt=null,ot=null,Ye=!1,Wa=null,ha=!1,eo=Error(r(519));function ei(e){var t=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw nn(ca(t,e)),eo}function yu(e){var t=e.stateNode,i=e.type,n=e.memoizedProps;switch(t[At]=e,t[Bt]=n,i){case"dialog":Pe("cancel",t),Pe("close",t);break;case"iframe":case"object":case"embed":Pe("load",t);break;case"video":case"audio":for(i=0;i<En.length;i++)Pe(En[i],t);break;case"source":Pe("error",t);break;case"img":case"image":case"link":Pe("error",t),Pe("load",t);break;case"details":Pe("toggle",t);break;case"input":Pe("invalid",t),Rd(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Pe("invalid",t);break;case"textarea":Pe("invalid",t),Md(t,n.value,n.defaultValue,n.children)}i=n.children,typeof i!="string"&&typeof i!="number"&&typeof i!="bigint"||t.textContent===""+i||n.suppressHydrationWarning===!0||Fm(t.textContent,i)?(n.popover!=null&&(Pe("beforetoggle",t),Pe("toggle",t)),n.onScroll!=null&&Pe("scroll",t),n.onScrollEnd!=null&&Pe("scrollend",t),n.onClick!=null&&(t.onclick=Da),t=!0):t=!1,t||ei(e,!0)}function ju(e){for(Dt=e.return;Dt;)switch(Dt.tag){case 5:case 31:case 13:ha=!1;return;case 27:case 3:ha=!0;return;default:Dt=Dt.return}}function hs(e){if(e!==Dt)return!1;if(!Ye)return ju(e),Ye=!0,!1;var t=e.tag,i;if((i=t!==3&&t!==27)&&((i=t===5)&&(i=e.type,i=!(i!=="form"&&i!=="button")||vc(e.type,e.memoizedProps)),i=!i),i&&ot&&ei(e),ju(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));ot=Vm(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(317));ot=Vm(e)}else t===27?(t=ot,fi(e.type)?(e=wc,wc=null,ot=e):ot=t):ot=Dt?fa(e.stateNode.nextSibling):null;return!0}function Ti(){ot=Dt=null,Ye=!1}function to(){var e=Wa;return e!==null&&(Gt===null?Gt=e:Gt.push.apply(Gt,e),Wa=null),e}function nn(e){Wa===null?Wa=[e]:Wa.push(e)}var ao=w(null),Ai=null,Ma=null;function ti(e,t,i){I(ao,t._currentValue),t._currentValue=i}function Ua(e){e._currentValue=ao.current,A(ao)}function io(e,t,i){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function so(e,t,i,n){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var h=c.dependencies;if(h!==null){var v=c.child;h=h.firstContext;e:for(;h!==null;){var C=h;h=c;for(var B=0;B<t.length;B++)if(C.context===t[B]){h.lanes|=i,C=h.alternate,C!==null&&(C.lanes|=i),io(h.return,i,e),n||(v=null);break e}h=C.next}}else if(c.tag===18){if(v=c.return,v===null)throw Error(r(341));v.lanes|=i,h=v.alternate,h!==null&&(h.lanes|=i),io(v,i,e),v=null}else v=c.child;if(v!==null)v.return=c;else for(v=c;v!==null;){if(v===e){v=null;break}if(c=v.sibling,c!==null){c.return=v.return,v=c;break}v=v.return}c=v}}function ms(e,t,i,n){e=null;for(var c=t,h=!1;c!==null;){if(!h){if((c.flags&524288)!==0)h=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var v=c.alternate;if(v===null)throw Error(r(387));if(v=v.memoizedProps,v!==null){var C=c.type;Kt(c.pendingProps.value,v.value)||(e!==null?e.push(C):e=[C])}}else if(c===me.current){if(v=c.alternate,v===null)throw Error(r(387));v.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(On):e=[On])}c=c.return}e!==null&&so(t,e,i,n),t.flags|=262144}function rl(e){for(e=e.firstContext;e!==null;){if(!Kt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Di(e){Ai=e,Ma=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ot(e){return Nu(Ai,e)}function ol(e,t){return Ai===null&&Di(e),Nu(e,t)}function Nu(e,t){var i=t._currentValue;if(t={context:t,memoizedValue:i,next:null},Ma===null){if(e===null)throw Error(r(308));Ma=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ma=Ma.next=t;return i}var Qg=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(i,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(i){return i()})}},Kg=o.unstable_scheduleCallback,Xg=o.unstable_NormalPriority,bt={$$typeof:j,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function no(){return{controller:new Qg,data:new Map,refCount:0}}function ln(e){e.refCount--,e.refCount===0&&Kg(Xg,function(){e.controller.abort()})}var rn=null,lo=0,fs=0,ps=null;function Jg(e,t){if(rn===null){var i=rn=[];lo=0,fs=dc(),ps={status:"pending",value:void 0,then:function(n){i.push(n)}}}return lo++,t.then(_u,_u),t}function _u(){if(--lo===0&&rn!==null){ps!==null&&(ps.status="fulfilled");var e=rn;rn=null,fs=0,ps=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Zg(e,t){var i=[],n={status:"pending",value:null,reason:null,then:function(c){i.push(c)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var c=0;c<i.length;c++)(0,i[c])(t)},function(c){for(n.status="rejected",n.reason=c,c=0;c<i.length;c++)(0,i[c])(void 0)}),n}var wu=U.S;U.S=function(e,t){rm=oe(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&Jg(e,t),wu!==null&&wu(e,t)};var Oi=w(null);function ro(){var e=Oi.current;return e!==null?e:st.pooledCache}function cl(e,t){t===null?I(Oi,Oi.current):I(Oi,t.pool)}function Su(){var e=ro();return e===null?null:{parent:bt._currentValue,pool:e}}var gs=Error(r(460)),oo=Error(r(474)),dl=Error(r(542)),ul={then:function(){}};function Cu(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Eu(e,t,i){switch(i=e[i],i===void 0?e.push(t):i!==t&&(t.then(Da,Da),t=i),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Tu(e),e;default:if(typeof t.status=="string")t.then(Da,Da);else{if(e=st,e!==null&&100<e.shellSuspendCounter)throw Error(r(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=n}},function(n){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Tu(e),e}throw ki=t,gs}}function Ri(e){try{var t=e._init;return t(e._payload)}catch(i){throw i!==null&&typeof i=="object"&&typeof i.then=="function"?(ki=i,gs):i}}var ki=null;function zu(){if(ki===null)throw Error(r(459));var e=ki;return ki=null,e}function Tu(e){if(e===gs||e===dl)throw Error(r(483))}var xs=null,on=0;function hl(e){var t=on;return on+=1,xs===null&&(xs=[]),Eu(xs,e,t)}function cn(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function ml(e,t){throw t.$$typeof===_?Error(r(525)):(e=Object.prototype.toString.call(t),Error(r(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function Au(e){function t(Y,G){if(e){var J=Y.deletions;J===null?(Y.deletions=[G],Y.flags|=16):J.push(G)}}function i(Y,G){if(!e)return null;for(;G!==null;)t(Y,G),G=G.sibling;return null}function n(Y){for(var G=new Map;Y!==null;)Y.key!==null?G.set(Y.key,Y):G.set(Y.index,Y),Y=Y.sibling;return G}function c(Y,G){return Y=Ra(Y,G),Y.index=0,Y.sibling=null,Y}function h(Y,G,J){return Y.index=J,e?(J=Y.alternate,J!==null?(J=J.index,J<G?(Y.flags|=67108866,G):J):(Y.flags|=67108866,G)):(Y.flags|=1048576,G)}function v(Y){return e&&Y.alternate===null&&(Y.flags|=67108866),Y}function C(Y,G,J,le){return G===null||G.tag!==6?(G=Xr(J,Y.mode,le),G.return=Y,G):(G=c(G,J),G.return=Y,G)}function B(Y,G,J,le){var Ae=J.type;return Ae===O?se(Y,G,J.props.children,le,J.key):G!==null&&(G.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===te&&Ri(Ae)===G.type)?(G=c(G,J.props),cn(G,J),G.return=Y,G):(G=nl(J.type,J.key,J.props,null,Y.mode,le),cn(G,J),G.return=Y,G)}function Z(Y,G,J,le){return G===null||G.tag!==4||G.stateNode.containerInfo!==J.containerInfo||G.stateNode.implementation!==J.implementation?(G=Jr(J,Y.mode,le),G.return=Y,G):(G=c(G,J.children||[]),G.return=Y,G)}function se(Y,G,J,le,Ae){return G===null||G.tag!==7?(G=zi(J,Y.mode,le,Ae),G.return=Y,G):(G=c(G,J),G.return=Y,G)}function re(Y,G,J){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return G=Xr(""+G,Y.mode,J),G.return=Y,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case S:return J=nl(G.type,G.key,G.props,null,Y.mode,J),cn(J,G),J.return=Y,J;case N:return G=Jr(G,Y.mode,J),G.return=Y,G;case te:return G=Ri(G),re(Y,G,J)}if(H(G)||ie(G))return G=zi(G,Y.mode,J,null),G.return=Y,G;if(typeof G.then=="function")return re(Y,hl(G),J);if(G.$$typeof===j)return re(Y,ol(Y,G),J);ml(Y,G)}return null}function W(Y,G,J,le){var Ae=G!==null?G.key:null;if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return Ae!==null?null:C(Y,G,""+J,le);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case S:return J.key===Ae?B(Y,G,J,le):null;case N:return J.key===Ae?Z(Y,G,J,le):null;case te:return J=Ri(J),W(Y,G,J,le)}if(H(J)||ie(J))return Ae!==null?null:se(Y,G,J,le,null);if(typeof J.then=="function")return W(Y,G,hl(J),le);if(J.$$typeof===j)return W(Y,G,ol(Y,J),le);ml(Y,J)}return null}function ae(Y,G,J,le,Ae){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return Y=Y.get(J)||null,C(G,Y,""+le,Ae);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case S:return Y=Y.get(le.key===null?J:le.key)||null,B(G,Y,le,Ae);case N:return Y=Y.get(le.key===null?J:le.key)||null,Z(G,Y,le,Ae);case te:return le=Ri(le),ae(Y,G,J,le,Ae)}if(H(le)||ie(le))return Y=Y.get(J)||null,se(G,Y,le,Ae,null);if(typeof le.then=="function")return ae(Y,G,J,hl(le),Ae);if(le.$$typeof===j)return ae(Y,G,J,ol(G,le),Ae);ml(G,le)}return null}function ye(Y,G,J,le){for(var Ae=null,Qe=null,_e=G,Be=G=0,Ge=null;_e!==null&&Be<J.length;Be++){_e.index>Be?(Ge=_e,_e=null):Ge=_e.sibling;var Ke=W(Y,_e,J[Be],le);if(Ke===null){_e===null&&(_e=Ge);break}e&&_e&&Ke.alternate===null&&t(Y,_e),G=h(Ke,G,Be),Qe===null?Ae=Ke:Qe.sibling=Ke,Qe=Ke,_e=Ge}if(Be===J.length)return i(Y,_e),Ye&&ka(Y,Be),Ae;if(_e===null){for(;Be<J.length;Be++)_e=re(Y,J[Be],le),_e!==null&&(G=h(_e,G,Be),Qe===null?Ae=_e:Qe.sibling=_e,Qe=_e);return Ye&&ka(Y,Be),Ae}for(_e=n(_e);Be<J.length;Be++)Ge=ae(_e,Y,Be,J[Be],le),Ge!==null&&(e&&Ge.alternate!==null&&_e.delete(Ge.key===null?Be:Ge.key),G=h(Ge,G,Be),Qe===null?Ae=Ge:Qe.sibling=Ge,Qe=Ge);return e&&_e.forEach(function(vi){return t(Y,vi)}),Ye&&ka(Y,Be),Ae}function Oe(Y,G,J,le){if(J==null)throw Error(r(151));for(var Ae=null,Qe=null,_e=G,Be=G=0,Ge=null,Ke=J.next();_e!==null&&!Ke.done;Be++,Ke=J.next()){_e.index>Be?(Ge=_e,_e=null):Ge=_e.sibling;var vi=W(Y,_e,Ke.value,le);if(vi===null){_e===null&&(_e=Ge);break}e&&_e&&vi.alternate===null&&t(Y,_e),G=h(vi,G,Be),Qe===null?Ae=vi:Qe.sibling=vi,Qe=vi,_e=Ge}if(Ke.done)return i(Y,_e),Ye&&ka(Y,Be),Ae;if(_e===null){for(;!Ke.done;Be++,Ke=J.next())Ke=re(Y,Ke.value,le),Ke!==null&&(G=h(Ke,G,Be),Qe===null?Ae=Ke:Qe.sibling=Ke,Qe=Ke);return Ye&&ka(Y,Be),Ae}for(_e=n(_e);!Ke.done;Be++,Ke=J.next())Ke=ae(_e,Y,Be,Ke.value,le),Ke!==null&&(e&&Ke.alternate!==null&&_e.delete(Ke.key===null?Be:Ke.key),G=h(Ke,G,Be),Qe===null?Ae=Ke:Qe.sibling=Ke,Qe=Ke);return e&&_e.forEach(function(cb){return t(Y,cb)}),Ye&&ka(Y,Be),Ae}function it(Y,G,J,le){if(typeof J=="object"&&J!==null&&J.type===O&&J.key===null&&(J=J.props.children),typeof J=="object"&&J!==null){switch(J.$$typeof){case S:e:{for(var Ae=J.key;G!==null;){if(G.key===Ae){if(Ae=J.type,Ae===O){if(G.tag===7){i(Y,G.sibling),le=c(G,J.props.children),le.return=Y,Y=le;break e}}else if(G.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===te&&Ri(Ae)===G.type){i(Y,G.sibling),le=c(G,J.props),cn(le,J),le.return=Y,Y=le;break e}i(Y,G);break}else t(Y,G);G=G.sibling}J.type===O?(le=zi(J.props.children,Y.mode,le,J.key),le.return=Y,Y=le):(le=nl(J.type,J.key,J.props,null,Y.mode,le),cn(le,J),le.return=Y,Y=le)}return v(Y);case N:e:{for(Ae=J.key;G!==null;){if(G.key===Ae)if(G.tag===4&&G.stateNode.containerInfo===J.containerInfo&&G.stateNode.implementation===J.implementation){i(Y,G.sibling),le=c(G,J.children||[]),le.return=Y,Y=le;break e}else{i(Y,G);break}else t(Y,G);G=G.sibling}le=Jr(J,Y.mode,le),le.return=Y,Y=le}return v(Y);case te:return J=Ri(J),it(Y,G,J,le)}if(H(J))return ye(Y,G,J,le);if(ie(J)){if(Ae=ie(J),typeof Ae!="function")throw Error(r(150));return J=Ae.call(J),Oe(Y,G,J,le)}if(typeof J.then=="function")return it(Y,G,hl(J),le);if(J.$$typeof===j)return it(Y,G,ol(Y,J),le);ml(Y,J)}return typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint"?(J=""+J,G!==null&&G.tag===6?(i(Y,G.sibling),le=c(G,J),le.return=Y,Y=le):(i(Y,G),le=Xr(J,Y.mode,le),le.return=Y,Y=le),v(Y)):i(Y,G)}return function(Y,G,J,le){try{on=0;var Ae=it(Y,G,J,le);return xs=null,Ae}catch(_e){if(_e===gs||_e===dl)throw _e;var Qe=Xt(29,_e,null,Y.mode);return Qe.lanes=le,Qe.return=Y,Qe}finally{}}}var Mi=Au(!0),Du=Au(!1),ai=!1;function co(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ii(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function si(e,t,i){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Xe&2)!==0){var c=n.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),n.pending=t,t=sl(e),fu(e,null,i),t}return il(e,n,t,i),sl(e)}function dn(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,Nd(e,i)}}function ho(e,t){var i=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var c=null,h=null;if(i=i.firstBaseUpdate,i!==null){do{var v={lane:i.lane,tag:i.tag,payload:i.payload,callback:null,next:null};h===null?c=h=v:h=h.next=v,i=i.next}while(i!==null);h===null?c=h=t:h=h.next=t}else c=h=t;i={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:h,shared:n.shared,callbacks:n.callbacks},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}var mo=!1;function un(){if(mo){var e=ps;if(e!==null)throw e}}function hn(e,t,i,n){mo=!1;var c=e.updateQueue;ai=!1;var h=c.firstBaseUpdate,v=c.lastBaseUpdate,C=c.shared.pending;if(C!==null){c.shared.pending=null;var B=C,Z=B.next;B.next=null,v===null?h=Z:v.next=Z,v=B;var se=e.alternate;se!==null&&(se=se.updateQueue,C=se.lastBaseUpdate,C!==v&&(C===null?se.firstBaseUpdate=Z:C.next=Z,se.lastBaseUpdate=B))}if(h!==null){var re=c.baseState;v=0,se=Z=B=null,C=h;do{var W=C.lane&-536870913,ae=W!==C.lane;if(ae?(He&W)===W:(n&W)===W){W!==0&&W===fs&&(mo=!0),se!==null&&(se=se.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});e:{var ye=e,Oe=C;W=t;var it=i;switch(Oe.tag){case 1:if(ye=Oe.payload,typeof ye=="function"){re=ye.call(it,re,W);break e}re=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=Oe.payload,W=typeof ye=="function"?ye.call(it,re,W):ye,W==null)break e;re=p({},re,W);break e;case 2:ai=!0}}W=C.callback,W!==null&&(e.flags|=64,ae&&(e.flags|=8192),ae=c.callbacks,ae===null?c.callbacks=[W]:ae.push(W))}else ae={lane:W,tag:C.tag,payload:C.payload,callback:C.callback,next:null},se===null?(Z=se=ae,B=re):se=se.next=ae,v|=W;if(C=C.next,C===null){if(C=c.shared.pending,C===null)break;ae=C,C=ae.next,ae.next=null,c.lastBaseUpdate=ae,c.shared.pending=null}}while(!0);se===null&&(B=re),c.baseState=B,c.firstBaseUpdate=Z,c.lastBaseUpdate=se,h===null&&(c.shared.lanes=0),ci|=v,e.lanes=v,e.memoizedState=re}}function Ou(e,t){if(typeof e!="function")throw Error(r(191,e));e.call(t)}function Ru(e,t){var i=e.callbacks;if(i!==null)for(e.callbacks=null,e=0;e<i.length;e++)Ou(i[e],t)}var bs=w(null),fl=w(0);function ku(e,t){e=Ga,I(fl,e),I(bs,t),Ga=e|t.baseLanes}function fo(){I(fl,Ga),I(bs,bs.current)}function po(){Ga=fl.current,A(bs),A(fl)}var Jt=w(null),ma=null;function ni(e){var t=e.alternate;I(gt,gt.current&1),I(Jt,e),ma===null&&(t===null||bs.current!==null||t.memoizedState!==null)&&(ma=e)}function go(e){I(gt,gt.current),I(Jt,e),ma===null&&(ma=e)}function Mu(e){e.tag===22?(I(gt,gt.current),I(Jt,e),ma===null&&(ma=e)):li()}function li(){I(gt,gt.current),I(Jt,Jt.current)}function Zt(e){A(Jt),ma===e&&(ma=null),A(gt)}var gt=w(0);function pl(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||Nc(i)||_c(i)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Fa=0,Le=null,tt=null,vt=null,gl=!1,vs=!1,Ui=!1,xl=0,mn=0,ys=null,Wg=0;function mt(){throw Error(r(321))}function xo(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Kt(e[i],t[i]))return!1;return!0}function bo(e,t,i,n,c,h){return Fa=h,Le=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,U.H=e===null||e.memoizedState===null?bh:Ro,Ui=!1,h=i(n,c),Ui=!1,vs&&(h=Fu(t,i,n,c)),Uu(e),h}function Uu(e){U.H=gn;var t=tt!==null&&tt.next!==null;if(Fa=0,vt=tt=Le=null,gl=!1,mn=0,ys=null,t)throw Error(r(300));e===null||yt||(e=e.dependencies,e!==null&&rl(e)&&(yt=!0))}function Fu(e,t,i,n){Le=e;var c=0;do{if(vs&&(ys=null),mn=0,vs=!1,25<=c)throw Error(r(301));if(c+=1,vt=tt=null,e.updateQueue!=null){var h=e.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}U.H=vh,h=t(i,n)}while(vs);return h}function ex(){var e=U.H,t=e.useState()[0];return t=typeof t.then=="function"?fn(t):t,e=e.useState()[0],(tt!==null?tt.memoizedState:null)!==e&&(Le.flags|=1024),t}function vo(){var e=xl!==0;return xl=0,e}function yo(e,t,i){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i}function jo(e){if(gl){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}gl=!1}Fa=0,vt=tt=Le=null,vs=!1,mn=xl=0,ys=null}function $t(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?Le.memoizedState=vt=e:vt=vt.next=e,vt}function xt(){if(tt===null){var e=Le.alternate;e=e!==null?e.memoizedState:null}else e=tt.next;var t=vt===null?Le.memoizedState:vt.next;if(t!==null)vt=t,tt=e;else{if(e===null)throw Le.alternate===null?Error(r(467)):Error(r(310));tt=e,e={memoizedState:tt.memoizedState,baseState:tt.baseState,baseQueue:tt.baseQueue,queue:tt.queue,next:null},vt===null?Le.memoizedState=vt=e:vt=vt.next=e}return vt}function bl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function fn(e){var t=mn;return mn+=1,ys===null&&(ys=[]),e=Eu(ys,e,t),t=Le,(vt===null?t.memoizedState:vt.next)===null&&(t=t.alternate,U.H=t===null||t.memoizedState===null?bh:Ro),e}function vl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return fn(e);if(e.$$typeof===j)return Ot(e)}throw Error(r(438,String(e)))}function No(e){var t=null,i=Le.updateQueue;if(i!==null&&(t=i.memoCache),t==null){var n=Le.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),i===null&&(i=bl(),Le.updateQueue=i),i.memoCache=t,i=t.data[t.index],i===void 0)for(i=t.data[t.index]=Array(e),n=0;n<e;n++)i[n]=de;return t.index++,i}function La(e,t){return typeof t=="function"?t(e):t}function yl(e){var t=xt();return _o(t,tt,e)}function _o(e,t,i){var n=e.queue;if(n===null)throw Error(r(311));n.lastRenderedReducer=i;var c=e.baseQueue,h=n.pending;if(h!==null){if(c!==null){var v=c.next;c.next=h.next,h.next=v}t.baseQueue=c=h,n.pending=null}if(h=e.baseState,c===null)e.memoizedState=h;else{t=c.next;var C=v=null,B=null,Z=t,se=!1;do{var re=Z.lane&-536870913;if(re!==Z.lane?(He&re)===re:(Fa&re)===re){var W=Z.revertLane;if(W===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),re===fs&&(se=!0);else if((Fa&W)===W){Z=Z.next,W===fs&&(se=!0);continue}else re={lane:0,revertLane:Z.revertLane,gesture:null,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},B===null?(C=B=re,v=h):B=B.next=re,Le.lanes|=W,ci|=W;re=Z.action,Ui&&i(h,re),h=Z.hasEagerState?Z.eagerState:i(h,re)}else W={lane:re,revertLane:Z.revertLane,gesture:Z.gesture,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},B===null?(C=B=W,v=h):B=B.next=W,Le.lanes|=re,ci|=re;Z=Z.next}while(Z!==null&&Z!==t);if(B===null?v=h:B.next=C,!Kt(h,e.memoizedState)&&(yt=!0,se&&(i=ps,i!==null)))throw i;e.memoizedState=h,e.baseState=v,e.baseQueue=B,n.lastRenderedState=h}return c===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function wo(e){var t=xt(),i=t.queue;if(i===null)throw Error(r(311));i.lastRenderedReducer=e;var n=i.dispatch,c=i.pending,h=t.memoizedState;if(c!==null){i.pending=null;var v=c=c.next;do h=e(h,v.action),v=v.next;while(v!==c);Kt(h,t.memoizedState)||(yt=!0),t.memoizedState=h,t.baseQueue===null&&(t.baseState=h),i.lastRenderedState=h}return[h,n]}function Lu(e,t,i){var n=Le,c=xt(),h=Ye;if(h){if(i===void 0)throw Error(r(407));i=i()}else i=t();var v=!Kt((tt||c).memoizedState,i);if(v&&(c.memoizedState=i,yt=!0),c=c.queue,Eo(Iu.bind(null,n,c,e),[e]),c.getSnapshot!==t||v||vt!==null&&vt.memoizedState.tag&1){if(n.flags|=2048,js(9,{destroy:void 0},Bu.bind(null,n,c,i,t),null),st===null)throw Error(r(349));h||(Fa&127)!==0||$u(n,t,i)}return i}function $u(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Le.updateQueue,t===null?(t=bl(),Le.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function Bu(e,t,i,n){t.value=i,t.getSnapshot=n,qu(t)&&Pu(e)}function Iu(e,t,i){return i(function(){qu(t)&&Pu(e)})}function qu(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Kt(e,i)}catch{return!0}}function Pu(e){var t=Ei(e,2);t!==null&&Vt(t,e,2)}function So(e){var t=$t();if(typeof e=="function"){var i=e;if(e=i(),Ui){ht(!0);try{i()}finally{ht(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:La,lastRenderedState:e},t}function Hu(e,t,i,n){return e.baseState=i,_o(e,tt,typeof n=="function"?n:La)}function tx(e,t,i,n,c){if(_l(e))throw Error(r(485));if(e=t.action,e!==null){var h={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){h.listeners.push(v)}};U.T!==null?i(!0):h.isTransition=!1,n(h),i=t.pending,i===null?(h.next=t.pending=h,Gu(t,h)):(h.next=i.next,t.pending=i.next=h)}}function Gu(e,t){var i=t.action,n=t.payload,c=e.state;if(t.isTransition){var h=U.T,v={};U.T=v;try{var C=i(c,n),B=U.S;B!==null&&B(v,C),Vu(e,t,C)}catch(Z){Co(e,t,Z)}finally{h!==null&&v.types!==null&&(h.types=v.types),U.T=h}}else try{h=i(c,n),Vu(e,t,h)}catch(Z){Co(e,t,Z)}}function Vu(e,t,i){i!==null&&typeof i=="object"&&typeof i.then=="function"?i.then(function(n){Yu(e,t,n)},function(n){return Co(e,t,n)}):Yu(e,t,i)}function Yu(e,t,i){t.status="fulfilled",t.value=i,Qu(t),e.state=i,t=e.pending,t!==null&&(i=t.next,i===t?e.pending=null:(i=i.next,t.next=i,Gu(e,i)))}function Co(e,t,i){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=i,Qu(t),t=t.next;while(t!==n)}e.action=null}function Qu(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Ku(e,t){return t}function Xu(e,t){if(Ye){var i=st.formState;if(i!==null){e:{var n=Le;if(Ye){if(ot){t:{for(var c=ot,h=ha;c.nodeType!==8;){if(!h){c=null;break t}if(c=fa(c.nextSibling),c===null){c=null;break t}}h=c.data,c=h==="F!"||h==="F"?c:null}if(c){ot=fa(c.nextSibling),n=c.data==="F!";break e}}ei(n)}n=!1}n&&(t=i[0])}}return i=$t(),i.memoizedState=i.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ku,lastRenderedState:t},i.queue=n,i=ph.bind(null,Le,n),n.dispatch=i,n=So(!1),h=Oo.bind(null,Le,!1,n.queue),n=$t(),c={state:t,dispatch:null,action:e,pending:null},n.queue=c,i=tx.bind(null,Le,c,h,i),c.dispatch=i,n.memoizedState=e,[t,i,!1]}function Ju(e){var t=xt();return Zu(t,tt,e)}function Zu(e,t,i){if(t=_o(e,t,Ku)[0],e=yl(La)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=fn(t)}catch(v){throw v===gs?dl:v}else n=t;t=xt();var c=t.queue,h=c.dispatch;return i!==t.memoizedState&&(Le.flags|=2048,js(9,{destroy:void 0},ax.bind(null,c,i),null)),[n,h,e]}function ax(e,t){e.action=t}function Wu(e){var t=xt(),i=tt;if(i!==null)return Zu(t,i,e);xt(),t=t.memoizedState,i=xt();var n=i.queue.dispatch;return i.memoizedState=e,[t,n,!1]}function js(e,t,i,n){return e={tag:e,create:i,deps:n,inst:t,next:null},t=Le.updateQueue,t===null&&(t=bl(),Le.updateQueue=t),i=t.lastEffect,i===null?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function eh(){return xt().memoizedState}function jl(e,t,i,n){var c=$t();Le.flags|=e,c.memoizedState=js(1|t,{destroy:void 0},i,n===void 0?null:n)}function Nl(e,t,i,n){var c=xt();n=n===void 0?null:n;var h=c.memoizedState.inst;tt!==null&&n!==null&&xo(n,tt.memoizedState.deps)?c.memoizedState=js(t,h,i,n):(Le.flags|=e,c.memoizedState=js(1|t,h,i,n))}function th(e,t){jl(8390656,8,e,t)}function Eo(e,t){Nl(2048,8,e,t)}function ix(e){Le.flags|=4;var t=Le.updateQueue;if(t===null)t=bl(),Le.updateQueue=t,t.events=[e];else{var i=t.events;i===null?t.events=[e]:i.push(e)}}function ah(e){var t=xt().memoizedState;return ix({ref:t,nextImpl:e}),function(){if((Xe&2)!==0)throw Error(r(440));return t.impl.apply(void 0,arguments)}}function ih(e,t){return Nl(4,2,e,t)}function sh(e,t){return Nl(4,4,e,t)}function nh(e,t){if(typeof t=="function"){e=e();var i=t(e);return function(){typeof i=="function"?i():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function lh(e,t,i){i=i!=null?i.concat([e]):null,Nl(4,4,nh.bind(null,t,e),i)}function zo(){}function rh(e,t){var i=xt();t=t===void 0?null:t;var n=i.memoizedState;return t!==null&&xo(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function oh(e,t){var i=xt();t=t===void 0?null:t;var n=i.memoizedState;if(t!==null&&xo(t,n[1]))return n[0];if(n=e(),Ui){ht(!0);try{e()}finally{ht(!1)}}return i.memoizedState=[n,t],n}function To(e,t,i){return i===void 0||(Fa&1073741824)!==0&&(He&261930)===0?e.memoizedState=t:(e.memoizedState=i,e=cm(),Le.lanes|=e,ci|=e,i)}function ch(e,t,i,n){return Kt(i,t)?i:bs.current!==null?(e=To(e,i,n),Kt(e,t)||(yt=!0),e):(Fa&42)===0||(Fa&1073741824)!==0&&(He&261930)===0?(yt=!0,e.memoizedState=i):(e=cm(),Le.lanes|=e,ci|=e,t)}function dh(e,t,i,n,c){var h=D.p;D.p=h!==0&&8>h?h:8;var v=U.T,C={};U.T=C,Oo(e,!1,t,i);try{var B=c(),Z=U.S;if(Z!==null&&Z(C,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var se=Zg(B,n);pn(e,t,se,ta(e))}else pn(e,t,n,ta(e))}catch(re){pn(e,t,{then:function(){},status:"rejected",reason:re},ta())}finally{D.p=h,v!==null&&C.types!==null&&(v.types=C.types),U.T=v}}function sx(){}function Ao(e,t,i,n){if(e.tag!==5)throw Error(r(476));var c=uh(e).queue;dh(e,c,t,R,i===null?sx:function(){return hh(e),i(n)})}function uh(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:R,baseState:R,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:La,lastRenderedState:R},next:null};var i={};return t.next={memoizedState:i,baseState:i,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:La,lastRenderedState:i},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function hh(e){var t=uh(e);t.next===null&&(t=e.alternate.memoizedState),pn(e,t.next.queue,{},ta())}function Do(){return Ot(On)}function mh(){return xt().memoizedState}function fh(){return xt().memoizedState}function nx(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var i=ta();e=ii(i);var n=si(t,e,i);n!==null&&(Vt(n,t,i),dn(n,t,i)),t={cache:no()},e.payload=t;return}t=t.return}}function lx(e,t,i){var n=ta();i={lane:n,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},_l(e)?gh(t,i):(i=Qr(e,t,i,n),i!==null&&(Vt(i,e,n),xh(i,t,n)))}function ph(e,t,i){var n=ta();pn(e,t,i,n)}function pn(e,t,i,n){var c={lane:n,revertLane:0,gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null};if(_l(e))gh(t,c);else{var h=e.alternate;if(e.lanes===0&&(h===null||h.lanes===0)&&(h=t.lastRenderedReducer,h!==null))try{var v=t.lastRenderedState,C=h(v,i);if(c.hasEagerState=!0,c.eagerState=C,Kt(C,v))return il(e,t,c,0),st===null&&al(),!1}catch{}finally{}if(i=Qr(e,t,c,n),i!==null)return Vt(i,e,n),xh(i,t,n),!0}return!1}function Oo(e,t,i,n){if(n={lane:2,revertLane:dc(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},_l(e)){if(t)throw Error(r(479))}else t=Qr(e,i,n,2),t!==null&&Vt(t,e,2)}function _l(e){var t=e.alternate;return e===Le||t!==null&&t===Le}function gh(e,t){vs=gl=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function xh(e,t,i){if((i&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,Nd(e,i)}}var gn={readContext:Ot,use:vl,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useLayoutEffect:mt,useInsertionEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useSyncExternalStore:mt,useId:mt,useHostTransitionStatus:mt,useFormState:mt,useActionState:mt,useOptimistic:mt,useMemoCache:mt,useCacheRefresh:mt};gn.useEffectEvent=mt;var bh={readContext:Ot,use:vl,useCallback:function(e,t){return $t().memoizedState=[e,t===void 0?null:t],e},useContext:Ot,useEffect:th,useImperativeHandle:function(e,t,i){i=i!=null?i.concat([e]):null,jl(4194308,4,nh.bind(null,t,e),i)},useLayoutEffect:function(e,t){return jl(4194308,4,e,t)},useInsertionEffect:function(e,t){jl(4,2,e,t)},useMemo:function(e,t){var i=$t();t=t===void 0?null:t;var n=e();if(Ui){ht(!0);try{e()}finally{ht(!1)}}return i.memoizedState=[n,t],n},useReducer:function(e,t,i){var n=$t();if(i!==void 0){var c=i(t);if(Ui){ht(!0);try{i(t)}finally{ht(!1)}}}else c=t;return n.memoizedState=n.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},n.queue=e,e=e.dispatch=lx.bind(null,Le,e),[n.memoizedState,e]},useRef:function(e){var t=$t();return e={current:e},t.memoizedState=e},useState:function(e){e=So(e);var t=e.queue,i=ph.bind(null,Le,t);return t.dispatch=i,[e.memoizedState,i]},useDebugValue:zo,useDeferredValue:function(e,t){var i=$t();return To(i,e,t)},useTransition:function(){var e=So(!1);return e=dh.bind(null,Le,e.queue,!0,!1),$t().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,i){var n=Le,c=$t();if(Ye){if(i===void 0)throw Error(r(407));i=i()}else{if(i=t(),st===null)throw Error(r(349));(He&127)!==0||$u(n,t,i)}c.memoizedState=i;var h={value:i,getSnapshot:t};return c.queue=h,th(Iu.bind(null,n,h,e),[e]),n.flags|=2048,js(9,{destroy:void 0},Bu.bind(null,n,h,i,t),null),i},useId:function(){var e=$t(),t=st.identifierPrefix;if(Ye){var i=Ea,n=Ca;i=(n&~(1<<32-xe(n)-1)).toString(32)+i,t="_"+t+"R_"+i,i=xl++,0<i&&(t+="H"+i.toString(32)),t+="_"}else i=Wg++,t="_"+t+"r_"+i.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:Do,useFormState:Xu,useActionState:Xu,useOptimistic:function(e){var t=$t();t.memoizedState=t.baseState=e;var i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=i,t=Oo.bind(null,Le,!0,i),i.dispatch=t,[e,t]},useMemoCache:No,useCacheRefresh:function(){return $t().memoizedState=nx.bind(null,Le)},useEffectEvent:function(e){var t=$t(),i={impl:e};return t.memoizedState=i,function(){if((Xe&2)!==0)throw Error(r(440));return i.impl.apply(void 0,arguments)}}},Ro={readContext:Ot,use:vl,useCallback:rh,useContext:Ot,useEffect:Eo,useImperativeHandle:lh,useInsertionEffect:ih,useLayoutEffect:sh,useMemo:oh,useReducer:yl,useRef:eh,useState:function(){return yl(La)},useDebugValue:zo,useDeferredValue:function(e,t){var i=xt();return ch(i,tt.memoizedState,e,t)},useTransition:function(){var e=yl(La)[0],t=xt().memoizedState;return[typeof e=="boolean"?e:fn(e),t]},useSyncExternalStore:Lu,useId:mh,useHostTransitionStatus:Do,useFormState:Ju,useActionState:Ju,useOptimistic:function(e,t){var i=xt();return Hu(i,tt,e,t)},useMemoCache:No,useCacheRefresh:fh};Ro.useEffectEvent=ah;var vh={readContext:Ot,use:vl,useCallback:rh,useContext:Ot,useEffect:Eo,useImperativeHandle:lh,useInsertionEffect:ih,useLayoutEffect:sh,useMemo:oh,useReducer:wo,useRef:eh,useState:function(){return wo(La)},useDebugValue:zo,useDeferredValue:function(e,t){var i=xt();return tt===null?To(i,e,t):ch(i,tt.memoizedState,e,t)},useTransition:function(){var e=wo(La)[0],t=xt().memoizedState;return[typeof e=="boolean"?e:fn(e),t]},useSyncExternalStore:Lu,useId:mh,useHostTransitionStatus:Do,useFormState:Wu,useActionState:Wu,useOptimistic:function(e,t){var i=xt();return tt!==null?Hu(i,tt,e,t):(i.baseState=e,[e,i.queue.dispatch])},useMemoCache:No,useCacheRefresh:fh};vh.useEffectEvent=ah;function ko(e,t,i,n){t=e.memoizedState,i=i(n,t),i=i==null?t:p({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Mo={enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ta(),c=ii(n);c.payload=t,i!=null&&(c.callback=i),t=si(e,c,n),t!==null&&(Vt(t,e,n),dn(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ta(),c=ii(n);c.tag=1,c.payload=t,i!=null&&(c.callback=i),t=si(e,c,n),t!==null&&(Vt(t,e,n),dn(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ta(),n=ii(i);n.tag=2,t!=null&&(n.callback=t),t=si(e,n,i),t!==null&&(Vt(t,e,i),dn(t,e,i))}};function yh(e,t,i,n,c,h,v){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,h,v):t.prototype&&t.prototype.isPureReactComponent?!tn(i,n)||!tn(c,h):!0}function jh(e,t,i,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Mo.enqueueReplaceState(t,t.state,null)}function Fi(e,t){var i=t;if("ref"in t){i={};for(var n in t)n!=="ref"&&(i[n]=t[n])}if(e=e.defaultProps){i===t&&(i=p({},i));for(var c in e)i[c]===void 0&&(i[c]=e[c])}return i}function Nh(e){tl(e)}function _h(e){console.error(e)}function wh(e){tl(e)}function wl(e,t){try{var i=e.onUncaughtError;i(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Sh(e,t,i){try{var n=e.onCaughtError;n(i.value,{componentStack:i.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Uo(e,t,i){return i=ii(i),i.tag=3,i.payload={element:null},i.callback=function(){wl(e,t)},i}function Ch(e){return e=ii(e),e.tag=3,e}function Eh(e,t,i,n){var c=i.type.getDerivedStateFromError;if(typeof c=="function"){var h=n.value;e.payload=function(){return c(h)},e.callback=function(){Sh(t,i,n)}}var v=i.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(e.callback=function(){Sh(t,i,n),typeof c!="function"&&(di===null?di=new Set([this]):di.add(this));var C=n.stack;this.componentDidCatch(n.value,{componentStack:C!==null?C:""})})}function rx(e,t,i,n,c){if(i.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=i.alternate,t!==null&&ms(t,i,c,!0),i=Jt.current,i!==null){switch(i.tag){case 31:case 13:return ma===null?Ul():i.alternate===null&&ft===0&&(ft=3),i.flags&=-257,i.flags|=65536,i.lanes=c,n===ul?i.flags|=16384:(t=i.updateQueue,t===null?i.updateQueue=new Set([n]):t.add(n),rc(e,n,c)),!1;case 22:return i.flags|=65536,n===ul?i.flags|=16384:(t=i.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},i.updateQueue=t):(i=t.retryQueue,i===null?t.retryQueue=new Set([n]):i.add(n)),rc(e,n,c)),!1}throw Error(r(435,i.tag))}return rc(e,n,c),Ul(),!1}if(Ye)return t=Jt.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,n!==eo&&(e=Error(r(422),{cause:n}),nn(ca(e,i)))):(n!==eo&&(t=Error(r(423),{cause:n}),nn(ca(t,i))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,n=ca(n,i),c=Uo(e.stateNode,n,c),ho(e,c),ft!==4&&(ft=2)),!1;var h=Error(r(520),{cause:n});if(h=ca(h,i),wn===null?wn=[h]:wn.push(h),ft!==4&&(ft=2),t===null)return!0;n=ca(n,i),i=t;do{switch(i.tag){case 3:return i.flags|=65536,e=c&-c,i.lanes|=e,e=Uo(i.stateNode,n,e),ho(i,e),!1;case 1:if(t=i.type,h=i.stateNode,(i.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(di===null||!di.has(h))))return i.flags|=65536,c&=-c,i.lanes|=c,c=Ch(c),Eh(c,e,i,n),ho(i,c),!1}i=i.return}while(i!==null);return!1}var Fo=Error(r(461)),yt=!1;function Rt(e,t,i,n){t.child=e===null?Du(t,null,i,n):Mi(t,e.child,i,n)}function zh(e,t,i,n,c){i=i.render;var h=t.ref;if("ref"in n){var v={};for(var C in n)C!=="ref"&&(v[C]=n[C])}else v=n;return Di(t),n=bo(e,t,i,v,h,c),C=vo(),e!==null&&!yt?(yo(e,t,c),$a(e,t,c)):(Ye&&C&&Zr(t),t.flags|=1,Rt(e,t,n,c),t.child)}function Th(e,t,i,n,c){if(e===null){var h=i.type;return typeof h=="function"&&!Kr(h)&&h.defaultProps===void 0&&i.compare===null?(t.tag=15,t.type=h,Ah(e,t,h,n,c)):(e=nl(i.type,null,n,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(h=e.child,!Go(e,c)){var v=h.memoizedProps;if(i=i.compare,i=i!==null?i:tn,i(v,n)&&e.ref===t.ref)return $a(e,t,c)}return t.flags|=1,e=Ra(h,n),e.ref=t.ref,e.return=t,t.child=e}function Ah(e,t,i,n,c){if(e!==null){var h=e.memoizedProps;if(tn(h,n)&&e.ref===t.ref)if(yt=!1,t.pendingProps=n=h,Go(e,c))(e.flags&131072)!==0&&(yt=!0);else return t.lanes=e.lanes,$a(e,t,c)}return Lo(e,t,i,n,c)}function Dh(e,t,i,n){var c=n.children,h=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((t.flags&128)!==0){if(h=h!==null?h.baseLanes|i:i,e!==null){for(n=t.child=e.child,c=0;n!==null;)c=c|n.lanes|n.childLanes,n=n.sibling;n=c&~h}else n=0,t.child=null;return Oh(e,t,h,i,n)}if((i&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&cl(t,h!==null?h.cachePool:null),h!==null?ku(t,h):fo(),Mu(t);else return n=t.lanes=536870912,Oh(e,t,h!==null?h.baseLanes|i:i,i,n)}else h!==null?(cl(t,h.cachePool),ku(t,h),li(),t.memoizedState=null):(e!==null&&cl(t,null),fo(),li());return Rt(e,t,c,i),t.child}function xn(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Oh(e,t,i,n,c){var h=ro();return h=h===null?null:{parent:bt._currentValue,pool:h},t.memoizedState={baseLanes:i,cachePool:h},e!==null&&cl(t,null),fo(),Mu(t),e!==null&&ms(e,t,n,!0),t.childLanes=c,null}function Sl(e,t){return t=El({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function Rh(e,t,i){return Mi(t,e.child,null,i),e=Sl(t,t.pendingProps),e.flags|=2,Zt(t),t.memoizedState=null,e}function ox(e,t,i){var n=t.pendingProps,c=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(Ye){if(n.mode==="hidden")return e=Sl(t,n),t.lanes=536870912,xn(null,e);if(go(t),(e=ot)?(e=Gm(e,ha),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Za!==null?{id:Ca,overflow:Ea}:null,retryLane:536870912,hydrationErrors:null},i=gu(e),i.return=t,t.child=i,Dt=t,ot=null)):e=null,e===null)throw ei(t);return t.lanes=536870912,null}return Sl(t,n)}var h=e.memoizedState;if(h!==null){var v=h.dehydrated;if(go(t),c)if(t.flags&256)t.flags&=-257,t=Rh(e,t,i);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(r(558));else if(yt||ms(e,t,i,!1),c=(i&e.childLanes)!==0,yt||c){if(n=st,n!==null&&(v=_d(n,i),v!==0&&v!==h.retryLane))throw h.retryLane=v,Ei(e,v),Vt(n,e,v),Fo;Ul(),t=Rh(e,t,i)}else e=h.treeContext,ot=fa(v.nextSibling),Dt=t,Ye=!0,Wa=null,ha=!1,e!==null&&vu(t,e),t=Sl(t,n),t.flags|=4096;return t}return e=Ra(e.child,{mode:n.mode,children:n.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Cl(e,t){var i=t.ref;if(i===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof i!="function"&&typeof i!="object")throw Error(r(284));(e===null||e.ref!==i)&&(t.flags|=4194816)}}function Lo(e,t,i,n,c){return Di(t),i=bo(e,t,i,n,void 0,c),n=vo(),e!==null&&!yt?(yo(e,t,c),$a(e,t,c)):(Ye&&n&&Zr(t),t.flags|=1,Rt(e,t,i,c),t.child)}function kh(e,t,i,n,c,h){return Di(t),t.updateQueue=null,i=Fu(t,n,i,c),Uu(e),n=vo(),e!==null&&!yt?(yo(e,t,h),$a(e,t,h)):(Ye&&n&&Zr(t),t.flags|=1,Rt(e,t,i,h),t.child)}function Mh(e,t,i,n,c){if(Di(t),t.stateNode===null){var h=cs,v=i.contextType;typeof v=="object"&&v!==null&&(h=Ot(v)),h=new i(n,h),t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=Mo,t.stateNode=h,h._reactInternals=t,h=t.stateNode,h.props=n,h.state=t.memoizedState,h.refs={},co(t),v=i.contextType,h.context=typeof v=="object"&&v!==null?Ot(v):cs,h.state=t.memoizedState,v=i.getDerivedStateFromProps,typeof v=="function"&&(ko(t,i,v,n),h.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(v=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),v!==h.state&&Mo.enqueueReplaceState(h,h.state,null),hn(t,n,h,c),un(),h.state=t.memoizedState),typeof h.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){h=t.stateNode;var C=t.memoizedProps,B=Fi(i,C);h.props=B;var Z=h.context,se=i.contextType;v=cs,typeof se=="object"&&se!==null&&(v=Ot(se));var re=i.getDerivedStateFromProps;se=typeof re=="function"||typeof h.getSnapshotBeforeUpdate=="function",C=t.pendingProps!==C,se||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(C||Z!==v)&&jh(t,h,n,v),ai=!1;var W=t.memoizedState;h.state=W,hn(t,n,h,c),un(),Z=t.memoizedState,C||W!==Z||ai?(typeof re=="function"&&(ko(t,i,re,n),Z=t.memoizedState),(B=ai||yh(t,i,B,n,W,Z,v))?(se||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(t.flags|=4194308)):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=Z),h.props=n,h.state=Z,h.context=v,n=B):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{h=t.stateNode,uo(e,t),v=t.memoizedProps,se=Fi(i,v),h.props=se,re=t.pendingProps,W=h.context,Z=i.contextType,B=cs,typeof Z=="object"&&Z!==null&&(B=Ot(Z)),C=i.getDerivedStateFromProps,(Z=typeof C=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(v!==re||W!==B)&&jh(t,h,n,B),ai=!1,W=t.memoizedState,h.state=W,hn(t,n,h,c),un();var ae=t.memoizedState;v!==re||W!==ae||ai||e!==null&&e.dependencies!==null&&rl(e.dependencies)?(typeof C=="function"&&(ko(t,i,C,n),ae=t.memoizedState),(se=ai||yh(t,i,se,n,W,ae,B)||e!==null&&e.dependencies!==null&&rl(e.dependencies))?(Z||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(n,ae,B),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(n,ae,B)),typeof h.componentDidUpdate=="function"&&(t.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&W===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&W===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=ae),h.props=n,h.state=ae,h.context=B,n=se):(typeof h.componentDidUpdate!="function"||v===e.memoizedProps&&W===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||v===e.memoizedProps&&W===e.memoizedState||(t.flags|=1024),n=!1)}return h=n,Cl(e,t),n=(t.flags&128)!==0,h||n?(h=t.stateNode,i=n&&typeof i.getDerivedStateFromError!="function"?null:h.render(),t.flags|=1,e!==null&&n?(t.child=Mi(t,e.child,null,c),t.child=Mi(t,null,i,c)):Rt(e,t,i,c),t.memoizedState=h.state,e=t.child):e=$a(e,t,c),e}function Uh(e,t,i,n){return Ti(),t.flags|=256,Rt(e,t,i,n),t.child}var $o={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bo(e){return{baseLanes:e,cachePool:Su()}}function Io(e,t,i){return e=e!==null?e.childLanes&~i:0,t&&(e|=ea),e}function Fh(e,t,i){var n=t.pendingProps,c=!1,h=(t.flags&128)!==0,v;if((v=h)||(v=e!==null&&e.memoizedState===null?!1:(gt.current&2)!==0),v&&(c=!0,t.flags&=-129),v=(t.flags&32)!==0,t.flags&=-33,e===null){if(Ye){if(c?ni(t):li(),(e=ot)?(e=Gm(e,ha),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Za!==null?{id:Ca,overflow:Ea}:null,retryLane:536870912,hydrationErrors:null},i=gu(e),i.return=t,t.child=i,Dt=t,ot=null)):e=null,e===null)throw ei(t);return _c(e)?t.lanes=32:t.lanes=536870912,null}var C=n.children;return n=n.fallback,c?(li(),c=t.mode,C=El({mode:"hidden",children:C},c),n=zi(n,c,i,null),C.return=t,n.return=t,C.sibling=n,t.child=C,n=t.child,n.memoizedState=Bo(i),n.childLanes=Io(e,v,i),t.memoizedState=$o,xn(null,n)):(ni(t),qo(t,C))}var B=e.memoizedState;if(B!==null&&(C=B.dehydrated,C!==null)){if(h)t.flags&256?(ni(t),t.flags&=-257,t=Po(e,t,i)):t.memoizedState!==null?(li(),t.child=e.child,t.flags|=128,t=null):(li(),C=n.fallback,c=t.mode,n=El({mode:"visible",children:n.children},c),C=zi(C,c,i,null),C.flags|=2,n.return=t,C.return=t,n.sibling=C,t.child=n,Mi(t,e.child,null,i),n=t.child,n.memoizedState=Bo(i),n.childLanes=Io(e,v,i),t.memoizedState=$o,t=xn(null,n));else if(ni(t),_c(C)){if(v=C.nextSibling&&C.nextSibling.dataset,v)var Z=v.dgst;v=Z,n=Error(r(419)),n.stack="",n.digest=v,nn({value:n,source:null,stack:null}),t=Po(e,t,i)}else if(yt||ms(e,t,i,!1),v=(i&e.childLanes)!==0,yt||v){if(v=st,v!==null&&(n=_d(v,i),n!==0&&n!==B.retryLane))throw B.retryLane=n,Ei(e,n),Vt(v,e,n),Fo;Nc(C)||Ul(),t=Po(e,t,i)}else Nc(C)?(t.flags|=192,t.child=e.child,t=null):(e=B.treeContext,ot=fa(C.nextSibling),Dt=t,Ye=!0,Wa=null,ha=!1,e!==null&&vu(t,e),t=qo(t,n.children),t.flags|=4096);return t}return c?(li(),C=n.fallback,c=t.mode,B=e.child,Z=B.sibling,n=Ra(B,{mode:"hidden",children:n.children}),n.subtreeFlags=B.subtreeFlags&65011712,Z!==null?C=Ra(Z,C):(C=zi(C,c,i,null),C.flags|=2),C.return=t,n.return=t,n.sibling=C,t.child=n,xn(null,n),n=t.child,C=e.child.memoizedState,C===null?C=Bo(i):(c=C.cachePool,c!==null?(B=bt._currentValue,c=c.parent!==B?{parent:B,pool:B}:c):c=Su(),C={baseLanes:C.baseLanes|i,cachePool:c}),n.memoizedState=C,n.childLanes=Io(e,v,i),t.memoizedState=$o,xn(e.child,n)):(ni(t),i=e.child,e=i.sibling,i=Ra(i,{mode:"visible",children:n.children}),i.return=t,i.sibling=null,e!==null&&(v=t.deletions,v===null?(t.deletions=[e],t.flags|=16):v.push(e)),t.child=i,t.memoizedState=null,i)}function qo(e,t){return t=El({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function El(e,t){return e=Xt(22,e,null,t),e.lanes=0,e}function Po(e,t,i){return Mi(t,e.child,null,i),e=qo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Lh(e,t,i){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),io(e.return,t,i)}function Ho(e,t,i,n,c,h){var v=e.memoizedState;v===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:c,treeForkCount:h}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=n,v.tail=i,v.tailMode=c,v.treeForkCount=h)}function $h(e,t,i){var n=t.pendingProps,c=n.revealOrder,h=n.tail;n=n.children;var v=gt.current,C=(v&2)!==0;if(C?(v=v&1|2,t.flags|=128):v&=1,I(gt,v),Rt(e,t,n,i),n=Ye?sn:0,!C&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Lh(e,i,t);else if(e.tag===19)Lh(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(i=t.child,c=null;i!==null;)e=i.alternate,e!==null&&pl(e)===null&&(c=i),i=i.sibling;i=c,i===null?(c=t.child,t.child=null):(c=i.sibling,i.sibling=null),Ho(t,!1,c,i,h,n);break;case"backwards":case"unstable_legacy-backwards":for(i=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&pl(e)===null){t.child=c;break}e=c.sibling,c.sibling=i,i=c,c=e}Ho(t,!0,i,null,h,n);break;case"together":Ho(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function $a(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),ci|=t.lanes,(i&t.childLanes)===0)if(e!==null){if(ms(e,t,i,!1),(i&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(r(153));if(t.child!==null){for(e=t.child,i=Ra(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Ra(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Go(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&rl(e)))}function cx(e,t,i){switch(t.tag){case 3:ke(t,t.stateNode.containerInfo),ti(t,bt,e.memoizedState.cache),Ti();break;case 27:case 5:St(t);break;case 4:ke(t,t.stateNode.containerInfo);break;case 10:ti(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,go(t),null;break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(ni(t),t.flags|=128,null):(i&t.child.childLanes)!==0?Fh(e,t,i):(ni(t),e=$a(e,t,i),e!==null?e.sibling:null);ni(t);break;case 19:var c=(e.flags&128)!==0;if(n=(i&t.childLanes)!==0,n||(ms(e,t,i,!1),n=(i&t.childLanes)!==0),c){if(n)return $h(e,t,i);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),I(gt,gt.current),n)break;return null;case 22:return t.lanes=0,Dh(e,t,i,t.pendingProps);case 24:ti(t,bt,e.memoizedState.cache)}return $a(e,t,i)}function Bh(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps)yt=!0;else{if(!Go(e,i)&&(t.flags&128)===0)return yt=!1,cx(e,t,i);yt=(e.flags&131072)!==0}else yt=!1,Ye&&(t.flags&1048576)!==0&&bu(t,sn,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=Ri(t.elementType),t.type=e,typeof e=="function")Kr(e)?(n=Fi(e,n),t.tag=1,t=Mh(null,t,e,n,i)):(t.tag=0,t=Lo(null,t,e,n,i));else{if(e!=null){var c=e.$$typeof;if(c===q){t.tag=11,t=zh(null,t,e,n,i);break e}else if(c===k){t.tag=14,t=Th(null,t,e,n,i);break e}}throw t=be(e)||e,Error(r(306,t,""))}}return t;case 0:return Lo(e,t,t.type,t.pendingProps,i);case 1:return n=t.type,c=Fi(n,t.pendingProps),Mh(e,t,n,c,i);case 3:e:{if(ke(t,t.stateNode.containerInfo),e===null)throw Error(r(387));n=t.pendingProps;var h=t.memoizedState;c=h.element,uo(e,t),hn(t,n,null,i);var v=t.memoizedState;if(n=v.cache,ti(t,bt,n),n!==h.cache&&so(t,[bt],i,!0),un(),n=v.element,h.isDehydrated)if(h={element:n,isDehydrated:!1,cache:v.cache},t.updateQueue.baseState=h,t.memoizedState=h,t.flags&256){t=Uh(e,t,n,i);break e}else if(n!==c){c=ca(Error(r(424)),t),nn(c),t=Uh(e,t,n,i);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(ot=fa(e.firstChild),Dt=t,Ye=!0,Wa=null,ha=!0,i=Du(t,null,n,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling}else{if(Ti(),n===c){t=$a(e,t,i);break e}Rt(e,t,n,i)}t=t.child}return t;case 26:return Cl(e,t),e===null?(i=Jm(t.type,null,t.pendingProps,null))?t.memoizedState=i:Ye||(i=t.type,e=t.pendingProps,n=Pl(ne.current).createElement(i),n[At]=t,n[Bt]=e,kt(n,i,e),zt(n),t.stateNode=n):t.memoizedState=Jm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return St(t),e===null&&Ye&&(n=t.stateNode=Qm(t.type,t.pendingProps,ne.current),Dt=t,ha=!0,c=ot,fi(t.type)?(wc=c,ot=fa(n.firstChild)):ot=c),Rt(e,t,t.pendingProps.children,i),Cl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Ye&&((c=n=ot)&&(n=$x(n,t.type,t.pendingProps,ha),n!==null?(t.stateNode=n,Dt=t,ot=fa(n.firstChild),ha=!1,c=!0):c=!1),c||ei(t)),St(t),c=t.type,h=t.pendingProps,v=e!==null?e.memoizedProps:null,n=h.children,vc(c,h)?n=null:v!==null&&vc(c,v)&&(t.flags|=32),t.memoizedState!==null&&(c=bo(e,t,ex,null,null,i),On._currentValue=c),Cl(e,t),Rt(e,t,n,i),t.child;case 6:return e===null&&Ye&&((e=i=ot)&&(i=Bx(i,t.pendingProps,ha),i!==null?(t.stateNode=i,Dt=t,ot=null,e=!0):e=!1),e||ei(t)),null;case 13:return Fh(e,t,i);case 4:return ke(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Mi(t,null,n,i):Rt(e,t,n,i),t.child;case 11:return zh(e,t,t.type,t.pendingProps,i);case 7:return Rt(e,t,t.pendingProps,i),t.child;case 8:return Rt(e,t,t.pendingProps.children,i),t.child;case 12:return Rt(e,t,t.pendingProps.children,i),t.child;case 10:return n=t.pendingProps,ti(t,t.type,n.value),Rt(e,t,n.children,i),t.child;case 9:return c=t.type._context,n=t.pendingProps.children,Di(t),c=Ot(c),n=n(c),t.flags|=1,Rt(e,t,n,i),t.child;case 14:return Th(e,t,t.type,t.pendingProps,i);case 15:return Ah(e,t,t.type,t.pendingProps,i);case 19:return $h(e,t,i);case 31:return ox(e,t,i);case 22:return Dh(e,t,i,t.pendingProps);case 24:return Di(t),n=Ot(bt),e===null?(c=ro(),c===null&&(c=st,h=no(),c.pooledCache=h,h.refCount++,h!==null&&(c.pooledCacheLanes|=i),c=h),t.memoizedState={parent:n,cache:c},co(t),ti(t,bt,c)):((e.lanes&i)!==0&&(uo(e,t),hn(t,null,null,i),un()),c=e.memoizedState,h=t.memoizedState,c.parent!==n?(c={parent:n,cache:n},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),ti(t,bt,n)):(n=h.cache,ti(t,bt,n),n!==c.cache&&so(t,[bt],i,!0))),Rt(e,t,t.pendingProps.children,i),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Ba(e){e.flags|=4}function Vo(e,t,i,n,c){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(mm())e.flags|=8192;else throw ki=ul,oo}else e.flags&=-16777217}function Ih(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!af(t))if(mm())e.flags|=8192;else throw ki=ul,oo}function zl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?yd():536870912,e.lanes|=t,Ss|=t)}function bn(e,t){if(!Ye)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ct(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,n=0;if(t)for(var c=e.child;c!==null;)i|=c.lanes|c.childLanes,n|=c.subtreeFlags&65011712,n|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)i|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function dx(e,t,i){var n=t.pendingProps;switch(Wr(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ct(t),null;case 1:return ct(t),null;case 3:return i=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Ua(bt),$e(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(hs(t)?Ba(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,to())),ct(t),null;case 26:var c=t.type,h=t.memoizedState;return e===null?(Ba(t),h!==null?(ct(t),Ih(t,h)):(ct(t),Vo(t,c,null,n,i))):h?h!==e.memoizedState?(Ba(t),ct(t),Ih(t,h)):(ct(t),t.flags&=-16777217):(e=e.memoizedProps,e!==n&&Ba(t),ct(t),Vo(t,c,e,n,i)),null;case 27:if(Q(t),i=ne.current,c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&Ba(t);else{if(!n){if(t.stateNode===null)throw Error(r(166));return ct(t),null}e=K.current,hs(t)?yu(t):(e=Qm(c,n,i),t.stateNode=e,Ba(t))}return ct(t),null;case 5:if(Q(t),c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&Ba(t);else{if(!n){if(t.stateNode===null)throw Error(r(166));return ct(t),null}if(h=K.current,hs(t))yu(t);else{var v=Pl(ne.current);switch(h){case 1:h=v.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:h=v.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":h=v.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":h=v.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":h=v.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof n.is=="string"?v.createElement("select",{is:n.is}):v.createElement("select"),n.multiple?h.multiple=!0:n.size&&(h.size=n.size);break;default:h=typeof n.is=="string"?v.createElement(c,{is:n.is}):v.createElement(c)}}h[At]=t,h[Bt]=n;e:for(v=t.child;v!==null;){if(v.tag===5||v.tag===6)h.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===t)break e;for(;v.sibling===null;){if(v.return===null||v.return===t)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}t.stateNode=h;e:switch(kt(h,c,n),c){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ba(t)}}return ct(t),Vo(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,i),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&Ba(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(r(166));if(e=ne.current,hs(t)){if(e=t.stateNode,i=t.memoizedProps,n=null,c=Dt,c!==null)switch(c.tag){case 27:case 5:n=c.memoizedProps}e[At]=t,e=!!(e.nodeValue===i||n!==null&&n.suppressHydrationWarning===!0||Fm(e.nodeValue,i)),e||ei(t,!0)}else e=Pl(e).createTextNode(n),e[At]=t,t.stateNode=e}return ct(t),null;case 31:if(i=t.memoizedState,e===null||e.memoizedState!==null){if(n=hs(t),i!==null){if(e===null){if(!n)throw Error(r(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(r(557));e[At]=t}else Ti(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;ct(t),e=!1}else i=to(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=i),e=!0;if(!e)return t.flags&256?(Zt(t),t):(Zt(t),null);if((t.flags&128)!==0)throw Error(r(558))}return ct(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=hs(t),n!==null&&n.dehydrated!==null){if(e===null){if(!c)throw Error(r(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));c[At]=t}else Ti(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;ct(t),c=!1}else c=to(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(Zt(t),t):(Zt(t),null)}return Zt(t),(t.flags&128)!==0?(t.lanes=i,t):(i=n!==null,e=e!==null&&e.memoizedState!==null,i&&(n=t.child,c=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(c=n.alternate.memoizedState.cachePool.pool),h=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(h=n.memoizedState.cachePool.pool),h!==c&&(n.flags|=2048)),i!==e&&i&&(t.child.flags|=8192),zl(t,t.updateQueue),ct(t),null);case 4:return $e(),e===null&&fc(t.stateNode.containerInfo),ct(t),null;case 10:return Ua(t.type),ct(t),null;case 19:if(A(gt),n=t.memoizedState,n===null)return ct(t),null;if(c=(t.flags&128)!==0,h=n.rendering,h===null)if(c)bn(n,!1);else{if(ft!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(h=pl(e),h!==null){for(t.flags|=128,bn(n,!1),e=h.updateQueue,t.updateQueue=e,zl(t,e),t.subtreeFlags=0,e=i,i=t.child;i!==null;)pu(i,e),i=i.sibling;return I(gt,gt.current&1|2),Ye&&ka(t,n.treeForkCount),t.child}e=e.sibling}n.tail!==null&&oe()>Rl&&(t.flags|=128,c=!0,bn(n,!1),t.lanes=4194304)}else{if(!c)if(e=pl(h),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,zl(t,e),bn(n,!0),n.tail===null&&n.tailMode==="hidden"&&!h.alternate&&!Ye)return ct(t),null}else 2*oe()-n.renderingStartTime>Rl&&i!==536870912&&(t.flags|=128,c=!0,bn(n,!1),t.lanes=4194304);n.isBackwards?(h.sibling=t.child,t.child=h):(e=n.last,e!==null?e.sibling=h:t.child=h,n.last=h)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=oe(),e.sibling=null,i=gt.current,I(gt,c?i&1|2:i&1),Ye&&ka(t,n.treeForkCount),e):(ct(t),null);case 22:case 23:return Zt(t),po(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(i&536870912)!==0&&(t.flags&128)===0&&(ct(t),t.subtreeFlags&6&&(t.flags|=8192)):ct(t),i=t.updateQueue,i!==null&&zl(t,i.retryQueue),i=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==i&&(t.flags|=2048),e!==null&&A(Oi),null;case 24:return i=null,e!==null&&(i=e.memoizedState.cache),t.memoizedState.cache!==i&&(t.flags|=2048),Ua(bt),ct(t),null;case 25:return null;case 30:return null}throw Error(r(156,t.tag))}function ux(e,t){switch(Wr(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ua(bt),$e(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Q(t),null;case 31:if(t.memoizedState!==null){if(Zt(t),t.alternate===null)throw Error(r(340));Ti()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(Zt(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(r(340));Ti()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return A(gt),null;case 4:return $e(),null;case 10:return Ua(t.type),null;case 22:case 23:return Zt(t),po(),e!==null&&A(Oi),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Ua(bt),null;case 25:return null;default:return null}}function qh(e,t){switch(Wr(t),t.tag){case 3:Ua(bt),$e();break;case 26:case 27:case 5:Q(t);break;case 4:$e();break;case 31:t.memoizedState!==null&&Zt(t);break;case 13:Zt(t);break;case 19:A(gt);break;case 10:Ua(t.type);break;case 22:case 23:Zt(t),po(),e!==null&&A(Oi);break;case 24:Ua(bt)}}function vn(e,t){try{var i=t.updateQueue,n=i!==null?i.lastEffect:null;if(n!==null){var c=n.next;i=c;do{if((i.tag&e)===e){n=void 0;var h=i.create,v=i.inst;n=h(),v.destroy=n}i=i.next}while(i!==c)}}catch(C){et(t,t.return,C)}}function ri(e,t,i){try{var n=t.updateQueue,c=n!==null?n.lastEffect:null;if(c!==null){var h=c.next;n=h;do{if((n.tag&e)===e){var v=n.inst,C=v.destroy;if(C!==void 0){v.destroy=void 0,c=t;var B=i,Z=C;try{Z()}catch(se){et(c,B,se)}}}n=n.next}while(n!==h)}}catch(se){et(t,t.return,se)}}function Ph(e){var t=e.updateQueue;if(t!==null){var i=e.stateNode;try{Ru(t,i)}catch(n){et(e,e.return,n)}}}function Hh(e,t,i){i.props=Fi(e.type,e.memoizedProps),i.state=e.memoizedState;try{i.componentWillUnmount()}catch(n){et(e,t,n)}}function yn(e,t){try{var i=e.ref;if(i!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof i=="function"?e.refCleanup=i(n):i.current=n}}catch(c){et(e,t,c)}}function za(e,t){var i=e.ref,n=e.refCleanup;if(i!==null)if(typeof n=="function")try{n()}catch(c){et(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof i=="function")try{i(null)}catch(c){et(e,t,c)}else i.current=null}function Gh(e){var t=e.type,i=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":i.autoFocus&&n.focus();break e;case"img":i.src?n.src=i.src:i.srcSet&&(n.srcset=i.srcSet)}}catch(c){et(e,e.return,c)}}function Yo(e,t,i){try{var n=e.stateNode;Rx(n,e.type,i,t),n[Bt]=t}catch(c){et(e,e.return,c)}}function Vh(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&fi(e.type)||e.tag===4}function Qo(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Vh(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&fi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ko(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i).insertBefore(e,t):(t=i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,t.appendChild(e),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Da));else if(n!==4&&(n===27&&fi(e.type)&&(i=e.stateNode,t=null),e=e.child,e!==null))for(Ko(e,t,i),e=e.sibling;e!==null;)Ko(e,t,i),e=e.sibling}function Tl(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(n!==4&&(n===27&&fi(e.type)&&(i=e.stateNode),e=e.child,e!==null))for(Tl(e,t,i),e=e.sibling;e!==null;)Tl(e,t,i),e=e.sibling}function Yh(e){var t=e.stateNode,i=e.memoizedProps;try{for(var n=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);kt(t,n,i),t[At]=e,t[Bt]=i}catch(h){et(e,e.return,h)}}var Ia=!1,jt=!1,Xo=!1,Qh=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function hx(e,t){if(e=e.containerInfo,xc=Xl,e=lu(e),qr(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var c=n.anchorOffset,h=n.focusNode;n=n.focusOffset;try{i.nodeType,h.nodeType}catch{i=null;break e}var v=0,C=-1,B=-1,Z=0,se=0,re=e,W=null;t:for(;;){for(var ae;re!==i||c!==0&&re.nodeType!==3||(C=v+c),re!==h||n!==0&&re.nodeType!==3||(B=v+n),re.nodeType===3&&(v+=re.nodeValue.length),(ae=re.firstChild)!==null;)W=re,re=ae;for(;;){if(re===e)break t;if(W===i&&++Z===c&&(C=v),W===h&&++se===n&&(B=v),(ae=re.nextSibling)!==null)break;re=W,W=re.parentNode}re=ae}i=C===-1||B===-1?null:{start:C,end:B}}else i=null}i=i||{start:0,end:0}}else i=null;for(bc={focusedElem:e,selectionRange:i},Xl=!1,Tt=t;Tt!==null;)if(t=Tt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Tt=e;else for(;Tt!==null;){switch(t=Tt,h=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(i=0;i<e.length;i++)c=e[i],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&h!==null){e=void 0,i=t,c=h.memoizedProps,h=h.memoizedState,n=i.stateNode;try{var ye=Fi(i.type,c);e=n.getSnapshotBeforeUpdate(ye,h),n.__reactInternalSnapshotBeforeUpdate=e}catch(Oe){et(i,i.return,Oe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,i=e.nodeType,i===9)jc(e);else if(i===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":jc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(r(163))}if(e=t.sibling,e!==null){e.return=t.return,Tt=e;break}Tt=t.return}}function Kh(e,t,i){var n=i.flags;switch(i.tag){case 0:case 11:case 15:Pa(e,i),n&4&&vn(5,i);break;case 1:if(Pa(e,i),n&4)if(e=i.stateNode,t===null)try{e.componentDidMount()}catch(v){et(i,i.return,v)}else{var c=Fi(i.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(v){et(i,i.return,v)}}n&64&&Ph(i),n&512&&yn(i,i.return);break;case 3:if(Pa(e,i),n&64&&(e=i.updateQueue,e!==null)){if(t=null,i.child!==null)switch(i.child.tag){case 27:case 5:t=i.child.stateNode;break;case 1:t=i.child.stateNode}try{Ru(e,t)}catch(v){et(i,i.return,v)}}break;case 27:t===null&&n&4&&Yh(i);case 26:case 5:Pa(e,i),t===null&&n&4&&Gh(i),n&512&&yn(i,i.return);break;case 12:Pa(e,i);break;case 31:Pa(e,i),n&4&&Zh(e,i);break;case 13:Pa(e,i),n&4&&Wh(e,i),n&64&&(e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(i=jx.bind(null,i),Ix(e,i))));break;case 22:if(n=i.memoizedState!==null||Ia,!n){t=t!==null&&t.memoizedState!==null||jt,c=Ia;var h=jt;Ia=n,(jt=t)&&!h?Ha(e,i,(i.subtreeFlags&8772)!==0):Pa(e,i),Ia=c,jt=h}break;case 30:break;default:Pa(e,i)}}function Xh(e){var t=e.alternate;t!==null&&(e.alternate=null,Xh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&Sr(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var dt=null,qt=!1;function qa(e,t,i){for(i=i.child;i!==null;)Jh(e,t,i),i=i.sibling}function Jh(e,t,i){if(Ie&&typeof Ie.onCommitFiberUnmount=="function")try{Ie.onCommitFiberUnmount(lt,i)}catch{}switch(i.tag){case 26:jt||za(i,t),qa(e,t,i),i.memoizedState?i.memoizedState.count--:i.stateNode&&(i=i.stateNode,i.parentNode.removeChild(i));break;case 27:jt||za(i,t);var n=dt,c=qt;fi(i.type)&&(dt=i.stateNode,qt=!1),qa(e,t,i),Tn(i.stateNode),dt=n,qt=c;break;case 5:jt||za(i,t);case 6:if(n=dt,c=qt,dt=null,qa(e,t,i),dt=n,qt=c,dt!==null)if(qt)try{(dt.nodeType===9?dt.body:dt.nodeName==="HTML"?dt.ownerDocument.body:dt).removeChild(i.stateNode)}catch(h){et(i,t,h)}else try{dt.removeChild(i.stateNode)}catch(h){et(i,t,h)}break;case 18:dt!==null&&(qt?(e=dt,Pm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,i.stateNode),Rs(e)):Pm(dt,i.stateNode));break;case 4:n=dt,c=qt,dt=i.stateNode.containerInfo,qt=!0,qa(e,t,i),dt=n,qt=c;break;case 0:case 11:case 14:case 15:ri(2,i,t),jt||ri(4,i,t),qa(e,t,i);break;case 1:jt||(za(i,t),n=i.stateNode,typeof n.componentWillUnmount=="function"&&Hh(i,t,n)),qa(e,t,i);break;case 21:qa(e,t,i);break;case 22:jt=(n=jt)||i.memoizedState!==null,qa(e,t,i),jt=n;break;default:qa(e,t,i)}}function Zh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Rs(e)}catch(i){et(t,t.return,i)}}}function Wh(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Rs(e)}catch(i){et(t,t.return,i)}}function mx(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new Qh),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new Qh),t;default:throw Error(r(435,e.tag))}}function Al(e,t){var i=mx(e);t.forEach(function(n){if(!i.has(n)){i.add(n);var c=Nx.bind(null,e,n);n.then(c,c)}})}function Pt(e,t){var i=t.deletions;if(i!==null)for(var n=0;n<i.length;n++){var c=i[n],h=e,v=t,C=v;e:for(;C!==null;){switch(C.tag){case 27:if(fi(C.type)){dt=C.stateNode,qt=!1;break e}break;case 5:dt=C.stateNode,qt=!1;break e;case 3:case 4:dt=C.stateNode.containerInfo,qt=!0;break e}C=C.return}if(dt===null)throw Error(r(160));Jh(h,v,c),dt=null,qt=!1,h=c.alternate,h!==null&&(h.return=null),c.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)em(t,e),t=t.sibling}var Na=null;function em(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Pt(t,e),Ht(e),n&4&&(ri(3,e,e.return),vn(3,e),ri(5,e,e.return));break;case 1:Pt(t,e),Ht(e),n&512&&(jt||i===null||za(i,i.return)),n&64&&Ia&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(i=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=i===null?n:i.concat(n))));break;case 26:var c=Na;if(Pt(t,e),Ht(e),n&512&&(jt||i===null||za(i,i.return)),n&4){var h=i!==null?i.memoizedState:null;if(n=e.memoizedState,i===null)if(n===null)if(e.stateNode===null){e:{n=e.type,i=e.memoizedProps,c=c.ownerDocument||c;t:switch(n){case"title":h=c.getElementsByTagName("title")[0],(!h||h[Vs]||h[At]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=c.createElement(n),c.head.insertBefore(h,c.querySelector("head > title"))),kt(h,n,i),h[At]=e,zt(h),n=h;break e;case"link":var v=ef("link","href",c).get(n+(i.href||""));if(v){for(var C=0;C<v.length;C++)if(h=v[C],h.getAttribute("href")===(i.href==null||i.href===""?null:i.href)&&h.getAttribute("rel")===(i.rel==null?null:i.rel)&&h.getAttribute("title")===(i.title==null?null:i.title)&&h.getAttribute("crossorigin")===(i.crossOrigin==null?null:i.crossOrigin)){v.splice(C,1);break t}}h=c.createElement(n),kt(h,n,i),c.head.appendChild(h);break;case"meta":if(v=ef("meta","content",c).get(n+(i.content||""))){for(C=0;C<v.length;C++)if(h=v[C],h.getAttribute("content")===(i.content==null?null:""+i.content)&&h.getAttribute("name")===(i.name==null?null:i.name)&&h.getAttribute("property")===(i.property==null?null:i.property)&&h.getAttribute("http-equiv")===(i.httpEquiv==null?null:i.httpEquiv)&&h.getAttribute("charset")===(i.charSet==null?null:i.charSet)){v.splice(C,1);break t}}h=c.createElement(n),kt(h,n,i),c.head.appendChild(h);break;default:throw Error(r(468,n))}h[At]=e,zt(h),n=h}e.stateNode=n}else tf(c,e.type,e.stateNode);else e.stateNode=Wm(c,n,e.memoizedProps);else h!==n?(h===null?i.stateNode!==null&&(i=i.stateNode,i.parentNode.removeChild(i)):h.count--,n===null?tf(c,e.type,e.stateNode):Wm(c,n,e.memoizedProps)):n===null&&e.stateNode!==null&&Yo(e,e.memoizedProps,i.memoizedProps)}break;case 27:Pt(t,e),Ht(e),n&512&&(jt||i===null||za(i,i.return)),i!==null&&n&4&&Yo(e,e.memoizedProps,i.memoizedProps);break;case 5:if(Pt(t,e),Ht(e),n&512&&(jt||i===null||za(i,i.return)),e.flags&32){c=e.stateNode;try{as(c,"")}catch(ye){et(e,e.return,ye)}}n&4&&e.stateNode!=null&&(c=e.memoizedProps,Yo(e,c,i!==null?i.memoizedProps:c)),n&1024&&(Xo=!0);break;case 6:if(Pt(t,e),Ht(e),n&4){if(e.stateNode===null)throw Error(r(162));n=e.memoizedProps,i=e.stateNode;try{i.nodeValue=n}catch(ye){et(e,e.return,ye)}}break;case 3:if(Vl=null,c=Na,Na=Hl(t.containerInfo),Pt(t,e),Na=c,Ht(e),n&4&&i!==null&&i.memoizedState.isDehydrated)try{Rs(t.containerInfo)}catch(ye){et(e,e.return,ye)}Xo&&(Xo=!1,tm(e));break;case 4:n=Na,Na=Hl(e.stateNode.containerInfo),Pt(t,e),Ht(e),Na=n;break;case 12:Pt(t,e),Ht(e);break;case 31:Pt(t,e),Ht(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Al(e,n)));break;case 13:Pt(t,e),Ht(e),e.child.flags&8192&&e.memoizedState!==null!=(i!==null&&i.memoizedState!==null)&&(Ol=oe()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Al(e,n)));break;case 22:c=e.memoizedState!==null;var B=i!==null&&i.memoizedState!==null,Z=Ia,se=jt;if(Ia=Z||c,jt=se||B,Pt(t,e),jt=se,Ia=Z,Ht(e),n&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(i===null||B||Ia||jt||Li(e)),i=null,t=e;;){if(t.tag===5||t.tag===26){if(i===null){B=i=t;try{if(h=B.stateNode,c)v=h.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{C=B.stateNode;var re=B.memoizedProps.style,W=re!=null&&re.hasOwnProperty("display")?re.display:null;C.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(ye){et(B,B.return,ye)}}}else if(t.tag===6){if(i===null){B=t;try{B.stateNode.nodeValue=c?"":B.memoizedProps}catch(ye){et(B,B.return,ye)}}}else if(t.tag===18){if(i===null){B=t;try{var ae=B.stateNode;c?Hm(ae,!0):Hm(B.stateNode,!1)}catch(ye){et(B,B.return,ye)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;i===t&&(i=null),t=t.return}i===t&&(i=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(i=n.retryQueue,i!==null&&(n.retryQueue=null,Al(e,i))));break;case 19:Pt(t,e),Ht(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Al(e,n)));break;case 30:break;case 21:break;default:Pt(t,e),Ht(e)}}function Ht(e){var t=e.flags;if(t&2){try{for(var i,n=e.return;n!==null;){if(Vh(n)){i=n;break}n=n.return}if(i==null)throw Error(r(160));switch(i.tag){case 27:var c=i.stateNode,h=Qo(e);Tl(e,h,c);break;case 5:var v=i.stateNode;i.flags&32&&(as(v,""),i.flags&=-33);var C=Qo(e);Tl(e,C,v);break;case 3:case 4:var B=i.stateNode.containerInfo,Z=Qo(e);Ko(e,Z,B);break;default:throw Error(r(161))}}catch(se){et(e,e.return,se)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function tm(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;tm(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Pa(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)Kh(e,t.alternate,t),t=t.sibling}function Li(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ri(4,t,t.return),Li(t);break;case 1:za(t,t.return);var i=t.stateNode;typeof i.componentWillUnmount=="function"&&Hh(t,t.return,i),Li(t);break;case 27:Tn(t.stateNode);case 26:case 5:za(t,t.return),Li(t);break;case 22:t.memoizedState===null&&Li(t);break;case 30:Li(t);break;default:Li(t)}e=e.sibling}}function Ha(e,t,i){for(i=i&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,c=e,h=t,v=h.flags;switch(h.tag){case 0:case 11:case 15:Ha(c,h,i),vn(4,h);break;case 1:if(Ha(c,h,i),n=h,c=n.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(Z){et(n,n.return,Z)}if(n=h,c=n.updateQueue,c!==null){var C=n.stateNode;try{var B=c.shared.hiddenCallbacks;if(B!==null)for(c.shared.hiddenCallbacks=null,c=0;c<B.length;c++)Ou(B[c],C)}catch(Z){et(n,n.return,Z)}}i&&v&64&&Ph(h),yn(h,h.return);break;case 27:Yh(h);case 26:case 5:Ha(c,h,i),i&&n===null&&v&4&&Gh(h),yn(h,h.return);break;case 12:Ha(c,h,i);break;case 31:Ha(c,h,i),i&&v&4&&Zh(c,h);break;case 13:Ha(c,h,i),i&&v&4&&Wh(c,h);break;case 22:h.memoizedState===null&&Ha(c,h,i),yn(h,h.return);break;case 30:break;default:Ha(c,h,i)}t=t.sibling}}function Jo(e,t){var i=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==i&&(e!=null&&e.refCount++,i!=null&&ln(i))}function Zo(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ln(e))}function _a(e,t,i,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)am(e,t,i,n),t=t.sibling}function am(e,t,i,n){var c=t.flags;switch(t.tag){case 0:case 11:case 15:_a(e,t,i,n),c&2048&&vn(9,t);break;case 1:_a(e,t,i,n);break;case 3:_a(e,t,i,n),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&ln(e)));break;case 12:if(c&2048){_a(e,t,i,n),e=t.stateNode;try{var h=t.memoizedProps,v=h.id,C=h.onPostCommit;typeof C=="function"&&C(v,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(B){et(t,t.return,B)}}else _a(e,t,i,n);break;case 31:_a(e,t,i,n);break;case 13:_a(e,t,i,n);break;case 23:break;case 22:h=t.stateNode,v=t.alternate,t.memoizedState!==null?h._visibility&2?_a(e,t,i,n):jn(e,t):h._visibility&2?_a(e,t,i,n):(h._visibility|=2,Ns(e,t,i,n,(t.subtreeFlags&10256)!==0||!1)),c&2048&&Jo(v,t);break;case 24:_a(e,t,i,n),c&2048&&Zo(t.alternate,t);break;default:_a(e,t,i,n)}}function Ns(e,t,i,n,c){for(c=c&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var h=e,v=t,C=i,B=n,Z=v.flags;switch(v.tag){case 0:case 11:case 15:Ns(h,v,C,B,c),vn(8,v);break;case 23:break;case 22:var se=v.stateNode;v.memoizedState!==null?se._visibility&2?Ns(h,v,C,B,c):jn(h,v):(se._visibility|=2,Ns(h,v,C,B,c)),c&&Z&2048&&Jo(v.alternate,v);break;case 24:Ns(h,v,C,B,c),c&&Z&2048&&Zo(v.alternate,v);break;default:Ns(h,v,C,B,c)}t=t.sibling}}function jn(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var i=e,n=t,c=n.flags;switch(n.tag){case 22:jn(i,n),c&2048&&Jo(n.alternate,n);break;case 24:jn(i,n),c&2048&&Zo(n.alternate,n);break;default:jn(i,n)}t=t.sibling}}var Nn=8192;function _s(e,t,i){if(e.subtreeFlags&Nn)for(e=e.child;e!==null;)im(e,t,i),e=e.sibling}function im(e,t,i){switch(e.tag){case 26:_s(e,t,i),e.flags&Nn&&e.memoizedState!==null&&Wx(i,Na,e.memoizedState,e.memoizedProps);break;case 5:_s(e,t,i);break;case 3:case 4:var n=Na;Na=Hl(e.stateNode.containerInfo),_s(e,t,i),Na=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Nn,Nn=16777216,_s(e,t,i),Nn=n):_s(e,t,i));break;default:_s(e,t,i)}}function sm(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function _n(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var n=t[i];Tt=n,lm(n,e)}sm(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)nm(e),e=e.sibling}function nm(e){switch(e.tag){case 0:case 11:case 15:_n(e),e.flags&2048&&ri(9,e,e.return);break;case 3:_n(e);break;case 12:_n(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Dl(e)):_n(e);break;default:_n(e)}}function Dl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var i=0;i<t.length;i++){var n=t[i];Tt=n,lm(n,e)}sm(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:ri(8,t,t.return),Dl(t);break;case 22:i=t.stateNode,i._visibility&2&&(i._visibility&=-3,Dl(t));break;default:Dl(t)}e=e.sibling}}function lm(e,t){for(;Tt!==null;){var i=Tt;switch(i.tag){case 0:case 11:case 15:ri(8,i,t);break;case 23:case 22:if(i.memoizedState!==null&&i.memoizedState.cachePool!==null){var n=i.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:ln(i.memoizedState.cache)}if(n=i.child,n!==null)n.return=i,Tt=n;else e:for(i=e;Tt!==null;){n=Tt;var c=n.sibling,h=n.return;if(Xh(n),n===i){Tt=null;break e}if(c!==null){c.return=h,Tt=c;break e}Tt=h}}}var fx={getCacheForType:function(e){var t=Ot(bt),i=t.data.get(e);return i===void 0&&(i=e(),t.data.set(e,i)),i},cacheSignal:function(){return Ot(bt).controller.signal}},px=typeof WeakMap=="function"?WeakMap:Map,Xe=0,st=null,qe=null,He=0,We=0,Wt=null,oi=!1,ws=!1,Wo=!1,Ga=0,ft=0,ci=0,$i=0,ec=0,ea=0,Ss=0,wn=null,Gt=null,tc=!1,Ol=0,rm=0,Rl=1/0,kl=null,di=null,Ct=0,ui=null,Cs=null,Va=0,ac=0,ic=null,om=null,Sn=0,sc=null;function ta(){return(Xe&2)!==0&&He!==0?He&-He:U.T!==null?dc():wd()}function cm(){if(ea===0)if((He&536870912)===0||Ye){var e=Ze;Ze<<=1,(Ze&3932160)===0&&(Ze=262144),ea=e}else ea=536870912;return e=Jt.current,e!==null&&(e.flags|=32),ea}function Vt(e,t,i){(e===st&&(We===2||We===9)||e.cancelPendingCommit!==null)&&(Es(e,0),hi(e,He,ea,!1)),Gs(e,i),((Xe&2)===0||e!==st)&&(e===st&&((Xe&2)===0&&($i|=i),ft===4&&hi(e,He,ea,!1)),Ta(e))}function dm(e,t,i){if((Xe&6)!==0)throw Error(r(327));var n=!i&&(t&127)===0&&(t&e.expiredLanes)===0||ya(e,t),c=n?bx(e,t):lc(e,t,!0),h=n;do{if(c===0){ws&&!n&&hi(e,t,0,!1);break}else{if(i=e.current.alternate,h&&!gx(i)){c=lc(e,t,!1),h=!1;continue}if(c===2){if(h=t,e.errorRecoveryDisabledLanes&h)var v=0;else v=e.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){t=v;e:{var C=e;c=wn;var B=C.current.memoizedState.isDehydrated;if(B&&(Es(C,v).flags|=256),v=lc(C,v,!1),v!==2){if(Wo&&!B){C.errorRecoveryDisabledLanes|=h,$i|=h,c=4;break e}h=Gt,Gt=c,h!==null&&(Gt===null?Gt=h:Gt.push.apply(Gt,h))}c=v}if(h=!1,c!==2)continue}}if(c===1){Es(e,0),hi(e,t,0,!0);break}e:{switch(n=e,h=c,h){case 0:case 1:throw Error(r(345));case 4:if((t&4194048)!==t)break;case 6:hi(n,t,ea,!oi);break e;case 2:Gt=null;break;case 3:case 5:break;default:throw Error(r(329))}if((t&62914560)===t&&(c=Ol+300-oe(),10<c)){if(hi(n,t,ea,!oi),Ki(n,0,!0)!==0)break e;Va=t,n.timeoutHandle=Im(um.bind(null,n,i,Gt,kl,tc,t,ea,$i,Ss,oi,h,"Throttled",-0,0),c);break e}um(n,i,Gt,kl,tc,t,ea,$i,Ss,oi,h,null,-0,0)}}break}while(!0);Ta(e)}function um(e,t,i,n,c,h,v,C,B,Z,se,re,W,ae){if(e.timeoutHandle=-1,re=t.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Da},im(t,h,re);var ye=(h&62914560)===h?Ol-oe():(h&4194048)===h?rm-oe():0;if(ye=eb(re,ye),ye!==null){Va=h,e.cancelPendingCommit=ye(vm.bind(null,e,t,h,i,n,c,v,C,B,se,re,null,W,ae)),hi(e,h,v,!Z);return}}vm(e,t,h,i,n,c,v,C,B)}function gx(e){for(var t=e;;){var i=t.tag;if((i===0||i===11||i===15)&&t.flags&16384&&(i=t.updateQueue,i!==null&&(i=i.stores,i!==null)))for(var n=0;n<i.length;n++){var c=i[n],h=c.getSnapshot;c=c.value;try{if(!Kt(h(),c))return!1}catch{return!1}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hi(e,t,i,n){t&=~ec,t&=~$i,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var c=t;0<c;){var h=31-xe(c),v=1<<h;n[h]=-1,c&=~v}i!==0&&jd(e,i,t)}function Ml(){return(Xe&6)===0?(Cn(0),!1):!0}function nc(){if(qe!==null){if(We===0)var e=qe.return;else e=qe,Ma=Ai=null,jo(e),xs=null,on=0,e=qe;for(;e!==null;)qh(e.alternate,e),e=e.return;qe=null}}function Es(e,t){var i=e.timeoutHandle;i!==-1&&(e.timeoutHandle=-1,Ux(i)),i=e.cancelPendingCommit,i!==null&&(e.cancelPendingCommit=null,i()),Va=0,nc(),st=e,qe=i=Ra(e.current,null),He=t,We=0,Wt=null,oi=!1,ws=ya(e,t),Wo=!1,Ss=ea=ec=$i=ci=ft=0,Gt=wn=null,tc=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var c=31-xe(n),h=1<<c;t|=e[c],n&=~h}return Ga=t,al(),i}function hm(e,t){Le=null,U.H=gn,t===gs||t===dl?(t=zu(),We=3):t===oo?(t=zu(),We=4):We=t===Fo?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,Wt=t,qe===null&&(ft=1,wl(e,ca(t,e.current)))}function mm(){var e=Jt.current;return e===null?!0:(He&4194048)===He?ma===null:(He&62914560)===He||(He&536870912)!==0?e===ma:!1}function fm(){var e=U.H;return U.H=gn,e===null?gn:e}function pm(){var e=U.A;return U.A=fx,e}function Ul(){ft=4,oi||(He&4194048)!==He&&Jt.current!==null||(ws=!0),(ci&134217727)===0&&($i&134217727)===0||st===null||hi(st,He,ea,!1)}function lc(e,t,i){var n=Xe;Xe|=2;var c=fm(),h=pm();(st!==e||He!==t)&&(kl=null,Es(e,t)),t=!1;var v=ft;e:do try{if(We!==0&&qe!==null){var C=qe,B=Wt;switch(We){case 8:nc(),v=6;break e;case 3:case 2:case 9:case 6:Jt.current===null&&(t=!0);var Z=We;if(We=0,Wt=null,zs(e,C,B,Z),i&&ws){v=0;break e}break;default:Z=We,We=0,Wt=null,zs(e,C,B,Z)}}xx(),v=ft;break}catch(se){hm(e,se)}while(!0);return t&&e.shellSuspendCounter++,Ma=Ai=null,Xe=n,U.H=c,U.A=h,qe===null&&(st=null,He=0,al()),v}function xx(){for(;qe!==null;)gm(qe)}function bx(e,t){var i=Xe;Xe|=2;var n=fm(),c=pm();st!==e||He!==t?(kl=null,Rl=oe()+500,Es(e,t)):ws=ya(e,t);e:do try{if(We!==0&&qe!==null){t=qe;var h=Wt;t:switch(We){case 1:We=0,Wt=null,zs(e,t,h,1);break;case 2:case 9:if(Cu(h)){We=0,Wt=null,xm(t);break}t=function(){We!==2&&We!==9||st!==e||(We=7),Ta(e)},h.then(t,t);break e;case 3:We=7;break e;case 4:We=5;break e;case 7:Cu(h)?(We=0,Wt=null,xm(t)):(We=0,Wt=null,zs(e,t,h,7));break;case 5:var v=null;switch(qe.tag){case 26:v=qe.memoizedState;case 5:case 27:var C=qe;if(v?af(v):C.stateNode.complete){We=0,Wt=null;var B=C.sibling;if(B!==null)qe=B;else{var Z=C.return;Z!==null?(qe=Z,Fl(Z)):qe=null}break t}}We=0,Wt=null,zs(e,t,h,5);break;case 6:We=0,Wt=null,zs(e,t,h,6);break;case 8:nc(),ft=6;break e;default:throw Error(r(462))}}vx();break}catch(se){hm(e,se)}while(!0);return Ma=Ai=null,U.H=n,U.A=c,Xe=i,qe!==null?0:(st=null,He=0,al(),ft)}function vx(){for(;qe!==null&&!Je();)gm(qe)}function gm(e){var t=Bh(e.alternate,e,Ga);e.memoizedProps=e.pendingProps,t===null?Fl(e):qe=t}function xm(e){var t=e,i=t.alternate;switch(t.tag){case 15:case 0:t=kh(i,t,t.pendingProps,t.type,void 0,He);break;case 11:t=kh(i,t,t.pendingProps,t.type.render,t.ref,He);break;case 5:jo(t);default:qh(i,t),t=qe=pu(t,Ga),t=Bh(i,t,Ga)}e.memoizedProps=e.pendingProps,t===null?Fl(e):qe=t}function zs(e,t,i,n){Ma=Ai=null,jo(t),xs=null,on=0;var c=t.return;try{if(rx(e,c,t,i,He)){ft=1,wl(e,ca(i,e.current)),qe=null;return}}catch(h){if(c!==null)throw qe=c,h;ft=1,wl(e,ca(i,e.current)),qe=null;return}t.flags&32768?(Ye||n===1?e=!0:ws||(He&536870912)!==0?e=!1:(oi=e=!0,(n===2||n===9||n===3||n===6)&&(n=Jt.current,n!==null&&n.tag===13&&(n.flags|=16384))),bm(t,e)):Fl(t)}function Fl(e){var t=e;do{if((t.flags&32768)!==0){bm(t,oi);return}e=t.return;var i=dx(t.alternate,t,Ga);if(i!==null){qe=i;return}if(t=t.sibling,t!==null){qe=t;return}qe=t=e}while(t!==null);ft===0&&(ft=5)}function bm(e,t){do{var i=ux(e.alternate,e);if(i!==null){i.flags&=32767,qe=i;return}if(i=e.return,i!==null&&(i.flags|=32768,i.subtreeFlags=0,i.deletions=null),!t&&(e=e.sibling,e!==null)){qe=e;return}qe=e=i}while(e!==null);ft=6,qe=null}function vm(e,t,i,n,c,h,v,C,B){e.cancelPendingCommit=null;do Ll();while(Ct!==0);if((Xe&6)!==0)throw Error(r(327));if(t!==null){if(t===e.current)throw Error(r(177));if(h=t.lanes|t.childLanes,h|=Yr,Zp(e,i,h,v,C,B),e===st&&(qe=st=null,He=0),Cs=t,ui=e,Va=i,ac=h,ic=c,om=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,_x(Me,function(){return wm(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=U.T,U.T=null,c=D.p,D.p=2,v=Xe,Xe|=4;try{hx(e,t,i)}finally{Xe=v,D.p=c,U.T=n}}Ct=1,ym(),jm(),Nm()}}function ym(){if(Ct===1){Ct=0;var e=ui,t=Cs,i=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||i){i=U.T,U.T=null;var n=D.p;D.p=2;var c=Xe;Xe|=4;try{em(t,e);var h=bc,v=lu(e.containerInfo),C=h.focusedElem,B=h.selectionRange;if(v!==C&&C&&C.ownerDocument&&nu(C.ownerDocument.documentElement,C)){if(B!==null&&qr(C)){var Z=B.start,se=B.end;if(se===void 0&&(se=Z),"selectionStart"in C)C.selectionStart=Z,C.selectionEnd=Math.min(se,C.value.length);else{var re=C.ownerDocument||document,W=re&&re.defaultView||window;if(W.getSelection){var ae=W.getSelection(),ye=C.textContent.length,Oe=Math.min(B.start,ye),it=B.end===void 0?Oe:Math.min(B.end,ye);!ae.extend&&Oe>it&&(v=it,it=Oe,Oe=v);var Y=su(C,Oe),G=su(C,it);if(Y&&G&&(ae.rangeCount!==1||ae.anchorNode!==Y.node||ae.anchorOffset!==Y.offset||ae.focusNode!==G.node||ae.focusOffset!==G.offset)){var J=re.createRange();J.setStart(Y.node,Y.offset),ae.removeAllRanges(),Oe>it?(ae.addRange(J),ae.extend(G.node,G.offset)):(J.setEnd(G.node,G.offset),ae.addRange(J))}}}}for(re=[],ae=C;ae=ae.parentNode;)ae.nodeType===1&&re.push({element:ae,left:ae.scrollLeft,top:ae.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<re.length;C++){var le=re[C];le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}Xl=!!xc,bc=xc=null}finally{Xe=c,D.p=n,U.T=i}}e.current=t,Ct=2}}function jm(){if(Ct===2){Ct=0;var e=ui,t=Cs,i=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||i){i=U.T,U.T=null;var n=D.p;D.p=2;var c=Xe;Xe|=4;try{Kh(e,t.alternate,t)}finally{Xe=c,D.p=n,U.T=i}}Ct=3}}function Nm(){if(Ct===4||Ct===3){Ct=0,X();var e=ui,t=Cs,i=Va,n=om;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?Ct=5:(Ct=0,Cs=ui=null,_m(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(di=null),_r(i),t=t.stateNode,Ie&&typeof Ie.onCommitFiberRoot=="function")try{Ie.onCommitFiberRoot(lt,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=U.T,c=D.p,D.p=2,U.T=null;try{for(var h=e.onRecoverableError,v=0;v<n.length;v++){var C=n[v];h(C.value,{componentStack:C.stack})}}finally{U.T=t,D.p=c}}(Va&3)!==0&&Ll(),Ta(e),c=e.pendingLanes,(i&261930)!==0&&(c&42)!==0?e===sc?Sn++:(Sn=0,sc=e):Sn=0,Cn(0)}}function _m(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,ln(t)))}function Ll(){return ym(),jm(),Nm(),wm()}function wm(){if(Ct!==5)return!1;var e=ui,t=ac;ac=0;var i=_r(Va),n=U.T,c=D.p;try{D.p=32>i?32:i,U.T=null,i=ic,ic=null;var h=ui,v=Va;if(Ct=0,Cs=ui=null,Va=0,(Xe&6)!==0)throw Error(r(331));var C=Xe;if(Xe|=4,nm(h.current),am(h,h.current,v,i),Xe=C,Cn(0,!1),Ie&&typeof Ie.onPostCommitFiberRoot=="function")try{Ie.onPostCommitFiberRoot(lt,h)}catch{}return!0}finally{D.p=c,U.T=n,_m(e,t)}}function Sm(e,t,i){t=ca(i,t),t=Uo(e.stateNode,t,2),e=si(e,t,2),e!==null&&(Gs(e,2),Ta(e))}function et(e,t,i){if(e.tag===3)Sm(e,e,i);else for(;t!==null;){if(t.tag===3){Sm(t,e,i);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(di===null||!di.has(n))){e=ca(i,e),i=Ch(2),n=si(t,i,2),n!==null&&(Eh(i,n,t,e),Gs(n,2),Ta(n));break}}t=t.return}}function rc(e,t,i){var n=e.pingCache;if(n===null){n=e.pingCache=new px;var c=new Set;n.set(t,c)}else c=n.get(t),c===void 0&&(c=new Set,n.set(t,c));c.has(i)||(Wo=!0,c.add(i),e=yx.bind(null,e,t,i),t.then(e,e))}function yx(e,t,i){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&i,e.warmLanes&=~i,st===e&&(He&i)===i&&(ft===4||ft===3&&(He&62914560)===He&&300>oe()-Ol?(Xe&2)===0&&Es(e,0):ec|=i,Ss===He&&(Ss=0)),Ta(e)}function Cm(e,t){t===0&&(t=yd()),e=Ei(e,t),e!==null&&(Gs(e,t),Ta(e))}function jx(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),Cm(e,i)}function Nx(e,t){var i=0;switch(e.tag){case 31:case 13:var n=e.stateNode,c=e.memoizedState;c!==null&&(i=c.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(r(314))}n!==null&&n.delete(t),Cm(e,i)}function _x(e,t){return Yt(e,t)}var $l=null,Ts=null,oc=!1,Bl=!1,cc=!1,mi=0;function Ta(e){e!==Ts&&e.next===null&&(Ts===null?$l=Ts=e:Ts=Ts.next=e),Bl=!0,oc||(oc=!0,Sx())}function Cn(e,t){if(!cc&&Bl){cc=!0;do for(var i=!1,n=$l;n!==null;){if(e!==0){var c=n.pendingLanes;if(c===0)var h=0;else{var v=n.suspendedLanes,C=n.pingedLanes;h=(1<<31-xe(42|e)+1)-1,h&=c&~(v&~C),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(i=!0,Am(n,h))}else h=He,h=Ki(n,n===st?h:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(h&3)===0||ya(n,h)||(i=!0,Am(n,h));n=n.next}while(i);cc=!1}}function wx(){Em()}function Em(){Bl=oc=!1;var e=0;mi!==0&&Mx()&&(e=mi);for(var t=oe(),i=null,n=$l;n!==null;){var c=n.next,h=zm(n,t);h===0?(n.next=null,i===null?$l=c:i.next=c,c===null&&(Ts=i)):(i=n,(e!==0||(h&3)!==0)&&(Bl=!0)),n=c}Ct!==0&&Ct!==5||Cn(e),mi!==0&&(mi=0)}function zm(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,c=e.expirationTimes,h=e.pendingLanes&-62914561;0<h;){var v=31-xe(h),C=1<<v,B=c[v];B===-1?((C&i)===0||(C&n)!==0)&&(c[v]=Jp(C,t)):B<=t&&(e.expiredLanes|=C),h&=~C}if(t=st,i=He,i=Ki(e,e===t?i:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,i===0||e===t&&(We===2||We===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&na(n),e.callbackNode=null,e.callbackPriority=0;if((i&3)===0||ya(e,i)){if(t=i&-i,t===e.callbackPriority)return t;switch(n!==null&&na(n),_r(i)){case 2:case 8:i=De;break;case 32:i=Me;break;case 268435456:i=fe;break;default:i=Me}return n=Tm.bind(null,e),i=Yt(i,n),e.callbackPriority=t,e.callbackNode=i,t}return n!==null&&n!==null&&na(n),e.callbackPriority=2,e.callbackNode=null,2}function Tm(e,t){if(Ct!==0&&Ct!==5)return e.callbackNode=null,e.callbackPriority=0,null;var i=e.callbackNode;if(Ll()&&e.callbackNode!==i)return null;var n=He;return n=Ki(e,e===st?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(dm(e,n,t),zm(e,oe()),e.callbackNode!=null&&e.callbackNode===i?Tm.bind(null,e):null)}function Am(e,t){if(Ll())return null;dm(e,t,!0)}function Sx(){Fx(function(){(Xe&6)!==0?Yt(je,wx):Em()})}function dc(){if(mi===0){var e=fs;e===0&&(e=ze,ze<<=1,(ze&261888)===0&&(ze=256)),mi=e}return mi}function Dm(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Qn(""+e)}function Om(e,t){var i=t.ownerDocument.createElement("input");return i.name=t.name,i.value=t.value,e.id&&i.setAttribute("form",e.id),t.parentNode.insertBefore(i,t),e=new FormData(e),i.parentNode.removeChild(i),e}function Cx(e,t,i,n,c){if(t==="submit"&&i&&i.stateNode===c){var h=Dm((c[Bt]||null).action),v=n.submitter;v&&(t=(t=v[Bt]||null)?Dm(t.formAction):v.getAttribute("formAction"),t!==null&&(h=t,v=null));var C=new Zn("action","action",null,n,c);e.push({event:C,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(mi!==0){var B=v?Om(c,v):new FormData(c);Ao(i,{pending:!0,data:B,method:c.method,action:h},null,B)}}else typeof h=="function"&&(C.preventDefault(),B=v?Om(c,v):new FormData(c),Ao(i,{pending:!0,data:B,method:c.method,action:h},h,B))},currentTarget:c}]})}}for(var uc=0;uc<Vr.length;uc++){var hc=Vr[uc],Ex=hc.toLowerCase(),zx=hc[0].toUpperCase()+hc.slice(1);ja(Ex,"on"+zx)}ja(cu,"onAnimationEnd"),ja(du,"onAnimationIteration"),ja(uu,"onAnimationStart"),ja("dblclick","onDoubleClick"),ja("focusin","onFocus"),ja("focusout","onBlur"),ja(Hg,"onTransitionRun"),ja(Gg,"onTransitionStart"),ja(Vg,"onTransitionCancel"),ja(hu,"onTransitionEnd"),es("onMouseEnter",["mouseout","mouseover"]),es("onMouseLeave",["mouseout","mouseover"]),es("onPointerEnter",["pointerout","pointerover"]),es("onPointerLeave",["pointerout","pointerover"]),_i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),_i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),_i("onBeforeInput",["compositionend","keypress","textInput","paste"]),_i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),_i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),_i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var En="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(En));function Rm(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var n=e[i],c=n.event;n=n.listeners;e:{var h=void 0;if(t)for(var v=n.length-1;0<=v;v--){var C=n[v],B=C.instance,Z=C.currentTarget;if(C=C.listener,B!==h&&c.isPropagationStopped())break e;h=C,c.currentTarget=Z;try{h(c)}catch(se){tl(se)}c.currentTarget=null,h=B}else for(v=0;v<n.length;v++){if(C=n[v],B=C.instance,Z=C.currentTarget,C=C.listener,B!==h&&c.isPropagationStopped())break e;h=C,c.currentTarget=Z;try{h(c)}catch(se){tl(se)}c.currentTarget=null,h=B}}}}function Pe(e,t){var i=t[wr];i===void 0&&(i=t[wr]=new Set);var n=e+"__bubble";i.has(n)||(km(t,e,2,!1),i.add(n))}function mc(e,t,i){var n=0;t&&(n|=4),km(i,e,n,t)}var Il="_reactListening"+Math.random().toString(36).slice(2);function fc(e){if(!e[Il]){e[Il]=!0,Ed.forEach(function(i){i!=="selectionchange"&&(Tx.has(i)||mc(i,!1,e),mc(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Il]||(t[Il]=!0,mc("selectionchange",!1,t))}}function km(e,t,i,n){switch(df(t)){case 2:var c=ib;break;case 8:c=sb;break;default:c=Tc}i=c.bind(null,t,i,e),c=void 0,!Rr||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),n?c!==void 0?e.addEventListener(t,i,{capture:!0,passive:c}):e.addEventListener(t,i,!0):c!==void 0?e.addEventListener(t,i,{passive:c}):e.addEventListener(t,i,!1)}function pc(e,t,i,n,c){var h=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var v=n.tag;if(v===3||v===4){var C=n.stateNode.containerInfo;if(C===c)break;if(v===4)for(v=n.return;v!==null;){var B=v.tag;if((B===3||B===4)&&v.stateNode.containerInfo===c)return;v=v.return}for(;C!==null;){if(v=Ji(C),v===null)return;if(B=v.tag,B===5||B===6||B===26||B===27){n=h=v;continue e}C=C.parentNode}}n=n.return}$d(function(){var Z=h,se=Dr(i),re=[];e:{var W=mu.get(e);if(W!==void 0){var ae=Zn,ye=e;switch(e){case"keypress":if(Xn(i)===0)break e;case"keydown":case"keyup":ae=Ng;break;case"focusin":ye="focus",ae=Fr;break;case"focusout":ye="blur",ae=Fr;break;case"beforeblur":case"afterblur":ae=Fr;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ae=qd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ae=dg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ae=Sg;break;case cu:case du:case uu:ae=mg;break;case hu:ae=Eg;break;case"scroll":case"scrollend":ae=og;break;case"wheel":ae=Tg;break;case"copy":case"cut":case"paste":ae=pg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ae=Hd;break;case"toggle":case"beforetoggle":ae=Dg}var Oe=(t&4)!==0,it=!Oe&&(e==="scroll"||e==="scrollend"),Y=Oe?W!==null?W+"Capture":null:W;Oe=[];for(var G=Z,J;G!==null;){var le=G;if(J=le.stateNode,le=le.tag,le!==5&&le!==26&&le!==27||J===null||Y===null||(le=Qs(G,Y),le!=null&&Oe.push(zn(G,le,J))),it)break;G=G.return}0<Oe.length&&(W=new ae(W,ye,null,i,se),re.push({event:W,listeners:Oe}))}}if((t&7)===0){e:{if(W=e==="mouseover"||e==="pointerover",ae=e==="mouseout"||e==="pointerout",W&&i!==Ar&&(ye=i.relatedTarget||i.fromElement)&&(Ji(ye)||ye[Xi]))break e;if((ae||W)&&(W=se.window===se?se:(W=se.ownerDocument)?W.defaultView||W.parentWindow:window,ae?(ye=i.relatedTarget||i.toElement,ae=Z,ye=ye?Ji(ye):null,ye!==null&&(it=u(ye),Oe=ye.tag,ye!==it||Oe!==5&&Oe!==27&&Oe!==6)&&(ye=null)):(ae=null,ye=Z),ae!==ye)){if(Oe=qd,le="onMouseLeave",Y="onMouseEnter",G="mouse",(e==="pointerout"||e==="pointerover")&&(Oe=Hd,le="onPointerLeave",Y="onPointerEnter",G="pointer"),it=ae==null?W:Ys(ae),J=ye==null?W:Ys(ye),W=new Oe(le,G+"leave",ae,i,se),W.target=it,W.relatedTarget=J,le=null,Ji(se)===Z&&(Oe=new Oe(Y,G+"enter",ye,i,se),Oe.target=J,Oe.relatedTarget=it,le=Oe),it=le,ae&&ye)t:{for(Oe=Ax,Y=ae,G=ye,J=0,le=Y;le;le=Oe(le))J++;le=0;for(var Ae=G;Ae;Ae=Oe(Ae))le++;for(;0<J-le;)Y=Oe(Y),J--;for(;0<le-J;)G=Oe(G),le--;for(;J--;){if(Y===G||G!==null&&Y===G.alternate){Oe=Y;break t}Y=Oe(Y),G=Oe(G)}Oe=null}else Oe=null;ae!==null&&Mm(re,W,ae,Oe,!1),ye!==null&&it!==null&&Mm(re,it,ye,Oe,!0)}}e:{if(W=Z?Ys(Z):window,ae=W.nodeName&&W.nodeName.toLowerCase(),ae==="select"||ae==="input"&&W.type==="file")var Qe=Zd;else if(Xd(W))if(Wd)Qe=Ig;else{Qe=$g;var _e=Lg}else ae=W.nodeName,!ae||ae.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?Z&&Tr(Z.elementType)&&(Qe=Zd):Qe=Bg;if(Qe&&(Qe=Qe(e,Z))){Jd(re,Qe,i,se);break e}_e&&_e(e,W,Z),e==="focusout"&&Z&&W.type==="number"&&Z.memoizedProps.value!=null&&zr(W,"number",W.value)}switch(_e=Z?Ys(Z):window,e){case"focusin":(Xd(_e)||_e.contentEditable==="true")&&(ls=_e,Pr=Z,an=null);break;case"focusout":an=Pr=ls=null;break;case"mousedown":Hr=!0;break;case"contextmenu":case"mouseup":case"dragend":Hr=!1,ru(re,i,se);break;case"selectionchange":if(Pg)break;case"keydown":case"keyup":ru(re,i,se)}var Be;if($r)e:{switch(e){case"compositionstart":var Ge="onCompositionStart";break e;case"compositionend":Ge="onCompositionEnd";break e;case"compositionupdate":Ge="onCompositionUpdate";break e}Ge=void 0}else ns?Qd(e,i)&&(Ge="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ge="onCompositionStart");Ge&&(Gd&&i.locale!=="ko"&&(ns||Ge!=="onCompositionStart"?Ge==="onCompositionEnd"&&ns&&(Be=Bd()):(Ja=se,kr="value"in Ja?Ja.value:Ja.textContent,ns=!0)),_e=ql(Z,Ge),0<_e.length&&(Ge=new Pd(Ge,e,null,i,se),re.push({event:Ge,listeners:_e}),Be?Ge.data=Be:(Be=Kd(i),Be!==null&&(Ge.data=Be)))),(Be=Rg?kg(e,i):Mg(e,i))&&(Ge=ql(Z,"onBeforeInput"),0<Ge.length&&(_e=new Pd("onBeforeInput","beforeinput",null,i,se),re.push({event:_e,listeners:Ge}),_e.data=Be)),Cx(re,e,Z,i,se)}Rm(re,t)})}function zn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function ql(e,t){for(var i=t+"Capture",n=[];e!==null;){var c=e,h=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||h===null||(c=Qs(e,i),c!=null&&n.unshift(zn(e,c,h)),c=Qs(e,t),c!=null&&n.push(zn(e,c,h))),e.tag===3)return n;e=e.return}return[]}function Ax(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Mm(e,t,i,n,c){for(var h=t._reactName,v=[];i!==null&&i!==n;){var C=i,B=C.alternate,Z=C.stateNode;if(C=C.tag,B!==null&&B===n)break;C!==5&&C!==26&&C!==27||Z===null||(B=Z,c?(Z=Qs(i,h),Z!=null&&v.unshift(zn(i,Z,B))):c||(Z=Qs(i,h),Z!=null&&v.push(zn(i,Z,B)))),i=i.return}v.length!==0&&e.push({event:t,listeners:v})}var Dx=/\r\n?/g,Ox=/\u0000|\uFFFD/g;function Um(e){return(typeof e=="string"?e:""+e).replace(Dx,`
`).replace(Ox,"")}function Fm(e,t){return t=Um(t),Um(e)===t}function at(e,t,i,n,c,h){switch(i){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||as(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&as(e,""+n);break;case"className":Vn(e,"class",n);break;case"tabIndex":Vn(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":Vn(e,i,n);break;case"style":Fd(e,n,h);break;case"data":if(t!=="object"){Vn(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||i!=="href")){e.removeAttribute(i);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(i);break}n=Qn(""+n),e.setAttribute(i,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(i,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(i==="formAction"?(t!=="input"&&at(e,t,"name",c.name,c,null),at(e,t,"formEncType",c.formEncType,c,null),at(e,t,"formMethod",c.formMethod,c,null),at(e,t,"formTarget",c.formTarget,c,null)):(at(e,t,"encType",c.encType,c,null),at(e,t,"method",c.method,c,null),at(e,t,"target",c.target,c,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(i);break}n=Qn(""+n),e.setAttribute(i,n);break;case"onClick":n!=null&&(e.onclick=Da);break;case"onScroll":n!=null&&Pe("scroll",e);break;case"onScrollEnd":n!=null&&Pe("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(r(61));if(i=n.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}i=Qn(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,""+n):e.removeAttribute(i);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,""):e.removeAttribute(i);break;case"capture":case"download":n===!0?e.setAttribute(i,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(i,n):e.removeAttribute(i);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(i,n):e.removeAttribute(i);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(i):e.setAttribute(i,n);break;case"popover":Pe("beforetoggle",e),Pe("toggle",e),Gn(e,"popover",n);break;case"xlinkActuate":Aa(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":Aa(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":Aa(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":Aa(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":Aa(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":Aa(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":Aa(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":Aa(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":Aa(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":Gn(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(i=lg.get(i)||i,Gn(e,i,n))}}function gc(e,t,i,n,c,h){switch(i){case"style":Fd(e,n,h);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(r(61));if(i=n.__html,i!=null){if(c.children!=null)throw Error(r(60));e.innerHTML=i}}break;case"children":typeof n=="string"?as(e,n):(typeof n=="number"||typeof n=="bigint")&&as(e,""+n);break;case"onScroll":n!=null&&Pe("scroll",e);break;case"onScrollEnd":n!=null&&Pe("scrollend",e);break;case"onClick":n!=null&&(e.onclick=Da);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!zd.hasOwnProperty(i))e:{if(i[0]==="o"&&i[1]==="n"&&(c=i.endsWith("Capture"),t=i.slice(2,c?i.length-7:void 0),h=e[Bt]||null,h=h!=null?h[i]:null,typeof h=="function"&&e.removeEventListener(t,h,c),typeof n=="function")){typeof h!="function"&&h!==null&&(i in e?e[i]=null:e.hasAttribute(i)&&e.removeAttribute(i)),e.addEventListener(t,n,c);break e}i in e?e[i]=n:n===!0?e.setAttribute(i,""):Gn(e,i,n)}}}function kt(e,t,i){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Pe("error",e),Pe("load",e);var n=!1,c=!1,h;for(h in i)if(i.hasOwnProperty(h)){var v=i[h];if(v!=null)switch(h){case"src":n=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:at(e,t,h,v,i,null)}}c&&at(e,t,"srcSet",i.srcSet,i,null),n&&at(e,t,"src",i.src,i,null);return;case"input":Pe("invalid",e);var C=h=v=c=null,B=null,Z=null;for(n in i)if(i.hasOwnProperty(n)){var se=i[n];if(se!=null)switch(n){case"name":c=se;break;case"type":v=se;break;case"checked":B=se;break;case"defaultChecked":Z=se;break;case"value":h=se;break;case"defaultValue":C=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(r(137,t));break;default:at(e,t,n,se,i,null)}}Rd(e,h,C,B,Z,v,c,!1);return;case"select":Pe("invalid",e),n=v=h=null;for(c in i)if(i.hasOwnProperty(c)&&(C=i[c],C!=null))switch(c){case"value":h=C;break;case"defaultValue":v=C;break;case"multiple":n=C;default:at(e,t,c,C,i,null)}t=h,i=v,e.multiple=!!n,t!=null?ts(e,!!n,t,!1):i!=null&&ts(e,!!n,i,!0);return;case"textarea":Pe("invalid",e),h=c=n=null;for(v in i)if(i.hasOwnProperty(v)&&(C=i[v],C!=null))switch(v){case"value":n=C;break;case"defaultValue":c=C;break;case"children":h=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(r(91));break;default:at(e,t,v,C,i,null)}Md(e,n,c,h);return;case"option":for(B in i)if(i.hasOwnProperty(B)&&(n=i[B],n!=null))switch(B){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:at(e,t,B,n,i,null)}return;case"dialog":Pe("beforetoggle",e),Pe("toggle",e),Pe("cancel",e),Pe("close",e);break;case"iframe":case"object":Pe("load",e);break;case"video":case"audio":for(n=0;n<En.length;n++)Pe(En[n],e);break;case"image":Pe("error",e),Pe("load",e);break;case"details":Pe("toggle",e);break;case"embed":case"source":case"link":Pe("error",e),Pe("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Z in i)if(i.hasOwnProperty(Z)&&(n=i[Z],n!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:at(e,t,Z,n,i,null)}return;default:if(Tr(t)){for(se in i)i.hasOwnProperty(se)&&(n=i[se],n!==void 0&&gc(e,t,se,n,i,void 0));return}}for(C in i)i.hasOwnProperty(C)&&(n=i[C],n!=null&&at(e,t,C,n,i,null))}function Rx(e,t,i,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,h=null,v=null,C=null,B=null,Z=null,se=null;for(ae in i){var re=i[ae];if(i.hasOwnProperty(ae)&&re!=null)switch(ae){case"checked":break;case"value":break;case"defaultValue":B=re;default:n.hasOwnProperty(ae)||at(e,t,ae,null,n,re)}}for(var W in n){var ae=n[W];if(re=i[W],n.hasOwnProperty(W)&&(ae!=null||re!=null))switch(W){case"type":h=ae;break;case"name":c=ae;break;case"checked":Z=ae;break;case"defaultChecked":se=ae;break;case"value":v=ae;break;case"defaultValue":C=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(r(137,t));break;default:ae!==re&&at(e,t,W,ae,n,re)}}Er(e,v,C,B,Z,se,h,c);return;case"select":ae=v=C=W=null;for(h in i)if(B=i[h],i.hasOwnProperty(h)&&B!=null)switch(h){case"value":break;case"multiple":ae=B;default:n.hasOwnProperty(h)||at(e,t,h,null,n,B)}for(c in n)if(h=n[c],B=i[c],n.hasOwnProperty(c)&&(h!=null||B!=null))switch(c){case"value":W=h;break;case"defaultValue":C=h;break;case"multiple":v=h;default:h!==B&&at(e,t,c,h,n,B)}t=C,i=v,n=ae,W!=null?ts(e,!!i,W,!1):!!n!=!!i&&(t!=null?ts(e,!!i,t,!0):ts(e,!!i,i?[]:"",!1));return;case"textarea":ae=W=null;for(C in i)if(c=i[C],i.hasOwnProperty(C)&&c!=null&&!n.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:at(e,t,C,null,n,c)}for(v in n)if(c=n[v],h=i[v],n.hasOwnProperty(v)&&(c!=null||h!=null))switch(v){case"value":W=c;break;case"defaultValue":ae=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(r(91));break;default:c!==h&&at(e,t,v,c,n,h)}kd(e,W,ae);return;case"option":for(var ye in i)if(W=i[ye],i.hasOwnProperty(ye)&&W!=null&&!n.hasOwnProperty(ye))switch(ye){case"selected":e.selected=!1;break;default:at(e,t,ye,null,n,W)}for(B in n)if(W=n[B],ae=i[B],n.hasOwnProperty(B)&&W!==ae&&(W!=null||ae!=null))switch(B){case"selected":e.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:at(e,t,B,W,n,ae)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Oe in i)W=i[Oe],i.hasOwnProperty(Oe)&&W!=null&&!n.hasOwnProperty(Oe)&&at(e,t,Oe,null,n,W);for(Z in n)if(W=n[Z],ae=i[Z],n.hasOwnProperty(Z)&&W!==ae&&(W!=null||ae!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(137,t));break;default:at(e,t,Z,W,n,ae)}return;default:if(Tr(t)){for(var it in i)W=i[it],i.hasOwnProperty(it)&&W!==void 0&&!n.hasOwnProperty(it)&&gc(e,t,it,void 0,n,W);for(se in n)W=n[se],ae=i[se],!n.hasOwnProperty(se)||W===ae||W===void 0&&ae===void 0||gc(e,t,se,W,n,ae);return}}for(var Y in i)W=i[Y],i.hasOwnProperty(Y)&&W!=null&&!n.hasOwnProperty(Y)&&at(e,t,Y,null,n,W);for(re in n)W=n[re],ae=i[re],!n.hasOwnProperty(re)||W===ae||W==null&&ae==null||at(e,t,re,W,n,ae)}function Lm(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kx(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,i=performance.getEntriesByType("resource"),n=0;n<i.length;n++){var c=i[n],h=c.transferSize,v=c.initiatorType,C=c.duration;if(h&&C&&Lm(v)){for(v=0,C=c.responseEnd,n+=1;n<i.length;n++){var B=i[n],Z=B.startTime;if(Z>C)break;var se=B.transferSize,re=B.initiatorType;se&&Lm(re)&&(B=B.responseEnd,v+=se*(B<C?1:(C-Z)/(B-Z)))}if(--n,t+=8*(h+v)/(c.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var xc=null,bc=null;function Pl(e){return e.nodeType===9?e:e.ownerDocument}function $m(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Bm(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var yc=null;function Mx(){var e=window.event;return e&&e.type==="popstate"?e===yc?!1:(yc=e,!0):(yc=null,!1)}var Im=typeof setTimeout=="function"?setTimeout:void 0,Ux=typeof clearTimeout=="function"?clearTimeout:void 0,qm=typeof Promise=="function"?Promise:void 0,Fx=typeof queueMicrotask=="function"?queueMicrotask:typeof qm<"u"?function(e){return qm.resolve(null).then(e).catch(Lx)}:Im;function Lx(e){setTimeout(function(){throw e})}function fi(e){return e==="head"}function Pm(e,t){var i=t,n=0;do{var c=i.nextSibling;if(e.removeChild(i),c&&c.nodeType===8)if(i=c.data,i==="/$"||i==="/&"){if(n===0){e.removeChild(c),Rs(t);return}n--}else if(i==="$"||i==="$?"||i==="$~"||i==="$!"||i==="&")n++;else if(i==="html")Tn(e.ownerDocument.documentElement);else if(i==="head"){i=e.ownerDocument.head,Tn(i);for(var h=i.firstChild;h;){var v=h.nextSibling,C=h.nodeName;h[Vs]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&h.rel.toLowerCase()==="stylesheet"||i.removeChild(h),h=v}}else i==="body"&&Tn(e.ownerDocument.body);i=c}while(i);Rs(t)}function Hm(e,t){var i=e;e=0;do{var n=i.nextSibling;if(i.nodeType===1?t?(i._stashedDisplay=i.style.display,i.style.display="none"):(i.style.display=i._stashedDisplay||"",i.getAttribute("style")===""&&i.removeAttribute("style")):i.nodeType===3&&(t?(i._stashedText=i.nodeValue,i.nodeValue=""):i.nodeValue=i._stashedText||""),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(e===0)break;e--}else i!=="$"&&i!=="$?"&&i!=="$~"&&i!=="$!"||e++;i=n}while(i)}function jc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var i=t;switch(t=t.nextSibling,i.nodeName){case"HTML":case"HEAD":case"BODY":jc(i),Sr(i);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(i.rel.toLowerCase()==="stylesheet")continue}e.removeChild(i)}}function $x(e,t,i,n){for(;e.nodeType===1;){var c=i;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[Vs])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(h=e.getAttribute("rel"),h==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(h!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(h=e.getAttribute("src"),(h!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&h&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var h=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===h)return e}else return e;if(e=fa(e.nextSibling),e===null)break}return null}function Bx(e,t,i){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!i||(e=fa(e.nextSibling),e===null))return null;return e}function Gm(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=fa(e.nextSibling),e===null))return null;return e}function Nc(e){return e.data==="$?"||e.data==="$~"}function _c(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Ix(e,t){var i=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||i.readyState!=="loading")t();else{var n=function(){t(),i.removeEventListener("DOMContentLoaded",n)};i.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function fa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var wc=null;function Vm(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"||i==="/&"){if(t===0)return fa(e.nextSibling);t--}else i!=="$"&&i!=="$!"&&i!=="$?"&&i!=="$~"&&i!=="&"||t++}e=e.nextSibling}return null}function Ym(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"){if(t===0)return e;t--}else i!=="/$"&&i!=="/&"||t++}e=e.previousSibling}return null}function Qm(e,t,i){switch(t=Pl(i),e){case"html":if(e=t.documentElement,!e)throw Error(r(452));return e;case"head":if(e=t.head,!e)throw Error(r(453));return e;case"body":if(e=t.body,!e)throw Error(r(454));return e;default:throw Error(r(451))}}function Tn(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Sr(e)}var pa=new Map,Km=new Set;function Hl(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ya=D.d;D.d={f:qx,r:Px,D:Hx,C:Gx,L:Vx,m:Yx,X:Kx,S:Qx,M:Xx};function qx(){var e=Ya.f(),t=Ml();return e||t}function Px(e){var t=Zi(e);t!==null&&t.tag===5&&t.type==="form"?hh(t):Ya.r(e)}var As=typeof document>"u"?null:document;function Xm(e,t,i){var n=As;if(n&&typeof t=="string"&&t){var c=ra(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof i=="string"&&(c+='[crossorigin="'+i+'"]'),Km.has(c)||(Km.add(c),e={rel:e,crossOrigin:i,href:t},n.querySelector(c)===null&&(t=n.createElement("link"),kt(t,"link",e),zt(t),n.head.appendChild(t)))}}function Hx(e){Ya.D(e),Xm("dns-prefetch",e,null)}function Gx(e,t){Ya.C(e,t),Xm("preconnect",e,t)}function Vx(e,t,i){Ya.L(e,t,i);var n=As;if(n&&e&&t){var c='link[rel="preload"][as="'+ra(t)+'"]';t==="image"&&i&&i.imageSrcSet?(c+='[imagesrcset="'+ra(i.imageSrcSet)+'"]',typeof i.imageSizes=="string"&&(c+='[imagesizes="'+ra(i.imageSizes)+'"]')):c+='[href="'+ra(e)+'"]';var h=c;switch(t){case"style":h=Ds(e);break;case"script":h=Os(e)}pa.has(h)||(e=p({rel:"preload",href:t==="image"&&i&&i.imageSrcSet?void 0:e,as:t},i),pa.set(h,e),n.querySelector(c)!==null||t==="style"&&n.querySelector(An(h))||t==="script"&&n.querySelector(Dn(h))||(t=n.createElement("link"),kt(t,"link",e),zt(t),n.head.appendChild(t)))}}function Yx(e,t){Ya.m(e,t);var i=As;if(i&&e){var n=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+ra(n)+'"][href="'+ra(e)+'"]',h=c;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=Os(e)}if(!pa.has(h)&&(e=p({rel:"modulepreload",href:e},t),pa.set(h,e),i.querySelector(c)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(i.querySelector(Dn(h)))return}n=i.createElement("link"),kt(n,"link",e),zt(n),i.head.appendChild(n)}}}function Qx(e,t,i){Ya.S(e,t,i);var n=As;if(n&&e){var c=Wi(n).hoistableStyles,h=Ds(e);t=t||"default";var v=c.get(h);if(!v){var C={loading:0,preload:null};if(v=n.querySelector(An(h)))C.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},i),(i=pa.get(h))&&Sc(e,i);var B=v=n.createElement("link");zt(B),kt(B,"link",e),B._p=new Promise(function(Z,se){B.onload=Z,B.onerror=se}),B.addEventListener("load",function(){C.loading|=1}),B.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Gl(v,t,n)}v={type:"stylesheet",instance:v,count:1,state:C},c.set(h,v)}}}function Kx(e,t){Ya.X(e,t);var i=As;if(i&&e){var n=Wi(i).hoistableScripts,c=Os(e),h=n.get(c);h||(h=i.querySelector(Dn(c)),h||(e=p({src:e,async:!0},t),(t=pa.get(c))&&Cc(e,t),h=i.createElement("script"),zt(h),kt(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},n.set(c,h))}}function Xx(e,t){Ya.M(e,t);var i=As;if(i&&e){var n=Wi(i).hoistableScripts,c=Os(e),h=n.get(c);h||(h=i.querySelector(Dn(c)),h||(e=p({src:e,async:!0,type:"module"},t),(t=pa.get(c))&&Cc(e,t),h=i.createElement("script"),zt(h),kt(h,"link",e),i.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},n.set(c,h))}}function Jm(e,t,i,n){var c=(c=ne.current)?Hl(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return typeof i.precedence=="string"&&typeof i.href=="string"?(t=Ds(i.href),i=Wi(c).hoistableStyles,n=i.get(t),n||(n={type:"style",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(i.rel==="stylesheet"&&typeof i.href=="string"&&typeof i.precedence=="string"){e=Ds(i.href);var h=Wi(c).hoistableStyles,v=h.get(e);if(v||(c=c.ownerDocument||c,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(e,v),(h=c.querySelector(An(e)))&&!h._p&&(v.instance=h,v.state.loading=5),pa.has(e)||(i={rel:"preload",as:"style",href:i.href,crossOrigin:i.crossOrigin,integrity:i.integrity,media:i.media,hrefLang:i.hrefLang,referrerPolicy:i.referrerPolicy},pa.set(e,i),h||Jx(c,e,i,v.state))),t&&n===null)throw Error(r(528,""));return v}if(t&&n!==null)throw Error(r(529,""));return null;case"script":return t=i.async,i=i.src,typeof i=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Os(i),i=Wi(c).hoistableScripts,n=i.get(t),n||(n={type:"script",instance:null,count:0,state:null},i.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Ds(e){return'href="'+ra(e)+'"'}function An(e){return'link[rel="stylesheet"]['+e+"]"}function Zm(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Jx(e,t,i,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),kt(t,"link",i),zt(t),e.head.appendChild(t))}function Os(e){return'[src="'+ra(e)+'"]'}function Dn(e){return"script[async]"+e}function Wm(e,t,i){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+ra(i.href)+'"]');if(n)return t.instance=n,zt(n),n;var c=p({},i,{"data-href":i.href,"data-precedence":i.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),zt(n),kt(n,"style",c),Gl(n,i.precedence,e),t.instance=n;case"stylesheet":c=Ds(i.href);var h=e.querySelector(An(c));if(h)return t.state.loading|=4,t.instance=h,zt(h),h;n=Zm(i),(c=pa.get(c))&&Sc(n,c),h=(e.ownerDocument||e).createElement("link"),zt(h);var v=h;return v._p=new Promise(function(C,B){v.onload=C,v.onerror=B}),kt(h,"link",n),t.state.loading|=4,Gl(h,i.precedence,e),t.instance=h;case"script":return h=Os(i.src),(c=e.querySelector(Dn(h)))?(t.instance=c,zt(c),c):(n=i,(c=pa.get(h))&&(n=p({},i),Cc(n,c)),e=e.ownerDocument||e,c=e.createElement("script"),zt(c),kt(c,"link",n),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(r(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,Gl(n,i.precedence,e));return t.instance}function Gl(e,t,i){for(var n=i.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=n.length?n[n.length-1]:null,h=c,v=0;v<n.length;v++){var C=n[v];if(C.dataset.precedence===t)h=C;else if(h!==c)break}h?h.parentNode.insertBefore(e,h.nextSibling):(t=i.nodeType===9?i.head:i,t.insertBefore(e,t.firstChild))}function Sc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Cc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var Vl=null;function ef(e,t,i){if(Vl===null){var n=new Map,c=Vl=new Map;c.set(i,n)}else c=Vl,n=c.get(i),n||(n=new Map,c.set(i,n));if(n.has(e))return n;for(n.set(e,null),i=i.getElementsByTagName(e),c=0;c<i.length;c++){var h=i[c];if(!(h[Vs]||h[At]||e==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var v=h.getAttribute(t)||"";v=e+v;var C=n.get(v);C?C.push(h):n.set(v,[h])}}return n}function tf(e,t,i){e=e.ownerDocument||e,e.head.insertBefore(i,t==="title"?e.querySelector("head > title"):null)}function Zx(e,t,i){if(i===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function af(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Wx(e,t,i,n){if(i.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var c=Ds(n.href),h=t.querySelector(An(c));if(h){t=h._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=Yl.bind(e),t.then(e,e)),i.state.loading|=4,i.instance=h,zt(h);return}h=t.ownerDocument||t,n=Zm(n),(c=pa.get(c))&&Sc(n,c),h=h.createElement("link"),zt(h);var v=h;v._p=new Promise(function(C,B){v.onload=C,v.onerror=B}),kt(h,"link",n),i.instance=h}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(i,t),(t=i.state.preload)&&(i.state.loading&3)===0&&(e.count++,i=Yl.bind(e),t.addEventListener("load",i),t.addEventListener("error",i))}}var Ec=0;function eb(e,t){return e.stylesheets&&e.count===0&&Kl(e,e.stylesheets),0<e.count||0<e.imgCount?function(i){var n=setTimeout(function(){if(e.stylesheets&&Kl(e,e.stylesheets),e.unsuspend){var h=e.unsuspend;e.unsuspend=null,h()}},6e4+t);0<e.imgBytes&&Ec===0&&(Ec=62500*kx());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Kl(e,e.stylesheets),e.unsuspend)){var h=e.unsuspend;e.unsuspend=null,h()}},(e.imgBytes>Ec?50:800)+t);return e.unsuspend=i,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(c)}}:null}function Yl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Kl(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Ql=null;function Kl(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Ql=new Map,t.forEach(tb,e),Ql=null,Yl.call(e))}function tb(e,t){if(!(t.state.loading&4)){var i=Ql.get(e);if(i)var n=i.get(null);else{i=new Map,Ql.set(e,i);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<c.length;h++){var v=c[h];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(i.set(v.dataset.precedence,v),n=v)}n&&i.set(null,n)}c=t.instance,v=c.getAttribute("data-precedence"),h=i.get(v)||n,h===n&&i.set(null,c),i.set(v,c),this.count++,n=Yl.bind(this),c.addEventListener("load",n),c.addEventListener("error",n),h?h.parentNode.insertBefore(c,h.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var On={$$typeof:j,Provider:null,Consumer:null,_currentValue:R,_currentValue2:R,_threadCount:0};function ab(e,t,i,n,c,h,v,C,B){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=jr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jr(0),this.hiddenUpdates=jr(null),this.identifierPrefix=n,this.onUncaughtError=c,this.onCaughtError=h,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function sf(e,t,i,n,c,h,v,C,B,Z,se,re){return e=new ab(e,t,i,v,B,Z,se,re,C),t=1,h===!0&&(t|=24),h=Xt(3,null,null,t),e.current=h,h.stateNode=e,t=no(),t.refCount++,e.pooledCache=t,t.refCount++,h.memoizedState={element:n,isDehydrated:i,cache:t},co(h),e}function nf(e){return e?(e=cs,e):cs}function lf(e,t,i,n,c,h){c=nf(c),n.context===null?n.context=c:n.pendingContext=c,n=ii(t),n.payload={element:i},h=h===void 0?null:h,h!==null&&(n.callback=h),i=si(e,n,t),i!==null&&(Vt(i,e,t),dn(i,e,t))}function rf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function zc(e,t){rf(e,t),(e=e.alternate)&&rf(e,t)}function of(e){if(e.tag===13||e.tag===31){var t=Ei(e,67108864);t!==null&&Vt(t,e,67108864),zc(e,67108864)}}function cf(e){if(e.tag===13||e.tag===31){var t=ta();t=Nr(t);var i=Ei(e,t);i!==null&&Vt(i,e,t),zc(e,t)}}var Xl=!0;function ib(e,t,i,n){var c=U.T;U.T=null;var h=D.p;try{D.p=2,Tc(e,t,i,n)}finally{D.p=h,U.T=c}}function sb(e,t,i,n){var c=U.T;U.T=null;var h=D.p;try{D.p=8,Tc(e,t,i,n)}finally{D.p=h,U.T=c}}function Tc(e,t,i,n){if(Xl){var c=Ac(n);if(c===null)pc(e,t,n,Jl,i),uf(e,n);else if(lb(c,e,t,i,n))n.stopPropagation();else if(uf(e,n),t&4&&-1<nb.indexOf(e)){for(;c!==null;){var h=Zi(c);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var v=va(h.pendingLanes);if(v!==0){var C=h;for(C.pendingLanes|=2,C.entangledLanes|=2;v;){var B=1<<31-xe(v);C.entanglements[1]|=B,v&=~B}Ta(h),(Xe&6)===0&&(Rl=oe()+500,Cn(0))}}break;case 31:case 13:C=Ei(h,2),C!==null&&Vt(C,h,2),Ml(),zc(h,2)}if(h=Ac(n),h===null&&pc(e,t,n,Jl,i),h===c)break;c=h}c!==null&&n.stopPropagation()}else pc(e,t,n,null,i)}}function Ac(e){return e=Dr(e),Dc(e)}var Jl=null;function Dc(e){if(Jl=null,e=Ji(e),e!==null){var t=u(e);if(t===null)e=null;else{var i=t.tag;if(i===13){if(e=m(t),e!==null)return e;e=null}else if(i===31){if(e=x(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Jl=e,null}function df(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ge()){case je:return 2;case De:return 8;case Me:case $:return 32;case fe:return 268435456;default:return 32}default:return 32}}var Oc=!1,pi=null,gi=null,xi=null,Rn=new Map,kn=new Map,bi=[],nb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function uf(e,t){switch(e){case"focusin":case"focusout":pi=null;break;case"dragenter":case"dragleave":gi=null;break;case"mouseover":case"mouseout":xi=null;break;case"pointerover":case"pointerout":Rn.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kn.delete(t.pointerId)}}function Mn(e,t,i,n,c,h){return e===null||e.nativeEvent!==h?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:h,targetContainers:[c]},t!==null&&(t=Zi(t),t!==null&&of(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function lb(e,t,i,n,c){switch(t){case"focusin":return pi=Mn(pi,e,t,i,n,c),!0;case"dragenter":return gi=Mn(gi,e,t,i,n,c),!0;case"mouseover":return xi=Mn(xi,e,t,i,n,c),!0;case"pointerover":var h=c.pointerId;return Rn.set(h,Mn(Rn.get(h)||null,e,t,i,n,c)),!0;case"gotpointercapture":return h=c.pointerId,kn.set(h,Mn(kn.get(h)||null,e,t,i,n,c)),!0}return!1}function hf(e){var t=Ji(e.target);if(t!==null){var i=u(t);if(i!==null){if(t=i.tag,t===13){if(t=m(i),t!==null){e.blockedOn=t,Sd(e.priority,function(){cf(i)});return}}else if(t===31){if(t=x(i),t!==null){e.blockedOn=t,Sd(e.priority,function(){cf(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Zl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=Ac(e.nativeEvent);if(i===null){i=e.nativeEvent;var n=new i.constructor(i.type,i);Ar=n,i.target.dispatchEvent(n),Ar=null}else return t=Zi(i),t!==null&&of(t),e.blockedOn=i,!1;t.shift()}return!0}function mf(e,t,i){Zl(e)&&i.delete(t)}function rb(){Oc=!1,pi!==null&&Zl(pi)&&(pi=null),gi!==null&&Zl(gi)&&(gi=null),xi!==null&&Zl(xi)&&(xi=null),Rn.forEach(mf),kn.forEach(mf)}function Wl(e,t){e.blockedOn===t&&(e.blockedOn=null,Oc||(Oc=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,rb)))}var er=null;function ff(e){er!==e&&(er=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){er===e&&(er=null);for(var t=0;t<e.length;t+=3){var i=e[t],n=e[t+1],c=e[t+2];if(typeof n!="function"){if(Dc(n||i)===null)continue;break}var h=Zi(i);h!==null&&(e.splice(t,3),t-=3,Ao(h,{pending:!0,data:c,method:i.method,action:n},n,c))}}))}function Rs(e){function t(B){return Wl(B,e)}pi!==null&&Wl(pi,e),gi!==null&&Wl(gi,e),xi!==null&&Wl(xi,e),Rn.forEach(t),kn.forEach(t);for(var i=0;i<bi.length;i++){var n=bi[i];n.blockedOn===e&&(n.blockedOn=null)}for(;0<bi.length&&(i=bi[0],i.blockedOn===null);)hf(i),i.blockedOn===null&&bi.shift();if(i=(e.ownerDocument||e).$$reactFormReplay,i!=null)for(n=0;n<i.length;n+=3){var c=i[n],h=i[n+1],v=c[Bt]||null;if(typeof h=="function")v||ff(i);else if(v){var C=null;if(h&&h.hasAttribute("formAction")){if(c=h,v=h[Bt]||null)C=v.formAction;else if(Dc(c)!==null)continue}else C=v.action;typeof C=="function"?i[n+1]=C:(i.splice(n,3),n-=3),ff(i)}}}function pf(){function e(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(v){return c=v})},focusReset:"manual",scroll:"manual"})}function t(){c!==null&&(c(),c=null),n||setTimeout(i,20)}function i(){if(!n&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(i,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),c!==null&&(c(),c=null)}}}function Rc(e){this._internalRoot=e}tr.prototype.render=Rc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(r(409));var i=t.current,n=ta();lf(i,n,e,t,null,null)},tr.prototype.unmount=Rc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;lf(e.current,2,null,e,null,null),Ml(),t[Xi]=null}};function tr(e){this._internalRoot=e}tr.prototype.unstable_scheduleHydration=function(e){if(e){var t=wd();e={blockedOn:null,target:e,priority:t};for(var i=0;i<bi.length&&t!==0&&t<bi[i].priority;i++);bi.splice(i,0,e),i===0&&hf(e)}};var gf=s.version;if(gf!=="19.2.0")throw Error(r(527,gf,"19.2.0"));D.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(r(188)):(e=Object.keys(e).join(","),Error(r(268,e)));return e=f(t),e=e!==null?b(e):null,e=e===null?null:e.stateNode,e};var ob={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ar=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ar.isDisabled&&ar.supportsFiber)try{lt=ar.inject(ob),Ie=ar}catch{}}return Fn.createRoot=function(e,t){if(!d(e))throw Error(r(299));var i=!1,n="",c=Nh,h=_h,v=wh;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(h=t.onCaughtError),t.onRecoverableError!==void 0&&(v=t.onRecoverableError)),t=sf(e,1,!1,null,null,i,n,null,c,h,v,pf),e[Xi]=t.current,fc(e),new Rc(t)},Fn.hydrateRoot=function(e,t,i){if(!d(e))throw Error(r(299));var n=!1,c="",h=Nh,v=_h,C=wh,B=null;return i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(h=i.onUncaughtError),i.onCaughtError!==void 0&&(v=i.onCaughtError),i.onRecoverableError!==void 0&&(C=i.onRecoverableError),i.formState!==void 0&&(B=i.formState)),t=sf(e,1,!0,t,i??null,n,c,B,h,v,C,pf),t.context=nf(null),i=t.current,n=ta(),n=Nr(n),c=ii(n),c.callback=null,si(i,c,n),i=n,t.current.lanes=i,Gs(t,i),Ta(t),e[Xi]=t.current,fc(e),new tr(t)},Fn.version="19.2.0",Fn}var Cf;function jb(){if(Cf)return Uc.exports;Cf=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(s){console.error(s)}}return o(),Uc.exports=yb(),Uc.exports}var Nb=jb();const _b=cd(Nb);var Xc=function(o,s){return Xc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,r){l.__proto__=r}||function(l,r){for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(l[d]=r[d])},Xc(o,s)};function ap(o,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");Xc(o,s);function l(){this.constructor=o}o.prototype=s===null?Object.create(s):(l.prototype=s.prototype,new l)}var mr=function(){return mr=Object.assign||function(s){for(var l,r=1,d=arguments.length;r<d;r++){l=arguments[r];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(s[u]=l[u])}return s},mr.apply(this,arguments)};function Ps(o,s){var l={};for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&s.indexOf(r)<0&&(l[r]=o[r]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,r=Object.getOwnPropertySymbols(o);d<r.length;d++)s.indexOf(r[d])<0&&Object.prototype.propertyIsEnumerable.call(o,r[d])&&(l[r[d]]=o[r[d]]);return l}function ip(o,s,l,r){var d=arguments.length,u=d<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,l):r,m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,s,l,r);else for(var x=o.length-1;x>=0;x--)(m=o[x])&&(u=(d<3?m(u):d>3?m(s,l,u):m(s,l))||u);return d>3&&u&&Object.defineProperty(s,l,u),u}function sp(o,s){return function(l,r){s(l,r,o)}}function np(o,s,l,r,d,u){function m(z){if(z!==void 0&&typeof z!="function")throw new TypeError("Function expected");return z}for(var x=r.kind,g=x==="getter"?"get":x==="setter"?"set":"value",f=!s&&o?r.static?o:o.prototype:null,b=s||(f?Object.getOwnPropertyDescriptor(f,r.name):{}),p,_=!1,S=l.length-1;S>=0;S--){var N={};for(var O in r)N[O]=O==="access"?{}:r[O];for(var O in r.access)N.access[O]=r.access[O];N.addInitializer=function(z){if(_)throw new TypeError("Cannot add initializers after decoration has completed");u.push(m(z||null))};var T=(0,l[S])(x==="accessor"?{get:b.get,set:b.set}:b[g],N);if(x==="accessor"){if(T===void 0)continue;if(T===null||typeof T!="object")throw new TypeError("Object expected");(p=m(T.get))&&(b.get=p),(p=m(T.set))&&(b.set=p),(p=m(T.init))&&d.unshift(p)}else(p=m(T))&&(x==="field"?d.unshift(p):b[g]=p)}f&&Object.defineProperty(f,r.name,b),_=!0}function lp(o,s,l){for(var r=arguments.length>2,d=0;d<s.length;d++)l=r?s[d].call(o,l):s[d].call(o);return r?l:void 0}function rp(o){return typeof o=="symbol"?o:"".concat(o)}function op(o,s,l){return typeof s=="symbol"&&(s=s.description?"[".concat(s.description,"]"):""),Object.defineProperty(o,"name",{configurable:!0,value:l?"".concat(l," ",s):s})}function cp(o,s){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,s)}function Se(o,s,l,r){function d(u){return u instanceof l?u:new l(function(m){m(u)})}return new(l||(l=Promise))(function(u,m){function x(b){try{f(r.next(b))}catch(p){m(p)}}function g(b){try{f(r.throw(b))}catch(p){m(p)}}function f(b){b.done?u(b.value):d(b.value).then(x,g)}f((r=r.apply(o,s||[])).next())})}function dp(o,s){var l={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,d,u,m=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return m.next=x(0),m.throw=x(1),m.return=x(2),typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function x(f){return function(b){return g([f,b])}}function g(f){if(r)throw new TypeError("Generator is already executing.");for(;m&&(m=0,f[0]&&(l=0)),l;)try{if(r=1,d&&(u=f[0]&2?d.return:f[0]?d.throw||((u=d.return)&&u.call(d),0):d.next)&&!(u=u.call(d,f[1])).done)return u;switch(d=0,u&&(f=[f[0]&2,u.value]),f[0]){case 0:case 1:u=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,d=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(u=l.trys,!(u=u.length>0&&u[u.length-1])&&(f[0]===6||f[0]===2)){l=0;continue}if(f[0]===3&&(!u||f[1]>u[0]&&f[1]<u[3])){l.label=f[1];break}if(f[0]===6&&l.label<u[1]){l.label=u[1],u=f;break}if(u&&l.label<u[2]){l.label=u[2],l.ops.push(f);break}u[2]&&l.ops.pop(),l.trys.pop();continue}f=s.call(o,l)}catch(b){f=[6,b],d=0}finally{r=u=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var br=Object.create?(function(o,s,l,r){r===void 0&&(r=l);var d=Object.getOwnPropertyDescriptor(s,l);(!d||("get"in d?!s.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return s[l]}}),Object.defineProperty(o,r,d)}):(function(o,s,l,r){r===void 0&&(r=l),o[r]=s[l]});function up(o,s){for(var l in o)l!=="default"&&!Object.prototype.hasOwnProperty.call(s,l)&&br(s,o,l)}function fr(o){var s=typeof Symbol=="function"&&Symbol.iterator,l=s&&o[s],r=0;if(l)return l.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&r>=o.length&&(o=void 0),{value:o&&o[r++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function ud(o,s){var l=typeof Symbol=="function"&&o[Symbol.iterator];if(!l)return o;var r=l.call(o),d,u=[],m;try{for(;(s===void 0||s-- >0)&&!(d=r.next()).done;)u.push(d.value)}catch(x){m={error:x}}finally{try{d&&!d.done&&(l=r.return)&&l.call(r)}finally{if(m)throw m.error}}return u}function hp(){for(var o=[],s=0;s<arguments.length;s++)o=o.concat(ud(arguments[s]));return o}function mp(){for(var o=0,s=0,l=arguments.length;s<l;s++)o+=arguments[s].length;for(var r=Array(o),d=0,s=0;s<l;s++)for(var u=arguments[s],m=0,x=u.length;m<x;m++,d++)r[d]=u[m];return r}function fp(o,s,l){if(l||arguments.length===2)for(var r=0,d=s.length,u;r<d;r++)(u||!(r in s))&&(u||(u=Array.prototype.slice.call(s,0,r)),u[r]=s[r]);return o.concat(u||Array.prototype.slice.call(s))}function qs(o){return this instanceof qs?(this.v=o,this):new qs(o)}function pp(o,s,l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=l.apply(o,s||[]),d,u=[];return d=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),x("next"),x("throw"),x("return",m),d[Symbol.asyncIterator]=function(){return this},d;function m(S){return function(N){return Promise.resolve(N).then(S,p)}}function x(S,N){r[S]&&(d[S]=function(O){return new Promise(function(T,z){u.push([S,O,T,z])>1||g(S,O)})},N&&(d[S]=N(d[S])))}function g(S,N){try{f(r[S](N))}catch(O){_(u[0][3],O)}}function f(S){S.value instanceof qs?Promise.resolve(S.value.v).then(b,p):_(u[0][2],S)}function b(S){g("next",S)}function p(S){g("throw",S)}function _(S,N){S(N),u.shift(),u.length&&g(u[0][0],u[0][1])}}function gp(o){var s,l;return s={},r("next"),r("throw",function(d){throw d}),r("return"),s[Symbol.iterator]=function(){return this},s;function r(d,u){s[d]=o[d]?function(m){return(l=!l)?{value:qs(o[d](m)),done:!1}:u?u(m):m}:u}}function xp(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o[Symbol.asyncIterator],l;return s?s.call(o):(o=typeof fr=="function"?fr(o):o[Symbol.iterator](),l={},r("next"),r("throw"),r("return"),l[Symbol.asyncIterator]=function(){return this},l);function r(u){l[u]=o[u]&&function(m){return new Promise(function(x,g){m=o[u](m),d(x,g,m.done,m.value)})}}function d(u,m,x,g){Promise.resolve(g).then(function(f){u({value:f,done:x})},m)}}function bp(o,s){return Object.defineProperty?Object.defineProperty(o,"raw",{value:s}):o.raw=s,o}var wb=Object.create?(function(o,s){Object.defineProperty(o,"default",{enumerable:!0,value:s})}):function(o,s){o.default=s},Jc=function(o){return Jc=Object.getOwnPropertyNames||function(s){var l=[];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(l[l.length]=r);return l},Jc(o)};function vp(o){if(o&&o.__esModule)return o;var s={};if(o!=null)for(var l=Jc(o),r=0;r<l.length;r++)l[r]!=="default"&&br(s,o,l[r]);return wb(s,o),s}function yp(o){return o&&o.__esModule?o:{default:o}}function jp(o,s,l,r){if(l==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof s=="function"?o!==s||!r:!s.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return l==="m"?r:l==="a"?r.call(o):r?r.value:s.get(o)}function Np(o,s,l,r,d){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof s=="function"?o!==s||!d:!s.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?d.call(o,l):d?d.value=l:s.set(o,l),l}function _p(o,s){if(s===null||typeof s!="object"&&typeof s!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof o=="function"?s===o:o.has(s)}function wp(o,s,l){if(s!=null){if(typeof s!="object"&&typeof s!="function")throw new TypeError("Object expected.");var r,d;if(l){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=s[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=s[Symbol.dispose],l&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(u){return Promise.reject(u)}}),o.stack.push({value:s,dispose:r,async:l})}else l&&o.stack.push({async:!0});return s}var Sb=typeof SuppressedError=="function"?SuppressedError:function(o,s,l){var r=new Error(l);return r.name="SuppressedError",r.error=o,r.suppressed=s,r};function Sp(o){function s(u){o.error=o.hasError?new Sb(u,o.error,"An error was suppressed during disposal."):u,o.hasError=!0}var l,r=0;function d(){for(;l=o.stack.pop();)try{if(!l.async&&r===1)return r=0,o.stack.push(l),Promise.resolve().then(d);if(l.dispose){var u=l.dispose.call(l.value);if(l.async)return r|=2,Promise.resolve(u).then(d,function(m){return s(m),d()})}else r|=1}catch(m){s(m)}if(r===1)return o.hasError?Promise.reject(o.error):Promise.resolve();if(o.hasError)throw o.error}return d()}function Cp(o,s){return typeof o=="string"&&/^\.\.?\//.test(o)?o.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(l,r,d,u,m){return r?s?".jsx":".js":d&&(!u||!m)?l:d+u+"."+m.toLowerCase()+"js"}):o}const Cb={__extends:ap,__assign:mr,__rest:Ps,__decorate:ip,__param:sp,__esDecorate:np,__runInitializers:lp,__propKey:rp,__setFunctionName:op,__metadata:cp,__awaiter:Se,__generator:dp,__createBinding:br,__exportStar:up,__values:fr,__read:ud,__spread:hp,__spreadArrays:mp,__spreadArray:fp,__await:qs,__asyncGenerator:pp,__asyncDelegator:gp,__asyncValues:xp,__makeTemplateObject:bp,__importStar:vp,__importDefault:yp,__classPrivateFieldGet:jp,__classPrivateFieldSet:Np,__classPrivateFieldIn:_p,__addDisposableResource:wp,__disposeResources:Sp,__rewriteRelativeImportExtension:Cp},Eb=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:wp,get __assign(){return mr},__asyncDelegator:gp,__asyncGenerator:pp,__asyncValues:xp,__await:qs,__awaiter:Se,__classPrivateFieldGet:jp,__classPrivateFieldIn:_p,__classPrivateFieldSet:Np,__createBinding:br,__decorate:ip,__disposeResources:Sp,__esDecorate:np,__exportStar:up,__extends:ap,__generator:dp,__importDefault:yp,__importStar:vp,__makeTemplateObject:bp,__metadata:cp,__param:sp,__propKey:rp,__read:ud,__rest:Ps,__rewriteRelativeImportExtension:Cp,__runInitializers:lp,__setFunctionName:op,__spread:hp,__spreadArray:fp,__spreadArrays:mp,__values:fr,default:Cb},Symbol.toStringTag,{value:"Module"})),zb=o=>o?(...s)=>o(...s):(...s)=>fetch(...s);class hd extends Error{constructor(s,l="FunctionsError",r){super(s),this.name=l,this.context=r}}class Tb extends hd{constructor(s){super("Failed to send a request to the Edge Function","FunctionsFetchError",s)}}class Ef extends hd{constructor(s){super("Relay Error invoking the Edge Function","FunctionsRelayError",s)}}class zf extends hd{constructor(s){super("Edge Function returned a non-2xx status code","FunctionsHttpError",s)}}var Zc;(function(o){o.Any="any",o.ApNortheast1="ap-northeast-1",o.ApNortheast2="ap-northeast-2",o.ApSouth1="ap-south-1",o.ApSoutheast1="ap-southeast-1",o.ApSoutheast2="ap-southeast-2",o.CaCentral1="ca-central-1",o.EuCentral1="eu-central-1",o.EuWest1="eu-west-1",o.EuWest2="eu-west-2",o.EuWest3="eu-west-3",o.SaEast1="sa-east-1",o.UsEast1="us-east-1",o.UsWest1="us-west-1",o.UsWest2="us-west-2"})(Zc||(Zc={}));class Ab{constructor(s,{headers:l={},customFetch:r,region:d=Zc.Any}={}){this.url=s,this.headers=l,this.region=d,this.fetch=zb(r)}setAuth(s){this.headers.Authorization=`Bearer ${s}`}invoke(s){return Se(this,arguments,void 0,function*(l,r={}){var d;let u,m;try{const{headers:x,method:g,body:f,signal:b,timeout:p}=r;let _={},{region:S}=r;S||(S=this.region);const N=new URL(`${this.url}/${l}`);S&&S!=="any"&&(_["x-region"]=S,N.searchParams.set("forceFunctionRegion",S));let O;f&&(x&&!Object.prototype.hasOwnProperty.call(x,"Content-Type")||!x)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(_["Content-Type"]="application/octet-stream",O=f):typeof f=="string"?(_["Content-Type"]="text/plain",O=f):typeof FormData<"u"&&f instanceof FormData?O=f:(_["Content-Type"]="application/json",O=JSON.stringify(f)):O=f;let T=b;p&&(m=new AbortController,u=setTimeout(()=>m.abort(),p),b?(T=m.signal,b.addEventListener("abort",()=>m.abort())):T=m.signal);const z=yield this.fetch(N.toString(),{method:g||"POST",headers:Object.assign(Object.assign(Object.assign({},_),this.headers),x),body:O,signal:T}).catch(y=>{throw new Tb(y)}),L=z.headers.get("x-relay-error");if(L&&L==="true")throw new Ef(z);if(!z.ok)throw new zf(z);let j=((d=z.headers.get("Content-Type"))!==null&&d!==void 0?d:"text/plain").split(";")[0].trim(),q;return j==="application/json"?q=yield z.json():j==="application/octet-stream"||j==="application/pdf"?q=yield z.blob():j==="text/event-stream"?q=z:j==="multipart/form-data"?q=yield z.formData():q=yield z.text(),{data:q,error:null,response:z}}catch(x){return{data:null,error:x,response:x instanceof zf||x instanceof Ef?x.context:void 0}}finally{u&&clearTimeout(u)}})}}var Ft={};const Hs=ub(Eb);var ir={},sr={},nr={},lr={},rr={},or={},Tf;function Ep(){if(Tf)return or;Tf=1,Object.defineProperty(or,"__esModule",{value:!0});class o extends Error{constructor(l){super(l.message),this.name="PostgrestError",this.details=l.details,this.hint=l.hint,this.code=l.code}}return or.default=o,or}var Af;function zp(){if(Af)return rr;Af=1,Object.defineProperty(rr,"__esModule",{value:!0});const s=Hs.__importDefault(Ep());class l{constructor(d){var u,m;this.shouldThrowOnError=!1,this.method=d.method,this.url=d.url,this.headers=new Headers(d.headers),this.schema=d.schema,this.body=d.body,this.shouldThrowOnError=(u=d.shouldThrowOnError)!==null&&u!==void 0?u:!1,this.signal=d.signal,this.isMaybeSingle=(m=d.isMaybeSingle)!==null&&m!==void 0?m:!1,d.fetch?this.fetch=d.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(d,u){return this.headers=new Headers(this.headers),this.headers.set(d,u),this}then(d,u){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const m=this.fetch;let x=m(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var f,b,p,_;let S=null,N=null,O=null,T=g.status,z=g.statusText;if(g.ok){if(this.method!=="HEAD"){const y=await g.text();y===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?N=y:N=JSON.parse(y))}const j=(b=this.headers.get("Prefer"))===null||b===void 0?void 0:b.match(/count=(exact|planned|estimated)/),q=(p=g.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");j&&q&&q.length>1&&(O=parseInt(q[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(N)&&(N.length>1?(S={code:"PGRST116",details:`Results contain ${N.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},N=null,O=null,T=406,z="Not Acceptable"):N.length===1?N=N[0]:N=null)}else{const j=await g.text();try{S=JSON.parse(j),Array.isArray(S)&&g.status===404&&(N=[],S=null,T=200,z="OK")}catch{g.status===404&&j===""?(T=204,z="No Content"):S={message:j}}if(S&&this.isMaybeSingle&&(!((_=S?.details)===null||_===void 0)&&_.includes("0 rows"))&&(S=null,T=200,z="OK"),S&&this.shouldThrowOnError)throw new s.default(S)}return{error:S,data:N,count:O,status:T,statusText:z}});return this.shouldThrowOnError||(x=x.catch(g=>{var f,b,p,_,S,N;let O="";const T=g?.cause;if(T){const z=(f=T?.message)!==null&&f!==void 0?f:"",L=(b=T?.code)!==null&&b!==void 0?b:"";O=`${(p=g?.name)!==null&&p!==void 0?p:"FetchError"}: ${g?.message}`,O+=`

Caused by: ${(_=T?.name)!==null&&_!==void 0?_:"Error"}: ${z}`,L&&(O+=` (${L})`),T?.stack&&(O+=`
${T.stack}`)}else O=(S=g?.stack)!==null&&S!==void 0?S:"";return{error:{message:`${(N=g?.name)!==null&&N!==void 0?N:"FetchError"}: ${g?.message}`,details:O,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),x.then(d,u)}returns(){return this}overrideTypes(){return this}}return rr.default=l,rr}var Df;function Tp(){if(Df)return lr;Df=1,Object.defineProperty(lr,"__esModule",{value:!0});const s=Hs.__importDefault(zp());class l extends s.default{select(d){let u=!1;const m=(d??"*").split("").map(x=>/\s/.test(x)&&!u?"":(x==='"'&&(u=!u),x)).join("");return this.url.searchParams.set("select",m),this.headers.append("Prefer","return=representation"),this}order(d,{ascending:u=!0,nullsFirst:m,foreignTable:x,referencedTable:g=x}={}){const f=g?`${g}.order`:"order",b=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${b?`${b},`:""}${d}.${u?"asc":"desc"}${m===void 0?"":m?".nullsfirst":".nullslast"}`),this}limit(d,{foreignTable:u,referencedTable:m=u}={}){const x=typeof m>"u"?"limit":`${m}.limit`;return this.url.searchParams.set(x,`${d}`),this}range(d,u,{foreignTable:m,referencedTable:x=m}={}){const g=typeof x>"u"?"offset":`${x}.offset`,f=typeof x>"u"?"limit":`${x}.limit`;return this.url.searchParams.set(g,`${d}`),this.url.searchParams.set(f,`${u-d+1}`),this}abortSignal(d){return this.signal=d,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:d=!1,verbose:u=!1,settings:m=!1,buffers:x=!1,wal:g=!1,format:f="text"}={}){var b;const p=[d?"analyze":null,u?"verbose":null,m?"settings":null,x?"buffers":null,g?"wal":null].filter(Boolean).join("|"),_=(b=this.headers.get("Accept"))!==null&&b!==void 0?b:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${_}"; options=${p};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(d){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${d}`),this}}return lr.default=l,lr}var Of;function md(){if(Of)return nr;Of=1,Object.defineProperty(nr,"__esModule",{value:!0});const s=Hs.__importDefault(Tp()),l=new RegExp("[,()]");class r extends s.default{eq(u,m){return this.url.searchParams.append(u,`eq.${m}`),this}neq(u,m){return this.url.searchParams.append(u,`neq.${m}`),this}gt(u,m){return this.url.searchParams.append(u,`gt.${m}`),this}gte(u,m){return this.url.searchParams.append(u,`gte.${m}`),this}lt(u,m){return this.url.searchParams.append(u,`lt.${m}`),this}lte(u,m){return this.url.searchParams.append(u,`lte.${m}`),this}like(u,m){return this.url.searchParams.append(u,`like.${m}`),this}likeAllOf(u,m){return this.url.searchParams.append(u,`like(all).{${m.join(",")}}`),this}likeAnyOf(u,m){return this.url.searchParams.append(u,`like(any).{${m.join(",")}}`),this}ilike(u,m){return this.url.searchParams.append(u,`ilike.${m}`),this}ilikeAllOf(u,m){return this.url.searchParams.append(u,`ilike(all).{${m.join(",")}}`),this}ilikeAnyOf(u,m){return this.url.searchParams.append(u,`ilike(any).{${m.join(",")}}`),this}is(u,m){return this.url.searchParams.append(u,`is.${m}`),this}in(u,m){const x=Array.from(new Set(m)).map(g=>typeof g=="string"&&l.test(g)?`"${g}"`:`${g}`).join(",");return this.url.searchParams.append(u,`in.(${x})`),this}contains(u,m){return typeof m=="string"?this.url.searchParams.append(u,`cs.${m}`):Array.isArray(m)?this.url.searchParams.append(u,`cs.{${m.join(",")}}`):this.url.searchParams.append(u,`cs.${JSON.stringify(m)}`),this}containedBy(u,m){return typeof m=="string"?this.url.searchParams.append(u,`cd.${m}`):Array.isArray(m)?this.url.searchParams.append(u,`cd.{${m.join(",")}}`):this.url.searchParams.append(u,`cd.${JSON.stringify(m)}`),this}rangeGt(u,m){return this.url.searchParams.append(u,`sr.${m}`),this}rangeGte(u,m){return this.url.searchParams.append(u,`nxl.${m}`),this}rangeLt(u,m){return this.url.searchParams.append(u,`sl.${m}`),this}rangeLte(u,m){return this.url.searchParams.append(u,`nxr.${m}`),this}rangeAdjacent(u,m){return this.url.searchParams.append(u,`adj.${m}`),this}overlaps(u,m){return typeof m=="string"?this.url.searchParams.append(u,`ov.${m}`):this.url.searchParams.append(u,`ov.{${m.join(",")}}`),this}textSearch(u,m,{config:x,type:g}={}){let f="";g==="plain"?f="pl":g==="phrase"?f="ph":g==="websearch"&&(f="w");const b=x===void 0?"":`(${x})`;return this.url.searchParams.append(u,`${f}fts${b}.${m}`),this}match(u){return Object.entries(u).forEach(([m,x])=>{this.url.searchParams.append(m,`eq.${x}`)}),this}not(u,m,x){return this.url.searchParams.append(u,`not.${m}.${x}`),this}or(u,{foreignTable:m,referencedTable:x=m}={}){const g=x?`${x}.or`:"or";return this.url.searchParams.append(g,`(${u})`),this}filter(u,m,x){return this.url.searchParams.append(u,`${m}.${x}`),this}}return nr.default=r,nr}var Rf;function Ap(){if(Rf)return sr;Rf=1,Object.defineProperty(sr,"__esModule",{value:!0});const s=Hs.__importDefault(md());class l{constructor(d,{headers:u={},schema:m,fetch:x}){this.url=d,this.headers=new Headers(u),this.schema=m,this.fetch=x}select(d,u){const{head:m=!1,count:x}=u??{},g=m?"HEAD":"GET";let f=!1;const b=(d??"*").split("").map(p=>/\s/.test(p)&&!f?"":(p==='"'&&(f=!f),p)).join("");return this.url.searchParams.set("select",b),x&&this.headers.append("Prefer",`count=${x}`),new s.default({method:g,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(d,{count:u,defaultToNull:m=!0}={}){var x;const g="POST";if(u&&this.headers.append("Prefer",`count=${u}`),m||this.headers.append("Prefer","missing=default"),Array.isArray(d)){const f=d.reduce((b,p)=>b.concat(Object.keys(p)),[]);if(f.length>0){const b=[...new Set(f)].map(p=>`"${p}"`);this.url.searchParams.set("columns",b.join(","))}}return new s.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}upsert(d,{onConflict:u,ignoreDuplicates:m=!1,count:x,defaultToNull:g=!0}={}){var f;const b="POST";if(this.headers.append("Prefer",`resolution=${m?"ignore":"merge"}-duplicates`),u!==void 0&&this.url.searchParams.set("on_conflict",u),x&&this.headers.append("Prefer",`count=${x}`),g||this.headers.append("Prefer","missing=default"),Array.isArray(d)){const p=d.reduce((_,S)=>_.concat(Object.keys(S)),[]);if(p.length>0){const _=[...new Set(p)].map(S=>`"${S}"`);this.url.searchParams.set("columns",_.join(","))}}return new s.default({method:b,url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(d,{count:u}={}){var m;const x="PATCH";return u&&this.headers.append("Prefer",`count=${u}`),new s.default({method:x,url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}delete({count:d}={}){var u;const m="DELETE";return d&&this.headers.append("Prefer",`count=${d}`),new s.default({method:m,url:this.url,headers:this.headers,schema:this.schema,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return sr.default=l,sr}var kf;function Db(){if(kf)return ir;kf=1,Object.defineProperty(ir,"__esModule",{value:!0});const o=Hs,s=o.__importDefault(Ap()),l=o.__importDefault(md());class r{constructor(u,{headers:m={},schema:x,fetch:g}={}){this.url=u,this.headers=new Headers(m),this.schemaName=x,this.fetch=g}from(u){const m=new URL(`${this.url}/${u}`);return new s.default(m,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(u){return new r(this.url,{headers:this.headers,schema:u,fetch:this.fetch})}rpc(u,m={},{head:x=!1,get:g=!1,count:f}={}){var b;let p;const _=new URL(`${this.url}/rpc/${u}`);let S;x||g?(p=x?"HEAD":"GET",Object.entries(m).filter(([O,T])=>T!==void 0).map(([O,T])=>[O,Array.isArray(T)?`{${T.join(",")}}`:`${T}`]).forEach(([O,T])=>{_.searchParams.append(O,T)})):(p="POST",S=m);const N=new Headers(this.headers);return f&&N.set("Prefer",`count=${f}`),new l.default({method:p,url:_,headers:N,schema:this.schemaName,body:S,fetch:(b=this.fetch)!==null&&b!==void 0?b:fetch})}}return ir.default=r,ir}var Mf;function Ob(){if(Mf)return Ft;Mf=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PostgrestError=Ft.PostgrestBuilder=Ft.PostgrestTransformBuilder=Ft.PostgrestFilterBuilder=Ft.PostgrestQueryBuilder=Ft.PostgrestClient=void 0;const o=Hs,s=o.__importDefault(Db());Ft.PostgrestClient=s.default;const l=o.__importDefault(Ap());Ft.PostgrestQueryBuilder=l.default;const r=o.__importDefault(md());Ft.PostgrestFilterBuilder=r.default;const d=o.__importDefault(Tp());Ft.PostgrestTransformBuilder=d.default;const u=o.__importDefault(zp());Ft.PostgrestBuilder=u.default;const m=o.__importDefault(Ep());return Ft.PostgrestError=m.default,Ft.default={PostgrestClient:s.default,PostgrestQueryBuilder:l.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:d.default,PostgrestBuilder:u.default,PostgrestError:m.default},Ft}var Dp=Ob();const Op=cd(Dp),Rb=db({__proto__:null,default:Op},[Dp]),{PostgrestClient:kb,PostgrestQueryBuilder:zy,PostgrestFilterBuilder:Ty,PostgrestTransformBuilder:Ay,PostgrestBuilder:Dy,PostgrestError:Oy}=Op||Rb;class Mb{constructor(){}static detectEnvironment(){var s;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((s=navigator.userAgent)===null||s===void 0)&&s.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const l=process.versions;if(l&&l.node){const r=l.node,d=parseInt(r.replace(/^v/,"").split(".")[0]);return d>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${d} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${d} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const s=this.detectEnvironment();if(s.constructor)return s.constructor;let l=s.error||"WebSocket not supported in this environment.";throw s.workaround&&(l+=`

Suggested solution: ${s.workaround}`),new Error(l)}static createWebSocket(s,l){const r=this.getWebSocketConstructor();return new r(s,l)}static isWebSocketSupported(){try{const s=this.detectEnvironment();return s.type==="native"||s.type==="ws"}catch{return!1}}}const Ub="2.83.0",Fb=`realtime-js/${Ub}`,Rp="1.0.0",Lb="2.0.0",Uf=Rp,Wc=1e4,$b=1e3,Bb=100;var Gi;(function(o){o[o.connecting=0]="connecting",o[o.open=1]="open",o[o.closing=2]="closing",o[o.closed=3]="closed"})(Gi||(Gi={}));var Et;(function(o){o.closed="closed",o.errored="errored",o.joined="joined",o.joining="joining",o.leaving="leaving"})(Et||(Et={}));var ga;(function(o){o.close="phx_close",o.error="phx_error",o.join="phx_join",o.reply="phx_reply",o.leave="phx_leave",o.access_token="access_token"})(ga||(ga={}));var ed;(function(o){o.websocket="websocket"})(ed||(ed={}));var Vi;(function(o){o.Connecting="connecting",o.Open="open",o.Closing="closing",o.Closed="closed"})(Vi||(Vi={}));class Ib{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(s,l){if(this._isArrayBuffer(s.payload))return l(this._binaryEncodePush(s));if(s.event===this.BROADCAST&&!(s.payload instanceof ArrayBuffer)&&typeof s.payload.event=="string")return l(this._binaryEncodeUserBroadcastPush(s));let r=[s.join_ref,s.ref,s.topic,s.event,s.payload];return l(JSON.stringify(r))}_binaryEncodePush(s){var l,r;const{event:d,topic:u,payload:m}=s,x=(l=s.ref)!==null&&l!==void 0?l:"",g=(r=s.join_ref)!==null&&r!==void 0?r:"",f=this.META_LENGTH+g.length+x.length+u.length+d.length,b=new ArrayBuffer(this.HEADER_LENGTH+f);let p=new DataView(b),_=0;p.setUint8(_++,this.KINDS.push),p.setUint8(_++,g.length),p.setUint8(_++,x.length),p.setUint8(_++,u.length),p.setUint8(_++,d.length),Array.from(g,N=>p.setUint8(_++,N.charCodeAt(0))),Array.from(x,N=>p.setUint8(_++,N.charCodeAt(0))),Array.from(u,N=>p.setUint8(_++,N.charCodeAt(0))),Array.from(d,N=>p.setUint8(_++,N.charCodeAt(0)));var S=new Uint8Array(b.byteLength+m.byteLength);return S.set(new Uint8Array(b),0),S.set(new Uint8Array(m),b.byteLength),S.buffer}_binaryEncodeUserBroadcastPush(s){var l;return this._isArrayBuffer((l=s.payload)===null||l===void 0?void 0:l.payload)?this._encodeBinaryUserBroadcastPush(s):this._encodeJsonUserBroadcastPush(s)}_encodeBinaryUserBroadcastPush(s){var l,r,d,u;const m=s.topic,x=(l=s.ref)!==null&&l!==void 0?l:"",g=(r=s.join_ref)!==null&&r!==void 0?r:"",f=s.payload.event,b=(u=(d=s.payload)===null||d===void 0?void 0:d.payload)!==null&&u!==void 0?u:new ArrayBuffer(0),p=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+x.length+m.length+f.length,_=new ArrayBuffer(this.HEADER_LENGTH+p);let S=new DataView(_),N=0;S.setUint8(N++,this.KINDS.userBroadcastPush),S.setUint8(N++,g.length),S.setUint8(N++,x.length),S.setUint8(N++,m.length),S.setUint8(N++,f.length),S.setUint8(N++,this.BINARY_ENCODING),Array.from(g,T=>S.setUint8(N++,T.charCodeAt(0))),Array.from(x,T=>S.setUint8(N++,T.charCodeAt(0))),Array.from(m,T=>S.setUint8(N++,T.charCodeAt(0))),Array.from(f,T=>S.setUint8(N++,T.charCodeAt(0)));var O=new Uint8Array(_.byteLength+b.byteLength);return O.set(new Uint8Array(_),0),O.set(new Uint8Array(b),_.byteLength),O.buffer}_encodeJsonUserBroadcastPush(s){var l,r,d,u;const m=s.topic,x=(l=s.ref)!==null&&l!==void 0?l:"",g=(r=s.join_ref)!==null&&r!==void 0?r:"",f=s.payload.event,b=(u=(d=s.payload)===null||d===void 0?void 0:d.payload)!==null&&u!==void 0?u:{},_=new TextEncoder().encode(JSON.stringify(b)).buffer,S=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+x.length+m.length+f.length,N=new ArrayBuffer(this.HEADER_LENGTH+S);let O=new DataView(N),T=0;O.setUint8(T++,this.KINDS.userBroadcastPush),O.setUint8(T++,g.length),O.setUint8(T++,x.length),O.setUint8(T++,m.length),O.setUint8(T++,f.length),O.setUint8(T++,this.JSON_ENCODING),Array.from(g,L=>O.setUint8(T++,L.charCodeAt(0))),Array.from(x,L=>O.setUint8(T++,L.charCodeAt(0))),Array.from(m,L=>O.setUint8(T++,L.charCodeAt(0))),Array.from(f,L=>O.setUint8(T++,L.charCodeAt(0)));var z=new Uint8Array(N.byteLength+_.byteLength);return z.set(new Uint8Array(N),0),z.set(new Uint8Array(_),N.byteLength),z.buffer}decode(s,l){if(this._isArrayBuffer(s)){let r=this._binaryDecode(s);return l(r)}if(typeof s=="string"){const r=JSON.parse(s),[d,u,m,x,g]=r;return l({join_ref:d,ref:u,topic:m,event:x,payload:g})}return l({})}_binaryDecode(s){const l=new DataView(s),r=l.getUint8(0),d=new TextDecoder;switch(r){case this.KINDS.push:return this._decodePush(s,l,d);case this.KINDS.reply:return this._decodeReply(s,l,d);case this.KINDS.broadcast:return this._decodeBroadcast(s,l,d);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(s,l,d)}}_decodePush(s,l,r){const d=l.getUint8(1),u=l.getUint8(2),m=l.getUint8(3);let x=this.HEADER_LENGTH+this.META_LENGTH-1;const g=r.decode(s.slice(x,x+d));x=x+d;const f=r.decode(s.slice(x,x+u));x=x+u;const b=r.decode(s.slice(x,x+m));x=x+m;const p=JSON.parse(r.decode(s.slice(x,s.byteLength)));return{join_ref:g,ref:null,topic:f,event:b,payload:p}}_decodeReply(s,l,r){const d=l.getUint8(1),u=l.getUint8(2),m=l.getUint8(3),x=l.getUint8(4);let g=this.HEADER_LENGTH+this.META_LENGTH;const f=r.decode(s.slice(g,g+d));g=g+d;const b=r.decode(s.slice(g,g+u));g=g+u;const p=r.decode(s.slice(g,g+m));g=g+m;const _=r.decode(s.slice(g,g+x));g=g+x;const S=JSON.parse(r.decode(s.slice(g,s.byteLength))),N={status:_,response:S};return{join_ref:f,ref:b,topic:p,event:ga.reply,payload:N}}_decodeBroadcast(s,l,r){const d=l.getUint8(1),u=l.getUint8(2);let m=this.HEADER_LENGTH+2;const x=r.decode(s.slice(m,m+d));m=m+d;const g=r.decode(s.slice(m,m+u));m=m+u;const f=JSON.parse(r.decode(s.slice(m,s.byteLength)));return{join_ref:null,ref:null,topic:x,event:g,payload:f}}_decodeUserBroadcast(s,l,r){const d=l.getUint8(1),u=l.getUint8(2),m=l.getUint8(3),x=l.getUint8(4);let g=this.HEADER_LENGTH+4;const f=r.decode(s.slice(g,g+d));g=g+d;const b=r.decode(s.slice(g,g+u));g=g+u;const p=r.decode(s.slice(g,g+m));g=g+m;const _=s.slice(g,s.byteLength),S=x===this.JSON_ENCODING?JSON.parse(r.decode(_)):_,N={type:this.BROADCAST,event:b,payload:S};return m>0&&(N.meta=JSON.parse(p)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST,payload:N}}_isArrayBuffer(s){var l;return s instanceof ArrayBuffer||((l=s?.constructor)===null||l===void 0?void 0:l.name)==="ArrayBuffer"}}class kp{constructor(s,l){this.callback=s,this.timerCalc=l,this.timer=void 0,this.tries=0,this.callback=s,this.timerCalc=l}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var rt;(function(o){o.abstime="abstime",o.bool="bool",o.date="date",o.daterange="daterange",o.float4="float4",o.float8="float8",o.int2="int2",o.int4="int4",o.int4range="int4range",o.int8="int8",o.int8range="int8range",o.json="json",o.jsonb="jsonb",o.money="money",o.numeric="numeric",o.oid="oid",o.reltime="reltime",o.text="text",o.time="time",o.timestamp="timestamp",o.timestamptz="timestamptz",o.timetz="timetz",o.tsrange="tsrange",o.tstzrange="tstzrange"})(rt||(rt={}));const Ff=(o,s,l={})=>{var r;const d=(r=l.skipTypes)!==null&&r!==void 0?r:[];return s?Object.keys(s).reduce((u,m)=>(u[m]=qb(m,o,s,d),u),{}):{}},qb=(o,s,l,r)=>{const d=s.find(x=>x.name===o),u=d?.type,m=l[o];return u&&!r.includes(u)?Mp(u,m):td(m)},Mp=(o,s)=>{if(o.charAt(0)==="_"){const l=o.slice(1,o.length);return Vb(s,l)}switch(o){case rt.bool:return Pb(s);case rt.float4:case rt.float8:case rt.int2:case rt.int4:case rt.int8:case rt.numeric:case rt.oid:return Hb(s);case rt.json:case rt.jsonb:return Gb(s);case rt.timestamp:return Yb(s);case rt.abstime:case rt.date:case rt.daterange:case rt.int4range:case rt.int8range:case rt.money:case rt.reltime:case rt.text:case rt.time:case rt.timestamptz:case rt.timetz:case rt.tsrange:case rt.tstzrange:return td(s);default:return td(s)}},td=o=>o,Pb=o=>{switch(o){case"t":return!0;case"f":return!1;default:return o}},Hb=o=>{if(typeof o=="string"){const s=parseFloat(o);if(!Number.isNaN(s))return s}return o},Gb=o=>{if(typeof o=="string")try{return JSON.parse(o)}catch(s){return console.log(`JSON parse error: ${s}`),o}return o},Vb=(o,s)=>{if(typeof o!="string")return o;const l=o.length-1,r=o[l];if(o[0]==="{"&&r==="}"){let u;const m=o.slice(1,l);try{u=JSON.parse("["+m+"]")}catch{u=m?m.split(","):[]}return u.map(x=>Mp(s,x))}return o},Yb=o=>typeof o=="string"?o.replace(" ","T"):o,Up=o=>{const s=new URL(o);return s.protocol=s.protocol.replace(/^ws/i,"http"),s.pathname=s.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),s.pathname===""||s.pathname==="/"?s.pathname="/api/broadcast":s.pathname=s.pathname+"/api/broadcast",s.href};class Bc{constructor(s,l,r={},d=Wc){this.channel=s,this.event=l,this.payload=r,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(s){this.timeout=s,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(s){this.payload=Object.assign(Object.assign({},this.payload),s)}receive(s,l){var r;return this._hasReceived(s)&&l((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:s,callback:l}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const s=l=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=l,this._matchReceive(l)};this.channel._on(this.refEvent,{},s),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(s,l){this.refEvent&&this.channel._trigger(this.refEvent,{status:s,response:l})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:s,response:l}){this.recHooks.filter(r=>r.status===s).forEach(r=>r.callback(l))}_hasReceived(s){return this.receivedResp&&this.receivedResp.status===s}}var Lf;(function(o){o.SYNC="sync",o.JOIN="join",o.LEAVE="leave"})(Lf||(Lf={}));class $n{constructor(s,l){this.channel=s,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=l?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},d=>{const{onJoin:u,onLeave:m,onSync:x}=this.caller;this.joinRef=this.channel._joinRef(),this.state=$n.syncState(this.state,d,u,m),this.pendingDiffs.forEach(g=>{this.state=$n.syncDiff(this.state,g,u,m)}),this.pendingDiffs=[],x()}),this.channel._on(r.diff,{},d=>{const{onJoin:u,onLeave:m,onSync:x}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(d):(this.state=$n.syncDiff(this.state,d,u,m),x())}),this.onJoin((d,u,m)=>{this.channel._trigger("presence",{event:"join",key:d,currentPresences:u,newPresences:m})}),this.onLeave((d,u,m)=>{this.channel._trigger("presence",{event:"leave",key:d,currentPresences:u,leftPresences:m})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(s,l,r,d){const u=this.cloneDeep(s),m=this.transformState(l),x={},g={};return this.map(u,(f,b)=>{m[f]||(g[f]=b)}),this.map(m,(f,b)=>{const p=u[f];if(p){const _=b.map(T=>T.presence_ref),S=p.map(T=>T.presence_ref),N=b.filter(T=>S.indexOf(T.presence_ref)<0),O=p.filter(T=>_.indexOf(T.presence_ref)<0);N.length>0&&(x[f]=N),O.length>0&&(g[f]=O)}else x[f]=b}),this.syncDiff(u,{joins:x,leaves:g},r,d)}static syncDiff(s,l,r,d){const{joins:u,leaves:m}={joins:this.transformState(l.joins),leaves:this.transformState(l.leaves)};return r||(r=()=>{}),d||(d=()=>{}),this.map(u,(x,g)=>{var f;const b=(f=s[x])!==null&&f!==void 0?f:[];if(s[x]=this.cloneDeep(g),b.length>0){const p=s[x].map(S=>S.presence_ref),_=b.filter(S=>p.indexOf(S.presence_ref)<0);s[x].unshift(..._)}r(x,b,g)}),this.map(m,(x,g)=>{let f=s[x];if(!f)return;const b=g.map(p=>p.presence_ref);f=f.filter(p=>b.indexOf(p.presence_ref)<0),s[x]=f,d(x,f,g),f.length===0&&delete s[x]}),s}static map(s,l){return Object.getOwnPropertyNames(s).map(r=>l(r,s[r]))}static transformState(s){return s=this.cloneDeep(s),Object.getOwnPropertyNames(s).reduce((l,r)=>{const d=s[r];return"metas"in d?l[r]=d.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):l[r]=d,l},{})}static cloneDeep(s){return JSON.parse(JSON.stringify(s))}onJoin(s){this.caller.onJoin=s}onLeave(s){this.caller.onLeave=s}onSync(s){this.caller.onSync=s}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var $f;(function(o){o.ALL="*",o.INSERT="INSERT",o.UPDATE="UPDATE",o.DELETE="DELETE"})($f||($f={}));var Bn;(function(o){o.BROADCAST="broadcast",o.PRESENCE="presence",o.POSTGRES_CHANGES="postgres_changes",o.SYSTEM="system"})(Bn||(Bn={}));var Qa;(function(o){o.SUBSCRIBED="SUBSCRIBED",o.TIMED_OUT="TIMED_OUT",o.CLOSED="CLOSED",o.CHANNEL_ERROR="CHANNEL_ERROR"})(Qa||(Qa={}));class fd{constructor(s,l={config:{}},r){var d,u;if(this.topic=s,this.params=l,this.socket=r,this.bindings={},this.state=Et.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=s.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},l.config),this.timeout=this.socket.timeout,this.joinPush=new Bc(this,ga.join,this.params,this.timeout),this.rejoinTimer=new kp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Et.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(m=>m.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Et.closed,this.socket._remove(this)}),this._onError(m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",m=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,m),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ga.reply,{},(m,x)=>{this._trigger(this._replyEventName(x),m)}),this.presence=new $n(this),this.broadcastEndpointURL=Up(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(d=this.params.config)===null||d===void 0?void 0:d.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(s,l=this.timeout){var r,d,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Et.closed){const{config:{broadcast:m,presence:x,private:g}}=this.params,f=(d=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(S=>S.filter))!==null&&d!==void 0?d:[],b=!!this.bindings[Bn.PRESENCE]&&this.bindings[Bn.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,p={},_={broadcast:m,presence:Object.assign(Object.assign({},x),{enabled:b}),postgres_changes:f,private:g};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(S=>s?.(Qa.CHANNEL_ERROR,S)),this._onClose(()=>s?.(Qa.CLOSED)),this.updateJoinPayload(Object.assign({config:_},p)),this.joinedOnce=!0,this._rejoin(l),this.joinPush.receive("ok",async({postgres_changes:S})=>{var N;if(this.socket.setAuth(),S===void 0){s?.(Qa.SUBSCRIBED);return}else{const O=this.bindings.postgres_changes,T=(N=O?.length)!==null&&N!==void 0?N:0,z=[];for(let L=0;L<T;L++){const j=O[L],{filter:{event:q,schema:y,table:M,filter:k}}=j,te=S&&S[L];if(te&&te.event===q&&te.schema===y&&te.table===M&&te.filter===k)z.push(Object.assign(Object.assign({},j),{id:te.id}));else{this.unsubscribe(),this.state=Et.errored,s?.(Qa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=z,s&&s(Qa.SUBSCRIBED);return}}).receive("error",S=>{this.state=Et.errored,s?.(Qa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{s?.(Qa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(s,l={}){return await this.send({type:"presence",event:"track",payload:s},l.timeout||this.timeout)}async untrack(s={}){return await this.send({type:"presence",event:"untrack"},s)}on(s,l,r){return this.state===Et.joined&&s===Bn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(s,l,r)}async httpSend(s,l,r={}){var d;const u=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(l==null)return Promise.reject("Payload is required for httpSend()");const m={method:"POST",headers:{Authorization:u,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:l,private:this.private}]})},x=await this._fetchWithTimeout(this.broadcastEndpointURL,m,(d=r.timeout)!==null&&d!==void 0?d:this.timeout);if(x.status===202)return{success:!0};let g=x.statusText;try{const f=await x.json();g=f.error||f.message||g}catch{}return Promise.reject(new Error(g))}async send(s,l={}){var r,d;if(!this._canPush()&&s.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:m}=s,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:m,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,g,(r=l.timeout)!==null&&r!==void 0?r:this.timeout);return await((d=f.body)===null||d===void 0?void 0:d.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var m,x,g;const f=this._push(s.type,s,l.timeout||this.timeout);s.type==="broadcast"&&!(!((g=(x=(m=this.params)===null||m===void 0?void 0:m.config)===null||x===void 0?void 0:x.broadcast)===null||g===void 0)&&g.ack)&&u("ok"),f.receive("ok",()=>u("ok")),f.receive("error",()=>u("error")),f.receive("timeout",()=>u("timed out"))})}updateJoinPayload(s){this.joinPush.updatePayload(s)}unsubscribe(s=this.timeout){this.state=Et.leaving;const l=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ga.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(d=>{r=new Bc(this,ga.leave,{},s),r.receive("ok",()=>{l(),d("ok")}).receive("timeout",()=>{l(),d("timed out")}).receive("error",()=>{d("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(s=>s.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Et.closed,this.bindings={}}async _fetchWithTimeout(s,l,r){const d=new AbortController,u=setTimeout(()=>d.abort(),r),m=await this.socket.fetch(s,Object.assign(Object.assign({},l),{signal:d.signal}));return clearTimeout(u),m}_push(s,l,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${s}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new Bc(this,s,l,r);return this._canPush()?d.send():this._addToPushBuffer(d),d}_addToPushBuffer(s){if(s.startTimeout(),this.pushBuffer.push(s),this.pushBuffer.length>Bb){const l=this.pushBuffer.shift();l&&(l.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${l.event}`,l.payload))}}_onMessage(s,l,r){return l}_isMember(s){return this.topic===s}_joinRef(){return this.joinPush.ref}_trigger(s,l,r){var d,u;const m=s.toLocaleLowerCase(),{close:x,error:g,leave:f,join:b}=ga;if(r&&[x,g,f,b].indexOf(m)>=0&&r!==this._joinRef())return;let _=this._onMessage(m,l,r);if(l&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(m)?(d=this.bindings.postgres_changes)===null||d===void 0||d.filter(S=>{var N,O,T;return((N=S.filter)===null||N===void 0?void 0:N.event)==="*"||((T=(O=S.filter)===null||O===void 0?void 0:O.event)===null||T===void 0?void 0:T.toLocaleLowerCase())===m}).map(S=>S.callback(_,r)):(u=this.bindings[m])===null||u===void 0||u.filter(S=>{var N,O,T,z,L,j;if(["broadcast","presence","postgres_changes"].includes(m))if("id"in S){const q=S.id,y=(N=S.filter)===null||N===void 0?void 0:N.event;return q&&((O=l.ids)===null||O===void 0?void 0:O.includes(q))&&(y==="*"||y?.toLocaleLowerCase()===((T=l.data)===null||T===void 0?void 0:T.type.toLocaleLowerCase()))}else{const q=(L=(z=S?.filter)===null||z===void 0?void 0:z.event)===null||L===void 0?void 0:L.toLocaleLowerCase();return q==="*"||q===((j=l?.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===m}).map(S=>{if(typeof _=="object"&&"ids"in _){const N=_.data,{schema:O,table:T,commit_timestamp:z,type:L,errors:j}=N;_=Object.assign(Object.assign({},{schema:O,table:T,commit_timestamp:z,eventType:L,new:{},old:{},errors:j}),this._getPayloadRecords(N))}S.callback(_,r)})}_isClosed(){return this.state===Et.closed}_isJoined(){return this.state===Et.joined}_isJoining(){return this.state===Et.joining}_isLeaving(){return this.state===Et.leaving}_replyEventName(s){return`chan_reply_${s}`}_on(s,l,r){const d=s.toLocaleLowerCase(),u={type:d,filter:l,callback:r};return this.bindings[d]?this.bindings[d].push(u):this.bindings[d]=[u],this}_off(s,l){const r=s.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(d=>{var u;return!(((u=d.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===r&&fd.isEqual(d.filter,l))})),this}static isEqual(s,l){if(Object.keys(s).length!==Object.keys(l).length)return!1;for(const r in s)if(s[r]!==l[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(s){this._on(ga.close,{},s)}_onError(s){this._on(ga.error,{},l=>s(l))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(s=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Et.joining,this.joinPush.resend(s))}_getPayloadRecords(s){const l={new:{},old:{}};return(s.type==="INSERT"||s.type==="UPDATE")&&(l.new=Ff(s.columns,s.record)),(s.type==="UPDATE"||s.type==="DELETE")&&(l.old=Ff(s.columns,s.old_record)),l}}const Ic=()=>{},cr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Qb=[1e3,2e3,5e3,1e4],Kb=1e4,Xb=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Jb{constructor(s,l){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Wc,this.transport=null,this.heartbeatIntervalMs=cr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ic,this.ref=0,this.reconnectTimer=null,this.vsn=Uf,this.logger=Ic,this.conn=null,this.sendBuffer=[],this.serializer=new Ib,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=d=>d?(...u)=>d(...u):(...u)=>fetch(...u),!(!((r=l?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=l.params.apikey,this.endPoint=`${s}/${ed.websocket}`,this.httpEndpoint=Up(s),this._initializeOptions(l),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(l?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Mb.createWebSocket(this.endpointURL())}catch(s){this._setConnectionState("disconnected");const l=s.message;throw l.includes("Node.js")?new Error(`${l}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${l}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(s,l){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(s?this.conn.close(s,l??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(s){const l=await s.unsubscribe();return this.channels.length===0&&this.disconnect(),l}async removeAllChannels(){const s=await Promise.all(this.channels.map(l=>l.unsubscribe()));return this.channels=[],this.disconnect(),s}log(s,l,r){this.logger(s,l,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Gi.connecting:return Vi.Connecting;case Gi.open:return Vi.Open;case Gi.closing:return Vi.Closing;default:return Vi.Closed}}isConnected(){return this.connectionState()===Vi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(s,l={config:{}}){const r=`realtime:${s}`,d=this.getChannels().find(u=>u.topic===r);if(d)return d;{const u=new fd(`realtime:${s}`,l,this);return this.channels.push(u),u}}push(s){const{topic:l,event:r,payload:d,ref:u}=s,m=()=>{this.encode(s,x=>{var g;(g=this.conn)===null||g===void 0||g.send(x)})};this.log("push",`${l} ${r} (${u})`,d),this.isConnected()?m():this.sendBuffer.push(m)}async setAuth(s=null){this._authPromise=this._performAuth(s);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var s;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(l){this.log("error","error in heartbeat callback",l)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(l){this.log("error","error in heartbeat callback",l)}this._wasManualDisconnect=!1,(s=this.conn)===null||s===void 0||s.close($b,"heartbeat timeout"),setTimeout(()=>{var l;this.isConnected()||(l=this.reconnectTimer)===null||l===void 0||l.scheduleTimeout()},cr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(l){this.log("error","error in heartbeat callback",l)}this._setAuthSafely("heartbeat")}onHeartbeat(s){this.heartbeatCallback=s}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(s=>s()),this.sendBuffer=[])}_makeRef(){let s=this.ref+1;return s===this.ref?this.ref=0:this.ref=s,this.ref.toString()}_leaveOpenTopic(s){let l=this.channels.find(r=>r.topic===s&&(r._isJoined()||r._isJoining()));l&&(this.log("transport",`leaving duplicate topic "${s}"`),l.unsubscribe())}_remove(s){this.channels=this.channels.filter(l=>l.topic!==s.topic)}_onConnMessage(s){this.decode(s.data,l=>{if(l.topic==="phoenix"&&l.event==="phx_reply")try{this.heartbeatCallback(l.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}l.ref&&l.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:d,payload:u,ref:m}=l,x=m?`(${m})`:"",g=u.status||"";this.log("receive",`${g} ${r} ${d} ${x}`.trim(),u),this.channels.filter(f=>f._isMember(r)).forEach(f=>f._trigger(d,u,m)),this._triggerStateCallbacks("message",l)})}_clearTimer(s){var l;s==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):s==="reconnect"&&((l=this.reconnectTimer)===null||l===void 0||l.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=s=>this._onConnError(s),this.conn.onmessage=s=>this._onConnMessage(s),this.conn.onclose=s=>this._onConnClose(s))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Gi.open||this.conn.readyState===Gi.connecting)try{this.conn.close()}catch(s){this.log("error","Error closing connection",s)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(s=>s.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(l=>{this.log("error","error waiting for auth on connect",l),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const s=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(s),this.workerRef.onerror=l=>{this.log("worker","worker error",l.message),this.workerRef.terminate()},this.workerRef.onmessage=l=>{l.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(s){var l;this._setConnectionState("disconnected"),this.log("transport","close",s),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(l=this.reconnectTimer)===null||l===void 0||l.scheduleTimeout(),this._triggerStateCallbacks("close",s)}_onConnError(s){this._setConnectionState("disconnected"),this.log("transport",`${s}`),this._triggerChanError(),this._triggerStateCallbacks("error",s)}_triggerChanError(){this.channels.forEach(s=>s._trigger(ga.error))}_appendParams(s,l){if(Object.keys(l).length===0)return s;const r=s.match(/\?/)?"&":"?",d=new URLSearchParams(l);return`${s}${r}${d}`}_workerObjectUrl(s){let l;if(s)l=s;else{const r=new Blob([Xb],{type:"application/javascript"});l=URL.createObjectURL(r)}return l}_setConnectionState(s,l=!1){this._connectionState=s,s==="connecting"?this._wasManualDisconnect=!1:s==="disconnecting"&&(this._wasManualDisconnect=l)}async _performAuth(s=null){let l;s?l=s:this.accessToken?l=await this.accessToken():l=this.accessTokenValue,this.accessTokenValue!=l&&(this.accessTokenValue=l,this.channels.forEach(r=>{const d={access_token:l,version:Fb};l&&r.updateJoinPayload(d),r.joinedOnce&&r._isJoined()&&r._push(ga.access_token,{access_token:l})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(s="general"){this.setAuth().catch(l=>{this.log("error",`error setting auth in ${s}`,l)})}_triggerStateCallbacks(s,l){try{this.stateChangeCallbacks[s].forEach(r=>{try{r(l)}catch(d){this.log("error",`error in ${s} callback`,d)}})}catch(r){this.log("error",`error triggering ${s} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new kp(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},cr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(s){var l,r,d,u,m,x,g,f,b,p,_,S;switch(this.transport=(l=s?.transport)!==null&&l!==void 0?l:null,this.timeout=(r=s?.timeout)!==null&&r!==void 0?r:Wc,this.heartbeatIntervalMs=(d=s?.heartbeatIntervalMs)!==null&&d!==void 0?d:cr.HEARTBEAT_INTERVAL,this.worker=(u=s?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(m=s?.accessToken)!==null&&m!==void 0?m:null,this.heartbeatCallback=(x=s?.heartbeatCallback)!==null&&x!==void 0?x:Ic,this.vsn=(g=s?.vsn)!==null&&g!==void 0?g:Uf,s?.params&&(this.params=s.params),s?.logger&&(this.logger=s.logger),(s?.logLevel||s?.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=s?.reconnectAfterMs)!==null&&f!==void 0?f:(N=>Qb[N-1]||Kb),this.vsn){case Rp:this.encode=(b=s?.encode)!==null&&b!==void 0?b:((N,O)=>O(JSON.stringify(N))),this.decode=(p=s?.decode)!==null&&p!==void 0?p:((N,O)=>O(JSON.parse(N)));break;case Lb:this.encode=(_=s?.encode)!==null&&_!==void 0?_:this.serializer.encode.bind(this.serializer),this.decode=(S=s?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=s?.workerUrl}}}class pd extends Error{constructor(s){super(s),this.__isStorageError=!0,this.name="StorageError"}}function ut(o){return typeof o=="object"&&o!==null&&"__isStorageError"in o}class Zb extends pd{constructor(s,l,r){super(s),this.name="StorageApiError",this.status=l,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ad extends pd{constructor(s,l){super(s),this.name="StorageUnknownError",this.originalError=l}}const gd=o=>o?(...s)=>o(...s):(...s)=>fetch(...s),Wb=()=>Response,id=o=>{if(Array.isArray(o))return o.map(l=>id(l));if(typeof o=="function"||o!==Object(o))return o;const s={};return Object.entries(o).forEach(([l,r])=>{const d=l.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));s[d]=id(r)}),s},ev=o=>{if(typeof o!="object"||o===null)return!1;const s=Object.getPrototypeOf(o);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},qc=o=>{var s;return o.msg||o.message||o.error_description||(typeof o.error=="string"?o.error:(s=o.error)===null||s===void 0?void 0:s.message)||JSON.stringify(o)},tv=(o,s,l)=>Se(void 0,void 0,void 0,function*(){const r=yield Wb();o instanceof r&&!l?.noResolveJson?o.json().then(d=>{const u=o.status||500,m=d?.statusCode||u+"";s(new Zb(qc(d),u,m))}).catch(d=>{s(new ad(qc(d),d))}):s(new ad(qc(o),o))}),av=(o,s,l,r)=>{const d={method:o,headers:s?.headers||{}};return o==="GET"||!r?d:(ev(r)?(d.headers=Object.assign({"Content-Type":"application/json"},s?.headers),d.body=JSON.stringify(r)):d.body=r,s?.duplex&&(d.duplex=s.duplex),Object.assign(Object.assign({},d),l))};function Hn(o,s,l,r,d,u){return Se(this,void 0,void 0,function*(){return new Promise((m,x)=>{o(l,av(s,r,d,u)).then(g=>{if(!g.ok)throw g;return r?.noResolveJson?g:g.json()}).then(g=>m(g)).catch(g=>tv(g,x,r))})})}function In(o,s,l,r){return Se(this,void 0,void 0,function*(){return Hn(o,"GET",s,l,r)})}function Sa(o,s,l,r,d){return Se(this,void 0,void 0,function*(){return Hn(o,"POST",s,r,d,l)})}function sd(o,s,l,r,d){return Se(this,void 0,void 0,function*(){return Hn(o,"PUT",s,r,d,l)})}function iv(o,s,l,r){return Se(this,void 0,void 0,function*(){return Hn(o,"HEAD",s,Object.assign(Object.assign({},l),{noResolveJson:!0}),r)})}function xd(o,s,l,r,d){return Se(this,void 0,void 0,function*(){return Hn(o,"DELETE",s,r,d,l)})}class sv{constructor(s,l){this.downloadFn=s,this.shouldThrowOnError=l}then(s,l){return this.execute().then(s,l)}execute(){return Se(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ut(s))return{data:null,error:s};throw s}})}}var Fp;class nv{constructor(s,l){this.downloadFn=s,this.shouldThrowOnError=l,this[Fp]="BlobDownloadBuilder",this.promise=null}asStream(){return new sv(this.downloadFn,this.shouldThrowOnError)}then(s,l){return this.getPromise().then(s,l)}catch(s){return this.getPromise().catch(s)}finally(s){return this.getPromise().finally(s)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Se(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ut(s))return{data:null,error:s};throw s}})}}Fp=Symbol.toStringTag;const lv={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Bf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rv{constructor(s,l={},r,d){this.shouldThrowOnError=!1,this.url=s,this.headers=l,this.bucketId=r,this.fetch=gd(d)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(s,l,r,d){return Se(this,void 0,void 0,function*(){try{let u;const m=Object.assign(Object.assign({},Bf),d);let x=Object.assign(Object.assign({},this.headers),s==="POST"&&{"x-upsert":String(m.upsert)});const g=m.metadata;typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",m.cacheControl),g&&u.append("metadata",this.encodeMetadata(g)),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.has("cacheControl")||u.append("cacheControl",m.cacheControl),g&&!u.has("metadata")&&u.append("metadata",this.encodeMetadata(g))):(u=r,x["cache-control"]=`max-age=${m.cacheControl}`,x["content-type"]=m.contentType,g&&(x["x-metadata"]=this.toBase64(this.encodeMetadata(g))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!m.duplex&&(m.duplex="half")),d?.headers&&(x=Object.assign(Object.assign({},x),d.headers));const f=this._removeEmptyFolders(l),b=this._getFinalPath(f),p=yield(s=="PUT"?sd:Sa)(this.fetch,`${this.url}/object/${b}`,u,Object.assign({headers:x},m?.duplex?{duplex:m.duplex}:{}));return{data:{path:f,id:p.Id,fullPath:p.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ut(u))return{data:null,error:u};throw u}})}upload(s,l,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",s,l,r)})}uploadToSignedUrl(s,l,r,d){return Se(this,void 0,void 0,function*(){const u=this._removeEmptyFolders(s),m=this._getFinalPath(u),x=new URL(this.url+`/object/upload/sign/${m}`);x.searchParams.set("token",l);try{let g;const f=Object.assign({upsert:Bf.upsert},d),b=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&r instanceof Blob?(g=new FormData,g.append("cacheControl",f.cacheControl),g.append("",r)):typeof FormData<"u"&&r instanceof FormData?(g=r,g.append("cacheControl",f.cacheControl)):(g=r,b["cache-control"]=`max-age=${f.cacheControl}`,b["content-type"]=f.contentType);const p=yield sd(this.fetch,x.toString(),g,{headers:b});return{data:{path:u,fullPath:p.Key},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(ut(g))return{data:null,error:g};throw g}})}createSignedUploadUrl(s,l){return Se(this,void 0,void 0,function*(){try{let r=this._getFinalPath(s);const d=Object.assign({},this.headers);l?.upsert&&(d["x-upsert"]="true");const u=yield Sa(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:d}),m=new URL(this.url+u.url),x=m.searchParams.get("token");if(!x)throw new pd("No token returned by API");return{data:{signedUrl:m.toString(),path:s,token:x},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}update(s,l,r){return Se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",s,l,r)})}move(s,l,r){return Se(this,void 0,void 0,function*(){try{return{data:yield Sa(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:s,destinationKey:l,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}copy(s,l,r){return Se(this,void 0,void 0,function*(){try{return{data:{path:(yield Sa(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:s,destinationKey:l,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}createSignedUrl(s,l,r){return Se(this,void 0,void 0,function*(){try{let d=this._getFinalPath(s),u=yield Sa(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:l},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const m=r?.download?`&download=${r.download===!0?"":r.download}`:"";return u={signedUrl:encodeURI(`${this.url}${u.signedURL}${m}`)},{data:u,error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}createSignedUrls(s,l,r){return Se(this,void 0,void 0,function*(){try{const d=yield Sa(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:l,paths:s},{headers:this.headers}),u=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:d.map(m=>Object.assign(Object.assign({},m),{signedUrl:m.signedURL?encodeURI(`${this.url}${m.signedURL}${u}`):null})),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}download(s,l){const d=typeof l?.transform<"u"?"render/image/authenticated":"object",u=this.transformOptsToQueryString(l?.transform||{}),m=u?`?${u}`:"",x=this._getFinalPath(s),g=()=>In(this.fetch,`${this.url}/${d}/${x}${m}`,{headers:this.headers,noResolveJson:!0});return new nv(g,this.shouldThrowOnError)}info(s){return Se(this,void 0,void 0,function*(){const l=this._getFinalPath(s);try{const r=yield In(this.fetch,`${this.url}/object/info/${l}`,{headers:this.headers});return{data:id(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}exists(s){return Se(this,void 0,void 0,function*(){const l=this._getFinalPath(s);try{return yield iv(this.fetch,`${this.url}/object/${l}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r)&&r instanceof ad){const d=r.originalError;if([400,404].includes(d?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(s,l){const r=this._getFinalPath(s),d=[],u=l?.download?`download=${l.download===!0?"":l.download}`:"";u!==""&&d.push(u);const x=typeof l?.transform<"u"?"render/image":"object",g=this.transformOptsToQueryString(l?.transform||{});g!==""&&d.push(g);let f=d.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${x}/public/${r}${f}`)}}}remove(s){return Se(this,void 0,void 0,function*(){try{return{data:yield xd(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:s},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}list(s,l,r){return Se(this,void 0,void 0,function*(){try{const d=Object.assign(Object.assign(Object.assign({},lv),l),{prefix:s||""});return{data:yield Sa(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},r),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}listV2(s,l){return Se(this,void 0,void 0,function*(){try{const r=Object.assign({},s);return{data:yield Sa(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},l),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const l=[];return s.width&&l.push(`width=${s.width}`),s.height&&l.push(`height=${s.height}`),s.resize&&l.push(`resize=${s.resize}`),s.format&&l.push(`format=${s.format}`),s.quality&&l.push(`quality=${s.quality}`),l.join("&")}}const Lp="2.83.0",$p={"X-Client-Info":`storage-js/${Lp}`};class ov{constructor(s,l={},r,d){this.shouldThrowOnError=!1;const u=new URL(s);d?.useNewHostname&&/supabase\.(co|in|red)$/.test(u.hostname)&&!u.hostname.includes("storage.supabase.")&&(u.hostname=u.hostname.replace("supabase.","storage.supabase.")),this.url=u.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$p),l),this.fetch=gd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(s){return Se(this,void 0,void 0,function*(){try{const l=this.listBucketOptionsToQueryString(s);return{data:yield In(this.fetch,`${this.url}/bucket${l}`,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}getBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield In(this.fetch,`${this.url}/bucket/${s}`,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}createBucket(s){return Se(this,arguments,void 0,function*(l,r={public:!1}){try{return{data:yield Sa(this.fetch,`${this.url}/bucket`,{id:l,name:l,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(ut(d))return{data:null,error:d};throw d}})}updateBucket(s,l){return Se(this,void 0,void 0,function*(){try{return{data:yield sd(this.fetch,`${this.url}/bucket/${s}`,{id:s,name:s,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}emptyBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield Sa(this.fetch,`${this.url}/bucket/${s}/empty`,{},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}deleteBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield xd(this.fetch,`${this.url}/bucket/${s}`,{},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}listBucketOptionsToQueryString(s){const l={};return s&&("limit"in s&&(l.limit=String(s.limit)),"offset"in s&&(l.offset=String(s.offset)),s.search&&(l.search=s.search),s.sortColumn&&(l.sortColumn=s.sortColumn),s.sortOrder&&(l.sortOrder=s.sortOrder)),Object.keys(l).length>0?"?"+new URLSearchParams(l).toString():""}}class cv{constructor(s,l={},r){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$p),l),this.fetch=gd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield Sa(this.fetch,`${this.url}/bucket`,{name:s},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}listBuckets(s){return Se(this,void 0,void 0,function*(){try{const l=new URLSearchParams;s?.limit!==void 0&&l.set("limit",s.limit.toString()),s?.offset!==void 0&&l.set("offset",s.offset.toString()),s?.sortColumn&&l.set("sortColumn",s.sortColumn),s?.sortOrder&&l.set("sortOrder",s.sortOrder),s?.search&&l.set("search",s.search);const r=l.toString(),d=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield In(this.fetch,d,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}deleteBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield xd(this.fetch,`${this.url}/bucket/${s}`,{},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ut(l))return{data:null,error:l};throw l}})}}const bd={"X-Client-Info":`storage-js/${Lp}`,"Content-Type":"application/json"};class Bp extends Error{constructor(s){super(s),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ia(o){return typeof o=="object"&&o!==null&&"__isStorageVectorsError"in o}class Pc extends Bp{constructor(s,l,r){super(s),this.name="StorageVectorsApiError",this.status=l,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class dv extends Bp{constructor(s,l){super(s),this.name="StorageVectorsUnknownError",this.originalError=l}}var If;(function(o){o.InternalError="InternalError",o.S3VectorConflictException="S3VectorConflictException",o.S3VectorNotFoundException="S3VectorNotFoundException",o.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",o.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",o.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(If||(If={}));const vd=o=>o?(...s)=>o(...s):(...s)=>fetch(...s),uv=o=>{if(typeof o!="object"||o===null)return!1;const s=Object.getPrototypeOf(o);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},qf=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),hv=(o,s,l)=>Se(void 0,void 0,void 0,function*(){if(o&&typeof o=="object"&&"status"in o&&"ok"in o&&typeof o.status=="number"&&!l?.noResolveJson){const d=o.status||500,u=o;if(typeof u.json=="function")u.json().then(m=>{const x=m?.statusCode||m?.code||d+"";s(new Pc(qf(m),d,x))}).catch(()=>{const m=d+"",x=u.statusText||`HTTP ${d} error`;s(new Pc(x,d,m))});else{const m=d+"",x=u.statusText||`HTTP ${d} error`;s(new Pc(x,d,m))}}else s(new dv(qf(o),o))}),mv=(o,s,l,r)=>{const d={method:o,headers:s?.headers||{}};return r?(uv(r)?(d.headers=Object.assign({"Content-Type":"application/json"},s?.headers),d.body=JSON.stringify(r)):d.body=r,Object.assign(Object.assign({},d),l)):d};function fv(o,s,l,r,d,u){return Se(this,void 0,void 0,function*(){return new Promise((m,x)=>{o(l,mv(s,r,d,u)).then(g=>{if(!g.ok)throw g;if(r?.noResolveJson)return g;const f=g.headers.get("content-type");return!f||!f.includes("application/json")?{}:g.json()}).then(g=>m(g)).catch(g=>hv(g,x,r))})})}function sa(o,s,l,r,d){return Se(this,void 0,void 0,function*(){return fv(o,"POST",s,r,d,l)})}class pv{constructor(s,l={},r){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bd),l),this.fetch=vd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(s){return Se(this,void 0,void 0,function*(){try{return{data:(yield sa(this.fetch,`${this.url}/CreateIndex`,s,{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}getIndex(s,l){return Se(this,void 0,void 0,function*(){try{return{data:yield sa(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:s,indexName:l},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ia(r))return{data:null,error:r};throw r}})}listIndexes(s){return Se(this,void 0,void 0,function*(){try{return{data:yield sa(this.fetch,`${this.url}/ListIndexes`,s,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}deleteIndex(s,l){return Se(this,void 0,void 0,function*(){try{return{data:(yield sa(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:s,indexName:l},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ia(r))return{data:null,error:r};throw r}})}}class gv{constructor(s,l={},r){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bd),l),this.fetch=vd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(s){return Se(this,void 0,void 0,function*(){try{if(s.vectors.length<1||s.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield sa(this.fetch,`${this.url}/PutVectors`,s,{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}getVectors(s){return Se(this,void 0,void 0,function*(){try{return{data:yield sa(this.fetch,`${this.url}/GetVectors`,s,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}listVectors(s){return Se(this,void 0,void 0,function*(){try{if(s.segmentCount!==void 0){if(s.segmentCount<1||s.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(s.segmentIndex!==void 0&&(s.segmentIndex<0||s.segmentIndex>=s.segmentCount))throw new Error(`segmentIndex must be between 0 and ${s.segmentCount-1}`)}return{data:yield sa(this.fetch,`${this.url}/ListVectors`,s,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}queryVectors(s){return Se(this,void 0,void 0,function*(){try{return{data:yield sa(this.fetch,`${this.url}/QueryVectors`,s,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}deleteVectors(s){return Se(this,void 0,void 0,function*(){try{if(s.keys.length<1||s.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield sa(this.fetch,`${this.url}/DeleteVectors`,s,{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}}class xv{constructor(s,l={},r){this.shouldThrowOnError=!1,this.url=s.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},bd),l),this.fetch=vd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:(yield sa(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:s},{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}getBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:yield sa(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:s},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}listBuckets(){return Se(this,arguments,void 0,function*(s={}){try{return{data:yield sa(this.fetch,`${this.url}/ListVectorBuckets`,s,{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}deleteBucket(s){return Se(this,void 0,void 0,function*(){try{return{data:(yield sa(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:s},{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ia(l))return{data:null,error:l};throw l}})}}class bv extends xv{constructor(s,l={}){super(s,l.headers||{},l.fetch)}from(s){return new vv(this.url,this.headers,s,this.fetch)}}class vv extends pv{constructor(s,l,r,d){super(s,l,d),this.vectorBucketName=r}createIndex(s){const l=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Se(this,void 0,void 0,function*(){return l.createIndex.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const s=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Se(this,arguments,void 0,function*(l={}){return s.listIndexes.call(this,Object.assign(Object.assign({},l),{vectorBucketName:this.vectorBucketName}))})}getIndex(s){const l=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Se(this,void 0,void 0,function*(){return l.getIndex.call(this,this.vectorBucketName,s)})}deleteIndex(s){const l=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Se(this,void 0,void 0,function*(){return l.deleteIndex.call(this,this.vectorBucketName,s)})}index(s){return new yv(this.url,this.headers,this.vectorBucketName,s,this.fetch)}}class yv extends gv{constructor(s,l,r,d,u){super(s,l,u),this.vectorBucketName=r,this.indexName=d}putVectors(s){const l=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Se(this,void 0,void 0,function*(){return l.putVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(s){const l=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Se(this,void 0,void 0,function*(){return l.getVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const s=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Se(this,arguments,void 0,function*(l={}){return s.listVectors.call(this,Object.assign(Object.assign({},l),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(s){const l=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Se(this,void 0,void 0,function*(){return l.queryVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(s){const l=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Se(this,void 0,void 0,function*(){return l.deleteVectors.call(this,Object.assign(Object.assign({},s),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class jv extends ov{constructor(s,l={},r,d){super(s,l,r,d)}from(s){return new rv(this.url,this.headers,s,this.fetch)}get vectors(){return new bv(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new cv(this.url+"/iceberg",this.headers,this.fetch)}}const Nv="2.83.0";let Ln="";typeof Deno<"u"?Ln="deno":typeof document<"u"?Ln="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ln="react-native":Ln="node";const _v={"X-Client-Info":`supabase-js-${Ln}/${Nv}`},wv={headers:_v},Sv={schema:"public"},Cv={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ev={},zv=o=>o?(...s)=>o(...s):(...s)=>fetch(...s),Tv=()=>Headers,Av=(o,s,l)=>{const r=zv(l),d=Tv();return async(u,m)=>{var x;const g=(x=await s())!==null&&x!==void 0?x:o;let f=new d(m?.headers);return f.has("apikey")||f.set("apikey",o),f.has("Authorization")||f.set("Authorization",`Bearer ${g}`),r(u,Object.assign(Object.assign({},m),{headers:f}))}};function Dv(o){return o.endsWith("/")?o:o+"/"}function Ov(o,s){var l,r;const{db:d,auth:u,realtime:m,global:x}=o,{db:g,auth:f,realtime:b,global:p}=s,_={db:Object.assign(Object.assign({},g),d),auth:Object.assign(Object.assign({},f),u),realtime:Object.assign(Object.assign({},b),m),storage:{},global:Object.assign(Object.assign(Object.assign({},p),x),{headers:Object.assign(Object.assign({},(l=p?.headers)!==null&&l!==void 0?l:{}),(r=x?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return o.accessToken?_.accessToken=o.accessToken:delete _.accessToken,_}function Rv(o){const s=o?.trim();if(!s)throw new Error("supabaseUrl is required.");if(!s.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Dv(s))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Ip="2.83.0",$s=30*1e3,nd=3,Hc=nd*$s,kv="http://localhost:9999",Mv="supabase.auth.token",Uv={"X-Client-Info":`gotrue-js/${Ip}`},ld="X-Supabase-Api-Version",qp={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Fv=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Lv=600*1e3;class qn extends Error{constructor(s,l,r){super(s),this.__isAuthError=!0,this.name="AuthError",this.status=l,this.code=r}}function Ee(o){return typeof o=="object"&&o!==null&&"__isAuthError"in o}class $v extends qn{constructor(s,l,r){super(s,l,r),this.name="AuthApiError",this.status=l,this.code=r}}function Bv(o){return Ee(o)&&o.name==="AuthApiError"}class Yi extends qn{constructor(s,l){super(s),this.name="AuthUnknownError",this.originalError=l}}class Ni extends qn{constructor(s,l,r,d){super(s,r,d),this.name=l,this.status=r}}class aa extends Ni{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Iv(o){return Ee(o)&&o.name==="AuthSessionMissingError"}class ks extends Ni{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class dr extends Ni{constructor(s){super(s,"AuthInvalidCredentialsError",400,void 0)}}class ur extends Ni{constructor(s,l=null){super(s,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=l}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function qv(o){return Ee(o)&&o.name==="AuthImplicitGrantRedirectError"}class Pf extends Ni{constructor(s,l=null){super(s,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=l}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class rd extends Ni{constructor(s,l){super(s,"AuthRetryableFetchError",l,void 0)}}function Gc(o){return Ee(o)&&o.name==="AuthRetryableFetchError"}class Hf extends Ni{constructor(s,l,r){super(s,"AuthWeakPasswordError",l,"weak_password"),this.reasons=r}}class od extends Ni{constructor(s){super(s,"AuthInvalidJwtError",400,"invalid_jwt")}}const pr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Gf=` 	
\r=`.split(""),Pv=(()=>{const o=new Array(128);for(let s=0;s<o.length;s+=1)o[s]=-1;for(let s=0;s<Gf.length;s+=1)o[Gf[s].charCodeAt(0)]=-2;for(let s=0;s<pr.length;s+=1)o[pr[s].charCodeAt(0)]=s;return o})();function Vf(o,s,l){if(o!==null)for(s.queue=s.queue<<8|o,s.queuedBits+=8;s.queuedBits>=6;){const r=s.queue>>s.queuedBits-6&63;l(pr[r]),s.queuedBits-=6}else if(s.queuedBits>0)for(s.queue=s.queue<<6-s.queuedBits,s.queuedBits=6;s.queuedBits>=6;){const r=s.queue>>s.queuedBits-6&63;l(pr[r]),s.queuedBits-=6}}function Pp(o,s,l){const r=Pv[o];if(r>-1)for(s.queue=s.queue<<6|r,s.queuedBits+=6;s.queuedBits>=8;)l(s.queue>>s.queuedBits-8&255),s.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(o)}"`)}}function Yf(o){const s=[],l=m=>{s.push(String.fromCodePoint(m))},r={utf8seq:0,codepoint:0},d={queue:0,queuedBits:0},u=m=>{Vv(m,r,l)};for(let m=0;m<o.length;m+=1)Pp(o.charCodeAt(m),d,u);return s.join("")}function Hv(o,s){if(o<=127){s(o);return}else if(o<=2047){s(192|o>>6),s(128|o&63);return}else if(o<=65535){s(224|o>>12),s(128|o>>6&63),s(128|o&63);return}else if(o<=1114111){s(240|o>>18),s(128|o>>12&63),s(128|o>>6&63),s(128|o&63);return}throw new Error(`Unrecognized Unicode codepoint: ${o.toString(16)}`)}function Gv(o,s){for(let l=0;l<o.length;l+=1){let r=o.charCodeAt(l);if(r>55295&&r<=56319){const d=(r-55296)*1024&65535;r=(o.charCodeAt(l+1)-56320&65535|d)+65536,l+=1}Hv(r,s)}}function Vv(o,s,l){if(s.utf8seq===0){if(o<=127){l(o);return}for(let r=1;r<6;r+=1)if((o>>7-r&1)===0){s.utf8seq=r;break}if(s.utf8seq===2)s.codepoint=o&31;else if(s.utf8seq===3)s.codepoint=o&15;else if(s.utf8seq===4)s.codepoint=o&7;else throw new Error("Invalid UTF-8 sequence");s.utf8seq-=1}else if(s.utf8seq>0){if(o<=127)throw new Error("Invalid UTF-8 sequence");s.codepoint=s.codepoint<<6|o&63,s.utf8seq-=1,s.utf8seq===0&&l(s.codepoint)}}function Is(o){const s=[],l={queue:0,queuedBits:0},r=d=>{s.push(d)};for(let d=0;d<o.length;d+=1)Pp(o.charCodeAt(d),l,r);return new Uint8Array(s)}function Yv(o){const s=[];return Gv(o,l=>s.push(l)),new Uint8Array(s)}function Qi(o){const s=[],l={queue:0,queuedBits:0},r=d=>{s.push(d)};return o.forEach(d=>Vf(d,l,r)),Vf(null,l,r),s.join("")}function Qv(o){return Math.round(Date.now()/1e3)+o}function Kv(){return Symbol("auth-callback")}const Mt=()=>typeof window<"u"&&typeof document<"u",Bi={tested:!1,writable:!1},Hp=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Bi.tested)return Bi.writable;const o=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(o,o),globalThis.localStorage.removeItem(o),Bi.tested=!0,Bi.writable=!0}catch{Bi.tested=!0,Bi.writable=!1}return Bi.writable};function Xv(o){const s={},l=new URL(o);if(l.hash&&l.hash[0]==="#")try{new URLSearchParams(l.hash.substring(1)).forEach((d,u)=>{s[u]=d})}catch{}return l.searchParams.forEach((r,d)=>{s[d]=r}),s}const Gp=o=>o?(...s)=>o(...s):(...s)=>fetch(...s),Jv=o=>typeof o=="object"&&o!==null&&"status"in o&&"ok"in o&&"json"in o&&typeof o.json=="function",Bs=async(o,s,l)=>{await o.setItem(s,JSON.stringify(l))},Ii=async(o,s)=>{const l=await o.getItem(s);if(!l)return null;try{return JSON.parse(l)}catch{return l}},yi=async(o,s)=>{await o.removeItem(s)};class vr{constructor(){this.promise=new vr.promiseConstructor((s,l)=>{this.resolve=s,this.reject=l})}}vr.promiseConstructor=Promise;function Vc(o){const s=o.split(".");if(s.length!==3)throw new od("Invalid JWT structure");for(let r=0;r<s.length;r++)if(!Fv.test(s[r]))throw new od("JWT not in base64url format");return{header:JSON.parse(Yf(s[0])),payload:JSON.parse(Yf(s[1])),signature:Is(s[2]),raw:{header:s[0],payload:s[1]}}}async function Zv(o){return await new Promise(s=>{setTimeout(()=>s(null),o)})}function Wv(o,s){return new Promise((r,d)=>{(async()=>{for(let u=0;u<1/0;u++)try{const m=await o(u);if(!s(u,null,m)){r(m);return}}catch(m){if(!s(u,m)){d(m);return}}})()})}function e0(o){return("0"+o.toString(16)).substr(-2)}function t0(){const s=new Uint32Array(56);if(typeof crypto>"u"){const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=l.length;let d="";for(let u=0;u<56;u++)d+=l.charAt(Math.floor(Math.random()*r));return d}return crypto.getRandomValues(s),Array.from(s,e0).join("")}async function a0(o){const l=new TextEncoder().encode(o),r=await crypto.subtle.digest("SHA-256",l),d=new Uint8Array(r);return Array.from(d).map(u=>String.fromCharCode(u)).join("")}async function i0(o){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),o;const l=await a0(o);return btoa(l).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ms(o,s,l=!1){const r=t0();let d=r;l&&(d+="/PASSWORD_RECOVERY"),await Bs(o,`${s}-code-verifier`,d);const u=await i0(r);return[u,r===u?"plain":"s256"]}const s0=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function n0(o){const s=o.headers.get(ld);if(!s||!s.match(s0))return null;try{return new Date(`${s}T00:00:00.0Z`)}catch{return null}}function l0(o){if(!o)throw new Error("Missing exp claim");const s=Math.floor(Date.now()/1e3);if(o<=s)throw new Error("JWT has expired")}function r0(o){switch(o){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const o0=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Us(o){if(!o0.test(o))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Yc(){const o={};return new Proxy(o,{get:(s,l)=>{if(l==="__isUserNotAvailableProxy")return!0;if(typeof l=="symbol"){const r=l.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${l}" property of the session object is not supported. Please use getUser() instead.`)},set:(s,l)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${l}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(s,l)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${l}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function c0(o,s){return new Proxy(o,{get:(l,r,d)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const u=r.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(l,r,d)}return!s.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s.value=!0),Reflect.get(l,r,d)}})}function Qf(o){return JSON.parse(JSON.stringify(o))}const Hi=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),d0=[502,503,504];async function Kf(o){var s;if(!Jv(o))throw new rd(Hi(o),0);if(d0.includes(o.status))throw new rd(Hi(o),o.status);let l;try{l=await o.json()}catch(u){throw new Yi(Hi(u),u)}let r;const d=n0(o);if(d&&d.getTime()>=qp["2024-01-01"].timestamp&&typeof l=="object"&&l&&typeof l.code=="string"?r=l.code:typeof l=="object"&&l&&typeof l.error_code=="string"&&(r=l.error_code),r){if(r==="weak_password")throw new Hf(Hi(l),o.status,((s=l.weak_password)===null||s===void 0?void 0:s.reasons)||[]);if(r==="session_not_found")throw new aa}else if(typeof l=="object"&&l&&typeof l.weak_password=="object"&&l.weak_password&&Array.isArray(l.weak_password.reasons)&&l.weak_password.reasons.length&&l.weak_password.reasons.reduce((u,m)=>u&&typeof m=="string",!0))throw new Hf(Hi(l),o.status,l.weak_password.reasons);throw new $v(Hi(l),o.status||500,r)}const u0=(o,s,l,r)=>{const d={method:o,headers:s?.headers||{}};return o==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},s?.headers),d.body=JSON.stringify(r),Object.assign(Object.assign({},d),l))};async function Re(o,s,l,r){var d;const u=Object.assign({},r?.headers);u[ld]||(u[ld]=qp["2024-01-01"].name),r?.jwt&&(u.Authorization=`Bearer ${r.jwt}`);const m=(d=r?.query)!==null&&d!==void 0?d:{};r?.redirectTo&&(m.redirect_to=r.redirectTo);const x=Object.keys(m).length?"?"+new URLSearchParams(m).toString():"",g=await h0(o,s,l+x,{headers:u,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(g):{data:Object.assign({},g),error:null}}async function h0(o,s,l,r,d,u){const m=u0(s,r,d,u);let x;try{x=await o(l,Object.assign({},m))}catch(g){throw console.error(g),new rd(Hi(g),0)}if(x.ok||await Kf(x),r?.noResolveJson)return x;try{return await x.json()}catch(g){await Kf(g)}}function wa(o){var s;let l=null;p0(o)&&(l=Object.assign({},o),o.expires_at||(l.expires_at=Qv(o.expires_in)));const r=(s=o.user)!==null&&s!==void 0?s:o;return{data:{session:l,user:r},error:null}}function Xf(o){const s=wa(o);return!s.error&&o.weak_password&&typeof o.weak_password=="object"&&Array.isArray(o.weak_password.reasons)&&o.weak_password.reasons.length&&o.weak_password.message&&typeof o.weak_password.message=="string"&&o.weak_password.reasons.reduce((l,r)=>l&&typeof r=="string",!0)&&(s.data.weak_password=o.weak_password),s}function ji(o){var s;return{data:{user:(s=o.user)!==null&&s!==void 0?s:o},error:null}}function m0(o){return{data:o,error:null}}function f0(o){const{action_link:s,email_otp:l,hashed_token:r,redirect_to:d,verification_type:u}=o,m=Ps(o,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),x={action_link:s,email_otp:l,hashed_token:r,redirect_to:d,verification_type:u},g=Object.assign({},m);return{data:{properties:x,user:g},error:null}}function Jf(o){return o}function p0(o){return o.access_token&&o.refresh_token&&o.expires_in}const Qc=["global","local","others"];class g0{constructor({url:s="",headers:l={},fetch:r}){this.url=s,this.headers=l,this.fetch=Gp(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(s,l=Qc[0]){if(Qc.indexOf(l)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Qc.join(", ")}`);try{return await Re(this.fetch,"POST",`${this.url}/logout?scope=${l}`,{headers:this.headers,jwt:s,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ee(r))return{data:null,error:r};throw r}}async inviteUserByEmail(s,l={}){try{return await Re(this.fetch,"POST",`${this.url}/invite`,{body:{email:s,data:l.data},headers:this.headers,redirectTo:l.redirectTo,xform:ji})}catch(r){if(Ee(r))return{data:{user:null},error:r};throw r}}async generateLink(s){try{const{options:l}=s,r=Ps(s,["options"]),d=Object.assign(Object.assign({},r),l);return"newEmail"in r&&(d.new_email=r?.newEmail,delete d.newEmail),await Re(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:f0,redirectTo:l?.redirectTo})}catch(l){if(Ee(l))return{data:{properties:null,user:null},error:l};throw l}}async createUser(s){try{return await Re(this.fetch,"POST",`${this.url}/admin/users`,{body:s,headers:this.headers,xform:ji})}catch(l){if(Ee(l))return{data:{user:null},error:l};throw l}}async listUsers(s){var l,r,d,u,m,x,g;try{const f={nextPage:null,lastPage:0,total:0},b=await Re(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(l=s?.page)===null||l===void 0?void 0:l.toString())!==null&&r!==void 0?r:"",per_page:(u=(d=s?.perPage)===null||d===void 0?void 0:d.toString())!==null&&u!==void 0?u:""},xform:Jf});if(b.error)throw b.error;const p=await b.json(),_=(m=b.headers.get("x-total-count"))!==null&&m!==void 0?m:0,S=(g=(x=b.headers.get("link"))===null||x===void 0?void 0:x.split(","))!==null&&g!==void 0?g:[];return S.length>0&&(S.forEach(N=>{const O=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(N.split(";")[1].split("=")[1]);f[`${T}Page`]=O}),f.total=parseInt(_)),{data:Object.assign(Object.assign({},p),f),error:null}}catch(f){if(Ee(f))return{data:{users:[]},error:f};throw f}}async getUserById(s){Us(s);try{return await Re(this.fetch,"GET",`${this.url}/admin/users/${s}`,{headers:this.headers,xform:ji})}catch(l){if(Ee(l))return{data:{user:null},error:l};throw l}}async updateUserById(s,l){Us(s);try{return await Re(this.fetch,"PUT",`${this.url}/admin/users/${s}`,{body:l,headers:this.headers,xform:ji})}catch(r){if(Ee(r))return{data:{user:null},error:r};throw r}}async deleteUser(s,l=!1){Us(s);try{return await Re(this.fetch,"DELETE",`${this.url}/admin/users/${s}`,{headers:this.headers,body:{should_soft_delete:l},xform:ji})}catch(r){if(Ee(r))return{data:{user:null},error:r};throw r}}async _listFactors(s){Us(s.userId);try{const{data:l,error:r}=await Re(this.fetch,"GET",`${this.url}/admin/users/${s.userId}/factors`,{headers:this.headers,xform:d=>({data:{factors:d},error:null})});return{data:l,error:r}}catch(l){if(Ee(l))return{data:null,error:l};throw l}}async _deleteFactor(s){Us(s.userId),Us(s.id);try{return{data:await Re(this.fetch,"DELETE",`${this.url}/admin/users/${s.userId}/factors/${s.id}`,{headers:this.headers}),error:null}}catch(l){if(Ee(l))return{data:null,error:l};throw l}}async _listOAuthClients(s){var l,r,d,u,m,x,g;try{const f={nextPage:null,lastPage:0,total:0},b=await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(l=s?.page)===null||l===void 0?void 0:l.toString())!==null&&r!==void 0?r:"",per_page:(u=(d=s?.perPage)===null||d===void 0?void 0:d.toString())!==null&&u!==void 0?u:""},xform:Jf});if(b.error)throw b.error;const p=await b.json(),_=(m=b.headers.get("x-total-count"))!==null&&m!==void 0?m:0,S=(g=(x=b.headers.get("link"))===null||x===void 0?void 0:x.split(","))!==null&&g!==void 0?g:[];return S.length>0&&(S.forEach(N=>{const O=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(N.split(";")[1].split("=")[1]);f[`${T}Page`]=O}),f.total=parseInt(_)),{data:Object.assign(Object.assign({},p),f),error:null}}catch(f){if(Ee(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(s){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:s,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(Ee(l))return{data:null,error:l};throw l}}async _getOAuthClient(s){try{return await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients/${s}`,{headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(Ee(l))return{data:null,error:l};throw l}}async _updateOAuthClient(s,l){try{return await Re(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${s}`,{body:l,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Ee(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(s){try{return await Re(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${s}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(l){if(Ee(l))return{data:null,error:l};throw l}}async _regenerateOAuthClientSecret(s){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients/${s}/regenerate_secret`,{headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(Ee(l))return{data:null,error:l};throw l}}}function Zf(o={}){return{getItem:s=>o[s]||null,setItem:(s,l)=>{o[s]=l},removeItem:s=>{delete o[s]}}}const Fs={debug:!!(globalThis&&Hp()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Vp extends Error{constructor(s){super(s),this.isAcquireTimeout=!0}}class x0 extends Vp{}async function b0(o,s,l){Fs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",o,s);const r=new globalThis.AbortController;return s>0&&setTimeout(()=>{r.abort(),Fs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",o)},s),await Promise.resolve().then(()=>globalThis.navigator.locks.request(o,s===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async d=>{if(d){Fs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",o,d.name);try{return await l()}finally{Fs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",o,d.name)}}else{if(s===0)throw Fs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",o),new x0(`Acquiring an exclusive Navigator LockManager lock "${o}" immediately failed`);if(Fs.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await l()}}))}function v0(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Yp(o){if(!/^0x[a-fA-F0-9]{40}$/.test(o))throw new Error(`@supabase/auth-js: Address "${o}" is invalid.`);return o.toLowerCase()}function y0(o){return parseInt(o,16)}function j0(o){const s=new TextEncoder().encode(o);return"0x"+Array.from(s,r=>r.toString(16).padStart(2,"0")).join("")}function N0(o){var s;const{chainId:l,domain:r,expirationTime:d,issuedAt:u=new Date,nonce:m,notBefore:x,requestId:g,resources:f,scheme:b,uri:p,version:_}=o;{if(!Number.isInteger(l))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${l}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(m&&m.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${m}`);if(!p)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(_!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${_}`);if(!((s=o.statement)===null||s===void 0)&&s.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${o.statement}`)}const S=Yp(o.address),N=b?`${b}://${r}`:r,O=o.statement?`${o.statement}
`:"",T=`${N} wants you to sign in with your Ethereum account:
${S}

${O}`;let z=`URI: ${p}
Version: ${_}
Chain ID: ${l}${m?`
Nonce: ${m}`:""}
Issued At: ${u.toISOString()}`;if(d&&(z+=`
Expiration Time: ${d.toISOString()}`),x&&(z+=`
Not Before: ${x.toISOString()}`),g&&(z+=`
Request ID: ${g}`),f){let L=`
Resources:`;for(const j of f){if(!j||typeof j!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${j}`);L+=`
- ${j}`}z+=L}return`${T}
${z}`}class Nt extends Error{constructor({message:s,code:l,cause:r,name:d}){var u;super(s,{cause:r}),this.__isWebAuthnError=!0,this.name=(u=d??(r instanceof Error?r.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=l}}class gr extends Nt{constructor(s,l){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l,message:s}),this.name="WebAuthnUnknownError",this.originalError=l}}function _0({error:o,options:s}){var l,r,d;const{publicKey:u}=s;if(!u)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(s.signal instanceof AbortSignal)return new Nt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else if(o.name==="ConstraintError"){if(((l=u.authenticatorSelection)===null||l===void 0?void 0:l.requireResidentKey)===!0)return new Nt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:o});if(s.mediation==="conditional"&&((r=u.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new Nt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:o});if(((d=u.authenticatorSelection)===null||d===void 0?void 0:d.userVerification)==="required")return new Nt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:o})}else{if(o.name==="InvalidStateError")return new Nt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:o});if(o.name==="NotAllowedError")return new Nt({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="NotSupportedError")return u.pubKeyCredParams.filter(x=>x.type==="public-key").length===0?new Nt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:o}):new Nt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:o});if(o.name==="SecurityError"){const m=window.location.hostname;if(Qp(m)){if(u.rp.id!==m)return new Nt({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Nt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Nt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:o})}else if(o.name==="UnknownError")return new Nt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Nt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}function w0({error:o,options:s}){const{publicKey:l}=s;if(!l)throw Error("options was missing required publicKey property");if(o.name==="AbortError"){if(s.signal instanceof AbortSignal)return new Nt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:o})}else{if(o.name==="NotAllowedError")return new Nt({message:o.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o});if(o.name==="SecurityError"){const r=window.location.hostname;if(Qp(r)){if(l.rpId!==r)return new Nt({message:`The RP ID "${l.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:o})}else return new Nt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:o})}else if(o.name==="UnknownError")return new Nt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:o})}return new Nt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:o})}class S0{createNewAbortSignal(){if(this.controller){const l=new Error("Cancelling existing WebAuthn API call for new one");l.name="AbortError",this.controller.abort(l)}const s=new AbortController;return this.controller=s,s.signal}cancelCeremony(){if(this.controller){const s=new Error("Manually cancelling existing WebAuthn API call");s.name="AbortError",this.controller.abort(s),this.controller=void 0}}}const C0=new S0;function E0(o){if(!o)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(o);const{challenge:s,user:l,excludeCredentials:r}=o,d=Ps(o,["challenge","user","excludeCredentials"]),u=Is(s).buffer,m=Object.assign(Object.assign({},l),{id:Is(l.id).buffer}),x=Object.assign(Object.assign({},d),{challenge:u,user:m});if(r&&r.length>0){x.excludeCredentials=new Array(r.length);for(let g=0;g<r.length;g++){const f=r[g];x.excludeCredentials[g]=Object.assign(Object.assign({},f),{id:Is(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return x}function z0(o){if(!o)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(o);const{challenge:s,allowCredentials:l}=o,r=Ps(o,["challenge","allowCredentials"]),d=Is(s).buffer,u=Object.assign(Object.assign({},r),{challenge:d});if(l&&l.length>0){u.allowCredentials=new Array(l.length);for(let m=0;m<l.length;m++){const x=l[m];u.allowCredentials[m]=Object.assign(Object.assign({},x),{id:Is(x.id).buffer,type:x.type||"public-key",transports:x.transports})}}return u}function T0(o){var s;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const l=o;return{id:o.id,rawId:o.id,response:{attestationObject:Qi(new Uint8Array(o.response.attestationObject)),clientDataJSON:Qi(new Uint8Array(o.response.clientDataJSON))},type:"public-key",clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:(s=l.authenticatorAttachment)!==null&&s!==void 0?s:void 0}}function A0(o){var s;if("toJSON"in o&&typeof o.toJSON=="function")return o.toJSON();const l=o,r=o.getClientExtensionResults(),d=o.response;return{id:o.id,rawId:o.id,response:{authenticatorData:Qi(new Uint8Array(d.authenticatorData)),clientDataJSON:Qi(new Uint8Array(d.clientDataJSON)),signature:Qi(new Uint8Array(d.signature)),userHandle:d.userHandle?Qi(new Uint8Array(d.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(s=l.authenticatorAttachment)!==null&&s!==void 0?s:void 0}}function Qp(o){return o==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(o)}function Wf(){var o,s;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((o=navigator?.credentials)===null||o===void 0?void 0:o.create)=="function"&&typeof((s=navigator?.credentials)===null||s===void 0?void 0:s.get)=="function")}async function D0(o){try{const s=await navigator.credentials.create(o);return s?s instanceof PublicKeyCredential?{data:s,error:null}:{data:null,error:new gr("Browser returned unexpected credential type",s)}:{data:null,error:new gr("Empty credential response",s)}}catch(s){return{data:null,error:_0({error:s,options:o})}}}async function O0(o){try{const s=await navigator.credentials.get(o);return s?s instanceof PublicKeyCredential?{data:s,error:null}:{data:null,error:new gr("Browser returned unexpected credential type",s)}:{data:null,error:new gr("Empty credential response",s)}}catch(s){return{data:null,error:w0({error:s,options:o})}}}const R0={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},k0={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function xr(...o){const s=d=>d!==null&&typeof d=="object"&&!Array.isArray(d),l=d=>d instanceof ArrayBuffer||ArrayBuffer.isView(d),r={};for(const d of o)if(d)for(const u in d){const m=d[u];if(m!==void 0)if(Array.isArray(m))r[u]=m;else if(l(m))r[u]=m;else if(s(m)){const x=r[u];s(x)?r[u]=xr(x,m):r[u]=xr(m)}else r[u]=m}return r}function M0(o,s){return xr(R0,o,s||{})}function U0(o,s){return xr(k0,o,s||{})}class F0{constructor(s){this.client=s,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(s){return this.client.mfa.enroll(Object.assign(Object.assign({},s),{factorType:"webauthn"}))}async _challenge({factorId:s,webauthn:l,friendlyName:r,signal:d},u){try{const{data:m,error:x}=await this.client.mfa.challenge({factorId:s,webauthn:l});if(!m)return{data:null,error:x};const g=d??C0.createNewAbortSignal();if(m.webauthn.type==="create"){const{user:f}=m.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${r}`),f.displayName||(f.displayName=f.name)}switch(m.webauthn.type){case"create":{const f=M0(m.webauthn.credential_options.publicKey,u?.create),{data:b,error:p}=await D0({publicKey:f,signal:g});return b?{data:{factorId:s,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:b}},error:null}:{data:null,error:p}}case"request":{const f=U0(m.webauthn.credential_options.publicKey,u?.request),{data:b,error:p}=await O0(Object.assign(Object.assign({},m.webauthn.credential_options),{publicKey:f,signal:g}));return b?{data:{factorId:s,challengeId:m.id,webauthn:{type:m.webauthn.type,credential_response:b}},error:null}:{data:null,error:p}}}}catch(m){return Ee(m)?{data:null,error:m}:{data:null,error:new Yi("Unexpected error in challenge",m)}}}async _verify({challengeId:s,factorId:l,webauthn:r}){return this.client.mfa.verify({factorId:l,challengeId:s,webauthn:r})}async _authenticate({factorId:s,webauthn:{rpId:l=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:d}={}},u){if(!l)return{data:null,error:new qn("rpId is required for WebAuthn authentication")};try{if(!Wf())return{data:null,error:new Yi("Browser does not support WebAuthn",null)};const{data:m,error:x}=await this.challenge({factorId:s,webauthn:{rpId:l,rpOrigins:r},signal:d},{request:u});if(!m)return{data:null,error:x};const{webauthn:g}=m;return this._verify({factorId:s,challengeId:m.challengeId,webauthn:{type:g.type,rpId:l,rpOrigins:r,credential_response:g.credential_response}})}catch(m){return Ee(m)?{data:null,error:m}:{data:null,error:new Yi("Unexpected error in authenticate",m)}}}async _register({friendlyName:s,webauthn:{rpId:l=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:d}={}},u){if(!l)return{data:null,error:new qn("rpId is required for WebAuthn registration")};try{if(!Wf())return{data:null,error:new Yi("Browser does not support WebAuthn",null)};const{data:m,error:x}=await this._enroll({friendlyName:s});if(!m)return await this.client.mfa.listFactors().then(b=>{var p;return(p=b.data)===null||p===void 0?void 0:p.all.find(_=>_.factor_type==="webauthn"&&_.friendly_name===s&&_.status!=="unverified")}).then(b=>b?this.client.mfa.unenroll({factorId:b?.id}):void 0),{data:null,error:x};const{data:g,error:f}=await this._challenge({factorId:m.id,friendlyName:m.friendly_name,webauthn:{rpId:l,rpOrigins:r},signal:d},{create:u});return g?this._verify({factorId:m.id,challengeId:g.challengeId,webauthn:{rpId:l,rpOrigins:r,type:g.webauthn.type,credential_response:g.webauthn.credential_response}}):{data:null,error:f}}catch(m){return Ee(m)?{data:null,error:m}:{data:null,error:new Yi("Unexpected error in register",m)}}}}v0();const L0={url:kv,storageKey:Mv,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Uv,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ep(o,s,l){return await l()}const Ls={};class Pn{get jwks(){var s,l;return(l=(s=Ls[this.storageKey])===null||s===void 0?void 0:s.jwks)!==null&&l!==void 0?l:{keys:[]}}set jwks(s){Ls[this.storageKey]=Object.assign(Object.assign({},Ls[this.storageKey]),{jwks:s})}get jwks_cached_at(){var s,l;return(l=(s=Ls[this.storageKey])===null||s===void 0?void 0:s.cachedAt)!==null&&l!==void 0?l:Number.MIN_SAFE_INTEGER}set jwks_cached_at(s){Ls[this.storageKey]=Object.assign(Object.assign({},Ls[this.storageKey]),{cachedAt:s})}constructor(s){var l,r,d;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},L0),s);if(this.storageKey=u.storageKey,this.instanceID=(l=Pn.nextInstanceID[this.storageKey])!==null&&l!==void 0?l:0,Pn.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&Mt()){const m=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(m),this.logDebugMessages&&console.trace(m)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new g0({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Gp(u.fetch),this.lock=u.lock||ep,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:Mt()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=b0:this.lock=ep,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new F0(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Hp()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Zf(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Zf(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(m){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",m)}(d=this.broadcastChannel)===null||d===void 0||d.addEventListener("message",async m=>{this._debug("received broadcast notification from other tab or client",m),await this._notifyAllSubscribers(m.data.event,m.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(s){if(this.throwOnError&&s&&s.error)throw s.error;return s}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Ip}) ${new Date().toISOString()}`}_debug(...s){return this.logDebugMessages&&this.logger(this._logPrefix(),...s),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var s;try{let l={},r="none";if(Mt()&&(l=Xv(window.location.href),this._isImplicitGrantCallback(l)?r="implicit":await this._isPKCECallback(l)&&(r="pkce")),Mt()&&this.detectSessionInUrl&&r!=="none"){const{data:d,error:u}=await this._getSessionFromURL(l,r);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),qv(u)){const g=(s=u.details)===null||s===void 0?void 0:s.code;if(g==="identity_already_exists"||g==="identity_not_found"||g==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:m,redirectType:x}=d;return this._debug("#_initialize()","detected session in URL",m,"redirect type",x),await this._saveSession(m),setTimeout(async()=>{x==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",m):await this._notifyAllSubscribers("SIGNED_IN",m)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(l){return Ee(l)?this._returnResult({error:l}):this._returnResult({error:new Yi("Unexpected error during initialization",l)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(s){var l,r,d;try{const u=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(l=s?.options)===null||l===void 0?void 0:l.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(d=s?.options)===null||d===void 0?void 0:d.captchaToken}},xform:wa}),{data:m,error:x}=u;if(x||!m)return this._returnResult({data:{user:null,session:null},error:x});const g=m.session,f=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:f,session:g},error:null})}catch(u){if(Ee(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(s){var l,r,d;try{let u;if("email"in s){const{email:b,password:p,options:_}=s;let S=null,N=null;this.flowType==="pkce"&&([S,N]=await Ms(this.storage,this.storageKey)),u=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:_?.emailRedirectTo,body:{email:b,password:p,data:(l=_?.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:_?.captchaToken},code_challenge:S,code_challenge_method:N},xform:wa})}else if("phone"in s){const{phone:b,password:p,options:_}=s;u=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:p,data:(r=_?.data)!==null&&r!==void 0?r:{},channel:(d=_?.channel)!==null&&d!==void 0?d:"sms",gotrue_meta_security:{captcha_token:_?.captchaToken}},xform:wa})}else throw new dr("You must provide either an email or phone number and a password");const{data:m,error:x}=u;if(x||!m)return this._returnResult({data:{user:null,session:null},error:x});const g=m.session,f=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:f,session:g},error:null})}catch(u){if(Ee(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(s){try{let l;if("email"in s){const{email:u,password:m,options:x}=s;l=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:m,gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Xf})}else if("phone"in s){const{phone:u,password:m,options:x}=s;l=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:m,gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Xf})}else throw new dr("You must provide either an email or phone number and a password");const{data:r,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!r||!r.session||!r.user){const u=new ks;return this._returnResult({data:{user:null,session:null},error:u})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:d})}catch(l){if(Ee(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithOAuth(s){var l,r,d,u;return await this._handleProviderSignIn(s.provider,{redirectTo:(l=s.options)===null||l===void 0?void 0:l.redirectTo,scopes:(r=s.options)===null||r===void 0?void 0:r.scopes,queryParams:(d=s.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:(u=s.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(s){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(s))}async signInWithWeb3(s){const{chain:l}=s;switch(l){case"ethereum":return await this.signInWithEthereum(s);case"solana":return await this.signInWithSolana(s);default:throw new Error(`@supabase/auth-js: Unsupported chain "${l}"`)}}async signInWithEthereum(s){var l,r,d,u,m,x,g,f,b,p,_;let S,N;if("message"in s)S=s.message,N=s.signature;else{const{chain:O,wallet:T,statement:z,options:L}=s;let j;if(Mt())if(typeof T=="object")j=T;else{const ue=window;if("ethereum"in ue&&typeof ue.ethereum=="object"&&"request"in ue.ethereum&&typeof ue.ethereum.request=="function")j=ue.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");j=T}const q=new URL((l=L?.url)!==null&&l!==void 0?l:window.location.href),y=await j.request({method:"eth_requestAccounts"}).then(ue=>ue).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!y||y.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const M=Yp(y[0]);let k=(r=L?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!k){const ue=await j.request({method:"eth_chainId"});k=y0(ue)}const te={domain:q.host,address:M,statement:z,uri:q.href,version:"1",chainId:k,nonce:(d=L?.signInWithEthereum)===null||d===void 0?void 0:d.nonce,issuedAt:(m=(u=L?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&m!==void 0?m:new Date,expirationTime:(x=L?.signInWithEthereum)===null||x===void 0?void 0:x.expirationTime,notBefore:(g=L?.signInWithEthereum)===null||g===void 0?void 0:g.notBefore,requestId:(f=L?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(b=L?.signInWithEthereum)===null||b===void 0?void 0:b.resources};S=N0(te),N=await j.request({method:"personal_sign",params:[j0(S),M]})}try{const{data:O,error:T}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:N},!((p=s.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(_=s.options)===null||_===void 0?void 0:_.captchaToken}}:null),xform:wa});if(T)throw T;if(!O||!O.session||!O.user){const z=new ks;return this._returnResult({data:{user:null,session:null},error:z})}return O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:Object.assign({},O),error:T})}catch(O){if(Ee(O))return this._returnResult({data:{user:null,session:null},error:O});throw O}}async signInWithSolana(s){var l,r,d,u,m,x,g,f,b,p,_,S;let N,O;if("message"in s)N=s.message,O=s.signature;else{const{chain:T,wallet:z,statement:L,options:j}=s;let q;if(Mt())if(typeof z=="object")q=z;else{const M=window;if("solana"in M&&typeof M.solana=="object"&&("signIn"in M.solana&&typeof M.solana.signIn=="function"||"signMessage"in M.solana&&typeof M.solana.signMessage=="function"))q=M.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof z!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");q=z}const y=new URL((l=j?.url)!==null&&l!==void 0?l:window.location.href);if("signIn"in q&&q.signIn){const M=await q.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j?.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),L?{statement:L}:null));let k;if(Array.isArray(M)&&M[0]&&typeof M[0]=="object")k=M[0];else if(M&&typeof M=="object"&&"signedMessage"in M&&"signature"in M)k=M;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)N=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),O=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in q)||typeof q.signMessage!="function"||!("publicKey"in q)||typeof q!="object"||!q.publicKey||!("toBase58"in q.publicKey)||typeof q.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");N=[`${y.host} wants you to sign in with your Solana account:`,q.publicKey.toBase58(),...L?["",L,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${(d=(r=j?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&d!==void 0?d:new Date().toISOString()}`,...!((u=j?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((m=j?.signInWithSolana)===null||m===void 0)&&m.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((x=j?.signInWithSolana)===null||x===void 0)&&x.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((g=j?.signInWithSolana)===null||g===void 0)&&g.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((f=j?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((p=(b=j?.signInWithSolana)===null||b===void 0?void 0:b.resources)===null||p===void 0)&&p.length?["Resources",...j.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const M=await q.signMessage(new TextEncoder().encode(N),"utf8");if(!M||!(M instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");O=M}}try{const{data:T,error:z}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:N,signature:Qi(O)},!((_=s.options)===null||_===void 0)&&_.captchaToken?{gotrue_meta_security:{captcha_token:(S=s.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:wa});if(z)throw z;if(!T||!T.session||!T.user){const L=new ks;return this._returnResult({data:{user:null,session:null},error:L})}return T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),this._returnResult({data:Object.assign({},T),error:z})}catch(T){if(Ee(T))return this._returnResult({data:{user:null,session:null},error:T});throw T}}async _exchangeCodeForSession(s){const l=await Ii(this.storage,`${this.storageKey}-code-verifier`),[r,d]=(l??"").split("/");try{const{data:u,error:m}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:s,code_verifier:r},xform:wa});if(await yi(this.storage,`${this.storageKey}-code-verifier`),m)throw m;if(!u||!u.session||!u.user){const x=new ks;return this._returnResult({data:{user:null,session:null,redirectType:null},error:x})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:d??null}),error:m})}catch(u){if(Ee(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(s){try{const{options:l,provider:r,token:d,access_token:u,nonce:m}=s,x=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:d,access_token:u,nonce:m,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:wa}),{data:g,error:f}=x;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!g||!g.session||!g.user){const b=new ks;return this._returnResult({data:{user:null,session:null},error:b})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:g,error:f})}catch(l){if(Ee(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithOtp(s){var l,r,d,u,m;try{if("email"in s){const{email:x,options:g}=s;let f=null,b=null;this.flowType==="pkce"&&([f,b]=await Ms(this.storage,this.storageKey));const{error:p}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:x,data:(l=g?.data)!==null&&l!==void 0?l:{},create_user:(r=g?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:g?.captchaToken},code_challenge:f,code_challenge_method:b},redirectTo:g?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}if("phone"in s){const{phone:x,options:g}=s,{data:f,error:b}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:x,data:(d=g?.data)!==null&&d!==void 0?d:{},create_user:(u=g?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:g?.captchaToken},channel:(m=g?.channel)!==null&&m!==void 0?m:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:b})}throw new dr("You must provide either an email or phone number.")}catch(x){if(Ee(x))return this._returnResult({data:{user:null,session:null},error:x});throw x}}async verifyOtp(s){var l,r;try{let d,u;"options"in s&&(d=(l=s.options)===null||l===void 0?void 0:l.redirectTo,u=(r=s.options)===null||r===void 0?void 0:r.captchaToken);const{data:m,error:x}=await Re(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},s),{gotrue_meta_security:{captcha_token:u}}),redirectTo:d,xform:wa});if(x)throw x;if(!m)throw new Error("An error occurred on token verification.");const g=m.session,f=m.user;return g?.access_token&&(await this._saveSession(g),await this._notifyAllSubscribers(s.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",g)),this._returnResult({data:{user:f,session:g},error:null})}catch(d){if(Ee(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}}async signInWithSSO(s){var l,r,d,u,m;try{let x=null,g=null;this.flowType==="pkce"&&([x,g]=await Ms(this.storage,this.storageKey));const f=await Re(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in s?{provider_id:s.providerId}:null),"domain"in s?{domain:s.domain}:null),{redirect_to:(r=(l=s.options)===null||l===void 0?void 0:l.redirectTo)!==null&&r!==void 0?r:void 0}),!((d=s?.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:s.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:x,code_challenge_method:g}),headers:this.headers,xform:m0});return!((u=f.data)===null||u===void 0)&&u.url&&Mt()&&!(!((m=s.options)===null||m===void 0)&&m.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(x){if(Ee(x))return this._returnResult({data:null,error:x});throw x}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async s=>{const{data:{session:l},error:r}=s;if(r)throw r;if(!l)throw new aa;const{error:d}=await Re(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:l.access_token});return this._returnResult({data:{user:null,session:null},error:d})})}catch(s){if(Ee(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async resend(s){try{const l=`${this.url}/resend`;if("email"in s){const{email:r,type:d,options:u}=s,{error:m}=await Re(this.fetch,"POST",l,{headers:this.headers,body:{email:r,type:d,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}else if("phone"in s){const{phone:r,type:d,options:u}=s,{data:m,error:x}=await Re(this.fetch,"POST",l,{headers:this.headers,body:{phone:r,type:d,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:x})}throw new dr("You must provide either an email or phone number and a type")}catch(l){if(Ee(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async l=>l))}async _acquireLock(s,l){this._debug("#_acquireLock","begin",s);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),d=(async()=>(await r,await l()))();return this.pendingInLock.push((async()=>{try{await d}catch{}})()),d}return await this.lock(`lock:${this.storageKey}`,s,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=l();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const d=[...this.pendingInLock];await Promise.all(d),this.pendingInLock.splice(0,d.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(s){this._debug("#_useSession","begin");try{const l=await this.__loadSession();return await s(l)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let s=null;const l=await Ii(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",l),l!==null&&(this._isValidSession(l)?s=l:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!s)return{data:{session:null},error:null};const r=s.expires_at?s.expires_at*1e3-Date.now()<Hc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",s.expires_at),!r){if(this.userStorage){const m=await Ii(this.userStorage,this.storageKey+"-user");m?.user?s.user=m.user:s.user=Yc()}if(this.storage.isServer&&s.user&&!s.user.__isUserNotAvailableProxy){const m={value:this.suppressGetSessionWarning};s.user=c0(s.user,m),m.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:s},error:null}}const{data:d,error:u}=await this._callRefreshToken(s.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:d},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(s){return s?await this._getUser(s):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(s){try{return s?await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:s,xform:ji}):await this._useSession(async l=>{var r,d,u;const{data:m,error:x}=l;if(x)throw x;return!(!((r=m.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new aa}:await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0,xform:ji})})}catch(l){if(Ee(l))return Iv(l)&&(await this._removeSession(),await yi(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:l});throw l}}async updateUser(s,l={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(s,l))}async _updateUser(s,l={}){try{return await this._useSession(async r=>{const{data:d,error:u}=r;if(u)throw u;if(!d.session)throw new aa;const m=d.session;let x=null,g=null;this.flowType==="pkce"&&s.email!=null&&([x,g]=await Ms(this.storage,this.storageKey));const{data:f,error:b}=await Re(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:l?.emailRedirectTo,body:Object.assign(Object.assign({},s),{code_challenge:x,code_challenge_method:g}),jwt:m.access_token,xform:ji});if(b)throw b;return m.user=f.user,await this._saveSession(m),await this._notifyAllSubscribers("USER_UPDATED",m),this._returnResult({data:{user:m.user},error:null})})}catch(r){if(Ee(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(s))}async _setSession(s){try{if(!s.access_token||!s.refresh_token)throw new aa;const l=Date.now()/1e3;let r=l,d=!0,u=null;const{payload:m}=Vc(s.access_token);if(m.exp&&(r=m.exp,d=r<=l),d){const{data:x,error:g}=await this._callRefreshToken(s.refresh_token);if(g)return this._returnResult({data:{user:null,session:null},error:g});if(!x)return{data:{user:null,session:null},error:null};u=x}else{const{data:x,error:g}=await this._getUser(s.access_token);if(g)throw g;u={access_token:s.access_token,refresh_token:s.refresh_token,user:x.user,token_type:"bearer",expires_in:r-l,expires_at:r},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(l){if(Ee(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}}async refreshSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(s))}async _refreshSession(s){try{return await this._useSession(async l=>{var r;if(!s){const{data:m,error:x}=l;if(x)throw x;s=(r=m.session)!==null&&r!==void 0?r:void 0}if(!s?.refresh_token)throw new aa;const{data:d,error:u}=await this._callRefreshToken(s.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):d?this._returnResult({data:{user:d.user,session:d},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(l){if(Ee(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async _getSessionFromURL(s,l){try{if(!Mt())throw new ur("No browser detected.");if(s.error||s.error_description||s.error_code)throw new ur(s.error_description||"Error in URL with unspecified error_description",{error:s.error||"unspecified_error",code:s.error_code||"unspecified_code"});switch(l){case"implicit":if(this.flowType==="pkce")throw new Pf("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ur("Not a valid implicit grant flow url.");break;default:}if(l==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!s.code)throw new Pf("No code detected.");const{data:L,error:j}=await this._exchangeCodeForSession(s.code);if(j)throw j;const q=new URL(window.location.href);return q.searchParams.delete("code"),window.history.replaceState(window.history.state,"",q.toString()),{data:{session:L.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:d,access_token:u,refresh_token:m,expires_in:x,expires_at:g,token_type:f}=s;if(!u||!x||!m||!f)throw new ur("No session defined in URL");const b=Math.round(Date.now()/1e3),p=parseInt(x);let _=b+p;g&&(_=parseInt(g));const S=_-b;S*1e3<=$s&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${p}s`);const N=_-p;b-N>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",N,_,b):b-N<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",N,_,b);const{data:O,error:T}=await this._getUser(u);if(T)throw T;const z={provider_token:r,provider_refresh_token:d,access_token:u,expires_in:p,expires_at:_,refresh_token:m,token_type:f,user:O.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:z,redirectType:s.type},error:null})}catch(r){if(Ee(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(s){return!!(s.access_token||s.error_description)}async _isPKCECallback(s){const l=await Ii(this.storage,`${this.storageKey}-code-verifier`);return!!(s.code&&l)}async signOut(s={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(s))}async _signOut({scope:s}={scope:"global"}){return await this._useSession(async l=>{var r;const{data:d,error:u}=l;if(u)return this._returnResult({error:u});const m=(r=d.session)===null||r===void 0?void 0:r.access_token;if(m){const{error:x}=await this.admin.signOut(m,s);if(x&&!(Bv(x)&&(x.status===404||x.status===401||x.status===403)))return this._returnResult({error:x})}return s!=="others"&&(await this._removeSession(),await yi(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(s){const l=Kv(),r={id:l,callback:s,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",l),this.stateChangeEmitters.delete(l)}};return this._debug("#onAuthStateChange()","registered callback with id",l),this.stateChangeEmitters.set(l,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(l)})))(),{data:{subscription:r}}}async _emitInitialSession(s){return await this._useSession(async l=>{var r,d;try{const{data:{session:u},error:m}=l;if(m)throw m;await((r=this.stateChangeEmitters.get(s))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",s,"session",u)}catch(u){await((d=this.stateChangeEmitters.get(s))===null||d===void 0?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",s,"error",u),console.error(u)}})}async resetPasswordForEmail(s,l={}){let r=null,d=null;this.flowType==="pkce"&&([r,d]=await Ms(this.storage,this.storageKey,!0));try{return await Re(this.fetch,"POST",`${this.url}/recover`,{body:{email:s,code_challenge:r,code_challenge_method:d,gotrue_meta_security:{captcha_token:l.captchaToken}},headers:this.headers,redirectTo:l.redirectTo})}catch(u){if(Ee(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var s;try{const{data:l,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(s=l.user.identities)!==null&&s!==void 0?s:[]},error:null})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async linkIdentity(s){return"token"in s?this.linkIdentityIdToken(s):this.linkIdentityOAuth(s)}async linkIdentityOAuth(s){var l;try{const{data:r,error:d}=await this._useSession(async u=>{var m,x,g,f,b;const{data:p,error:_}=u;if(_)throw _;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,s.provider,{redirectTo:(m=s.options)===null||m===void 0?void 0:m.redirectTo,scopes:(x=s.options)===null||x===void 0?void 0:x.scopes,queryParams:(g=s.options)===null||g===void 0?void 0:g.queryParams,skipBrowserRedirect:!0});return await Re(this.fetch,"GET",S,{headers:this.headers,jwt:(b=(f=p.session)===null||f===void 0?void 0:f.access_token)!==null&&b!==void 0?b:void 0})});if(d)throw d;return Mt()&&!(!((l=s.options)===null||l===void 0)&&l.skipBrowserRedirect)&&window.location.assign(r?.url),this._returnResult({data:{provider:s.provider,url:r?.url},error:null})}catch(r){if(Ee(r))return this._returnResult({data:{provider:s.provider,url:null},error:r});throw r}}async linkIdentityIdToken(s){return await this._useSession(async l=>{var r;try{const{error:d,data:{session:u}}=l;if(d)throw d;const{options:m,provider:x,token:g,access_token:f,nonce:b}=s,p=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=u?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:x,id_token:g,access_token:f,nonce:b,link_identity:!0,gotrue_meta_security:{captcha_token:m?.captchaToken}},xform:wa}),{data:_,error:S}=p;return S?this._returnResult({data:{user:null,session:null},error:S}):!_||!_.session||!_.user?this._returnResult({data:{user:null,session:null},error:new ks}):(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("USER_UPDATED",_.session)),this._returnResult({data:_,error:S}))}catch(d){if(Ee(d))return this._returnResult({data:{user:null,session:null},error:d});throw d}})}async unlinkIdentity(s){try{return await this._useSession(async l=>{var r,d;const{data:u,error:m}=l;if(m)throw m;return await Re(this.fetch,"DELETE",`${this.url}/user/identities/${s.identity_id}`,{headers:this.headers,jwt:(d=(r=u.session)===null||r===void 0?void 0:r.access_token)!==null&&d!==void 0?d:void 0})})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async _refreshAccessToken(s){const l=`#_refreshAccessToken(${s.substring(0,5)}...)`;this._debug(l,"begin");try{const r=Date.now();return await Wv(async d=>(d>0&&await Zv(200*Math.pow(2,d-1)),this._debug(l,"refreshing attempt",d),await Re(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:s},headers:this.headers,xform:wa})),(d,u)=>{const m=200*Math.pow(2,d);return u&&Gc(u)&&Date.now()+m-r<$s})}catch(r){if(this._debug(l,"error",r),Ee(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(l,"end")}}_isValidSession(s){return typeof s=="object"&&s!==null&&"access_token"in s&&"refresh_token"in s&&"expires_at"in s}async _handleProviderSignIn(s,l){const r=await this._getUrlForProvider(`${this.url}/authorize`,s,{redirectTo:l.redirectTo,scopes:l.scopes,queryParams:l.queryParams});return this._debug("#_handleProviderSignIn()","provider",s,"options",l,"url",r),Mt()&&!l.skipBrowserRedirect&&window.location.assign(r),{data:{provider:s,url:r},error:null}}async _recoverAndRefresh(){var s,l;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const d=await Ii(this.storage,this.storageKey);if(d&&this.userStorage){let m=await Ii(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!m&&(m={user:d.user},await Bs(this.userStorage,this.storageKey+"-user",m)),d.user=(s=m?.user)!==null&&s!==void 0?s:Yc()}else if(d&&!d.user&&!d.user){const m=await Ii(this.storage,this.storageKey+"-user");m&&m?.user?(d.user=m.user,await yi(this.storage,this.storageKey+"-user"),await Bs(this.storage,this.storageKey,d)):d.user=Yc()}if(this._debug(r,"session from storage",d),!this._isValidSession(d)){this._debug(r,"session is not valid"),d!==null&&await this._removeSession();return}const u=((l=d.expires_at)!==null&&l!==void 0?l:1/0)*1e3-Date.now()<Hc;if(this._debug(r,`session has${u?"":" not"} expired with margin of ${Hc}s`),u){if(this.autoRefreshToken&&d.refresh_token){const{error:m}=await this._callRefreshToken(d.refresh_token);m&&(console.error(m),Gc(m)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",m),await this._removeSession()))}}else if(d.user&&d.user.__isUserNotAvailableProxy===!0)try{const{data:m,error:x}=await this._getUser(d.access_token);!x&&m?.user?(d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(m){console.error("Error getting user data:",m),this._debug(r,"error getting user data, skipping SIGNED_IN notification",m)}else await this._notifyAllSubscribers("SIGNED_IN",d)}catch(d){this._debug(r,"error",d),console.error(d);return}finally{this._debug(r,"end")}}async _callRefreshToken(s){var l,r;if(!s)throw new aa;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const d=`#_callRefreshToken(${s.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new vr;const{data:u,error:m}=await this._refreshAccessToken(s);if(m)throw m;if(!u.session)throw new aa;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const x={data:u.session,error:null};return this.refreshingDeferred.resolve(x),x}catch(u){if(this._debug(d,"error",u),Ee(u)){const m={data:null,error:u};return Gc(u)||await this._removeSession(),(l=this.refreshingDeferred)===null||l===void 0||l.resolve(m),m}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(u),u}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(s,l,r=!0){const d=`#_notifyAllSubscribers(${s})`;this._debug(d,"begin",l,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:s,session:l});const u=[],m=Array.from(this.stateChangeEmitters.values()).map(async x=>{try{await x.callback(s,l)}catch(g){u.push(g)}});if(await Promise.all(m),u.length>0){for(let x=0;x<u.length;x+=1)console.error(u[x]);throw u[0]}}finally{this._debug(d,"end")}}async _saveSession(s){this._debug("#_saveSession()",s),this.suppressGetSessionWarning=!0;const l=Object.assign({},s),r=l.user&&l.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&l.user&&await Bs(this.userStorage,this.storageKey+"-user",{user:l.user});const d=Object.assign({},l);delete d.user;const u=Qf(d);await Bs(this.storage,this.storageKey,u)}else{const d=Qf(l);await Bs(this.storage,this.storageKey,d)}}async _removeSession(){this._debug("#_removeSession()"),await yi(this.storage,this.storageKey),await yi(this.storage,this.storageKey+"-code-verifier"),await yi(this.storage,this.storageKey+"-user"),this.userStorage&&await yi(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const s=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{s&&Mt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",s)}catch(l){console.error("removing visibilitychange callback failed",l)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const s=setInterval(()=>this._autoRefreshTokenTick(),$s);this.autoRefreshTicker=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const s=this.autoRefreshTicker;this.autoRefreshTicker=null,s&&clearInterval(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const s=Date.now();try{return await this._useSession(async l=>{const{data:{session:r}}=l;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const d=Math.floor((r.expires_at*1e3-s)/$s);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts ${$s}ms, refresh threshold is ${nd} ticks`),d<=nd&&await this._callRefreshToken(r.refresh_token)})}catch(l){console.error("Auto refresh tick failed with error. This is likely a transient error.",l)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(s){if(s.isAcquireTimeout||s instanceof Vp)this._debug("auto refresh token tick lock not available");else throw s}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(s){console.error("_handleVisibilityChange",s)}}async _onVisibilityChanged(s){const l=`#_onVisibilityChanged(${s})`;this._debug(l,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),s||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(l,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(s,l,r){const d=[`provider=${encodeURIComponent(l)}`];if(r?.redirectTo&&d.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&d.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[u,m]=await Ms(this.storage,this.storageKey),x=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(m)}`});d.push(x.toString())}if(r?.queryParams){const u=new URLSearchParams(r.queryParams);d.push(u.toString())}return r?.skipBrowserRedirect&&d.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${s}?${d.join("&")}`}async _unenroll(s){try{return await this._useSession(async l=>{var r;const{data:d,error:u}=l;return u?this._returnResult({data:null,error:u}):await Re(this.fetch,"DELETE",`${this.url}/factors/${s.factorId}`,{headers:this.headers,jwt:(r=d?.session)===null||r===void 0?void 0:r.access_token})})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async _enroll(s){try{return await this._useSession(async l=>{var r,d;const{data:u,error:m}=l;if(m)return this._returnResult({data:null,error:m});const x=Object.assign({friendly_name:s.friendlyName,factor_type:s.factorType},s.factorType==="phone"?{phone:s.phone}:s.factorType==="totp"?{issuer:s.issuer}:{}),{data:g,error:f}=await Re(this.fetch,"POST",`${this.url}/factors`,{body:x,headers:this.headers,jwt:(r=u?.session)===null||r===void 0?void 0:r.access_token});return f?this._returnResult({data:null,error:f}):(s.factorType==="totp"&&g.type==="totp"&&(!((d=g?.totp)===null||d===void 0)&&d.qr_code)&&(g.totp.qr_code=`data:image/svg+xml;utf-8,${g.totp.qr_code}`),this._returnResult({data:g,error:null}))})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async _verify(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async l=>{var r;const{data:d,error:u}=l;if(u)return this._returnResult({data:null,error:u});const m=Object.assign({challenge_id:s.challengeId},"webauthn"in s?{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_response:s.webauthn.type==="create"?T0(s.webauthn.credential_response):A0(s.webauthn.credential_response)})}:{code:s.code}),{data:x,error:g}=await Re(this.fetch,"POST",`${this.url}/factors/${s.factorId}/verify`,{body:m,headers:this.headers,jwt:(r=d?.session)===null||r===void 0?void 0:r.access_token});return g?this._returnResult({data:null,error:g}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+x.expires_in},x)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",x),this._returnResult({data:x,error:g}))})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}})}async _challenge(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async l=>{var r;const{data:d,error:u}=l;if(u)return this._returnResult({data:null,error:u});const m=await Re(this.fetch,"POST",`${this.url}/factors/${s.factorId}/challenge`,{body:s,headers:this.headers,jwt:(r=d?.session)===null||r===void 0?void 0:r.access_token});if(m.error)return m;const{data:x}=m;if(x.type!=="webauthn")return{data:x,error:null};switch(x.webauthn.type){case"create":return{data:Object.assign(Object.assign({},x),{webauthn:Object.assign(Object.assign({},x.webauthn),{credential_options:Object.assign(Object.assign({},x.webauthn.credential_options),{publicKey:E0(x.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},x),{webauthn:Object.assign(Object.assign({},x.webauthn),{credential_options:Object.assign(Object.assign({},x.webauthn.credential_options),{publicKey:z0(x.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}})}async _challengeAndVerify(s){const{data:l,error:r}=await this._challenge({factorId:s.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:s.factorId,challengeId:l.id,code:s.code})}async _listFactors(){var s;const{data:{user:l},error:r}=await this.getUser();if(r)return{data:null,error:r};const d={all:[],phone:[],totp:[],webauthn:[]};for(const u of(s=l?.factors)!==null&&s!==void 0?s:[])d.all.push(u),u.status==="verified"&&d[u.factor_type].push(u);return{data:d,error:null}}async _getAuthenticatorAssuranceLevel(){var s,l;const{data:{session:r},error:d}=await this.getSession();if(d)return this._returnResult({data:null,error:d});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Vc(r.access_token);let m=null;u.aal&&(m=u.aal);let x=m;((l=(s=r.user.factors)===null||s===void 0?void 0:s.filter(b=>b.status==="verified"))!==null&&l!==void 0?l:[]).length>0&&(x="aal2");const f=u.amr||[];return{data:{currentLevel:m,nextLevel:x,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(s){try{return await this._useSession(async l=>{const{data:{session:r},error:d}=l;return d?this._returnResult({data:null,error:d}):r?await Re(this.fetch,"GET",`${this.url}/oauth/authorizations/${s}`,{headers:this.headers,jwt:r.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new aa})})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async _approveAuthorization(s,l){try{return await this._useSession(async r=>{const{data:{session:d},error:u}=r;if(u)return this._returnResult({data:null,error:u});if(!d)return this._returnResult({data:null,error:new aa});const m=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${s}/consent`,{headers:this.headers,jwt:d.access_token,body:{action:"approve"},xform:x=>({data:x,error:null})});return m.data&&m.data.redirect_url&&Mt()&&!l?.skipBrowserRedirect&&window.location.assign(m.data.redirect_url),m})}catch(r){if(Ee(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(s,l){try{return await this._useSession(async r=>{const{data:{session:d},error:u}=r;if(u)return this._returnResult({data:null,error:u});if(!d)return this._returnResult({data:null,error:new aa});const m=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${s}/consent`,{headers:this.headers,jwt:d.access_token,body:{action:"deny"},xform:x=>({data:x,error:null})});return m.data&&m.data.redirect_url&&Mt()&&!l?.skipBrowserRedirect&&window.location.assign(m.data.redirect_url),m})}catch(r){if(Ee(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async s=>{const{data:{session:l},error:r}=s;return r?this._returnResult({data:null,error:r}):l?await Re(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,xform:d=>({data:d,error:null})}):this._returnResult({data:null,error:new aa})})}catch(s){if(Ee(s))return this._returnResult({data:null,error:s});throw s}}async _revokeOAuthGrant(s){try{return await this._useSession(async l=>{const{data:{session:r},error:d}=l;return d?this._returnResult({data:null,error:d}):r?await Re(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:s.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new aa})})}catch(l){if(Ee(l))return this._returnResult({data:null,error:l});throw l}}async fetchJwk(s,l={keys:[]}){let r=l.keys.find(x=>x.kid===s);if(r)return r;const d=Date.now();if(r=this.jwks.keys.find(x=>x.kid===s),r&&this.jwks_cached_at+Lv>d)return r;const{data:u,error:m}=await Re(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(m)throw m;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=d,r=u.keys.find(x=>x.kid===s),!r)?null:r}async getClaims(s,l={}){try{let r=s;if(!r){const{data:S,error:N}=await this.getSession();if(N||!S.session)return this._returnResult({data:null,error:N});r=S.session.access_token}const{header:d,payload:u,signature:m,raw:{header:x,payload:g}}=Vc(r);l?.allowExpired||l0(u.exp);const f=!d.alg||d.alg.startsWith("HS")||!d.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(d.kid,l?.keys?{keys:l.keys}:l?.jwks);if(!f){const{error:S}=await this.getUser(r);if(S)throw S;return{data:{claims:u,header:d,signature:m},error:null}}const b=r0(d.alg),p=await crypto.subtle.importKey("jwk",f,b,!0,["verify"]);if(!await crypto.subtle.verify(b,p,m,Yv(`${x}.${g}`)))throw new od("Invalid JWT signature");return{data:{claims:u,header:d,signature:m},error:null}}catch(r){if(Ee(r))return this._returnResult({data:null,error:r});throw r}}}Pn.nextInstanceID={};const $0=Pn;class B0 extends $0{constructor(s){super(s)}}class I0{constructor(s,l,r){var d,u,m;this.supabaseUrl=s,this.supabaseKey=l;const x=Rv(s);if(!l)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",x),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",x),this.storageUrl=new URL("storage/v1",x),this.functionsUrl=new URL("functions/v1",x);const g=`sb-${x.hostname.split(".")[0]}-auth-token`,f={db:Sv,realtime:Ev,auth:Object.assign(Object.assign({},Cv),{storageKey:g}),global:wv},b=Ov(r??{},f);this.storageKey=(d=b.auth.storageKey)!==null&&d!==void 0?d:"",this.headers=(u=b.global.headers)!==null&&u!==void 0?u:{},b.accessToken?(this.accessToken=b.accessToken,this.auth=new Proxy({},{get:(p,_)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(_)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((m=b.auth)!==null&&m!==void 0?m:{},this.headers,b.global.fetch),this.fetch=Av(l,this._getAccessToken.bind(this),b.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},b.realtime)),this.accessToken&&this.accessToken().then(p=>this.realtime.setAuth(p)).catch(p=>console.warn("Failed to set initial Realtime auth token:",p)),this.rest=new kb(new URL("rest/v1",x).href,{headers:this.headers,schema:b.db.schema,fetch:this.fetch}),this.storage=new jv(this.storageUrl.href,this.headers,this.fetch,r?.storage),b.accessToken||this._listenForAuthEvents()}get functions(){return new Ab(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,l={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(s,l,r)}channel(s,l={config:{}}){return this.realtime.channel(s,l)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var s,l;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(l=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&l!==void 0?l:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:l,detectSessionInUrl:r,storage:d,userStorage:u,storageKey:m,flowType:x,lock:g,debug:f,throwOnError:b},p,_){const S={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new B0({url:this.authUrl.href,headers:Object.assign(Object.assign({},S),p),storageKey:m,autoRefreshToken:s,persistSession:l,detectSessionInUrl:r,storage:d,userStorage:u,flowType:x,lock:g,debug:f,throwOnError:b,fetch:_,hasCustomAuthorizationHeader:Object.keys(this.headers).some(N=>N.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new Jb(this.realtimeUrl.href,Object.assign(Object.assign({},s),{params:Object.assign({apikey:this.supabaseKey},s?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((l,r)=>{this._handleTokenChanged(l,"CLIENT",r?.access_token)})}_handleTokenChanged(s,l,r){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):s==="SIGNED_OUT"&&(this.realtime.setAuth(),l=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const q0=(o,s,l)=>new I0(o,s,l);function P0(){if(typeof window<"u"||typeof process>"u")return!1;const o=process.version;if(o==null)return!1;const s=o.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}P0()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const H0="https://lxvizxyvvzfjxyoetuig.supabase.co",G0="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4dml6eHl2dnpmanh5b2V0dWlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NzQwMDQsImV4cCI6MjA3OTE1MDAwNH0.IKkqr7C75kZYLqAO1MfjT7Fu70A2zzAWt8b_-tAm2dY",_t=q0(H0,G0,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},db:{schema:"public"},global:{headers:{"x-client-info":"marrel-gestionale/1.0"}}}),tp=o=>Object.entries(o).reduce((s,[l,r])=>(r!=null&&r!==""&&(s[l]=r),s),{}),qi=o=>(console.error("Supabase error:",o),{success:!1,error:o.message||"An error occurred"}),Pi=async()=>{try{const{data:{user:o}}=await _t.auth.getUser();if(!o)return{success:!1,error:"Utente non autenticato"};const{data:s,error:l}=await _t.from("profiles").select("azienda").eq("id",o.id).single();if(l)throw l;return!s||!s.azienda?{success:!1,error:"Profilo o azienda non trovati"}:{success:!0,azienda:s.azienda}}catch(o){return{success:!1,error:o.message}}},hr={async getAll(o){console.log(` GET ALL ${o} START`);const s=performance.now(),l=await Pi();if(!l.success)return l;const{data:r,error:d}=await _t.from(o).select("*").eq("azienda",l.azienda).order("created_at",{ascending:!1}),u=performance.now()-s;return d?(console.error(` GET ALL ${o} ERROR (${u.toFixed(0)}ms):`,d),qi(d)):(console.log(` GET ALL ${o} SUCCESS (${u.toFixed(0)}ms): ${r?.length||0} records`),{success:!0,data:r})},async getById(o,s){console.log(` GET BY ID ${o} START:`,s);const l=performance.now(),r=await Pi();if(!r.success)return r;const{data:d,error:u}=await _t.from(o).select("*").eq("id",s).eq("azienda",r.azienda).single(),m=performance.now()-l;return u?(console.error(` GET BY ID ${o} ERROR (${m.toFixed(0)}ms):`,u),qi(u)):(console.log(` GET BY ID ${o} SUCCESS (${m.toFixed(0)}ms)`),{success:!0,data:d})},async create(o,s){console.log(` CREATE ${o} START`),console.log(" Original data:",s);const l=performance.now(),r=await Pi();if(!r.success)return r;const d=tp(s);console.log(" Clean data:",d);const{data:u,error:m}=await _t.from(o).insert([{...d,azienda:r.azienda}]).select().single(),x=performance.now()-l;return m?(console.error(` CREATE ${o} ERROR (${x.toFixed(0)}ms):`,m),qi(m)):(console.log(` CREATE ${o} SUCCESS (${x.toFixed(0)}ms)`),{success:!0,data:u})},async update(o,s,l){console.log(` UPDATE ${o} START:`,s),console.log(" Original updates:",l);const r=performance.now(),d=await Pi();if(!d.success)return d;const u=tp(l);console.log(" Clean updates:",u);const{data:m,error:x}=await _t.from(o).update(u).eq("id",s).eq("azienda",d.azienda).select().single(),g=performance.now()-r;return x?(console.error(` UPDATE ${o} ERROR (${g.toFixed(0)}ms):`,x),qi(x)):(console.log(` UPDATE ${o} SUCCESS (${g.toFixed(0)}ms)`),{success:!0,data:m})},async delete(o,s){console.log(` DELETE ${o} START:`,s);const l=performance.now(),r=await Pi();if(!r.success)return r;const{error:d}=await _t.from(o).delete().eq("id",s).eq("azienda",r.azienda),u=performance.now()-l;return d?(console.error(` DELETE ${o} ERROR (${u.toFixed(0)}ms):`,d),qi(d)):(console.log(` DELETE ${o} SUCCESS (${u.toFixed(0)}ms)`),{success:!0})},async getFiltered(o,s,l){console.log(` GET FILTERED ${o} START: ${s}=${l}`);const r=performance.now(),d=await Pi();if(!d.success)return d;const{data:u,error:m}=await _t.from(o).select("*").eq("azienda",d.azienda).eq(s,l),x=performance.now()-r;return m?(console.error(` GET FILTERED ${o} ERROR (${x.toFixed(0)}ms):`,m),qi(m)):(console.log(` GET FILTERED ${o} SUCCESS (${x.toFixed(0)}ms): ${u?.length||0} records`),{success:!0,data:u})},async getWithFilters(o,s={}){console.log(` GET WITH FILTERS ${o} START:`,s);const l=performance.now(),r=await Pi();if(!r.success)return r;let d=_t.from(o).select("*").eq("azienda",r.azienda);Object.entries(s).forEach(([g,f])=>{f!=null&&f!==""&&(d=d.eq(g,f))});const{data:u,error:m}=await d,x=performance.now()-l;return m?(console.error(` GET WITH FILTERS ${o} ERROR (${x.toFixed(0)}ms):`,m),qi(m)):(console.log(` GET WITH FILTERS ${o} SUCCESS (${x.toFixed(0)}ms): ${u?.length||0} records`),{success:!0,data:u})}},Kp=F.createContext(),wt=()=>{const o=F.useContext(Kp);if(!o)throw new Error("useData must be used within DataProvider");return o},V0=({children:o})=>{const[s,l]=F.useState({lavoratori:[],cantieri:[],fornitori:[],subappaltatori:[],veicoli:[],unilav:[],presenze:[],notePresenze:[],certificazioni:[],sal:[],fattureEmesse:[],acconti:[],rateizzi:[],noteRateizzi:[],rate:[],movimentiContabili:[],settings:[],storicoPaghe:[],dttFormulari:[],cassaEdileLavoratori:[],cassaEdileTotali:[],ordiniFornitori:[],documenti:[]}),[r,d]=F.useState({lavoratori:!0,cantieri:!0,fornitori:!0,subappaltatori:!0,veicoli:!0,unilav:!0,presenze:!0,notePresenze:!0,certificazioni:!0,sal:!0,fattureEmesse:!0,acconti:!0,rateizzi:!0,noteRateizzi:!0,rate:!0,movimentiContabili:!0,settings:!0,storicoPaghe:!0,dttFormulari:!0,cassaEdileLavoratori:!0,cassaEdileTotali:!0,ordiniFornitori:!0,documenti:!0,critical:!0,secondary:!0}),[u,m]=F.useState({}),x={queries:[],logQuery:(H,U)=>{x.queries.push({table:H,duration:U,time:new Date}),U>500&&console.warn(` Slow query on ${H}: ${U}ms`)},getSlowestQueries:()=>x.queries.sort((H,U)=>U.duration-H.duration).slice(0,10)},g={lavoratori:"lavoratori",cantieri:"cantieri",fornitori:"fornitori",subappaltatori:"subappaltatori",veicoli:"veicoli",unilav:"unilav",presenze:"presenze",notePresenze:"note_presenze",certificazioni:"certificazioni",sal:"sal",fattureEmesse:"fatture_emesse",acconti:"acconti",rateizzi:"rateizzi",noteRateizzi:"note_rateizzi",rate:"rate",movimentiContabili:"movimenti_contabili",settings:"settings",storicoPaghe:"storico_paghe",dttFormulari:"dtt_formulari",cassaEdileLavoratori:"cassa_edile_lavoratori",cassaEdileTotali:"cassa_edile_totali",ordiniFornitori:"ordini_fornitori",documenti:"documenti"},f=["lavoratori","cantieri","fornitori"],b=Object.keys(g).filter(H=>!f.includes(H)),p=async H=>{const U=g[H],D=performance.now();d(R=>({...R,[H]:!0})),m(R=>({...R,[H]:null}));try{const R=await hr.getAll(U),E=performance.now()-D;x.logQuery(U,E),R.success?(console.log(` Loaded ${U}: ${R.data?.length||0} records (${E.toFixed(0)}ms)`),l(V=>({...V,[H]:R.data||[]}))):(console.error(` Failed to load ${U}:`,R.error),m(V=>({...V,[H]:R.error})),l(V=>({...V,[H]:[]})))}catch(R){const E=performance.now()-D;console.error(` Exception loading ${U} (${E.toFixed(0)}ms):`,R),m(V=>({...V,[H]:R.message})),l(V=>({...V,[H]:[]}))}d(R=>({...R,[H]:!1}))},_=async()=>{console.log(" Starting data load (prioritized)");const H=performance.now();console.log(" Loading critical data...");const U=f.map(D=>p(D));await Promise.allSettled(U),d(D=>({...D,critical:!1})),console.log(` Critical data loaded (${(performance.now()-H).toFixed(0)}ms)`),setTimeout(async()=>{console.log(" Loading secondary data...");const D=b.map(V=>p(V));await Promise.allSettled(D),d(V=>({...V,secondary:!1}));const R=performance.now()-H;console.log(` All data loaded (${R.toFixed(0)}ms)`);const E=x.getSlowestQueries();E.length>0&&console.log(" Slowest queries:",E)},300)};F.useEffect(()=>{_()},[]);const S=async(H,U)=>{const D=g[H],R=performance.now();if(!D)return console.error(` Table mapping not found for key: ${H}`),{success:!1,error:`Tabella non trovata per chiave: ${H}`};console.log(` Adding record to ${D}`);const E=await hr.create(D,U),V=performance.now()-R;return x.logQuery(`${D} INSERT`,V),console.log(` Record added to ${D} (${V.toFixed(0)}ms)`),E.success?(l(w=>({...w,[H]:[E.data,...w[H]]})),{success:!0,data:E.data}):E},N=async(H,U,D)=>{const R=g[H],E=performance.now();if(!R)return console.error(` Table mapping not found for key: ${H}`),{success:!1,error:`Tabella non trovata per chiave: ${H}`};console.log(` Updating record in ${R}:`,U);const V=await hr.update(R,U,D),w=performance.now()-E;return x.logQuery(`${R} UPDATE`,w),console.log(` Record updated in ${R} (${w.toFixed(0)}ms)`),V.success?(l(A=>({...A,[H]:A[H].map(I=>I.id===U?V.data:I)})),{success:!0,data:V.data}):V},be={...s,loading:r,errors:u,fetchTable:p,fetchAllData:_,addRecord:S,updateRecord:N,deleteRecord:async(H,U)=>{const D=g[H],R=performance.now();if(!D)return console.error(` Table mapping not found for key: ${H}`),{success:!1,error:`Tabella non trovata per chiave: ${H}`};console.log(` Deleting record from ${D}:`,U);const E=await hr.delete(D,U),V=performance.now()-R;return x.logQuery(`${D} DELETE`,V),console.log(` Record deleted from ${D} (${V.toFixed(0)}ms)`),E.success?(l(w=>({...w,[H]:w[H].filter(A=>A.id!==U)})),{success:!0}):E},getLavoratoreById:H=>s.lavoratori.find(U=>U.id===H),getCantiereById:H=>s.cantieri.find(U=>U.id===H),getFornitoreById:H=>s.fornitori.find(U=>U.id===H),getCantieriAttivi:()=>s.cantieri.filter(H=>H.attivo!==!1&&H.stato!=="completato"&&H.stato!=="annullato"),getLavoratoriAttivi:()=>s.lavoratori.filter(H=>H.attivo!==!1),getFornitoriAttivi:()=>s.fornitori.filter(H=>H.attivo!==!1),getPresenzeByLavoratore:H=>s.presenze.filter(U=>U.lavoratore_id===H),getUnilavByLavoratore:H=>s.unilav.filter(U=>U.lavoratore_id===H),getCertificazioniByLavoratore:H=>s.certificazioni.filter(U=>U.lavoratore_id===H),getSalByCantiere:H=>s.sal.filter(U=>U.cantiere_id===H),getNotaPresenza:(H,U,D)=>s.notePresenze.find(R=>R.lavoratore_id===H&&R.anno===U&&R.mese===D),getSetting:(H,U=null)=>{const D=s.settings.find(R=>R.chiave===H);return D?D.valore:U},setSetting:async(H,U)=>{const D=s.settings.find(R=>R.chiave===H);return D?await N("settings",D.id,{valore:U.toString()}):await S("settings",{chiave:H,valore:U.toString()})},getPerformanceStats:()=>{const H=x.queries,U=H.reduce((R,E)=>R+E.duration,0)/H.length,D=x.getSlowestQueries();return{totalQueries:H.length,averageDuration:U.toFixed(0),slowestQueries:D.map(R=>({table:R.table,duration:`${R.duration.toFixed(0)}ms`}))}}};return a.jsx(Kp.Provider,{value:be,children:o})},Xp=F.createContext(),yr=()=>{const o=F.useContext(Xp);if(!o)throw new Error("useAuth must be used within AuthProvider");return o},Y0=({children:o})=>{const[s,l]=F.useState(null),[r,d]=F.useState(null),[u,m]=F.useState(!0);F.useEffect(()=>{console.log(" AuthProvider: Starting initialization"),(async()=>{try{const j=new URLSearchParams(window.location.hash.substring(1));(window.location.hash.includes("access_token")||window.location.hash.includes("reset-password"))&&(console.log(" Redirect detected, waiting for session..."),await new Promise(k=>setTimeout(k,500)));const{data:{session:y},error:M}=await _t.auth.getSession();console.log(" Session:",y?.user?.email||"none"),M&&console.error(" Session error:",M),y?.user&&(console.log(" User found"),l(y.user),await x(y.user.id))}catch(j){console.error(" Auth error:",j)}finally{m(!1)}})();const z=setInterval(async()=>{const{data:{user:j}}=await _t.auth.getUser();if(j){console.log(" Auto-refreshing session...");const{data:{session:q},error:y}=await _t.auth.refreshSession();y?(console.error(" Failed to refresh session:",y),console.log(" Session expired, logging out..."),await b()):q&&(console.log(" Session refreshed successfully"),l(q.user))}},3e3*1e3),{data:{subscription:L}}=_t.auth.onAuthStateChange(async(j,q)=>{console.log(" Auth event:",j,"Session:",q?.user?.email||"none"),j==="PASSWORD_RECOVERY"&&console.log(" Password recovery detected!"),j==="TOKEN_REFRESHED"&&console.log(" Token refreshed automatically"),j==="SIGNED_OUT"&&(console.log(" User signed out"),clearInterval(z)),l(q?.user??null),q?.user?await x(q.user.id):d(null)});return()=>{L.unsubscribe(),clearInterval(z)}},[]);const x=async T=>{try{console.log(" Fetching profile for user:",T);const{data:z,error:L}=await _t.from("profiles").select("*").eq("id",T).single();if(console.log(" Profile data:",z),L){console.error(" Profile error:",L),m(!1);return}d(z)}catch(z){console.error("Exception fetching profile:",z)}finally{console.log(" Setting loading to false"),m(!1)}},g=async(T,z)=>{try{const{data:L,error:j}=await _t.auth.signInWithPassword({email:T,password:z});if(j)throw j;return{success:!0,data:L}}catch(L){return console.error("Error signing in:",L),{success:!1,error:L.message}}},f=async(T,z,L,j,q,y="operativo")=>{try{const{data:M,error:k}=await _t.auth.signUp({email:T,password:z,options:{data:{azienda:L,nome:j,cognome:q,ruolo:y}}});if(k)throw k;return{success:!0,data:M}}catch(M){return console.error("Error signing up:",M),{success:!1,error:M.message}}},b=async()=>{try{const{error:T}=await _t.auth.signOut();if(T)throw T;return l(null),d(null),{success:!0}}catch(T){return console.error("Error signing out:",T),{success:!1,error:T.message}}},p=async T=>{try{const{error:z}=await _t.auth.resetPasswordForEmail(T,{redirectTo:"http://192.168.1.5/#/reset-password"});if(z)throw z;return{success:!0}}catch(z){return console.error("Error resetting password:",z),{success:!1,error:z.message}}},_=async T=>{try{const{data:z,error:L}=await _t.auth.updateUser({password:T});if(L)throw L;return{success:!0,data:z}}catch(z){return console.error("Error updating password:",z),{success:!1,error:z.message}}},S=async()=>{try{const{data:{session:T},error:z}=await _t.auth.getSession();return z||!T?(console.log(" Session invalid or expired"),!1):(console.log(" Session is valid"),!0)}catch(T){return console.error("Error checking session:",T),!1}},N=T=>r?r.ruolo==="admin"?!0:!["storicoPaghe","fattureEmesse","contabilita"].includes(T):!1;console.log(" Current state - Loading:",u,"User:",s?.email||null,"Profile:",r?.ruolo||null);const O={user:s,profile:r,loading:u,signIn:g,signUp:f,signOut:b,resetPassword:p,updatePassword:_,checkSession:S,hasAccess:N,isAdmin:r?.ruolo==="admin",isManager:r?.ruolo==="manager",isOperativo:r?.ruolo==="operativo"};return a.jsx(Xp.Provider,{value:O,children:o})};function Q0(){const{signIn:o,signUp:s,resetPassword:l}=yr(),[r,d]=F.useState("login"),[u,m]=F.useState({email:"",password:"",confirmPassword:"",nome:"",cognome:"",azienda:"",ruolo:"operativo"}),[x,g]=F.useState(""),[f,b]=F.useState(""),[p,_]=F.useState(!1),S=async N=>{N.preventDefault(),g(""),b(""),_(!0);try{if(r==="login"){const O=await o(u.email,u.password);O.success||g(O.error||"Errore durante il login")}else if(r==="signup"){if(u.password!==u.confirmPassword){g("Le password non coincidono"),_(!1);return}if(!u.azienda){g("Il nome azienda  obbligatorio"),_(!1);return}const O=await s(u.email,u.password,u.azienda,u.nome,u.cognome,u.ruolo);O.success?(b("Registrazione completata! Puoi effettuare il login."),d("login"),m({...u,password:"",confirmPassword:""})):g(O.error||"Errore durante la registrazione")}else if(r==="reset"){const O=await l(u.email);O.success?b("Email di reset inviata! Controlla la tua casella di posta."):g(O.error||"Errore durante il reset password")}}catch{g("Si  verificato un errore imprevisto")}finally{_(!1)}};return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Gestionale MARREL"}),a.jsxs("p",{className:"text-gray-600",children:[r==="login"&&"Accedi al tuo account",r==="signup"&&"Crea un nuovo account",r==="reset"&&"Recupera password"]})]}),x&&a.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:x}),f&&a.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:f}),a.jsxs("form",{onSubmit:S,className:"space-y-4",children:[r==="signup"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Azienda *"}),a.jsx("input",{type:"text",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.azienda,onChange:N=>m({...u,azienda:N.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.nome,onChange:N=>m({...u,nome:N.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cognome"}),a.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.cognome,onChange:N=>m({...u,cognome:N.target.value})})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ruolo *"}),a.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.ruolo,onChange:N=>m({...u,ruolo:N.target.value}),children:[a.jsx("option",{value:"operativo",children:"Operativo"}),a.jsx("option",{value:"manager",children:"Manager"}),a.jsx("option",{value:"admin",children:"Admin"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),a.jsx("input",{type:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.email,onChange:N=>m({...u,email:N.target.value})})]}),r!=="reset"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),a.jsx("input",{type:"password",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.password,onChange:N=>m({...u,password:N.target.value})})]}),r==="signup"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conferma Password *"}),a.jsx("input",{type:"password",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u.confirmPassword,onChange:N=>m({...u,confirmPassword:N.target.value})})]})]}),a.jsx("button",{type:"submit",disabled:p,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:p?"Caricamento...":r==="login"?"Accedi":r==="signup"?"Registrati":"Invia email di reset"})]}),a.jsxs("div",{className:"mt-6 text-center space-y-2",children:[r==="login"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>d("signup"),className:"text-blue-600 hover:underline text-sm block w-full",children:"Non hai un account? Registrati"}),a.jsx("button",{onClick:()=>d("reset"),className:"text-blue-600 hover:underline text-sm block w-full",children:"Password dimenticata?"})]}),(r==="signup"||r==="reset")&&a.jsx("button",{onClick:()=>{d("login"),g(""),b("")},className:"text-blue-600 hover:underline text-sm block w-full",children:"Torna al login"})]})]})})}function K0({esportaDati:o,importaDati:s}){const{profile:l,signOut:r}=yr(),d=async()=>{confirm("Sei sicuro di voler uscire?")&&await r()};return a.jsx("header",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:" Gestionale Marrel S.r.l."}),a.jsx("p",{className:"text-blue-100 text-sm",children:"v. 3.8"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[l&&a.jsxs("div",{className:"text-right bg-blue-700 px-4 py-2 rounded-lg",children:[a.jsxs("p",{className:"text-sm font-medium",children:[l.nome," ",l.cognome]}),a.jsxs("p",{className:"text-xs text-blue-200",children:[l.azienda,"  ",l.ruolo==="admin"?" Admin":l.ruolo==="manager"?" Manager":" Operativo"]})]}),a.jsxs("button",{onClick:d,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:[a.jsx("span",{children:""}),a.jsx("span",{className:"font-medium",children:"Esci"})]})]})]})})})}function X0({activeTab:o,setActiveTab:s,openDropdown:l,setOpenDropdown:r}){const{profile:d}=yr(),[u,m]=F.useState({}),x=F.useRef({}),f=[{id:"dashboard",label:"Dashboard",icon:"",type:"single"},{id:"anagrafiche",label:"Anagrafiche",icon:"",type:"group",subtabs:[{id:"lavoratori",label:"Lavoratori",icon:""},{id:"automezzi",label:"Automezzi",icon:""},{id:"subappaltatori",label:"Subappaltatori",icon:""},{id:"cantieri",label:"Cantieri",icon:""},{id:"fornitori",label:"Fornitori",icon:""}]},{id:"amministrazione",label:"Amministrazione",icon:"",type:"group",subtabs:(b=>{if(!d||d.ruolo==="admin")return b;const p=["fatture-emesse","storico-paghe","contabilita"];return b.filter(_=>!p.includes(_.id))})([{id:"unilav",label:"Unilav",icon:""},{id:"presenze",label:"Presenze",icon:""},{id:"casse",label:"Cassa Edile",icon:""},{id:"acconti",label:"Acconti",icon:""},{id:"fatture-emesse",label:"Fatture Emesse",icon:""},{id:"storico-paghe",label:"Storico Paghe",icon:""},{id:"dtt-formulari",label:"DTT/Formulari",icon:""},{id:"situazione-fornitori",label:"Situazione Fornitori",icon:""},{id:"rateizzi",label:"Rateizzi",icon:""},{id:"sal",label:"SAL",icon:""},{id:"contabilita",label:"Contabilit",icon:""}])},{id:"corsi",label:"Corsi/Visite",icon:"",type:"single"},{id:"certificazioni",label:"Certificazioni",icon:"",type:"single"},{id:"scadenzario",label:"Scadenzario",icon:"",type:"single"}];return F.useEffect(()=>{if(l&&x.current[l]){const b=x.current[l].getBoundingClientRect();m({position:"fixed",top:`${b.bottom}px`,left:`${b.left}px`,minWidth:`${b.width}px`})}},[l]),a.jsxs(a.Fragment,{children:[a.jsx("nav",{className:"bg-white shadow-md sticky top-0 z-50",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4",children:a.jsx("div",{className:"flex overflow-x-auto",children:f.map(b=>{if(b.type==="single")return a.jsxs("button",{onClick:()=>{s(b.id),r(null)},className:`px-4 py-3 border-b-2 whitespace-nowrap flex-shrink-0 transition-colors ${o===b.id?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-600 hover:text-blue-600"}`,children:[b.icon," ",b.label]},b.id);{const p=b.subtabs.some(S=>S.id===o),_=l===b.id;return a.jsx("div",{className:"relative flex-shrink-0",children:a.jsxs("button",{ref:S=>x.current[b.id]=S,onClick:()=>r(_?null:b.id),className:`px-4 py-3 border-b-2 whitespace-nowrap flex items-center gap-1 transition-colors ${p?"border-blue-600 text-blue-600 font-medium":"border-transparent text-gray-600 hover:text-blue-600"}`,children:[b.icon," ",b.label,a.jsx("span",{className:"text-xs",children:_?"":""})]})},b.id)}})})})}),l&&a.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(null)}),l&&a.jsx("div",{className:"bg-white shadow-xl border border-gray-200 rounded-b-lg overflow-hidden z-50",style:u,children:f.find(b=>b.id===l)?.subtabs.map((b,p,_)=>a.jsxs("button",{onClick:()=>{s(b.id),r(null)},className:`w-full text-left px-4 py-3 hover:bg-blue-50 flex items-center gap-2 transition-colors ${o===b.id?"bg-blue-100 text-blue-600 font-medium":"text-gray-700"} ${p===_.length-1?"rounded-b-lg":""}`,children:[a.jsx("span",{className:"text-lg",children:b.icon}),a.jsx("span",{children:b.label})]},b.id))})]})}function J0(){return a.jsx("footer",{className:"bg-gray-800 text-white py-4 mt-8",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 text-center text-sm",children:[a.jsx("p",{children:"Gestionale Marrel S.r.l. - by Andrii Prydryk"}),a.jsxs("p",{className:"text-gray-400 text-xs mt-1",children:[" ",new Date().getFullYear()," - Tutti i diritti riservati"]})]})})}const Ka=o=>{if(!o)return"-";const s=new Date(o);return isNaN(s.getTime())?o:s.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},Z0=o=>{const s=new Date(o),l=s.getDate(),r=s.getMonth()+1,d=s.getFullYear();if([{m:1,d:1},{m:1,d:6},{m:4,d:25},{m:5,d:1},{m:6,d:2},{m:8,d:15},{m:11,d:1},{m:12,d:8},{m:12,d:25},{m:12,d:26}].some(M=>M.m===r&&M.d===l))return!0;const m=d%19,x=Math.floor(d/100),g=d%100,f=Math.floor(x/4),b=x%4,p=Math.floor((x+8)/25),_=Math.floor((x-p+1)/3),S=(19*m+x-f-_+15)%30,N=Math.floor(g/4),O=g%4,T=(32+2*b+2*N-S-O)%7,z=Math.floor((m+11*S+22*T)/451),L=Math.floor((S+T-7*z+114)/31),j=(S+T-7*z+114)%31+1;if(r===L&&l===j)return!0;const q=new Date(d,L-1,j),y=new Date(q);return y.setDate(q.getDate()+1),r===y.getMonth()+1&&l===y.getDate()};function W0(){const{lavoratori:o,unilav:s,cantieri:l,veicoli:r,certificazioni:d,documenti:u,rateizzi:m,rate:x,loading:g}=wt(),f=F.useMemo(()=>o.filter(N=>N.ruolo==="amministratore"||N.ruolo==="direttore_tecnico"?!1:s.some(T=>T.lavoratore_id===N.id)),[o,s]),b=N=>{const O=new Date,T=[];return d.forEach(z=>{if(z.data_scadenza){const L=o.find(y=>y.id===z.lavoratore_id);if(!L)return;const j=new Date(z.data_scadenza),q=Math.ceil((j-O)/(1e3*60*60*24));q<=30&&q>=0&&T.push({tipo:z.tipo,descrizione:`${z.tipo==="corso"?"Corso":"Visita"}: ${z.nome}`,lavoratore:`${L.nome} ${L.cognome}`,scadenza:z.data_scadenza,giorniMancanti:q})}}),r.forEach(z=>{["assicurazione","revisione"].forEach(L=>{const j=L==="assicurazione"?"scadenza_assicurazione":"scadenza_revisione";if(z[j]){const q=new Date(z[j]),y=Math.ceil((q-O)/(1e3*60*60*24));y<=30&&y>=0&&T.push({tipo:L,descrizione:`${L.charAt(0).toUpperCase()+L.slice(1)} ${z.targa}`,lavoratore:z.modello,scadenza:z[j],giorniMancanti:y})}})}),l.forEach(z=>{if(z.stato!=="completato"&&z.scadenza_dnlt){const L=new Date(z.scadenza_dnlt),j=Math.ceil((L-O)/(1e3*60*60*24));j<=30&&j>=0&&T.push({tipo:"dnlt",descrizione:"Scadenza DNLT",lavoratore:z.nome,scadenza:z.scadenza_dnlt,giorniMancanti:j})}}),N.forEach(z=>{const L=s.filter(j=>j.lavoratore_id===z.id);if(L.length>0){const j=L.sort((q,y)=>{const M=new Date(q.data_inizio||"1900-01-01");return new Date(y.data_inizio||"1900-01-01")-M})[0];if(j.tipo_contratto==="determinato"&&j.data_fine){const q=new Date(j.data_fine),y=Math.ceil((q-O)/(1e3*60*60*24));if(y<=30&&y>=0){const M=l.find(k=>k.id===j.cantiere_id);T.push({tipo:"contratto",descrizione:"Scadenza Contratto",lavoratore:`${z.nome} ${z.cognome} - ${M?M.nome:"N/A"}`,scadenza:j.data_fine,giorniMancanti:y})}}}}),u.forEach(z=>{if(z.data_scadenza){const L=new Date(z.data_scadenza),j=Math.ceil((L-O)/(1e3*60*60*24));if(j<=30&&j>=0){const q=l.find(y=>y.id===z.riferimento_id);T.push({tipo:"documento",descrizione:`${z.tipo}: ${z.nome}`,lavoratore:q?q.nome:"N/A",scadenza:z.data_scadenza,giorniMancanti:j})}}}),x.forEach(z=>{if(z.data_scadenza&&z.stato!=="pagato"){const L=new Date(z.data_scadenza),j=Math.ceil((L-O)/(1e3*60*60*24));if(j<=30&&j>=0){const q=m.find(y=>y.id===z.rateizzazione_id);T.push({tipo:"rata",descrizione:q?`${q.nome} - Rata ${z.numero_rata}/${q.numero_rate||"?"}`:`Rata ${z.numero_rata}`,lavoratore:`Importo:  ${parseFloat(z.importo||0).toLocaleString("it-IT",{minimumFractionDigits:2,maximumFractionDigits:2})}`,scadenza:z.data_scadenza,giorniMancanti:j})}}}),T.sort((z,L)=>z.giorniMancanti-L.giorniMancanti)},p=F.useMemo(()=>b(f),[o,s,l,r,d,u,m,x,f]),_=F.useMemo(()=>{const N={};return f.forEach(O=>{const T=s.filter(z=>z.lavoratore_id===O.id);if(T.length>0){const z=T.sort((j,q)=>{const y=new Date(j.data_inizio||"1900-01-01");return new Date(q.data_inizio||"1900-01-01")-y})[0],L=z.cantiere_id;N[L]||(N[L]=[]),N[L].push({...O,livello:z.livello,qualifica:z.qualifica,data_inizio:z.data_inizio})}}),N},[f,s]),S=()=>{const O=new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});let T=0;Object.values(_).forEach(j=>{T+=j.length});let z=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lavoratori per Cantiere</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; font-size: 11px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; }
    h2 { color: #2563eb; margin-top: 25px; margin-bottom: 10px; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #3b82f6; color: white; font-weight: bold; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .summary { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    .cantiere-box { margin-bottom: 30px; page-break-inside: avoid; }
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      button { display: none !important; }
      .cantiere-box { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <button onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">
     Stampa / Salva PDF
  </button>
  
  <h1> Lavoratori per Cantiere</h1>
  <p><strong>Data Stampa:</strong> ${O}</p>
  
  <div class="summary">
    <p><strong>Cantieri Attivi:</strong> ${Object.keys(_).length}</p>
    <p><strong>Lavoratori Totali:</strong> ${T}</p>
  </div>
`;Object.entries(_).forEach(([j,q])=>{const y=l.find(te=>te.id===j),M=y?y.nome:`Cantiere ${j}`,k=y?`${y.indirizzo||""} ${y.citta||""}`.trim():"";z+=`
  <div class="cantiere-box">
    <h2> ${M}</h2>
    ${k?`<p style="margin-top: -10px; color: #666;"><em>${k}</em></p>`:""}
    <p><strong>Numero Lavoratori:</strong> ${q.length}</p>
    
    <table>
      <thead>
        <tr>
          <th>Nome Completo</th>
          <th>Qualifica</th>
          <th>Livello</th>
          <th>Data Inizio</th>
        </tr>
      </thead>
      <tbody>
        ${q.map(te=>`
        <tr>
          <td><strong>${te.nome} ${te.cognome}</strong></td>
          <td>${te.qualifica||"-"}</td>
          <td>${te.livello||"-"}</td>
          <td>${Ka(te.data_inizio)}</td>
        </tr>
        `).join("")}
      </tbody>
    </table>
  </div>
`}),z+=`
  <div style="margin-top: 30px; padding: 10px; background: #eff6ff; border-top: 2px solid #1e40af; font-size: 9px;">
    <p>Documento generato automaticamente da Marrel S.r.l. - ${O}</p>
  </div>
</body>
</html>`;const L=window.open("","_blank");L?(L.document.write(z),L.document.close()):alert(" Popup bloccato! Abilita i popup per questo sito.")};return g.lavoratori||g.cantieri||g.unilav?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento dashboard..."})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Lavoratori"}),a.jsx("p",{className:"text-3xl font-bold text-blue-900",children:f.length})]}),a.jsx("span",{className:"text-4xl",children:""})]})}),a.jsx("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Cantieri"}),a.jsx("p",{className:"text-3xl font-bold text-green-900",children:l.length})]}),a.jsx("span",{className:"text-4xl",children:""})]})}),a.jsx("div",{className:"bg-orange-50 p-6 rounded-lg border border-orange-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Veicoli"}),a.jsx("p",{className:"text-3xl font-bold text-orange-900",children:r.length})]}),a.jsx("span",{className:"text-4xl",children:""})]})}),a.jsx("div",{className:"bg-red-50 p-6 rounded-lg border border-red-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Scadenze"}),a.jsx("p",{className:"text-3xl font-bold text-red-900",children:p.length})]}),a.jsx("span",{className:"text-4xl",children:""})]})})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:" Scadenze Imminenti (30 giorni)"}),p.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessuna scadenza imminente"})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Tipo"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Descrizione"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Riferimento"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Scadenza"}),a.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium",children:"Giorni"})]})}),a.jsx("tbody",{children:p.map((N,O)=>a.jsxs("tr",{className:N.giorniMancanti<=7?"bg-red-50":"bg-yellow-50",children:[a.jsx("td",{className:"px-4 py-2 text-sm",children:a.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100",children:N.tipo})}),a.jsx("td",{className:"px-4 py-2 text-sm",children:N.descrizione}),a.jsx("td",{className:"px-4 py-2 text-sm",children:N.lavoratore}),a.jsx("td",{className:"px-4 py-2 text-sm",children:Ka(N.scadenza)}),a.jsx("td",{className:"px-4 py-2 text-sm",children:a.jsxs("span",{className:`font-semibold ${N.giorniMancanti<=7?"text-red-600":"text-yellow-600"}`,children:[N.giorniMancanti,"g"]})})]},O))})]})})]}),a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:" Lavoratori per Cantiere"}),Object.keys(_).length>0&&a.jsx("button",{onClick:S,className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 text-sm",children:" Esporta PDF"})]}),Object.keys(_).length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun lavoratore assegnato"})]}):a.jsx("div",{className:"space-y-4",children:Object.entries(_).map(([N,O])=>{const T=l.find(z=>z.id===N);return a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-600 text-lg",children:T?T.nome:`Cantiere ${N}`}),T?.indirizzo&&a.jsxs("p",{className:"text-sm text-gray-600",children:[T.indirizzo," ",T.citta]})]}),a.jsxs("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold",children:[O.length," ",O.length===1?"lavoratore":"lavoratori"]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:O.map(z=>a.jsxs("div",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[a.jsxs("p",{className:"font-semibold text-blue-900",children:[z.nome," ",z.cognome]}),a.jsxs("div",{className:"text-xs text-gray-600 mt-1 space-y-0.5",children:[z.qualifica&&a.jsxs("p",{children:[" ",z.qualifica]}),z.livello&&a.jsxs("p",{children:[" Livello: ",z.livello]}),z.data_inizio&&a.jsxs("p",{children:[" Dal: ",Ka(z.data_inizio)]})]})]},z.id))})]},N)})})]})]})}const Lt=o=>{const s=o.replace(/\s/g,"").toUpperCase();if(s.length<15||s.length>34||!/^[A-Z]{2}[0-9]{2}[A-Z0-9]+$/.test(s))return!1;let d=(s.slice(4)+s.slice(0,4)).split("").map(u=>{const m=u.charCodeAt(0);return m>=65&&m<=90?m-55:u}).join("");for(;d.length>2;){const u=d.slice(0,9);d=parseInt(u,10)%97+d.slice(u.length)}return parseInt(d,10)%97===1};function ey(){const{lavoratori:o,loading:s,addRecord:l,updateRecord:r,deleteRecord:d}=wt(),[u,m]=F.useState(""),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1);if(s.lavoratori)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento lavoratori..."})]})});const O=o.filter(j=>j.nome?.toLowerCase().includes(u.toLowerCase())||j.cognome?.toLowerCase().includes(u.toLowerCase())||j.codice_fiscale?.toLowerCase().includes(u.toLowerCase())),T=async()=>{if(!p.nome||!p.cognome){alert(" Nome e Cognome sono obbligatori!");return}N(!0);const j={nome:p.nome,cognome:p.cognome,codice_fiscale:p.codice_fiscale||p.codiceFiscale,indirizzo:p.indirizzo,telefono:p.telefono,email:p.email,iban_primario:p.iban_primario||p.ibanPrimario,iban_secondario:p.iban_secondario||p.ibanSecondario,ruolo:p.ruolo||"operaio"};let q;f?q=await r("lavoratori",f,j):q=await l("lavoratori",j),N(!1),q.success?(g(!1),_({}),b(null),alert(f?" Lavoratore aggiornato!":" Lavoratore aggiunto!")):alert(" Errore: "+q.error)},z=async j=>{if(!confirm(` Eliminare il lavoratore ${j.nome} ${j.cognome}?

Questa azione  irreversibile!`))return;const q=await d("lavoratori",j.id);q.success?alert(" Lavoratore eliminato!"):alert(" Errore: "+q.error)},L=j=>{_({nome:j.nome,cognome:j.cognome,codice_fiscale:j.codice_fiscale,codiceFiscale:j.codice_fiscale,indirizzo:j.indirizzo,telefono:j.telefono,email:j.email,iban_primario:j.iban_primario,ibanPrimario:j.iban_primario,iban_secondario:j.iban_secondario,ibanSecondario:j.iban_secondario,ruolo:j.ruolo}),b(j.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("input",{type:"text",placeholder:" Cerca...",className:"border rounded px-3 py-2 w-64",value:u,onChange:j=>m(j.target.value)}),a.jsx("button",{onClick:()=>{g(!0),b(null),_({})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo"})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuovo"," Lavoratore"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome *",className:"border rounded px-3 py-2",value:p.nome||"",onChange:j=>_({...p,nome:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Cognome *",className:"border rounded px-3 py-2",value:p.cognome||"",onChange:j=>_({...p,cognome:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Codice Fiscale",className:"border rounded px-3 py-2",value:p.codiceFiscale||p.codice_fiscale||"",onChange:j=>_({...p,codiceFiscale:j.target.value,codice_fiscale:j.target.value}),disabled:S}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"IBAN Primario",className:`border rounded px-3 py-2 w-full ${(p.ibanPrimario||p.iban_primario)&&!Lt(p.ibanPrimario||p.iban_primario)?"border-red-500 bg-red-50":(p.ibanPrimario||p.iban_primario)&&Lt(p.ibanPrimario||p.iban_primario)?"border-green-500 bg-green-50":""}`,value:p.ibanPrimario||p.iban_primario||"",onChange:j=>_({...p,ibanPrimario:j.target.value.toUpperCase(),iban_primario:j.target.value.toUpperCase()}),disabled:S}),(p.ibanPrimario||p.iban_primario)&&!Lt(p.ibanPrimario||p.iban_primario)&&a.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:" IBAN non valido"}),(p.ibanPrimario||p.iban_primario)&&Lt(p.ibanPrimario||p.iban_primario)&&a.jsx("span",{className:"text-green-600 text-xs mt-1 block",children:" IBAN valido"})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"IBAN Secondario",className:`border rounded px-3 py-2 w-full ${(p.ibanSecondario||p.iban_secondario)&&!Lt(p.ibanSecondario||p.iban_secondario)?"border-red-500 bg-red-50":(p.ibanSecondario||p.iban_secondario)&&Lt(p.ibanSecondario||p.iban_secondario)?"border-green-500 bg-green-50":""}`,value:p.ibanSecondario||p.iban_secondario||"",onChange:j=>_({...p,ibanSecondario:j.target.value.toUpperCase(),iban_secondario:j.target.value.toUpperCase()}),disabled:S}),(p.ibanSecondario||p.iban_secondario)&&!Lt(p.ibanSecondario||p.iban_secondario)&&a.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:" IBAN non valido"}),(p.ibanSecondario||p.iban_secondario)&&Lt(p.ibanSecondario||p.iban_secondario)&&a.jsx("span",{className:"text-green-600 text-xs mt-1 block",children:" IBAN valido"})]}),a.jsx("input",{type:"email",placeholder:"Email",className:"border rounded px-3 py-2",value:p.email||"",onChange:j=>_({...p,email:j.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono",className:"border rounded px-3 py-2",value:p.telefono||"",onChange:j=>_({...p,telefono:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Indirizzo",className:"border rounded px-3 py-2",value:p.indirizzo||"",onChange:j=>_({...p,indirizzo:j.target.value}),disabled:S}),a.jsxs("select",{className:"border rounded px-3 py-2",value:p.ruolo||"operaio",onChange:j=>_({...p,ruolo:j.target.value}),disabled:S,children:[a.jsx("option",{value:"operaio",children:"Operaio"}),a.jsx("option",{value:"amministratore",children:"Amministratore Unico"}),a.jsx("option",{value:"direttore_tecnico",children:"Direttore Tecnico"})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:T,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",disabled:S,children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Nome"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Cognome"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"C.F."}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Email"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"IBAN Primario"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Azioni"})]})}),a.jsx("tbody",{children:O.map(j=>a.jsxs("tr",{className:"hover:bg-gray-50 border-t",children:[a.jsx("td",{className:"px-4 py-3 text-sm",children:j.nome}),a.jsx("td",{className:"px-4 py-3 text-sm",children:j.cognome}),a.jsx("td",{className:"px-4 py-3 text-sm",children:j.codice_fiscale}),a.jsx("td",{className:"px-4 py-3 text-sm",children:j.email}),a.jsx("td",{className:"px-4 py-3 text-sm font-mono text-xs",children:j.iban_primario}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>L(j),className:"text-blue-600 mr-2 hover:text-blue-800",children:""}),a.jsx("button",{onClick:()=>z(j),className:"text-red-600 hover:text-red-800",children:""})]})]},j.id))})]}),O.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun lavoratore trovato"})]})]})]})}function ty(){const{unilav:o=[],lavoratori:s=[],cantieri:l=[],loading:r,addRecord:d,updateRecord:u,deleteRecord:m}=wt(),[x,g]=F.useState(""),[f,b]=F.useState(""),[p,_]=F.useState(""),[S,N]=F.useState(""),[O,T]=F.useState(!1),[z,L]=F.useState(null),[j,q]=F.useState({}),[y,M]=F.useState(!1),k=H=>{if(!H)return"-";const U=new Date(H);return isNaN(U.getTime())?H:U.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},te=[{value:"assunzione",label:"Assunzione",color:"bg-green-100"},{value:"trasf_part_full",label:"PartFull",color:"bg-blue-100"},{value:"trasf_cantiere",label:"Trasf. Cantiere",color:"bg-purple-100"},{value:"trasf_livello",label:"Trasf. Livello",color:"bg-indigo-100"},{value:"dimissioni",label:"Dimissioni",color:"bg-red-100"},{value:"distacco_comando",label:"Distacco/Comando",color:"bg-orange-100"},{value:"proroga",label:"Proroga",color:"bg-yellow-100"},{value:"trasf_det_ind",label:"DetInd",color:"bg-teal-100"}];if(r.unilav||r.lavoratori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento Unilav..."})]})});const ue=(()=>{let H=o;if(f&&(H=H.filter(U=>U.lavoratore_id===f)),p&&S){const U=new Date(p),D=new Date(S),R={};H.forEach(V=>{R[V.lavoratore_id]||(R[V.lavoratore_id]=[]),R[V.lavoratore_id].push(V)});const E=[];return Object.entries(R).forEach(([V,w])=>{const A=w.filter(I=>{const K=new Date(I.data_inizio);return K>=U&&K<=D});if(A.length>0)E.push(...A);else{const I=w.filter(K=>{const ee=new Date(K.data_inizio),ne=K.data_fine?new Date(K.data_fine):null;return ee>=U?!1:ne?ne>=U:!0});if(I.length>0){const K=I.reduce((ee,ne)=>{const me=new Date(ee.data_inizio);return new Date(ne.data_inizio)>me?ne:ee});E.push(K)}}}),E}return H})(),de=[...new Set(ue.map(H=>H.lavoratore_id))],ve=async()=>{if(!j.tipoUnilav||!j.lavoratoreId||!j.dataInizio)return alert(" Compila i campi obbligatori (Tipo Unilav, Lavoratore, Data Inizio)");M(!0);const H={tipo_unilav:j.tipoUnilav,lavoratore_id:j.lavoratoreId,cantiere_id:j.cantiereId||null,data_comunicazione:j.dataComunicazione||null,data_inizio:j.dataInizio,data_fine:j.tipoContratto==="indeterminato"&&j.tipoUnilav!=="distacco_comando"?null:j.dataFine||null,livello:j.livello||null,tipo_contratto:j.tipoContratto||null,orario:j.orario||null};let U;z?U=await u("unilav",z,H):U=await d("unilav",H),M(!1),U.success?(alert(z?" Unilav aggiornato!":" Unilav creato!"),T(!1),q({}),L(null)):alert(" Errore: "+U.error)},ie=async H=>{const U=s.find(E=>E.id===H.lavoratore_id),D=U?`${U.nome} ${U.cognome}`:"questo Unilav";if(!confirm(` Eliminare l'Unilav di ${D}?

Questa azione  irreversibile!`))return;const R=await m("unilav",H.id);R.success?alert(" Unilav eliminato!"):alert(" Errore: "+R.error)},pe=H=>{q({tipoUnilav:H.tipo_unilav,lavoratoreId:H.lavoratore_id,cantiereId:H.cantiere_id,dataComunicazione:H.data_comunicazione,dataInizio:H.data_inizio,dataFine:H.data_fine,livello:H.livello,tipoContratto:H.tipo_contratto,orario:H.orario}),L(H.id),T(!0),window.scrollTo({top:0,behavior:"smooth"})},be=()=>{_(""),N(""),b(""),g("")};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex gap-4 flex-1 flex-wrap",children:[a.jsx("input",{type:"text",placeholder:" Cerca per nome lavoratore o cantiere...",className:"border rounded px-3 py-2 flex-1 min-w-[200px]",value:x,onChange:H=>g(H.target.value)}),a.jsxs("select",{className:"border rounded px-3 py-2 min-w-[200px]",value:f,onChange:H=>b(H.target.value),children:[a.jsx("option",{value:"",children:"Tutti i lavoratori"}),s.map(H=>a.jsxs("option",{value:H.id,children:[H.nome," ",H.cognome]},H.id))]}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2",value:p,onChange:H=>_(H.target.value),placeholder:"Data inizio"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2",value:S,onChange:H=>N(H.target.value),placeholder:"Data fine"}),(p||S||f)&&a.jsx("button",{onClick:be,className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:" Reset"})]}),a.jsx("button",{onClick:()=>{T(!0),L(null),q({}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Unilav"})]}),ue.length>0&&(f||p&&S)&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[" Visualizzati ",ue.length," Unilav",p&&S&&a.jsxs("span",{className:"font-semibold",children:[" - ",de.length," lavoratori attivi dal ",k(p)," al ",k(S)]})]})}),O&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[z?" Modifica":" Nuovo"," Unilav"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo Unilav *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j.tipoUnilav||"",onChange:H=>q({...j,tipoUnilav:H.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona tipo"}),te.map(H=>a.jsx("option",{value:H.value,children:H.label},H.value))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lavoratore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j.lavoratoreId||"",onChange:H=>q({...j,lavoratoreId:H.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona lavoratore"}),s.map(H=>a.jsxs("option",{value:H.id,children:[H.nome," ",H.cognome]},H.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j.cantiereId||"",onChange:H=>q({...j,cantiereId:H.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona cantiere"}),l.map(H=>a.jsx("option",{value:H.id,children:H.nome},H.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Comunicazione"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:j.dataComunicazione||"",onChange:H=>q({...j,dataComunicazione:H.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Inizio *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:j.dataInizio||"",onChange:H=>q({...j,dataInizio:H.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fine"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:j.dataFine||"",onChange:H=>q({...j,dataFine:H.target.value}),disabled:y||j.tipoContratto==="indeterminato"&&j.tipoUnilav!=="distacco_comando"}),j.tipoContratto==="indeterminato"&&j.tipoUnilav!=="distacco_comando"&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Disabilitato per contratti indeterminati"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Livello"}),a.jsx("input",{type:"text",placeholder:"es: 3",className:"border rounded px-3 py-2 w-full",value:j.livello||"",onChange:H=>q({...j,livello:H.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo Contratto"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j.tipoContratto||"",onChange:H=>q({...j,tipoContratto:H.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona tipo"}),a.jsx("option",{value:"determinato",children:"Determinato"}),a.jsx("option",{value:"indeterminato",children:"Indeterminato"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Orario"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j.orario||"",onChange:H=>q({...j,orario:H.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona orario"}),a.jsx("option",{value:"full-time",children:"Full-time"}),a.jsx("option",{value:"part-time",children:"Part-time"})]})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:ve,disabled:y,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:y?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{T(!1),q({}),L(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:y,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Lavoratore"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Cantiere"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Inizio"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Fine"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Livello"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Contratto"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Azioni"})]})}),a.jsx("tbody",{children:ue.filter(H=>{if(!x)return!0;const U=s.find(w=>w.id===H.lavoratore_id),D=l.find(w=>w.id===H.cantiere_id),R=U?`${U.nome} ${U.cognome}`.toLowerCase():"",E=D?D.nome.toLowerCase():"",V=x.toLowerCase();return R.includes(V)||E.includes(V)}).sort((H,U)=>{const D=new Date(H.data_inizio||"9999-12-31");return new Date(U.data_inizio||"9999-12-31")-D}).map(H=>{const U=s.find(E=>E.id===H.lavoratore_id),D=l.find(E=>E.id===H.cantiere_id),R=te.find(E=>E.value===H.tipo_unilav);return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs ${R?.color||"bg-gray-100"}`,children:R?.label||"N/A"})}),a.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:U?`${U.nome} ${U.cognome}`:"N/A"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:D?.nome||"N/A"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k(H.data_inizio)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:H.tipo_contratto==="indeterminato"&&H.tipo_unilav!=="distacco_comando"?a.jsx("span",{className:"text-green-600 font-medium",children:"Indet."}):k(H.data_fine)}),a.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:H.livello||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs ${H.tipo_contratto==="indeterminato"?"bg-green-100":"bg-yellow-100"}`,children:H.tipo_contratto==="indeterminato"?"Indet.":"Det."})}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>pe(H),className:"text-blue-600 mr-2 hover:text-blue-800",children:""}),a.jsx("button",{onClick:()=>ie(H),className:"text-red-600 hover:text-red-800",children:""})]})]},H.id)})})]}),ue.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun Unilav trovato"})]})]})]})}function ay(){const{certificazioni:o,lavoratori:s,loading:l,addRecord:r,updateRecord:d,deleteRecord:u}=wt(),[m,x]=F.useState(!1),[g,f]=F.useState(null),[b,p]=F.useState({tipo:"corso"}),[_,S]=F.useState(""),[N,O]=F.useState(""),[T,z]=F.useState(!1),[L,j]=F.useState(null),[q,y]=F.useState(new Date().toISOString().split("T")[0]),[M,k]=F.useState(""),[te,ue]=F.useState(""),[de,ve]=F.useState(!1),ie=["Rischio alto 16h","Antincendio","Primo Soccorso","Cond. Escavatori","RSPP","RLS","PIMUS","Preposto","P. Cappotti","Patentino Perforatore","Visita Medica"];if(l.certificazioni||l.lavoratori)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento corsi e visite..."})]})});const pe=E=>{if(!E)return"-";const V=new Date(E);return isNaN(V.getTime())?E:V.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},be=async()=>{if(!b.lavoratoreId||!b.nome){alert(" Lavoratore e tipo sono obbligatori!");return}ve(!0);const E={lavoratore_id:b.lavoratoreId||b.lavoratore_id,nome:b.nome,nome_certificazione:b.nome,tipo:b.tipo,data_conseguimento:b.dataConseguimento||b.data_conseguimento,data_scadenza:b.dataScadenza||b.data_scadenza,ente_rilascio:b.enteRilascio||b.ente_rilascio,numero_attestato:b.numeroAttestato||b.numero_attestato,note:b.note||"",storico:b.storico||[]};let V;g?V=await d("certificazioni",g,E):V=await r("certificazioni",E),ve(!1),V.success?(x(!1),p({tipo:"corso"}),f(null),alert(g?" Corso/Visita aggiornato!":" Corso/Visita aggiunto!")):alert(" Errore: "+V.error)},H=async E=>{if(!confirm(` Eliminare ${E.nome}?

Questa azione  irreversibile!`))return;const V=await u("certificazioni",E.id);V.success?alert(" Corso/Visita eliminato!"):alert(" Errore: "+V.error)},U=E=>{p({lavoratoreId:E.lavoratore_id,lavoratore_id:E.lavoratore_id,nome:E.nome||E.nome_certificazione,tipo:E.tipo,dataConseguimento:E.data_conseguimento,data_conseguimento:E.data_conseguimento,dataScadenza:E.data_scadenza,data_scadenza:E.data_scadenza,enteRilascio:E.ente_rilascio,ente_rilascio:E.ente_rilascio,numeroAttestato:E.numero_attestato,numero_attestato:E.numero_attestato,note:E.note,storico:E.storico||[]}),f(E.id),x(!0),window.scrollTo({top:0,behavior:"smooth"})},D=async(E,V)=>{if(!M)return alert(" Inserisci la nuova scadenza");const w=o.find(ee=>ee.id===E&&ee.lavoratore_id===V);if(!w)return;const A={id:Date.now().toString(),dataAggiornamento:q,scadenzaPrecedente:w.data_scadenza,nuovaScadenza:M,nota:te},I=[...w.storico||[],A],K=await d("certificazioni",E,{data_scadenza:M,storico:I});K.success?(y(new Date().toISOString().split("T")[0]),k(""),ue(""),j(K.data),alert(" Aggiornamento registrato!")):alert(" Errore: "+K.error)},R=F.useMemo(()=>{let E=o;if(N&&(E=E.filter(V=>V.lavoratore_id===N)),_){const V=_.toLowerCase();E=E.filter(w=>{const A=s.find(K=>K.id===w.lavoratore_id);return(A?`${A.nome} ${A.cognome}`.toLowerCase():"").includes(V)||w.nome?.toLowerCase().includes(V)})}return E},[o,N,_,s]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center gap-4",children:[a.jsxs("div",{className:"flex gap-4 flex-1",children:[a.jsx("input",{type:"text",placeholder:" Cerca per nome lavoratore...",className:"border rounded px-3 py-2 flex-1",value:_,onChange:E=>S(E.target.value)}),a.jsxs("select",{className:"border rounded px-3 py-2 min-w-[200px]",value:N,onChange:E=>O(E.target.value),children:[a.jsx("option",{value:"",children:"Tutti i lavoratori"}),s.map(E=>a.jsxs("option",{value:E.id,children:[E.nome," ",E.cognome]},E.id))]})]}),a.jsx("button",{onClick:()=>{x(!0),f(null),p({tipo:"corso"}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo"})]}),R.length>0&&N&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[" Visualizzati ",R.length," corsi/visite per il lavoratore selezionato"]})}),m&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[g?" Modifica":" Nuovo"," Corso/Visita"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("select",{className:"border rounded px-3 py-2",value:b.lavoratoreId||"",onChange:E=>p({...b,lavoratoreId:E.target.value}),disabled:de,children:[a.jsx("option",{value:"",children:"Lavoratore *"}),s.map(E=>a.jsxs("option",{value:E.id,children:[E.nome," ",E.cognome]},E.id))]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:b.nome||"",onChange:E=>p({...b,nome:E.target.value,tipo:E.target.value==="Visita Medica"?"visita":"corso"}),disabled:de,children:[a.jsx("option",{value:"",children:"Tipo *"}),ie.map(E=>a.jsx("option",{value:E,children:E},E))]}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2",placeholder:"Data Conseguimento",value:b.dataConseguimento||"",onChange:E=>p({...b,dataConseguimento:E.target.value}),disabled:de}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2",placeholder:"Data Scadenza",value:b.dataScadenza||"",onChange:E=>p({...b,dataScadenza:E.target.value}),disabled:de}),a.jsx("input",{type:"text",placeholder:"Numero Attestato",className:"border rounded px-3 py-2",value:b.numeroAttestato||"",onChange:E=>p({...b,numeroAttestato:E.target.value}),disabled:de}),a.jsx("input",{type:"text",placeholder:"Ente Rilascio",className:"border rounded px-3 py-2",value:b.enteRilascio||"",onChange:E=>p({...b,enteRilascio:E.target.value}),disabled:de}),a.jsx("textarea",{placeholder:"Note (opzionale)",className:"border rounded px-3 py-2 col-span-2",rows:"2",value:b.note||"",onChange:E=>p({...b,note:E.target.value}),disabled:de})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:be,disabled:de,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:de?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{x(!1),p({tipo:"corso"}),f(null)},disabled:de,className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Tipo"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Lavoratore"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Nome"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"N. Attestato"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Conseguimento"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Scadenza"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Stato"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Azioni"})]})}),a.jsx("tbody",{children:R.map(E=>{const V=s.find(ne=>ne.id===E.lavoratore_id),w=new Date,A=new Date(E.data_scadenza),I=Math.ceil((A-w)/(1e3*60*60*24));let K="Valido",ee="text-green-600";return I<0?(K="Scaduto",ee="text-red-600"):I<=30&&(K="In scadenza",ee="text-orange-600"),a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs ${E.tipo==="corso"?"bg-blue-100":"bg-purple-100"}`,children:E.tipo==="corso"?"Corso":"Visita"})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:V?`${V.nome} ${V.cognome}`:"N/A"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:E.nome}),a.jsx("td",{className:"px-4 py-3 text-sm",children:E.numero_attestato||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:pe(E.data_conseguimento)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:pe(E.data_scadenza)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:ee,children:K})}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>{j(E),z(!0)},className:"text-purple-600 hover:text-purple-700 mr-2",title:"Visualizza storico",children:""}),a.jsx("button",{onClick:()=>U(E),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>H(E),className:"text-red-600",children:""})]})]},E.id)})})]}),R.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun corso/visita trovato"})]})]}),T&&L&&a.jsx(iy,{corso:L,lavoratori:s,onClose:()=>{z(!1),j(null)},dataAggiornamento:q,setDataAggiornamento:y,nuovaScadenza:M,setNuovaScadenza:k,notaAggiornamento:te,setNotaAggiornamento:ue,aggiungiAggiornamento:D,formatDate:pe})]})}function iy({corso:o,lavoratori:s,onClose:l,dataAggiornamento:r,setDataAggiornamento:d,nuovaScadenza:u,setNuovaScadenza:m,notaAggiornamento:x,setNotaAggiornamento:g,aggiungiAggiornamento:f,formatDate:b}){const p=s.find(_=>_.id===o.lavoratore_id);return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Storico - ",o.nome," - ",p?.nome," ",p?.cognome]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Scadenza Attuale"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:b(o.data_scadenza)})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg mb-4 border border-green-200",children:[a.jsx("h4",{className:"font-medium mb-3 text-green-900",children:" Registra Aggiornamento"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Aggiornamento"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:r,onChange:_=>d(_.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nuova Scadenza *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:u,onChange:_=>m(_.target.value)})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>f(o.id,o.lavoratore_id),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full",children:" Aggiungi"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note (opzionale)"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Es: Corso rinnovato presso ente X...",value:x,onChange:_=>g(_.target.value)})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3",children:["Storico Aggiornamenti (",(o.storico||[]).length,")"]}),(o.storico||[]).length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Nessun aggiornamento registrato. Usa il form sopra per registrare aggiornamenti."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data Aggiornamento"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Scadenza Precedente"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Nuova Scadenza"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Note"})]})}),a.jsx("tbody",{children:[...o.storico||[]].reverse().map(_=>a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2",children:b(_.dataAggiornamento)}),a.jsx("td",{className:"px-3 py-2 text-red-600 line-through",children:b(_.scadenzaPrecedente)}),a.jsx("td",{className:"px-3 py-2 text-green-600 font-semibold",children:b(_.nuovaScadenza)}),a.jsx("td",{className:"px-3 py-2 text-gray-600",children:_.nota||"-"})]},_.id))})]})})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:l,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Chiudi"})})]})})}function sy(){const{veicoli:o,loading:s,addRecord:l,updateRecord:r,deleteRecord:d}=wt(),[u,m]=F.useState(""),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1);if(s.veicoli)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento veicoli..."})]})});const O=async()=>{if(!p.targa){alert(" La targa  obbligatoria!");return}N(!0);const y={targa:p.targa,marca:p.marca,modello:p.modello,anno:p.anno,tipo:p.tipo,scadenza_assicurazione:p.scadenza_assicurazione||p.scadenzaAssicurazione,scadenza_revisione:p.scadenza_revisione||p.scadenzaRevisione,note:p.note};let M;f?M=await r("veicoli",f,y):M=await l("veicoli",y),N(!1),M.success?(g(!1),_({}),b(null),alert(f?" Veicolo aggiornato!":" Veicolo aggiunto!")):alert(" Errore: "+M.error)},T=async y=>{if(!confirm(` Eliminare il veicolo ${y.targa}?

Questa azione  irreversibile!`))return;const M=await d("veicoli",y.id);M.success?alert(" Veicolo eliminato!"):alert(" Errore: "+M.error)},z=y=>{_({targa:y.targa,marca:y.marca,modello:y.modello,anno:y.anno,tipo:y.tipo,scadenza_assicurazione:y.scadenza_assicurazione,scadenzaAssicurazione:y.scadenza_assicurazione,scadenza_revisione:y.scadenza_revisione,scadenzaRevisione:y.scadenza_revisione,note:y.note}),b(y.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},L=o.filter(y=>y.targa?.toLowerCase().includes(u.toLowerCase())||y.marca?.toLowerCase().includes(u.toLowerCase())||y.modello?.toLowerCase().includes(u.toLowerCase())||y.tipo?.toLowerCase().includes(u.toLowerCase())),j=y=>{if(!y)return{stato:"sconosciuto",label:"-",color:"bg-gray-100"};const M=new Date,k=new Date(y),te=Math.ceil((k-M)/(1e3*60*60*24));return te<0?{stato:"scaduto",label:`Scaduto da ${Math.abs(te)}g`,color:"bg-red-100 text-red-700"}:te<=30?{stato:"in_scadenza",label:`${te}g`,color:"bg-yellow-100 text-yellow-700"}:{stato:"valido",label:`${te}g`,color:"bg-green-100 text-green-700"}},q=F.useMemo(()=>{let y=o.length,M=0,k=0,te=0,ue=0;return o.forEach(de=>{const ve=j(de.scadenza_assicurazione),ie=j(de.scadenza_revisione);ve.stato==="scaduto"&&M++,ve.stato==="in_scadenza"&&k++,ie.stato==="scaduto"&&te++,ie.stato==="in_scadenza"&&ue++}),{totale:y,assicurazioniScadute:M,assicurazioniInScadenza:k,revisioniScadute:te,revisioniInScadenza:ue}},[o]);return a.jsxs("div",{className:"space-y-4",children:[o.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Totale Veicoli"}),a.jsx("p",{className:"text-3xl font-bold text-blue-900",children:q.totale})]}),a.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[a.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Assic. Scadute"}),a.jsx("p",{className:"text-3xl font-bold text-red-900",children:q.assicurazioniScadute})]}),a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[a.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Assic. In Scadenza"}),a.jsx("p",{className:"text-3xl font-bold text-yellow-900",children:q.assicurazioniInScadenza})]}),a.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[a.jsx("p",{className:"text-sm text-red-600 font-medium",children:"Rev. Scadute"}),a.jsx("p",{className:"text-3xl font-bold text-red-900",children:q.revisioniScadute})]}),a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[a.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:"Rev. In Scadenza"}),a.jsx("p",{className:"text-3xl font-bold text-yellow-900",children:q.revisioniInScadenza})]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("input",{type:"text",placeholder:" Cerca per targa, marca, modello o tipo...",className:"border rounded px-3 py-2 w-96",value:u,onChange:y=>m(y.target.value)}),a.jsx("button",{onClick:()=>{g(!0),b(null),_({})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Veicolo"})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuovo"," Veicolo"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Targa (es: AB123CD) *",className:"border rounded px-3 py-2 uppercase",value:p.targa||"",onChange:y=>_({...p,targa:y.target.value.toUpperCase()}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Marca",className:"border rounded px-3 py-2",value:p.marca||"",onChange:y=>_({...p,marca:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Modello",className:"border rounded px-3 py-2",value:p.modello||"",onChange:y=>_({...p,modello:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Anno (es: 2020)",className:"border rounded px-3 py-2",value:p.anno||"",onChange:y=>_({...p,anno:y.target.value}),disabled:S}),a.jsxs("select",{className:"border rounded px-3 py-2",value:p.tipo||"",onChange:y=>_({...p,tipo:y.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Seleziona Tipo"}),a.jsx("option",{value:"furgone",children:"Furgone"}),a.jsx("option",{value:"autocarro",children:"Autocarro"}),a.jsx("option",{value:"escavatore",children:"Escavatore"}),a.jsx("option",{value:"gru",children:"Gru"}),a.jsx("option",{value:"betoniera",children:"Betoniera"}),a.jsx("option",{value:"rimorchio",children:"Rimorchio"}),a.jsx("option",{value:"auto",children:"Auto"}),a.jsx("option",{value:"camion",children:"Camion"}),a.jsx("option",{value:"altro",children:"Altro"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scadenza Assicurazione"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p.scadenzaAssicurazione||p.scadenza_assicurazione||"",onChange:y=>_({...p,scadenzaAssicurazione:y.target.value,scadenza_assicurazione:y.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Scadenza Revisione"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p.scadenzaRevisione||p.scadenza_revisione||"",onChange:y=>_({...p,scadenzaRevisione:y.target.value,scadenza_revisione:y.target.value}),disabled:S})]}),a.jsx("textarea",{placeholder:"Note (optional)",className:"border rounded px-3 py-2 col-span-2",rows:"3",value:p.note||"",onChange:y=>_({...p,note:y.target.value}),disabled:S})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:O,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",disabled:S,children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Targa"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Marca/Modello"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Anno"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipo"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Assicurazione"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Stato Ass."}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Revisione"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Stato Rev."}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Azioni"})]})}),a.jsx("tbody",{children:L.map(y=>{const M=j(y.scadenza_assicurazione),k=j(y.scadenza_revisione);return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm font-bold",children:y.targa}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[y.marca," ",y.modello]}),a.jsx("td",{className:"px-4 py-3 text-sm",children:y.anno}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100",children:y.tipo||"-"})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:Ka(y.scadenza_assicurazione)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${M.color}`,children:M.label})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:Ka(y.scadenza_revisione)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${k.color}`,children:k.label})}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>z(y),className:"text-blue-600 mr-2 hover:text-blue-800",children:""}),a.jsx("button",{onClick:()=>T(y),className:"text-red-600 hover:text-red-800",children:""})]})]},y.id)})})]}),L.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun veicolo trovato"})]})]}),L.some(y=>y.note)&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:" Veicoli con Note"}),L.filter(y=>y.note).map(y=>a.jsx("div",{className:"bg-white p-4 rounded-lg shadow border-l-4 border-blue-500",children:a.jsx("div",{className:"flex justify-between items-start",children:a.jsxs("div",{children:[a.jsxs("p",{className:"font-bold text-lg",children:[y.targa," - ",y.marca," ",y.modello]}),a.jsx("p",{className:"text-sm text-gray-600 mt-2",children:y.note})]})})},y.id))]})]})}function ny(){const{subappaltatori:o,cantieri:s,loading:l,addRecord:r,updateRecord:d,deleteRecord:u}=wt(),[m,x]=F.useState(""),[g,f]=F.useState(""),[b,p]=F.useState(!1),[_,S]=F.useState(null),[N,O]=F.useState({cantieri_ids:[]}),[T,z]=F.useState(!1);if(l.subappaltatori||l.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento subappaltatori..."})]})});const L=async()=>{if(!N.ragione_sociale&&!N.ragioneSociale){alert(" La ragione sociale  obbligatoria!");return}if((N.cantieri_ids||[]).length===0&&(N.cantieriIds||[]).length===0){alert(" Seleziona almeno un cantiere!");return}z(!0);const k={ragione_sociale:N.ragione_sociale||N.ragioneSociale,partita_iva:N.partita_iva||N.piva,codice_fiscale:N.codice_fiscale||N.codiceFiscale,iban:N.iban,cantieri_ids:N.cantieri_ids||N.cantieriIds||[],tipologia:N.tipologia,indirizzo:N.indirizzo,telefono:N.telefono,email:N.email,pec:N.pec,note:N.note};let te;_?te=await d("subappaltatori",_,k):te=await r("subappaltatori",k),z(!1),te.success?(p(!1),O({cantieri_ids:[]}),S(null),alert(_?" Subappaltatore aggiornato!":" Subappaltatore aggiunto!")):alert(" Errore: "+te.error)},j=async k=>{if(!confirm(` Eliminare il subappaltatore ${k.ragione_sociale}?

Questa azione  irreversibile!`))return;const te=await u("subappaltatori",k.id);te.success?alert(" Subappaltatore eliminato!"):alert(" Errore: "+te.error)},q=k=>{O({ragione_sociale:k.ragione_sociale,ragioneSociale:k.ragione_sociale,partita_iva:k.partita_iva,piva:k.partita_iva,codice_fiscale:k.codice_fiscale,codiceFiscale:k.codice_fiscale,iban:k.iban,cantieri_ids:k.cantieri_ids||[],cantieriIds:k.cantieri_ids||[],tipologia:k.tipologia,indirizzo:k.indirizzo,telefono:k.telefono,email:k.email,pec:k.pec,note:k.note}),S(k.id),p(!0),window.scrollTo({top:0,behavior:"smooth"})},M=o.filter(k=>g?(k.cantieri_ids||[]).includes(g):!0).filter(k=>{if(!m)return!0;const te=m.toLowerCase();return k.ragione_sociale?.toLowerCase().includes(te)||k.partita_iva?.toLowerCase().includes(te)});return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center gap-4 flex-wrap",children:[a.jsxs("div",{className:"flex gap-4 flex-1 flex-wrap",children:[a.jsx("input",{type:"text",placeholder:" Cerca per ragione sociale o P.IVA...",className:"border rounded px-3 py-2 flex-1 min-w-[250px]",value:m,onChange:k=>x(k.target.value)}),a.jsxs("select",{className:"border rounded px-3 py-2 min-w-[200px]",value:g,onChange:k=>f(k.target.value),children:[a.jsx("option",{value:"",children:"Tutti i cantieri"}),s.map(k=>a.jsx("option",{value:k.id,children:k.nome},k.id))]})]}),a.jsx("button",{onClick:()=>{p(!0),S(null),O({cantieri_ids:[]})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Subappaltatore"})]}),M.length>0&&g&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:a.jsxs("p",{className:"text-sm text-blue-800",children:[" Visualizzati ",M.length," subappaltatori per il cantiere selezionato"]})}),b&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[_?" Modifica":" Nuovo"," Subappaltatore"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Ragione Sociale *",className:"border rounded px-3 py-2 col-span-2",value:N.ragioneSociale||N.ragione_sociale||"",onChange:k=>O({...N,ragioneSociale:k.target.value,ragione_sociale:k.target.value}),disabled:T}),a.jsx("input",{type:"text",placeholder:"Partita IVA",className:"border rounded px-3 py-2",value:N.piva||N.partita_iva||"",onChange:k=>O({...N,piva:k.target.value,partita_iva:k.target.value}),disabled:T}),a.jsx("input",{type:"text",placeholder:"Codice Fiscale",className:"border rounded px-3 py-2",value:N.codiceFiscale||N.codice_fiscale||"",onChange:k=>O({...N,codiceFiscale:k.target.value,codice_fiscale:k.target.value}),disabled:T}),a.jsxs("div",{className:"relative col-span-2",children:[a.jsx("input",{type:"text",placeholder:"IBAN",className:`border rounded px-3 py-2 w-full ${N.iban&&!Lt(N.iban)?"border-red-500 bg-red-50":N.iban&&Lt(N.iban)?"border-green-500 bg-green-50":""}`,value:N.iban||"",onChange:k=>O({...N,iban:k.target.value.toUpperCase()}),disabled:T}),N.iban&&!Lt(N.iban)&&a.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:" IBAN non valido"}),N.iban&&Lt(N.iban)&&a.jsx("span",{className:"text-green-600 text-xs mt-1 block",children:" IBAN valido"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cantieri * (tieni premuto Ctrl/Cmd per selezionare multipli)"}),a.jsx("select",{multiple:!0,className:"border rounded px-3 py-2 w-full h-32",value:N.cantieriIds||N.cantieri_ids||[],onChange:k=>{const te=Array.from(k.target.selectedOptions,ue=>ue.value);O({...N,cantieriIds:te,cantieri_ids:te})},disabled:T,children:s.map(k=>a.jsx("option",{value:k.id,children:k.nome},k.id))}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Selezionati: ",(N.cantieriIds||N.cantieri_ids||[]).length," cantiere/i"]})]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:N.tipologia||"",onChange:k=>O({...N,tipologia:k.target.value}),disabled:T,children:[a.jsx("option",{value:"",children:"Tipologia"}),a.jsx("option",{value:"2%",children:"Ritenuta 2%"}),a.jsx("option",{value:"subappalto",children:"Subappalto"})]}),a.jsx("input",{type:"tel",placeholder:"Telefono",className:"border rounded px-3 py-2",value:N.telefono||"",onChange:k=>O({...N,telefono:k.target.value}),disabled:T}),a.jsx("input",{type:"email",placeholder:"Email",className:"border rounded px-3 py-2",value:N.email||"",onChange:k=>O({...N,email:k.target.value}),disabled:T}),a.jsx("input",{type:"email",placeholder:"PEC",className:"border rounded px-3 py-2",value:N.pec||"",onChange:k=>O({...N,pec:k.target.value}),disabled:T}),a.jsx("input",{type:"text",placeholder:"Indirizzo",className:"border rounded px-3 py-2 col-span-2",value:N.indirizzo||"",onChange:k=>O({...N,indirizzo:k.target.value}),disabled:T}),a.jsx("textarea",{placeholder:"Note (optional)",className:"border rounded px-3 py-2 col-span-2",rows:"3",value:N.note||"",onChange:k=>O({...N,note:k.target.value}),disabled:T})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:L,disabled:T||!(N.ragioneSociale||N.ragione_sociale)||(N.cantieriIds||N.cantieri_ids||[]).length===0,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-gray-300 disabled:opacity-50",children:T?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{p(!1),O({cantieri_ids:[]}),S(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:T,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Ragione Sociale"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"P.IVA"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Cantieri"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Tipologia"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Telefono"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:"Azioni"})]})}),a.jsx("tbody",{children:M.map(k=>{const te=(k.cantieri_ids||[]).filter(ue=>ue).map(ue=>s.find(de=>de.id===ue)?.nome||"N/A").join(", ");return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:k.ragione_sociale}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k.partita_iva||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:"text-xs",children:te||"N/A"})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k.tipologia?a.jsx("span",{className:`px-2 py-1 rounded text-xs ${k.tipologia==="2%"?"bg-green-100":"bg-blue-100"}`,children:k.tipologia}):"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k.telefono||"-"}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>q(k),className:"text-blue-600 mr-2 hover:text-blue-800",children:""}),a.jsx("button",{onClick:()=>j(k),className:"text-red-600 hover:text-red-800",children:""})]})]},k.id)})})]}),M.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun subappaltatore trovato"})]})]}),M.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:" Dettagli Subappaltatori"}),M.map(k=>{const te=(k.cantieri_ids||[]).filter(ue=>ue).map(ue=>{const de=s.find(ve=>ve.id===ue);return de?de.nome:"N/A"});return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-xl font-bold text-blue-600",children:k.ragione_sociale}),k.tipologia&&a.jsx("span",{className:`inline-block mt-2 px-3 py-1 rounded text-xs font-medium ${k.tipologia==="2%"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:k.tipologia})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>q(k),className:"text-blue-600 hover:text-blue-800 text-xl",children:""}),a.jsx("button",{onClick:()=>j(k),className:"text-red-600 hover:text-red-800 text-xl",children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[k.partita_iva&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"P.IVA:"})," ",k.partita_iva]}),k.codice_fiscale&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"CF:"})," ",k.codice_fiscale]}),k.iban&&a.jsxs("div",{className:"col-span-full",children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"IBAN:"}),a.jsx("span",{className:"font-mono text-xs ml-2",children:k.iban})]}),te.length>0&&a.jsxs("div",{className:"col-span-full",children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Cantieri:"}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:te.map((ue,de)=>a.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs",children:ue},de))})]}),k.telefono&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Tel:"})," ",k.telefono]}),k.email&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Email:"}),a.jsx("a",{href:`mailto:${k.email}`,className:"text-blue-600 hover:underline ml-1",children:k.email})]}),k.pec&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"PEC:"})," ",k.pec]}),k.indirizzo&&a.jsxs("div",{className:"col-span-full",children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Indirizzo:"})," ",k.indirizzo]})]}),k.note&&a.jsx("div",{className:"mt-4 pt-4 border-t",children:a.jsxs("p",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:" Note:"})," ",k.note]})})]},k.id)})]})]})}function ly(){const{cantieri:o,loading:s,addRecord:l,updateRecord:r,deleteRecord:d}=wt(),[u,m]=F.useState(!1),[x,g]=F.useState(null),[f,b]=F.useState({}),[p,_]=F.useState(""),[S,N]=F.useState(!1);if(s.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento cantieri..."})]})});const O=async()=>{if(!f.nome){alert(" Il nome del cantiere  obbligatorio!");return}N(!0);const y={nome:f.nome,cliente_id:f.cliente_id||f.clienteId||null,cliente_nome:f.cliente_nome||f.clienteNome||null,indirizzo:f.indirizzo||null,comune:f.comune||null,provincia:f.provincia||null,cap:f.cap||null,stato:f.stato||"pianificato",cig:f.cig||null,cup:f.cup||null,casse_edile:f.casse_edile||f.casseEdile||f.cassaEdile||null,data_inizio:f.data_inizio||f.dataInizio||null,data_fine:f.data_fine||f.dataFine||null,data_fine_prevista:f.data_fine_prevista||f.dataFinePrevista||null,importo_contratto:f.importo_contratto||f.importoContratto||null,importo_lavori:f.importo_lavori||f.importoLavori||null,codice_commessa:f.codice_commessa||f.codiceCommessa||null,rup_nome:f.rup_nome||f.rupNome||null,rup_email:f.rup_email||f.rupEmail||null,rup_pec:f.rup_pec||f.rupPec||null,rup_telefono:f.rup_telefono||f.rupTelefono||null,rup_cellulare:f.rup_cellulare||f.rupCellulare||null,cse_nome:f.cse_nome||f.cseNome||null,cse_email:f.cse_email||f.cseEmail||null,cse_pec:f.cse_pec||f.csePec||null,cse_telefono:f.cse_telefono||f.cseTelefono||null,cse_cellulare:f.cse_cellulare||f.cseCellulare||null,dl_nome:f.dl_nome||f.dlNome||null,dl_email:f.dl_email||f.dlEmail||null,dl_pec:f.dl_pec||f.dlPec||null,dl_telefono:f.dl_telefono||f.dlTelefono||null,dl_cellulare:f.dl_cellulare||f.dlCellulare||null,collaudatore_nome:f.collaudatore_nome||f.collaudatoreNome||null,collaudatore_email:f.collaudatore_email||f.collaudatoreEmail||null,collaudatore_telefono:f.collaudatore_telefono||f.collaudatoreTelefono||null,collaudatore_cellulare:f.collaudatore_cellulare||f.collaudatoreCellulare||null,collaudatore_pec:f.collaudatore_pec||f.collaudatorePec||null,data_comunicazione_dnlt:f.data_comunicazione_dnlt||f.dataComunicazioneDNLT||null,scadenza_dnlt:f.scadenza_dnlt||f.scadenzaDNLT||null,direttore_lavori:f.direttore_lavori||f.direttoreLavori||null,responsabile_sicurezza:f.responsabile_sicurezza||f.responsabileSicurezza||null,note:f.note||null,attivo:f.attivo!==void 0?f.attivo:!0};let M;x?M=await r("cantieri",x,y):M=await l("cantieri",y),N(!1),M.success?(m(!1),b({}),g(null),alert(x?" Cantiere aggiornato!":" Cantiere aggiunto!")):alert(" Errore: "+M.error)},T=async y=>{if(!confirm(` Eliminare il cantiere ${y.nome}?

Questa azione  irreversibile!`))return;const M=await d("cantieri",y.id);M.success?alert(" Cantiere eliminato!"):alert(" Errore: "+M.error)},z=y=>{b({nome:y.nome,cliente_id:y.cliente_id,clienteId:y.cliente_id,cliente_nome:y.cliente_nome,clienteNome:y.cliente_nome,indirizzo:y.indirizzo,comune:y.comune,provincia:y.provincia,cap:y.cap,stato:y.stato,cig:y.cig,cup:y.cup,casse_edile:y.casse_edile,casseEdile:y.casse_edile,cassaEdile:y.casse_edile,data_inizio:y.data_inizio,dataInizio:y.data_inizio,data_fine:y.data_fine,dataFine:y.data_fine,data_fine_prevista:y.data_fine_prevista,dataFinePrevista:y.data_fine_prevista,importo_contratto:y.importo_contratto,importoContratto:y.importo_contratto,importo_lavori:y.importo_lavori,importoLavori:y.importo_lavori,codice_commessa:y.codice_commessa,codiceCommessa:y.codice_commessa,rup_nome:y.rup_nome,rupNome:y.rup_nome,rup_email:y.rup_email,rupEmail:y.rup_email,rup_pec:y.rup_pec,rupPec:y.rup_pec,rup_telefono:y.rup_telefono,rupTelefono:y.rup_telefono,rup_cellulare:y.rup_cellulare,rupCellulare:y.rup_cellulare,cse_nome:y.cse_nome,cseNome:y.cse_nome,cse_email:y.cse_email,cseEmail:y.cse_email,cse_pec:y.cse_pec,csePec:y.cse_pec,cse_telefono:y.cse_telefono,cseTelefono:y.cse_telefono,cse_cellulare:y.cse_cellulare,cseCellulare:y.cse_cellulare,dl_nome:y.dl_nome,dlNome:y.dl_nome,dl_email:y.dl_email,dlEmail:y.dl_email,dl_pec:y.dl_pec,dlPec:y.dl_pec,dl_telefono:y.dl_telefono,dlTelefono:y.dl_telefono,dl_cellulare:y.dl_cellulare,dlCellulare:y.dl_cellulare,collaudatore_nome:y.collaudatore_nome,collaudatoreNome:y.collaudatore_nome,collaudatore_email:y.collaudatore_email,collaudatoreEmail:y.collaudatore_email,collaudatore_telefono:y.collaudatore_telefono,collaudatoreTelefono:y.collaudatore_telefono,collaudatore_cellulare:y.collaudatore_cellulare,collaudatoreCellulare:y.collaudatore_cellulare,collaudatore_pec:y.collaudatore_pec,collaudatorePec:y.collaudatore_pec,data_comunicazione_dnlt:y.data_comunicazione_dnlt,dataComunicazioneDNLT:y.data_comunicazione_dnlt,scadenza_dnlt:y.scadenza_dnlt,scadenzaDNLT:y.scadenza_dnlt,direttore_lavori:y.direttore_lavori,direttoreLavori:y.direttore_lavori,responsabile_sicurezza:y.responsabile_sicurezza,responsabileSicurezza:y.responsabile_sicurezza,note:y.note,attivo:y.attivo}),g(y.id),m(!0),window.scrollTo({top:0,behavior:"smooth"})},L={pianificato:"bg-blue-100 text-blue-700",in_corso:"bg-green-100 text-green-700",sospeso:"bg-orange-100 text-orange-700",completato:"bg-gray-100 text-gray-700",annullato:"bg-red-100 text-red-700"},j={pianificato:"Pianificato",in_corso:"In Corso",sospeso:"Sospeso",completato:"Completato",annullato:"Annullato"},q=F.useMemo(()=>{if(!p)return o;const y=p.toLowerCase();return o.filter(M=>M.nome?.toLowerCase().includes(y)||M.indirizzo?.toLowerCase().includes(y)||M.cig?.toLowerCase().includes(y)||M.cup?.toLowerCase().includes(y)||M.rup_nome?.toLowerCase().includes(y)||M.cse_nome?.toLowerCase().includes(y)||M.dl_nome?.toLowerCase().includes(y))},[o,p]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center gap-4",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Cantieri"}),a.jsx("div",{className:"flex-1 max-w-md",children:a.jsx("input",{type:"text",placeholder:" Cerca cantieri (nome, indirizzo, CIG, CUP, contatti...)",className:"border rounded px-4 py-2 w-full",value:p,onChange:y=>_(y.target.value)})}),a.jsx("button",{onClick:()=>{m(!0),g(null),b({stato:"pianificato"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 whitespace-nowrap",children:" Nuovo Cantiere"})]}),u&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200 max-h-[80vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[x?" Modifica":" Nuovo"," Cantiere"]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"Dati Generali"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome Cantiere *",className:"border rounded px-3 py-2 col-span-2",value:f.nome||"",onChange:y=>b({...f,nome:y.target.value}),disabled:S}),a.jsxs("select",{className:"border rounded px-3 py-2",value:f.stato||"pianificato",onChange:y=>b({...f,stato:y.target.value}),disabled:S,children:[a.jsx("option",{value:"pianificato",children:"Pianificato"}),a.jsx("option",{value:"in_corso",children:"In Corso"}),a.jsx("option",{value:"sospeso",children:"Sospeso"}),a.jsx("option",{value:"completato",children:"Completato"}),a.jsx("option",{value:"annullato",children:"Annullato"})]}),a.jsx("input",{type:"text",placeholder:"CIG",className:"border rounded px-3 py-2",value:f.cig||"",onChange:y=>b({...f,cig:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"CUP",className:"border rounded px-3 py-2",value:f.cup||"",onChange:y=>b({...f,cup:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Cassa Edile",className:"border rounded px-3 py-2",value:f.casseEdile||f.casse_edile||"",onChange:y=>b({...f,casseEdile:y.target.value,casse_edile:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Indirizzo",className:"border rounded px-3 py-2 col-span-2",value:f.indirizzo||"",onChange:y=>b({...f,indirizzo:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Comune",className:"border rounded px-3 py-2",value:f.comune||"",onChange:y=>b({...f,comune:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Provincia (es: CE)",className:"border rounded px-3 py-2",value:f.provincia||"",onChange:y=>b({...f,provincia:y.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"CAP",className:"border rounded px-3 py-2",value:f.cap||"",onChange:y=>b({...f,cap:y.target.value}),disabled:S}),a.jsx("input",{type:"date",placeholder:"Data Inizio",className:"border rounded px-3 py-2",value:f.dataInizio||f.data_inizio||"",onChange:y=>b({...f,dataInizio:y.target.value,data_inizio:y.target.value}),disabled:S}),a.jsx("input",{type:"date",placeholder:"Data Fine Prevista",className:"border rounded px-3 py-2",value:f.dataFinePrevista||f.data_fine_prevista||"",onChange:y=>b({...f,dataFinePrevista:y.target.value,data_fine_prevista:y.target.value}),disabled:S}),a.jsx("input",{type:"number",step:"0.01",placeholder:"Importo Lavori ",className:"border rounded px-3 py-2",value:f.importoLavori||f.importo_lavori||"",onChange:y=>b({...f,importoLavori:y.target.value,importo_lavori:y.target.value}),disabled:S}),a.jsx("input",{type:"number",step:"0.01",placeholder:"Importo Contratto ",className:"border rounded px-3 py-2",value:f.importoContratto||f.importo_contratto||"",onChange:y=>b({...f,importoContratto:y.target.value,importo_contratto:y.target.value}),disabled:S})]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"RUP - Responsabile Unico Procedimento"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome RUP",className:"border rounded px-3 py-2",value:f.rupNome||f.rup_nome||"",onChange:y=>b({...f,rupNome:y.target.value,rup_nome:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"Email RUP",className:"border rounded px-3 py-2",value:f.rupEmail||f.rup_email||"",onChange:y=>b({...f,rupEmail:y.target.value,rup_email:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"PEC RUP",className:"border rounded px-3 py-2",value:f.rupPec||f.rup_pec||"",onChange:y=>b({...f,rupPec:y.target.value,rup_pec:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono RUP",className:"border rounded px-3 py-2",value:f.rupTelefono||f.rup_telefono||"",onChange:y=>b({...f,rupTelefono:y.target.value,rup_telefono:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Cellulare RUP",className:"border rounded px-3 py-2",value:f.rupCellulare||f.rup_cellulare||"",onChange:y=>b({...f,rupCellulare:y.target.value,rup_cellulare:y.target.value}),disabled:S})]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"CSE - Coordinatore Sicurezza Esecuzione"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome CSE",className:"border rounded px-3 py-2",value:f.cseNome||f.cse_nome||"",onChange:y=>b({...f,cseNome:y.target.value,cse_nome:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"Email CSE",className:"border rounded px-3 py-2",value:f.cseEmail||f.cse_email||"",onChange:y=>b({...f,cseEmail:y.target.value,cse_email:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"PEC CSE",className:"border rounded px-3 py-2",value:f.csePec||f.cse_pec||"",onChange:y=>b({...f,csePec:y.target.value,cse_pec:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono CSE",className:"border rounded px-3 py-2",value:f.cseTelefono||f.cse_telefono||"",onChange:y=>b({...f,cseTelefono:y.target.value,cse_telefono:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Cellulare CSE",className:"border rounded px-3 py-2",value:f.cseCellulare||f.cse_cellulare||"",onChange:y=>b({...f,cseCellulare:y.target.value,cse_cellulare:y.target.value}),disabled:S})]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"DL - Direttore Lavori"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome DL",className:"border rounded px-3 py-2",value:f.dlNome||f.dl_nome||"",onChange:y=>b({...f,dlNome:y.target.value,dl_nome:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"Email DL",className:"border rounded px-3 py-2",value:f.dlEmail||f.dl_email||"",onChange:y=>b({...f,dlEmail:y.target.value,dl_email:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"PEC DL",className:"border rounded px-3 py-2",value:f.dlPec||f.dl_pec||"",onChange:y=>b({...f,dlPec:y.target.value,dl_pec:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono DL",className:"border rounded px-3 py-2",value:f.dlTelefono||f.dl_telefono||"",onChange:y=>b({...f,dlTelefono:y.target.value,dl_telefono:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Cellulare DL",className:"border rounded px-3 py-2",value:f.dlCellulare||f.dl_cellulare||"",onChange:y=>b({...f,dlCellulare:y.target.value,dl_cellulare:y.target.value}),disabled:S})]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"Collaudatore"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Nome Collaudatore",className:"border rounded px-3 py-2",value:f.collaudatoreNome||f.collaudatore_nome||"",onChange:y=>b({...f,collaudatoreNome:y.target.value,collaudatore_nome:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"Email Collaudatore",className:"border rounded px-3 py-2",value:f.collaudatoreEmail||f.collaudatore_email||"",onChange:y=>b({...f,collaudatoreEmail:y.target.value,collaudatore_email:y.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"PEC Collaudatore",className:"border rounded px-3 py-2",value:f.collaudatorePec||f.collaudatore_pec||"",onChange:y=>b({...f,collaudatorePec:y.target.value,collaudatore_pec:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono Collaudatore",className:"border rounded px-3 py-2",value:f.collaudatoreTelefono||f.collaudatore_telefono||"",onChange:y=>b({...f,collaudatoreTelefono:y.target.value,collaudatore_telefono:y.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Cellulare Collaudatore",className:"border rounded px-3 py-2",value:f.collaudatoreCellulare||f.collaudatore_cellulare||"",onChange:y=>b({...f,collaudatoreCellulare:y.target.value,collaudatore_cellulare:y.target.value}),disabled:S})]}),a.jsx("h4",{className:"font-semibold text-gray-700 mb-2 mt-4",children:"DNLT"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"date",placeholder:"Data Comunicazione DNLT",className:"border rounded px-3 py-2",value:f.dataComunicazioneDNLT||f.data_comunicazione_dnlt||"",onChange:y=>b({...f,dataComunicazioneDNLT:y.target.value,data_comunicazione_dnlt:y.target.value}),disabled:S}),a.jsx("input",{type:"date",placeholder:"Scadenza DNLT",className:"border rounded px-3 py-2",value:f.scadenzaDNLT||f.scadenza_dnlt||"",onChange:y=>b({...f,scadenzaDNLT:y.target.value,scadenza_dnlt:y.target.value}),disabled:S})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:O,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",disabled:S,children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{m(!1),b({}),g(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsx("div",{className:"space-y-4",children:q.length===0&&!p?a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessun cantiere presente"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Clicca su " Nuovo Cantiere" per iniziare'})]}):q.length===0&&p?a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsxs("p",{className:"text-gray-500",children:['Nessun cantiere trovato per "',p,'"']}),a.jsx("button",{onClick:()=>_(""),className:"mt-3 text-blue-600 hover:underline text-sm",children:" Cancella ricerca"})]}):q.map(y=>{const M=y.stato||"pianificato";return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-xl font-bold text-blue-600",children:y.nome}),a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${L[M]}`,children:j[M]})]}),a.jsx("p",{className:"text-gray-600",children:y.indirizzo})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>z(y),className:"text-blue-600 hover:text-blue-800 text-xl",children:""}),a.jsx("button",{onClick:()=>T(y),className:"text-red-600 hover:text-red-800 text-xl",children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"CIG:"})," ",y.cig||"-"]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"CUP:"})," ",y.cup||"-"]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Cassa:"})," ",y.casse_edile||"-"]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Importo:"}),"  ",y.importo_lavori||"-"]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Inizio:"})," ",Ka(y.data_inizio)]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Fine Prevista:"})," ",Ka(y.data_fine_prevista)]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Com. DNLT:"})," ",Ka(y.data_comunicazione_dnlt)]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Scad. DNLT:"})," ",Ka(y.scadenza_dnlt)]})]}),(y.rup_nome||y.cse_nome||y.dl_nome||y.collaudatore_nome)&&a.jsxs("div",{className:"mt-4 pt-4 border-t",children:[a.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Contatti"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[y.rup_nome&&a.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[a.jsx("p",{className:"font-medium text-blue-600",children:"RUP"}),a.jsx("p",{children:y.rup_nome}),y.rup_email&&a.jsx("p",{className:"text-gray-600",children:y.rup_email}),y.rup_telefono&&a.jsx("p",{className:"text-gray-600",children:y.rup_telefono})]}),y.cse_nome&&a.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[a.jsx("p",{className:"font-medium text-blue-600",children:"CSE"}),a.jsx("p",{children:y.cse_nome}),y.cse_email&&a.jsx("p",{className:"text-gray-600",children:y.cse_email}),y.cse_telefono&&a.jsx("p",{className:"text-gray-600",children:y.cse_telefono})]}),y.dl_nome&&a.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[a.jsx("p",{className:"font-medium text-blue-600",children:"DL"}),a.jsx("p",{children:y.dl_nome}),y.dl_email&&a.jsx("p",{className:"text-gray-600",children:y.dl_email}),y.dl_telefono&&a.jsx("p",{className:"text-gray-600",children:y.dl_telefono})]}),y.collaudatore_nome&&a.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[a.jsx("p",{className:"font-medium text-blue-600",children:"Collaudatore"}),a.jsx("p",{children:y.collaudatore_nome}),y.collaudatore_email&&a.jsx("p",{className:"text-gray-600",children:y.collaudatore_email}),y.collaudatore_pec&&a.jsxs("p",{className:"text-gray-600",children:["PEC: ",y.collaudatore_pec]}),y.collaudatore_telefono&&a.jsx("p",{className:"text-gray-600",children:y.collaudatore_telefono})]})]})]})]},y.id)})})]})}function ry(){const{fornitori:o,loading:s,addRecord:l,updateRecord:r,deleteRecord:d}=wt(),[u,m]=F.useState(""),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1);if(s.fornitori)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento fornitori..."})]})});const O=async()=>{if(!p.ragioneSociale){alert(" La ragione sociale  obbligatoria!");return}N(!0);const j={ragione_sociale:p.ragioneSociale||p.ragione_sociale,partita_iva:p.piva||p.partita_iva,codice_fiscale:p.codiceFiscale||p.codice_fiscale,iban:p.iban,email:p.email,pec:p.pec,telefono:p.telefono,cellulare:p.cellulare,indirizzo:p.indirizzo,citta:p.citta,cap:p.cap,provincia:p.provincia,categoria:p.categoria,referente:p.referente,sito_web:p.sitoWeb||p.sito_web,note:p.note,attivo:p.attivo!==void 0?p.attivo:!0};let q;f?q=await r("fornitori",f,j):q=await l("fornitori",j),N(!1),q.success?(g(!1),_({}),b(null),alert(f?" Fornitore aggiornato!":" Fornitore aggiunto!")):alert(" Errore: "+q.error)},T=async j=>{if(!confirm(` Eliminare il fornitore ${j.ragione_sociale}?

Questa azione  irreversibile!`))return;const q=await d("fornitori",j.id);q.success?alert(" Fornitore eliminato!"):alert(" Errore: "+q.error)},z=j=>{_({ragioneSociale:j.ragione_sociale,ragione_sociale:j.ragione_sociale,piva:j.partita_iva,partita_iva:j.partita_iva,codiceFiscale:j.codice_fiscale,codice_fiscale:j.codice_fiscale,iban:j.iban,email:j.email,pec:j.pec,telefono:j.telefono,cellulare:j.cellulare,indirizzo:j.indirizzo,citta:j.citta,cap:j.cap,provincia:j.provincia,categoria:j.categoria,referente:j.referente,sitoWeb:j.sito_web,sito_web:j.sito_web,note:j.note,attivo:j.attivo}),b(j.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},L=F.useMemo(()=>{if(!u)return o;const j=u.toLowerCase();return o.filter(q=>q.ragione_sociale?.toLowerCase().includes(j)||q.partita_iva?.toLowerCase().includes(j)||q.codice_fiscale?.toLowerCase().includes(j)||q.email?.toLowerCase().includes(j))},[o,u]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("input",{type:"text",placeholder:" Cerca per ragione sociale, P.IVA, CF o email...",className:"border rounded px-3 py-2 w-96",value:u,onChange:j=>m(j.target.value)}),a.jsx("button",{onClick:()=>{g(!0),b(null),_({})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Fornitore"})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuovo"," Fornitore"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("input",{type:"text",placeholder:"Ragione Sociale *",className:"border rounded px-3 py-2 col-span-2",value:p.ragioneSociale||"",onChange:j=>_({...p,ragioneSociale:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Partita IVA",className:"border rounded px-3 py-2",value:p.piva||"",onChange:j=>_({...p,piva:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Codice Fiscale",className:"border rounded px-3 py-2",value:p.codiceFiscale||"",onChange:j=>_({...p,codiceFiscale:j.target.value}),disabled:S}),a.jsxs("div",{className:"relative col-span-2",children:[a.jsx("input",{type:"text",placeholder:"IBAN",className:`border rounded px-3 py-2 w-full ${p.iban&&!Lt(p.iban)?"border-red-500 bg-red-50":p.iban&&Lt(p.iban)?"border-green-500 bg-green-50":""}`,value:p.iban||"",onChange:j=>_({...p,iban:j.target.value.toUpperCase()}),disabled:S}),p.iban&&!Lt(p.iban)&&a.jsx("span",{className:"text-red-500 text-xs mt-1 block",children:" IBAN non valido"}),p.iban&&Lt(p.iban)&&a.jsx("span",{className:"text-green-600 text-xs mt-1 block",children:" IBAN valido"})]}),a.jsx("input",{type:"email",placeholder:"Email",className:"border rounded px-3 py-2",value:p.email||"",onChange:j=>_({...p,email:j.target.value}),disabled:S}),a.jsx("input",{type:"email",placeholder:"PEC",className:"border rounded px-3 py-2",value:p.pec||"",onChange:j=>_({...p,pec:j.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Telefono",className:"border rounded px-3 py-2",value:p.telefono||"",onChange:j=>_({...p,telefono:j.target.value}),disabled:S}),a.jsx("input",{type:"tel",placeholder:"Cellulare",className:"border rounded px-3 py-2",value:p.cellulare||"",onChange:j=>_({...p,cellulare:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Indirizzo",className:"border rounded px-3 py-2 col-span-2",value:p.indirizzo||"",onChange:j=>_({...p,indirizzo:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Citt",className:"border rounded px-3 py-2",value:p.citta||"",onChange:j=>_({...p,citta:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"CAP",className:"border rounded px-3 py-2",value:p.cap||"",onChange:j=>_({...p,cap:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Provincia",className:"border rounded px-3 py-2",value:p.provincia||"",onChange:j=>_({...p,provincia:j.target.value.toUpperCase()}),maxLength:"2",disabled:S}),a.jsxs("select",{className:"border rounded px-3 py-2",value:p.categoria||"",onChange:j=>_({...p,categoria:j.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Categoria Fornitore"}),a.jsx("option",{value:"Materiali edili",children:"Materiali edili"}),a.jsx("option",{value:"Ferramenta",children:"Ferramenta"}),a.jsx("option",{value:"Noleggio",children:"Noleggio"}),a.jsx("option",{value:"Carburanti",children:"Carburanti"}),a.jsx("option",{value:"Utenze",children:"Utenze"}),a.jsx("option",{value:"Assicurazioni",children:"Assicurazioni"}),a.jsx("option",{value:"Servizi",children:"Servizi"}),a.jsx("option",{value:"Consulenza",children:"Consulenza"}),a.jsx("option",{value:"Altro",children:"Altro"})]}),a.jsx("input",{type:"text",placeholder:"Referente",className:"border rounded px-3 py-2",value:p.referente||"",onChange:j=>_({...p,referente:j.target.value}),disabled:S}),a.jsx("input",{type:"text",placeholder:"Sito Web",className:"border rounded px-3 py-2",value:p.sitoWeb||"",onChange:j=>_({...p,sitoWeb:j.target.value}),disabled:S}),a.jsx("textarea",{placeholder:"Note (optional)",className:"border rounded px-3 py-2 col-span-2",rows:"3",value:p.note||"",onChange:j=>_({...p,note:j.target.value}),disabled:S})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:O,disabled:!p.ragioneSociale||S,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-gray-300",children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium whitespace-nowrap",children:"Ragione Sociale"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium whitespace-nowrap",children:"Contatti"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium whitespace-nowrap",children:"IBAN"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium whitespace-nowrap",children:"Azioni"})]})}),a.jsx("tbody",{children:L.map(j=>a.jsxs("tr",{className:"hover:bg-gray-50 border-t",children:[a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("div",{className:"font-medium text-blue-600",children:j.ragione_sociale}),j.partita_iva&&a.jsxs("div",{className:"text-xs text-gray-500",children:["P.IVA: ",j.partita_iva]})]}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsxs("div",{className:"space-y-1",children:[j.email&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[a.jsx("span",{children:""}),a.jsx("a",{href:`mailto:${j.email}`,className:"text-blue-600 hover:underline",children:j.email})]}),(j.telefono||j.cellulare)&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[a.jsx("span",{children:""}),a.jsx("span",{children:j.telefono||j.cellulare})]}),!j.email&&!j.telefono&&!j.cellulare&&a.jsx("span",{className:"text-gray-400",children:"-"})]})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:j.iban?a.jsx("div",{className:"font-mono text-xs",children:j.iban}):a.jsx("span",{className:"text-gray-400",children:"-"})}),a.jsxs("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:[a.jsx("button",{onClick:()=>z(j),className:"text-blue-600 mr-2 hover:text-blue-800",children:""}),a.jsx("button",{onClick:()=>T(j),className:"text-red-600 hover:text-red-800",children:""})]})]},j.id))})]}),L.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-2",children:""}),a.jsx("p",{children:"Nessun fornitore trovato"})]})]}),L.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:" Dettagli Fornitori"}),L.map(j=>a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-xl font-bold text-blue-600",children:j.ragione_sociale}),j.categoria&&a.jsx("span",{className:"inline-block mt-2 px-3 py-1 rounded text-xs bg-blue-100 text-blue-700 font-medium",children:j.categoria})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>z(j),className:"text-blue-600 hover:text-blue-800 text-xl",children:""}),a.jsx("button",{onClick:()=>T(j),className:"text-red-600 hover:text-red-800 text-xl",children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[j.partita_iva&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"P.IVA:"})," ",j.partita_iva]}),j.codice_fiscale&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"CF:"})," ",j.codice_fiscale]}),j.iban&&a.jsxs("div",{className:"col-span-full",children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"IBAN:"}),a.jsx("span",{className:"font-mono text-xs ml-2",children:j.iban})]}),j.telefono&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Tel:"})," ",j.telefono]}),j.cellulare&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Cell:"})," ",j.cellulare]}),j.email&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Email:"}),a.jsx("a",{href:`mailto:${j.email}`,className:"text-blue-600 hover:underline ml-1",children:j.email})]}),j.pec&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"PEC:"})," ",j.pec]}),j.sito_web&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Sito:"}),a.jsx("a",{href:j.sito_web,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline ml-1",children:j.sito_web})]}),j.referente&&a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Referente:"})," ",j.referente]}),(j.indirizzo||j.citta)&&a.jsxs("div",{className:"col-span-full",children:[a.jsx("span",{className:"text-gray-600 font-medium",children:"Indirizzo:"}),j.indirizzo&&a.jsxs("span",{children:[" ",j.indirizzo]}),j.cap&&a.jsxs("span",{children:[", ",j.cap]}),j.citta&&a.jsxs("span",{children:[" ",j.citta]}),j.provincia&&a.jsxs("span",{children:[" (",j.provincia,")"]})]})]}),j.note&&a.jsx("div",{className:"mt-4 pt-4 border-t",children:a.jsxs("p",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:" Note:"})," ",j.note]})})]},j.id))]})]})}function oy(){const{sal:o=[],cantieri:s=[],loading:l,addRecord:r,updateRecord:d,deleteRecord:u}=wt(),[m,x]=F.useState(!1),[g,f]=F.useState(null),[b,p]=F.useState({}),[_,S]=F.useState(!1),[N,O]=F.useState(""),T=M=>{if(!M)return"-";const k=new Date(M);return isNaN(k.getTime())?M:k.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},z=F.useMemo(()=>o.filter(M=>!(N&&M.cantiere_id!==N)).sort((M,k)=>new Date(k.data_sal)-new Date(M.data_sal)),[o,N]),L=F.useMemo(()=>{if(!N)return null;const M=o.filter(pe=>pe.cantiere_id===N),k=M.reduce((pe,be)=>pe+(parseFloat(be.importo)||0),0),te=M.length,ue=s.find(pe=>pe.id===N),de=ue&&parseFloat(ue.importo_lavori)||0,ve=de>0?(k/de*100).toFixed(2):0,ie=de-k;return{totaleImporto:k,numeroSAL:te,percentualeAvanzamento:ve,importoLavori:de,rimanente:ie}},[o,N,s]);if(l.sal||l.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento SAL..."})]})});const j=async()=>{if(!b.cantiereId||!b.numeroSAL||!b.dataSAL||!b.importo||!b.stato)return alert(` Compila tutti i campi obbligatori:
- Cantiere
- Numero SAL
- Data
- Importo
- Stato`);S(!0);const M={cantiere_id:b.cantiereId,numero_sal:b.numeroSAL,data_sal:b.dataSAL,importo:parseFloat(b.importo),percentuale:parseFloat(b.percentuale||0),stato:b.stato,note:b.note||null};let k;g?k=await d("sal",g,M):k=await r("sal",M),S(!1),k.success?(alert(g?" SAL aggiornato!":" SAL creato!"),x(!1),p({}),f(null)):alert(" Errore: "+k.error)},q=async M=>{if(!confirm(` Eliminare il SAL n. ${M.numero_sal}?

Questa azione  irreversibile!`))return;const k=await u("sal",M.id);k.success?alert(" SAL eliminato!"):alert(" Errore: "+k.error)},y=M=>{p({cantiereId:M.cantiere_id,numeroSAL:M.numero_sal,dataSAL:M.data_sal,importo:M.importo,percentuale:M.percentuale,stato:M.stato,note:M.note}),f(M.id),x(!0),window.scrollTo({top:0,behavior:"smooth"})};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("button",{onClick:()=>{x(!0),f(null),p({}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo SAL"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("label",{className:"text-sm font-medium",children:"Filtra per Cantiere:"}),a.jsxs("select",{className:"border rounded px-3 py-2",value:N,onChange:M=>O(M.target.value),children:[a.jsx("option",{value:"",children:"Tutti i cantieri"}),s.map(M=>a.jsx("option",{value:M.id,children:M.nome},M.id))]}),N&&a.jsx("button",{onClick:()=>O(""),className:"text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:" Reset"})]})]}),L&&a.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-green-100 p-6 rounded-lg shadow-lg border-2 border-green-300",children:[a.jsxs("h3",{className:"text-lg font-bold text-green-900 mb-4",children:[" Riepilogo SAL - ",s.find(M=>M.id===N)?.nome]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Numero SAL"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:L.numeroSAL})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Importo Lavori"}),a.jsxs("div",{className:"text-xl font-bold text-blue-900",children:[" ",L.importoLavori.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale SAL"}),a.jsxs("div",{className:"text-xl font-bold text-green-900",children:[" ",L.totaleImporto.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Avanzamento"}),a.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[L.percentualeAvanzamento,"%"]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Rimanente"}),a.jsxs("div",{className:"text-xl font-bold text-orange-900",children:[" ",L.rimanente.toFixed(2)]})]})]})]}),m&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[g?" Modifica":" Nuovo"," SAL"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:b.cantiereId||"",onChange:M=>p({...b,cantiereId:M.target.value}),disabled:_,children:[a.jsx("option",{value:"",children:"Seleziona cantiere"}),s.map(M=>a.jsx("option",{value:M.id,children:M.nome},M.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"N. SAL *"}),a.jsx("input",{type:"text",placeholder:"es: SAL-001",className:"border rounded px-3 py-2 w-full",value:b.numeroSAL||"",onChange:M=>p({...b,numeroSAL:M.target.value}),disabled:_})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data SAL *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:b.dataSAL||"",onChange:M=>p({...b,dataSAL:M.target.value}),disabled:_})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo () *"}),a.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",className:"border rounded px-3 py-2 w-full",value:b.importo||"",onChange:M=>{const k=parseFloat(M.target.value)||0,te=s.find(pe=>pe.id===b.cantiereId),ue=te&&parseFloat(te.importo_lavori)||0,ve=o.filter(pe=>pe.cantiere_id===b.cantiereId&&pe.id!==g).reduce((pe,be)=>pe+(parseFloat(be.importo)||0),0)+k,ie=ue>0?(ve/ue*100).toFixed(2):0;p({...b,importo:M.target.value,percentuale:ie})},disabled:_})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Avanzamento Cumulativo"}),a.jsxs("div",{className:"border rounded px-3 py-2 bg-gray-50 text-lg font-semibold text-purple-700",children:[b.percentuale||0,"%"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stato *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:b.stato||"",onChange:M=>p({...b,stato:M.target.value}),disabled:_,children:[a.jsx("option",{value:"",children:"Seleziona stato"}),a.jsx("option",{value:"bozza",children:" Bozza"}),a.jsx("option",{value:"presentato",children:" Presentato"}),a.jsx("option",{value:"approvato",children:" Approvato"}),a.jsx("option",{value:"pagato",children:" Pagato"})]})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Note aggiuntive...",value:b.note||"",onChange:M=>p({...b,note:M.target.value}),disabled:_})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:j,disabled:_,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:_?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{x(!1),p({}),f(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:_,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Cantiere"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"N. SAL"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Data"}),a.jsx("th",{className:"px-4 py-3 text-right text-sm",children:"Importo"}),a.jsx("th",{className:"px-4 py-3 text-center text-sm",children:"Avanzamento"}),a.jsx("th",{className:"px-4 py-3 text-center text-sm",children:"Stato"}),a.jsx("th",{className:"px-4 py-3 text-center text-sm",children:"Azioni"})]})}),a.jsx("tbody",{children:z.map(M=>{const k=s.find(de=>de.id===M.cantiere_id),te={bozza:"bg-gray-100 text-gray-700",presentato:"bg-blue-100 text-blue-700",approvato:"bg-green-100 text-green-700",pagato:"bg-purple-100 text-purple-700"},ue={bozza:" Bozza",presentato:" Presentato",approvato:" Approvato",pagato:" Pagato"};return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:k?.nome||"N/A"}),a.jsx("td",{className:"px-4 py-3 text-sm font-mono",children:M.numero_sal}),a.jsx("td",{className:"px-4 py-3 text-sm",children:T(M.data_sal)}),a.jsxs("td",{className:"px-4 py-3 text-sm text-right font-mono",children:[" ",parseFloat(M.importo).toFixed(2)]}),a.jsx("td",{className:"px-4 py-3 text-sm text-center",children:a.jsxs("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded font-semibold",children:[parseFloat(M.percentuale||0).toFixed(1),"%"]})}),a.jsx("td",{className:"px-4 py-3 text-sm text-center",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${te[M.stato]}`,children:ue[M.stato]||M.stato})}),a.jsxs("td",{className:"px-4 py-3 text-sm text-center",children:[a.jsx("button",{onClick:()=>y(M),className:"text-blue-600 mr-2 text-lg",children:""}),a.jsx("button",{onClick:()=>q(M),className:"text-red-600 text-lg",children:""})]})]},M.id)})})]}),z.length===0&&N&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-2xl mb-2",children:""}),a.jsx("p",{children:"Nessun SAL trovato per questo cantiere"}),a.jsx("button",{onClick:()=>O(""),className:"mt-2 text-blue-600 hover:underline text-sm",children:" Cancella filtro"})]}),z.length===0&&!N&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessun SAL registrato"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Clicca su " Nuovo SAL" per iniziare'})]})]})]})}function cy(){const{documenti:o=[],loading:s,addRecord:l,updateRecord:r,deleteRecord:d}=wt(),[u,m]=F.useState(!1),[x,g]=F.useState(null),[f,b]=F.useState({}),[p,_]=F.useState(!1),[S,N]=F.useState(null),[O,T]=F.useState(new Date().toISOString().split("T")[0]),[z,L]=F.useState(""),[j,q]=F.useState(""),[y,M]=F.useState(!1),k=ie=>{if(!ie)return"-";const pe=new Date(ie);return isNaN(pe.getTime())?ie:pe.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},te=async()=>{if(!f.tipo||!f.nome)return alert(" Compila i campi obbligatori (Tipo e Nome)");M(!0);const ie={tipo:f.tipo,nome:f.nome,data_emissione:f.dataEmissione||null,data_scadenza:f.dataScadenza||null,numero_documento:f.numeroDocumento||null,ente_rilascio:f.enteRilascio||null,note:f.note||null,storico:f.storico||[]};let pe;x?pe=await r("documenti",x,ie):pe=await l("documenti",ie),M(!1),pe.success?(alert(x?" Certificazione aggiornata!":" Certificazione creata!"),m(!1),b({}),g(null)):alert(" Errore: "+pe.error)},ue=ie=>{b({tipo:ie.tipo,nome:ie.nome,dataEmissione:ie.data_emissione,dataScadenza:ie.data_scadenza,numeroDocumento:ie.numero_documento,enteRilascio:ie.ente_rilascio,note:ie.note,storico:ie.storico||[]}),g(ie.id),m(!0),window.scrollTo({top:0,behavior:"smooth"})},de=async ie=>{if(!confirm(` Eliminare ${ie.nome}?

Questa azione  irreversibile!`))return;const pe=await d("documenti",ie.id);pe.success?alert(" Certificazione eliminata!"):alert(" Errore: "+pe.error)},ve=async ie=>{if(!z)return alert(" Inserisci la nuova scadenza");const pe=o.find(U=>U.id===ie);if(!pe)return;const be={id:Date.now().toString(),dataAggiornamento:O,scadenzaPrecedente:pe.data_scadenza,nuovaScadenza:z,nota:j},H=await r("documenti",ie,{data_scadenza:z,storico:[...pe.storico||[],be]});H.success?(alert(" Aggiornamento registrato!"),T(new Date().toISOString().split("T")[0]),L(""),q(""),N(H.data)):alert(" Errore: "+H.error)};return s.documenti?a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento certificazioni..."})]})}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:()=>{m(!0),g(null),b({}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuova Certificazione"}),u&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[x?" Modifica":" Nuova"," Certificazione"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:f.tipo||"",onChange:ie=>b({...f,tipo:ie.target.value}),disabled:y,children:[a.jsx("option",{value:"",children:"Seleziona tipo"}),a.jsx("option",{value:"contratto",children:"Contratto"}),a.jsx("option",{value:"certificato",children:"Certificato"}),a.jsx("option",{value:"autorizzazione",children:"Autorizzazione"}),a.jsx("option",{value:"durc",children:"DURC"}),a.jsx("option",{value:"visura",children:"Visura"}),a.jsx("option",{value:"polizza",children:"Polizza Assicurativa"}),a.jsx("option",{value:"altro",children:"Altro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome *"}),a.jsx("input",{type:"text",placeholder:"Nome certificazione",className:"border rounded px-3 py-2 w-full",value:f.nome||"",onChange:ie=>b({...f,nome:ie.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Emissione"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:f.dataEmissione||"",onChange:ie=>b({...f,dataEmissione:ie.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Scadenza"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:f.dataScadenza||"",onChange:ie=>b({...f,dataScadenza:ie.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Documento"}),a.jsx("input",{type:"text",placeholder:"Es: ABC123/2025",className:"border rounded px-3 py-2 w-full",value:f.numeroDocumento||"",onChange:ie=>b({...f,numeroDocumento:ie.target.value}),disabled:y})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ente Rilascio"}),a.jsx("input",{type:"text",placeholder:"Es: Camera di Commercio",className:"border rounded px-3 py-2 w-full",value:f.enteRilascio||"",onChange:ie=>b({...f,enteRilascio:ie.target.value}),disabled:y})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Note aggiuntive...",value:f.note||"",onChange:ie=>b({...f,note:ie.target.value}),disabled:y})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:te,disabled:y,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:y?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{m(!1),b({}),g(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:y,children:" Annulla"})]})]}),a.jsx("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Tipo"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Nome"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"N. Documento"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Ente Rilascio"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Emissione"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Scadenza"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Azioni"})]})}),a.jsx("tbody",{children:o.length===0?a.jsx("tr",{children:a.jsxs("td",{colSpan:"7",className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessuna certificazione registrata"})]})}):o.map(ie=>a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:"px-2 py-1 rounded text-xs bg-blue-100",children:ie.tipo})}),a.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:ie.nome}),a.jsx("td",{className:"px-4 py-3 text-sm",children:ie.numero_documento||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:ie.ente_rilascio||"-"}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k(ie.data_emissione)}),a.jsx("td",{className:"px-4 py-3 text-sm",children:k(ie.data_scadenza)}),a.jsxs("td",{className:"px-4 py-3 text-sm",children:[a.jsx("button",{onClick:()=>{N(ie),_(!0)},className:"text-purple-600 hover:text-purple-700 mr-2",title:"Visualizza storico",children:""}),a.jsx("button",{onClick:()=>ue(ie),className:"text-blue-600 hover:text-blue-700 mr-2",children:""}),a.jsx("button",{onClick:()=>de(ie),className:"text-red-600 hover:text-red-700",children:""})]})]},ie.id))})]})}),p&&S&&a.jsx(dy,{certificazione:S,onClose:()=>{_(!1),N(null)},dataAggiornamento:O,setDataAggiornamento:T,nuovaScadenza:z,setNuovaScadenza:L,notaAggiornamento:j,setNotaAggiornamento:q,aggiungiAggiornamento:ve,formatDate:k})]})}function dy({certificazione:o,onClose:s,dataAggiornamento:l,setDataAggiornamento:r,nuovaScadenza:d,setNuovaScadenza:u,notaAggiornamento:m,setNotaAggiornamento:x,aggiungiAggiornamento:g,formatDate:f}){return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Storico - ",o.nome]}),a.jsx("div",{className:"bg-gray-50 p-3 rounded mb-4 text-sm",children:a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Tipo:"})," ",o.tipo]}),o.numero_documento&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"N. Documento:"})," ",o.numero_documento]}),o.ente_rilascio&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Ente Rilascio:"})," ",o.ente_rilascio]})]})}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Scadenza Attuale"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:f(o.data_scadenza)})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg mb-4 border border-green-200",children:[a.jsx("h4",{className:"font-medium mb-3 text-green-900",children:" Registra Aggiornamento/Rinnovo"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Aggiornamento"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:l,onChange:b=>r(b.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nuova Scadenza *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:d,onChange:b=>u(b.target.value)})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>g(o.id),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full",children:" Aggiungi"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note (opzionale)"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Es: Certificazione rinnovata presso ente Y, nuovo protocollo ABC123...",value:m,onChange:b=>x(b.target.value)})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3",children:["Storico Aggiornamenti (",(o.storico||[]).length,")"]}),(o.storico||[]).length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Nessun aggiornamento registrato. Usa il form sopra per registrare rinnovi."}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data Aggiornamento"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Scadenza Precedente"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Nuova Scadenza"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Note"})]})}),a.jsx("tbody",{children:[...o.storico||[]].reverse().map(b=>a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2",children:f(b.dataAggiornamento)}),a.jsx("td",{className:"px-3 py-2 text-red-600 line-through",children:f(b.scadenzaPrecedente)}),a.jsx("td",{className:"px-3 py-2 text-green-600 font-semibold",children:f(b.nuovaScadenza)}),a.jsx("td",{className:"px-3 py-2 text-gray-600",children:b.nota||"-"})]},b.id))})]})})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:s,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Chiudi"})})]})})}function uy(){const{cassaEdileLavoratori:o=[],cassaEdileTotali:s=[],lavoratori:l=[],cantieri:r=[],loading:d,addRecord:u,updateRecord:m,deleteRecord:x}=wt(),[g,f]=F.useState(0),[b,p]=F.useState(null),[_,S]=F.useState(null),[N,O]=F.useState(!1),[T,z]=F.useState({lavoratoreId:"",cantiereId:"",giornoInizio:1,giornoFine:1,mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0}),[L,j]=F.useState({cassaEdile:"",mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0}),[q,y]=F.useState(new Date().getMonth()+1),[M,k]=F.useState(new Date().getFullYear()),[te,ue]=F.useState(""),[de,ve]=F.useState(new Date().getMonth()+1),[ie,pe]=F.useState(new Date().getFullYear()),[be,H]=F.useState({}),U=[{key:"accant",label:"accant."},{key:"contr",label:"contr."},{key:"previdenz",label:"previdenz."},{key:"fondo_sai",label:"fondo sai"},{key:"fondo_oc",label:"fondo oc"},{key:"acc_mal",label:"acc. mal"},{key:"ape",label:"ape"}],D=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];if(d.cassaEdileLavoratori||d.cassaEdileTotali||d.lavoratori||d.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento Cassa Edile..."})]})});const R=F.useMemo(()=>[...new Set(r.map(Q=>Q.casse_edile).filter(Boolean))],[r]),E=F.useMemo(()=>o.filter(Q=>Q.mese===q&&Q.anno===M),[o,q,M]),V=F.useMemo(()=>s.filter(Q=>Q.mese===q&&Q.anno===M),[s,q,M]),w=async()=>{if(!T.lavoratoreId||!T.cantiereId)return alert(" Seleziona lavoratore e cantiere!");O(!0);const Q={lavoratore_id:T.lavoratoreId,cantiere_id:T.cantiereId,mese:T.mese,anno:T.anno,giorno_inizio:T.giornoInizio,giorno_fine:T.giornoFine,accant:parseFloat(T.accant)||0,contr:parseFloat(T.contr)||0,previdenz:parseFloat(T.previdenz)||0,fondo_sai:parseFloat(T.fondo_sai)||0,fondo_oc:parseFloat(T.fondo_oc)||0,acc_mal:parseFloat(T.acc_mal)||0,ape:parseFloat(T.ape)||0};let P;b?P=await m("cassaEdileLavoratori",b,Q):P=await u("cassaEdileLavoratori",Q),O(!1),P.success?(z({lavoratoreId:"",cantiereId:"",giornoInizio:1,giornoFine:1,mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0}),p(null),alert(b?" Cifre aggiornate!":" Cifre salvate!")):alert(" Errore: "+P.error)},A=async Q=>{if(!confirm(` Eliminare questa voce?

Questa azione  irreversibile!`))return;const P=await x("cassaEdileLavoratori",Q);P.success?alert(" Voce eliminata!"):alert(" Errore: "+P.error)},I=Q=>{z({lavoratoreId:Q.lavoratore_id,cantiereId:Q.cantiere_id,giornoInizio:Q.giorno_inizio,giornoFine:Q.giorno_fine,mese:Q.mese,anno:Q.anno,accant:Q.accant,contr:Q.contr,previdenz:Q.previdenz,fondo_sai:Q.fondo_sai,fondo_oc:Q.fondo_oc,acc_mal:Q.acc_mal,ape:Q.ape}),p(Q.id),f(0),window.scrollTo({top:0,behavior:"smooth"})},K=async()=>{if(!L.cassaEdile)return alert(" Seleziona una cassa edile!");O(!0);const Q={cassa_edile:L.cassaEdile,mese:L.mese,anno:L.anno,accant:parseFloat(L.accant)||0,contr:parseFloat(L.contr)||0,previdenz:parseFloat(L.previdenz)||0,fondo_sai:parseFloat(L.fondo_sai)||0,fondo_oc:parseFloat(L.fondo_oc)||0,acc_mal:parseFloat(L.acc_mal)||0,ape:parseFloat(L.ape)||0};let P;_?P=await m("cassaEdileTotali",_,Q):P=await u("cassaEdileTotali",Q),O(!1),P.success?(j({cassaEdile:"",mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0}),S(null),alert(_?" Totali aggiornati!":" Totali salvati!")):alert(" Errore: "+P.error)},ee=async Q=>{if(!confirm(` Eliminare questa voce?

Questa azione  irreversibile!`))return;const P=await x("cassaEdileTotali",Q);P.success?alert(" Voce eliminata!"):alert(" Errore: "+P.error)},ne=Q=>{j({cassaEdile:Q.cassa_edile,mese:Q.mese,anno:Q.anno,accant:Q.accant,contr:Q.contr,previdenz:Q.previdenz,fondo_sai:Q.fondo_sai,fondo_oc:Q.fondo_oc,acc_mal:Q.acc_mal,ape:Q.ape}),S(Q.id),f(1),window.scrollTo({top:0,behavior:"smooth"})},me=()=>{if(!te)return alert(" Seleziona una cassa edile!");const Q=r.filter(he=>he.casse_edile===te).map(he=>he.id),P={};U.forEach(({key:he})=>{let ce=0;o.forEach(nt=>{Q.includes(nt.cantiere_id)&&nt.mese===q&&nt.anno===M&&(ce+=parseFloat(nt[he])||0)});const we=s.find(nt=>nt.cassa_edile===te&&nt.mese===q&&nt.anno===M),Ne=we&&parseFloat(we[he])||0,Ve=ce-Ne;P[he]={sommaLavoratori:ce,totaleCassa:Ne,differenza:Ve,alert:Math.abs(Ve)>.01}}),H(P)},ke=F.useMemo(()=>{const Q={};return r.forEach(P=>{const he=P.casse_edile;if(!he)return;const we=o.filter(Ne=>Ne.cantiere_id===P.id&&Ne.mese===de&&Ne.anno===ie).reduce((Ne,Ve)=>Ne+U.reduce((nt,{key:pt})=>nt+(parseFloat(Ve[pt])||0),0),0);Q[he]||(Q[he]={}),Q[he][P.nome]=we}),Q},[r,o,de,ie,U]),$e=()=>{const Q=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Report Casse Edili - ${D[de-1]} ${ie}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; }
    h2 { color: #3b82f6; margin-top: 30px; }
    .info { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; }
    th, td { border: 1px solid #333; padding: 12px; text-align: left; }
    th { background-color: #3b82f6; color: white; font-weight: bold; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .total { font-weight: bold; text-align: right; }
    .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #ccc; padding-top: 20px; }
    @media print { .no-print { display: none; } body { margin: 0; } }
  </style>
</head>
<body>
  <button class="no-print" onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">
     Stampa / Salva PDF
  </button>
  <h1> Report Casse Edili</h1>
  <div class="info">
    <strong>Azienda:</strong> Marrel S.r.l.<br>
    <strong>Periodo:</strong> ${D[de-1]} ${ie}<br>
    <strong>Data generazione:</strong> ${new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}
  </div>
  ${Object.entries(ke).map(([he,ce])=>{const we=Object.values(ce).reduce((Ne,Ve)=>Ne+Ve,0);return`
    <h2>Cassa Edile: ${he}</h2>
    <table>
      <thead>
        <tr>
          <th style="width: 70%">Cantiere</th>
          <th style="width: 30%; text-align: right">Totale Contributi ()</th>
        </tr>
      </thead>
      <tbody>
        ${Object.entries(ce).map(([Ne,Ve])=>`
        <tr>
          <td>${Ne}</td>
          <td class="total">${Ve.toFixed(2)}</td>
        </tr>
        `).join("")}
        <tr style="background-color: #dbeafe; font-weight: bold;">
          <td>TOTALE ${he}</td>
          <td class="total">${we.toFixed(2)}</td>
        </tr>
      </tbody>
    </table>
    `}).join("")}
  <div class="footer">
    <p>Gestionale Marrel S.r.l. - Report Casse Edili</p>
    <p>Documento generato automaticamente dal sistema</p>
  </div>
</body>
</html>`,P=window.open("","_blank");P.document.write(Q),P.document.close()},St=["Cifre Lavoratore","Totali Casse","Controllo","Report"];return a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:a.jsx("p",{className:"text-sm text-blue-700",children:" Sistema calcolo contributi Cassa Edile integrato con cantieri e lavoratori"})}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:St.map((Q,P)=>a.jsx("button",{className:`px-4 py-2 rounded whitespace-nowrap ${g===P?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300"}`,onClick:()=>f(P),children:Q},P))}),g===0&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[b?" Modifica":" Nuove"," Cifre Lavoratore"]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lavoratore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:T.lavoratoreId,onChange:Q=>z({...T,lavoratoreId:Q.target.value}),disabled:N,children:[a.jsx("option",{value:"",children:"Seleziona lavoratore"}),l.map(Q=>a.jsxs("option",{value:Q.id,children:[Q.nome," ",Q.cognome]},Q.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:T.cantiereId,onChange:Q=>z({...T,cantiereId:Q.target.value}),disabled:N,children:[a.jsx("option",{value:"",children:"Seleziona cantiere"}),r.map(Q=>a.jsx("option",{value:Q.id,children:Q.nome},Q.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Periodo (gg)"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("input",{type:"number",min:"1",max:"31",className:"border rounded px-3 py-2",value:T.giornoInizio,onChange:Q=>z({...T,giornoInizio:Number(Q.target.value)}),disabled:N}),a.jsx("input",{type:"number",min:"1",max:"31",className:"border rounded px-3 py-2",value:T.giornoFine,onChange:Q=>z({...T,giornoFine:Number(Q.target.value)}),disabled:N})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese/Anno"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("select",{className:"border rounded px-3 py-2",value:T.mese,onChange:Q=>z({...T,mese:Number(Q.target.value)}),disabled:N,children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:P+1},P))}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:T.anno,onChange:Q=>z({...T,anno:Number(Q.target.value)}),disabled:N})]})]})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:U.map(({key:Q,label:P})=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:P}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:T[Q]===0?"":T[Q],onChange:he=>z({...T,[Q]:he.target.value}),disabled:N})]},Q))}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:w,disabled:N,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:N?" Salvataggio...":" Salva"}),b&&a.jsx("button",{onClick:()=>{p(null),z({lavoratoreId:"",cantiereId:"",giornoInizio:1,giornoFine:1,mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0})},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:N,children:" Annulla"})]})]}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsx("select",{className:"border rounded px-3 py-2",value:q,onChange:Q=>y(Number(Q.target.value)),children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:Q},P))}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:M,onChange:Q=>k(Number(Q.target.value))})]})}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Lavoratore"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Cantiere"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Periodo"}),U.map(({key:Q,label:P})=>a.jsx("th",{className:"px-3 py-2 text-right",children:P},Q)),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:E.map(Q=>{const P=l.find(ce=>ce.id===Q.lavoratore_id),he=r.find(ce=>ce.id===Q.cantiere_id);return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2",children:P?`${P.nome} {lav.cognome}`:"N/A"}),a.jsx("td",{className:"px-3 py-2",children:he?.nome||"N/A"}),a.jsxs("td",{className:"px-3 py-2 text-center text-xs",children:[Q.giorno_inizio,"-",Q.giorno_fine]}),U.map(({key:ce})=>a.jsx("td",{className:"px-3 py-2 text-right font-mono",children:parseFloat(Q[ce]||0).toFixed(2)},ce)),a.jsxs("td",{className:"px-3 py-2 text-center",children:[a.jsx("button",{onClick:()=>I(Q),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>A(Q.id),className:"text-red-600",children:""})]})]},Q.id)})})]}),E.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessuna cifra registrata per questo periodo"})]})]})]}),g===1&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[_?" Modifica":" Nuovi"," Totali Cassa Edile"]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cassa Edile *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:L.cassaEdile,onChange:Q=>j({...L,cassaEdile:Q.target.value}),disabled:N,children:[a.jsx("option",{value:"",children:"Seleziona cassa"}),R.map(Q=>a.jsx("option",{value:Q,children:Q},Q))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese"}),a.jsx("select",{className:"border rounded px-3 py-2 w-full",value:L.mese,onChange:Q=>j({...L,mese:Number(Q.target.value)}),disabled:N,children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:Q},P))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Anno"}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2 w-full",value:L.anno,onChange:Q=>j({...L,anno:Number(Q.target.value)}),disabled:N})]})]}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:U.map(({key:Q,label:P})=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:P}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:L[Q]===0?"":L[Q],onChange:he=>j({...L,[Q]:he.target.value}),disabled:N})]},Q))}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:K,disabled:N,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:N?" Salvataggio...":" Salva"}),_&&a.jsx("button",{onClick:()=>{S(null),j({cassaEdile:"",mese:new Date().getMonth()+1,anno:new Date().getFullYear(),accant:0,contr:0,previdenz:0,fondo_sai:0,fondo_oc:0,acc_mal:0,ape:0})},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:N,children:" Annulla"})]})]}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsx("select",{className:"border rounded px-3 py-2",value:q,onChange:Q=>y(Number(Q.target.value)),children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:Q},P))}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:M,onChange:Q=>k(Number(Q.target.value))})]})}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Cassa Edile"}),U.map(({key:Q,label:P})=>a.jsx("th",{className:"px-3 py-2 text-right",children:P},Q)),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:V.map(Q=>a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2 font-medium",children:Q.cassa_edile}),U.map(({key:P})=>a.jsx("td",{className:"px-3 py-2 text-right font-mono",children:parseFloat(Q[P]||0).toFixed(2)},P)),a.jsxs("td",{className:"px-3 py-2 text-center",children:[a.jsx("button",{onClick:()=>ne(Q),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>ee(Q.id),className:"text-red-600",children:""})]})]},Q.id))})]}),V.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessun totale registrato per questo periodo"})]})]})]}),g===2&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-xl font-semibold",children:" Controllo Discrepanze"}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("select",{className:"border rounded px-3 py-2 flex-1",value:te,onChange:Q=>ue(Q.target.value),children:[a.jsx("option",{value:"",children:"Seleziona Cassa Edile"}),R.map(Q=>a.jsx("option",{value:Q,children:Q},Q))]}),a.jsx("select",{className:"border rounded px-3 py-2",value:q,onChange:Q=>y(Number(Q.target.value)),children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:Q},P))}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:M,onChange:Q=>k(Number(Q.target.value))}),a.jsx("button",{onClick:me,className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600",children:" Calcola"})]})}),Object.keys(be).length>0&&a.jsx("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left",children:"Voce"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Somma Lavoratori"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Totale Cassa"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Differenza"})]})}),a.jsx("tbody",{children:U.map(({key:Q,label:P})=>{const he=be[Q];return he?a.jsxs("tr",{className:`border-t ${he.alert?"bg-red-50":""}`,children:[a.jsx("td",{className:"px-4 py-3 font-medium",children:P}),a.jsxs("td",{className:"px-4 py-3 text-right font-mono",children:[" ",he.sommaLavoratori.toFixed(2)]}),a.jsxs("td",{className:"px-4 py-3 text-right font-mono",children:[" ",he.totaleCassa.toFixed(2)]}),a.jsx("td",{className:"px-4 py-3 text-right font-mono",children:a.jsxs("span",{className:he.alert?"text-red-600 font-bold":"",children:[" ",he.differenza.toFixed(2)," ",he.alert&&""]})})]},Q):null})})]})})]}),g===3&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-xl font-semibold",children:" Report Cantieri per Cassa"}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:a.jsxs("div",{className:"flex gap-4 items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese"}),a.jsx("select",{className:"border rounded px-3 py-2",value:de,onChange:Q=>ve(Number(Q.target.value)),children:D.map((Q,P)=>a.jsx("option",{value:P+1,children:Q},P))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Anno"}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:ie,onChange:Q=>pe(Number(Q.target.value))})]}),a.jsx("button",{onClick:$e,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:" Esporta PDF"})]})}),Object.entries(ke).map(([Q,P])=>{const he=Object.values(P).reduce((ce,we)=>ce+we,0);return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h4",{className:"text-lg font-semibold text-blue-700 mb-4",children:Q}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left",children:"Cantiere"}),a.jsx("th",{className:"px-4 py-3 text-right",children:"Totale Contributi ()"})]})}),a.jsxs("tbody",{children:[Object.entries(P).map(([ce,we])=>a.jsxs("tr",{className:"border-t",children:[a.jsx("td",{className:"px-4 py-3",children:ce}),a.jsx("td",{className:"px-4 py-3 text-right font-mono",children:we.toFixed(2)})]},ce)),a.jsxs("tr",{className:"border-t-2 bg-blue-50 font-bold",children:[a.jsxs("td",{className:"px-4 py-3",children:["TOTALE ",Q]}),a.jsxs("td",{className:"px-4 py-3 text-right font-mono text-lg",children:[" ",he.toFixed(2)]})]})]})]})})]},Q)}),Object.keys(ke).length===0&&a.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessun dato disponibile per il periodo selezionato"})]})]})]})}function hy(){const{lavoratori:o=[],unilav:s=[],certificazioni:l=[],veicoli:r=[],cantieri:d=[],documenti:u=[],rateizzi:m=[],rate:x=[],loading:g}=wt();if(g.lavoratori||g.unilav||g.certificazioni||g.veicoli||g.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento scadenzario..."})]})});const f=S=>{if(!S)return"-";const N=new Date(S);return isNaN(N.getTime())?S:N.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},b=F.useMemo(()=>{const S=new Date,N=[];return l.forEach(O=>{if(O.data_scadenza){const T=o.find(j=>j.id===O.lavoratore_id);if(!T)return;const z=new Date(O.data_scadenza),L=Math.ceil((z-S)/(1e3*60*60*24));L<=30&&L>=-30&&N.push({tipo:O.tipo,descrizione:`${O.tipo==="corso"?"Corso":"Visita"}: ${O.nome}`,lavoratore:`${T.nome} ${T.cognome}`,scadenza:O.data_scadenza,giorniMancanti:L})}}),r.forEach(O=>{["assicurazione","revisione"].forEach(T=>{const z=T==="assicurazione"?"scadenza_assicurazione":"scadenza_revisione";if(O[z]){const L=new Date(O[z]),j=Math.ceil((L-S)/(1e3*60*60*24));j<=30&&j>=-30&&N.push({tipo:T,descrizione:`${T.charAt(0).toUpperCase()+T.slice(1)} ${O.targa}`,lavoratore:O.modello,scadenza:O[z],giorniMancanti:j})}})}),d.forEach(O=>{if(O.scadenza_dnlt){const T=new Date(O.scadenza_dnlt),z=Math.ceil((T-S)/(1e3*60*60*24));z<=30&&z>=-30&&N.push({tipo:"dnlt",descrizione:"Scadenza DNLT",lavoratore:`${O.nome}${O.stato==="completato"?" (Completato)":""}`,scadenza:O.scadenza_dnlt,giorniMancanti:z})}}),o.forEach(O=>{const T=s.filter(z=>z.lavoratore_id===O.id);if(T.length>0){const z=T.sort((L,j)=>{const q=new Date(L.data_inizio||"1900-01-01");return new Date(j.data_inizio||"1900-01-01")-q})[0];if(z.tipo_contratto==="determinato"&&z.data_fine){const L=new Date(z.data_fine),j=Math.ceil((L-S)/(1e3*60*60*24));if(j<=30&&j>=-30){const q=d.find(M=>M.id===z.cantiere_id),y=T.every(M=>M.tipo_unilav!=="dimissioni"||new Date(M.data_inizio)>S);N.push({tipo:"contratto",descrizione:"Scadenza Contratto",lavoratore:`${O.nome} ${O.cognome}${y?"":" (Non attivo)"} - ${q?q.nome:"N/A"}`,scadenza:z.data_fine,giorniMancanti:j})}}}}),u.forEach(O=>{if(O.data_scadenza){const T=new Date(O.data_scadenza),z=Math.ceil((T-S)/(1e3*60*60*24));if(z<=30&&z>=-30){const L=d.find(j=>j.id===O.riferimento_id);N.push({tipo:"documento",descrizione:`${O.tipo}: ${O.nome}`,lavoratore:L?L.nome:"N/A",scadenza:O.data_scadenza,giorniMancanti:z})}}}),x.forEach(O=>{if(O.data_scadenza&&O.stato!=="pagato"){const T=new Date(O.data_scadenza),z=Math.ceil((T-S)/(1e3*60*60*24));if(z<=30&&z>=-30){const L=m.find(j=>j.id===O.rateizzazione_id);N.push({tipo:"rateizzo",descrizione:L?`Rata ${O.numero_rata} - ${L.nome}`:`Rata ${O.numero_rata}`,lavoratore:` ${parseFloat(O.importo||0).toFixed(2)}`,scadenza:O.data_scadenza,giorniMancanti:z})}}}),N.sort((O,T)=>O.giorniMancanti-T.giorniMancanti)},[l,r,d,s,o,u,m,x]),p=b.filter(S=>S.giorniMancanti>=0),_=b.filter(S=>S.giorniMancanti<0);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Scadenze Imminenti (prossimi 30 giorni)"}),p.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessuna scadenza imminente"})]}):a.jsx("div",{className:"space-y-3",children:p.map((S,N)=>a.jsx("div",{className:`p-4 rounded-lg border-l-4 ${S.giorniMancanti<=7?"bg-red-50 border-red-500":S.giorniMancanti<=15?"bg-orange-50 border-orange-500":"bg-yellow-50 border-yellow-500"}`,children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-semibold mb-1",children:S.descrizione}),a.jsx("p",{className:"text-sm text-gray-600",children:S.lavoratore}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Scadenza: ",f(S.scadenza)]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:`text-2xl font-bold ${S.giorniMancanti<=7?"text-red-600":S.giorniMancanti<=15?"text-orange-600":"text-yellow-600"}`,children:S.giorniMancanti}),a.jsx("div",{className:"text-xs text-gray-600",children:"giorni"})]})]})},N))})]}),_.length>0&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-red-300",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4 text-red-700",children:" Scadenze Passate (ultimi 30 giorni)"}),a.jsx("div",{className:"space-y-3",children:_.map((S,N)=>a.jsx("div",{className:"p-4 rounded-lg border-l-4 bg-red-100 border-red-700",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-semibold mb-1 text-red-800",children:S.descrizione}),a.jsx("p",{className:"text-sm text-red-700",children:S.lavoratore}),a.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Scadenza: ",f(S.scadenza)]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-2xl font-bold text-red-700",children:Math.abs(S.giorniMancanti)}),a.jsx("div",{className:"text-xs text-red-600",children:"giorni fa"})]})]})},N))})]})]})}function my(){const{rateizzi:o=[],noteRateizzi:s=[],loading:l,addRecord:r,updateRecord:d,deleteRecord:u}=wt(),[m,x]=F.useState(!1),[g,f]=F.useState(null),[b,p]=F.useState({nome:"",rate:[]}),[_,S]=F.useState(!1),[N,O]=F.useState({}),[T,z]=F.useState(!1),[L,j]=F.useState(null),[q,y]=F.useState(null),[M,k]=F.useState(""),[te,ue]=F.useState({}),de=A=>{if(!A)return"-";const I=new Date(A);return isNaN(I.getTime())?A:I.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},ve=A=>{if(A.dataPagamento&&A.dataPagamento!=="")return"pagato";const I=new Date,K=new Date(A.dataScadenza),ee=Math.ceil((K-I)/(1e3*60*60*24));return ee<0?"scaduto":ee<=7&&ee>=0?"in_scadenza":"da_pagare"},ie=A=>({...A,rate:(A.rate||[]).map(I=>({...I,stato:ve(I)}))}),pe=A=>{const I=A.rate||[],K=I.reduce((me,ke)=>me+parseFloat(ke.importo||0),0),ee=I.filter(me=>me.stato==="pagato").reduce((me,ke)=>me+parseFloat(ke.importo||0),0),ne=K-ee;return{totale:K,pagato:ee,rimanente:ne}},be=F.useMemo(()=>{let A=0,I=0;o.forEach(ee=>{const ne=pe(ee);A+=ne.totale,I+=ne.pagato});const K=A-I;return{totale:A,pagato:I,rimanente:K,numeroRateizzi:o.length}},[o]);if(l.rateizzi||l.noteRateizzi)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento rateizzi..."})]})});const H=async()=>{if(!b.nome||(b.rate||[]).length===0)return alert(` Compila tutti i campi:
- Nome Rateizzo
- Almeno una rata`);S(!0);const A={nome:b.nome,rate:(b.rate||[]).map(K=>({...K,stato:K.stato||"da_pagare",dataPagamento:K.dataPagamento||""}))};let I;g?I=await d("rateizzi",g,A):I=await r("rateizzi",A),S(!1),I.success?(alert(g?" Rateizzo aggiornato!":" Rateizzo creato!"),x(!1),p({nome:"",rate:[]}),f(null)):alert(" Errore: "+I.error)},U=async A=>{if(!confirm(` Eliminare il rateizzo ${A.nome}?

Questa azione  irreversibile!`))return;const I=await u("rateizzi",A.id);I.success?alert(" Rateizzo eliminato!"):alert(" Errore: "+I.error)},D=A=>{const I={...A,rate:(A.rate||[]).map(K=>({...K,stato:K.stato||"da_pagare"}))};p(I),f(A.id),x(!0),window.scrollTo({top:0,behavior:"smooth"})},R=async(A,I,K)=>{const ee=o.find(me=>me.id===A);if(!ee)return;const ne=await d("rateizzi",A,{rate:ee.rate.map(me=>me.id===I?{...me,...K}:me)});ne.success||alert(" Errore: "+ne.error)},E=(A,I)=>s.find(ee=>ee.rateizzo_id===A&&ee.rata_id===I)?.nota||"",V=(A,I)=>{const K=s.find(ee=>ee.rateizzo_id===A&&ee.rata_id===I);j(A),y(I),k(K?.nota||""),z(!0)},w=async()=>{const A=s.find(I=>I.rateizzo_id===L&&I.rata_id===q);M.trim()===""?A&&await u("noteRateizzi",A.id):A?await d("noteRateizzi",A.id,{nota:M}):await r("noteRateizzi",{rateizzo_id:L,rata_id:q,nota:M}),z(!1),j(null),y(null),k("")};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:()=>{x(!0),f(null),p({nome:"",rate:[]}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Rateizzo"}),o.length>0&&a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg shadow-lg border-2 border-blue-300",children:[a.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-4",children:" Riepilogo Complessivo Rateizzi"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Numero Rateizzi"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:be.numeroRateizzi})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Complessivo"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",be.totale.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale Pagato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",be.pagato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Totale Rimanente"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",be.rimanente.toFixed(2)]})]})]})]}),m&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[g?" Modifica":" Nuovo"," Rateizzo"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome Rateizzo *"}),a.jsx("input",{type:"text",placeholder:"es: Fornitore XYZ - Fornitura materiali",className:"border rounded px-3 py-2 w-full",value:b.nome||"",onChange:A=>p({...b,nome:A.target.value}),disabled:_})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Rate"}),a.jsx("input",{type:"number",placeholder:"es: 12",className:"border rounded px-3 py-2 w-full",value:b.numeroRate||"",onChange:A=>p({...b,numeroRate:A.target.value}),disabled:_})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{const A=parseInt(b.numeroRate||0);if(A>0){const I=Array.from({length:A},(K,ee)=>({id:`r${Date.now()}_${ee}`,numeroRata:ee+1,dataScadenza:"",importo:"",stato:"da_pagare",dataPagamento:""}));p({...b,rate:I})}},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 whitespace-nowrap",disabled:_,children:" Genera Rate"})})]}),(b.rate||[]).length>0&&a.jsxs("div",{className:"border rounded p-4 max-h-96 overflow-y-auto",children:[a.jsxs("h4",{className:"font-semibold mb-3",children:["Rate generate (",b.rate.length,"):"]}),a.jsx("div",{className:"space-y-3",children:b.rate.map((A,I)=>a.jsx("div",{className:"border rounded p-3 bg-gray-50",children:a.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[a.jsxs("div",{className:"font-semibold self-center",children:["Rata ",A.numeroRata]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs mb-1",children:"Scadenza"}),a.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm w-full",value:A.dataScadenza,onChange:K=>{const ee=[...b.rate];ee[I].dataScadenza=K.target.value,p({...b,rate:ee})}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs mb-1",children:"Importo "}),a.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",className:"border rounded px-2 py-1 text-sm w-full",value:A.importo,onChange:K=>{const ee=[...b.rate];ee[I].importo=K.target.value,p({...b,rate:ee})}})]}),a.jsx("div",{className:"self-center text-center",children:a.jsx("button",{onClick:()=>{const K=b.rate.filter((ee,ne)=>ne!==I);p({...b,rate:K})},className:"text-red-600 text-xl hover:text-red-700",title:"Elimina rata",children:""})})]})},A.id))})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:H,disabled:_,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:_?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{x(!1),p({nome:"",rate:[]}),f(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:_,children:" Annulla"})]})]}),a.jsx("div",{className:"space-y-4",children:o.length===0?a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessun rateizzo registrato"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Clicca su " Nuovo Rateizzo" per iniziare'})]}):o.map(A=>{const I=ie(A),K=pe(I);return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>O({...N,[A.id]:!N[A.id]}),className:"text-2xl text-blue-600 hover:text-blue-700",children:N[A.id]?"":""}),a.jsx("h3",{className:"text-xl font-bold text-blue-600",children:A.nome})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>D(A),className:"text-blue-600 text-xl",children:""}),a.jsx("button",{onClick:()=>U(A),className:"text-red-600 text-xl",children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Rateizzo"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",K.totale.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Pagato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",K.pagato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Rimanente"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",K.rimanente.toFixed(2)]})]})]}),N[A.id]&&a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Rata"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Scadenza"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Importo"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Stato"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Data Pagamento"}),a.jsx("th",{className:"px-4 py-3 text-center text-sm",children:"Note"}),a.jsx("th",{className:"px-4 py-3 text-left text-sm",children:"Azioni"})]})}),a.jsx("tbody",{children:I.rate.map(ee=>{const ne={da_pagare:"bg-gray-100 text-gray-700",in_scadenza:"bg-yellow-100 text-yellow-700",scaduto:"bg-red-100 text-red-700",pagato:"bg-green-100 text-green-700"},me={da_pagare:"Da Pagare",in_scadenza:"In Scadenza",scaduto:"Scaduto",pagato:"Pagato"};return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["Rata ",ee.numeroRata]}),a.jsx("td",{className:"px-4 py-3 text-sm",children:de(ee.dataScadenza)}),a.jsxs("td",{className:"px-4 py-3 text-sm font-mono",children:[" ",parseFloat(ee.importo||0).toFixed(2)]}),a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${ne[ee.stato]}`,children:me[ee.stato]})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:ee.stato==="pagato"?a.jsx("span",{children:de(ee.dataPagamento)}):a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-sm",value:te[`${A.id}-${ee.id}`]||ee.dataPagamento||"",onChange:ke=>{ue({...te,[`${A.id}-${ee.id}`]:ke.target.value})}}),te[`${A.id}-${ee.id}`]&&a.jsx("button",{onClick:()=>{R(A.id,ee.id,{dataPagamento:te[`${A.id}-${ee.id}`],stato:"pagato"}),ue({...te,[`${A.id}-${ee.id}`]:void 0})},className:"bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700",title:"Conferma pagamento",children:""})]})}),a.jsx("td",{className:"px-4 py-3 text-center",children:a.jsxs("button",{onClick:()=>V(A.id,ee.id),className:`text-sm px-2 py-1 rounded ${E(A.id,ee.id)?"bg-yellow-100 text-yellow-700 hover:bg-yellow-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,title:E(A.id,ee.id)||"Aggiungi nota",children:[" ",E(A.id,ee.id)&&""]})}),a.jsx("td",{className:"px-4 py-3 text-sm",children:ee.stato==="pagato"&&a.jsx("button",{onClick:()=>{R(A.id,ee.id,{dataPagamento:"",stato:"da_pagare"})},className:"text-orange-600 hover:text-orange-700",title:"Annulla pagamento",children:""})})]},ee.id)})})]})})]},A.id)})}),T&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full p-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Nota per Rata"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nota"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"6",value:M,onChange:A=>k(A.target.value),placeholder:"Es: Importo modificato da 500 a 450 per accordi con fornitore del 15/01/2025..."}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:" Usa questo campo per annotare variazioni di importo, accordi speciali o altre note importanti"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:w,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Salva Nota"}),a.jsx("button",{onClick:()=>{z(!1),j(null),y(null),k("")},className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Annulla"})]})]})})]})}function fy(){const{acconti:o=[],lavoratori:s=[],loading:l,addRecord:r,updateRecord:d,deleteRecord:u}=wt(),[m,x]=F.useState(!1),[g,f]=F.useState(null),[b,p]=F.useState({tipo:"paga",meseRiferimento:new Date().getMonth()+1,annoRiferimento:new Date().getFullYear()}),[_,S]=F.useState(!1),[N,O]=F.useState({}),[T,z]=F.useState(new Date().getMonth()+1),[L,j]=F.useState(new Date().getFullYear()),[q,y]=F.useState(""),[M,k]=F.useState(""),[te,ue]=F.useState(""),de=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],ve=w=>{if(!w)return"-";const A=new Date(w);return isNaN(A.getTime())?w:A.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},ie=w=>{if(w.tipo==="tfr")return{stato:"completo",label:"TFR",color:"bg-purple-100 text-purple-700"};const A=(w.detrazioni||[]).reduce((K,ee)=>K+parseFloat(ee.importo||0),0);return parseFloat(w.importo||0)-A<=0?{stato:"saldato",label:"Saldato",color:"bg-green-100 text-green-700"}:A>0?{stato:"in_corso",label:"In recupero",color:"bg-yellow-100 text-yellow-700"}:{stato:"da_recuperare",label:"Da recuperare",color:"bg-red-100 text-red-700"}},pe=w=>{const A=parseFloat(w.importo||0),I=(w.detrazioni||[]).reduce((ee,ne)=>ee+parseFloat(ne.importo||0),0),K=A-I;return{totale:A,pagato:I,rimanente:K}},be=F.useMemo(()=>o.filter(w=>{if(M&&w.lavoratore_id!==M)return!1;if(te){const A=ie(w);if(te==="da_recuperare"&&A.stato!=="da_recuperare"||te==="tfr"&&w.tipo!=="tfr"||te==="saldato"&&A.stato!=="saldato")return!1}return!0}),[o,M,te]),H=F.useMemo(()=>{const w=be.reduce((ne,me)=>ne+parseFloat(me.importo||0),0),A=be.filter(ne=>ne.tipo==="tfr").reduce((ne,me)=>ne+parseFloat(me.importo||0),0),I=be.filter(ne=>ne.tipo!=="tfr").reduce((ne,me)=>{const ke=(me.detrazioni||[]).reduce(($e,St)=>$e+parseFloat(St.importo||0),0);return ne+ke},0),K=be.filter(ne=>ne.tipo!=="tfr").reduce((ne,me)=>ne+parseFloat(me.importo||0),0),ee=K-I;return{totaleAcconti:w,totaleTFR:A,totaleAccontiPaga:K,totaleRecuperato:I,residuo:ee}},[be]);if(l.acconti||l.lavoratori)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento acconti..."})]})});const U=async()=>{if(!b.lavoratoreId||!b.importo||!b.dataBonifico)return alert(` Compila tutti i campi obbligatori:
- Lavoratore
- Importo
- Data Bonifico`);if(!b.meseRiferimento||!b.annoRiferimento)return alert(" Compila Mese e Anno di riferimento");S(!0);const w={lavoratore_id:b.lavoratoreId,tipo:b.tipo||"paga",importo:parseFloat(b.importo),data_bonifico:b.dataBonifico,mese_riferimento:parseInt(b.meseRiferimento),anno_riferimento:parseInt(b.annoRiferimento),note:b.note||null,detrazioni:b.detrazioni||[]};let A;g?A=await d("acconti",g,w):A=await r("acconti",w),S(!1),A.success?(alert(g?" Acconto aggiornato!":" Acconto creato!"),x(!1),p({tipo:"paga",meseRiferimento:new Date().getMonth()+1,annoRiferimento:new Date().getFullYear()}),f(null)):alert(" Errore: "+A.error)},D=async w=>{const A=s.find(ee=>ee.id===w.lavoratore_id),I=A?`${A.nome} ${A.cognome}`:"questo acconto";if(!confirm(` Eliminare l'acconto di ${I}?

Questa azione  irreversibile!`))return;const K=await u("acconti",w.id);K.success?alert(" Acconto eliminato!"):alert(" Errore: "+K.error)},R=w=>{p({lavoratoreId:w.lavoratore_id,tipo:w.tipo,importo:w.importo,dataBonifico:w.data_bonifico,meseRiferimento:w.mese_riferimento,annoRiferimento:w.anno_riferimento,note:w.note,detrazioni:w.detrazioni||[]}),f(w.id),x(!0),window.scrollTo({top:0,behavior:"smooth"})},E=async w=>{if(!q||parseFloat(q)<=0)return alert(" Inserisci un importo valido maggiore di 0");const A=o.find(ee=>ee.id===w);if(!A)return;const I={id:Date.now().toString(),mese:T,anno:L,importo:parseFloat(q).toFixed(2)},K=await d("acconti",w,{detrazioni:[...A.detrazioni||[],I]});K.success?(y(""),alert(" Detrazione aggiunta!")):alert(" Errore: "+K.error)},V=async(w,A)=>{if(!confirm(" Eliminare questa detrazione?"))return;const I=o.find(ee=>ee.id===w);if(!I)return;const K=await d("acconti",w,{detrazioni:I.detrazioni.filter(ee=>ee.id!==A)});K.success||alert(" Errore: "+K.error)};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("button",{onClick:()=>{x(!0),f(null),p({tipo:"paga",meseRiferimento:new Date().getMonth()+1,annoRiferimento:new Date().getFullYear()}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Acconto"}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("h3",{className:"font-semibold mb-3",children:" Filtri"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Filtra per Lavoratore"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:M,onChange:w=>k(w.target.value),children:[a.jsx("option",{value:"",children:"Tutti i lavoratori"}),s.map(w=>a.jsxs("option",{value:w.id,children:[w.nome," ",w.cognome]},w.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Filtra per Stato"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:te,onChange:w=>ue(w.target.value),children:[a.jsx("option",{value:"",children:"Tutti gli stati"}),a.jsx("option",{value:"da_recuperare",children:"Da Recuperare"}),a.jsx("option",{value:"tfr",children:"TFR"}),a.jsx("option",{value:"saldato",children:"Saldato"})]})]})]}),(M||te)&&a.jsx("button",{onClick:()=>{k(""),ue("")},className:"mt-3 text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:" Reset Filtri"})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Acconti"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",H.totaleAcconti.toFixed(2)]}),a.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[be.length," acconti"]})]}),a.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[a.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Totale TFR"}),a.jsxs("div",{className:"text-2xl font-bold text-purple-900",children:[" ",H.totaleTFR.toFixed(2)]}),a.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:[be.filter(w=>w.tipo==="tfr").length," TFR"]})]}),a.jsxs("div",{className:"bg-cyan-50 p-4 rounded-lg border border-cyan-200",children:[a.jsx("div",{className:"text-sm text-cyan-700 mb-1",children:"Totale Acconto Paghe"}),a.jsxs("div",{className:"text-2xl font-bold text-cyan-900",children:[" ",H.totaleAccontiPaga.toFixed(2)]}),a.jsxs("div",{className:"text-xs text-cyan-600 mt-1",children:[be.filter(w=>w.tipo!=="tfr").length," acconti paga"]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale Recuperato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",H.totaleRecuperato.toFixed(2)]}),a.jsxs("div",{className:"text-xs text-green-600 mt-1",children:[be.filter(w=>ie(w).stato==="saldato").length," saldati"]})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Residuo da Recuperare"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",H.residuo.toFixed(2)]}),a.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:[be.filter(w=>ie(w).stato==="da_recuperare").length," da recuperare"]})]})]}),m&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[g?" Modifica":" Nuovo"," Acconto"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Lavoratore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:b.lavoratoreId||"",onChange:w=>p({...b,lavoratoreId:w.target.value}),disabled:_,children:[a.jsx("option",{value:"",children:"Seleziona Lavoratore"}),s.map(w=>a.jsxs("option",{value:w.id,children:[w.nome," ",w.cognome]},w.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:b.tipo||"paga",onChange:w=>p({...b,tipo:w.target.value}),disabled:_,children:[a.jsx("option",{value:"paga",children:"Acconto Paga"}),a.jsx("option",{value:"tfr",children:"Acconto TFR"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo () *"}),a.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",className:"border rounded px-3 py-2 w-full",value:b.importo||"",onChange:w=>p({...b,importo:w.target.value}),disabled:_})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Bonifico *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:b.dataBonifico||"",onChange:w=>p({...b,dataBonifico:w.target.value}),disabled:_})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese Riferimento *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:b.meseRiferimento||"",onChange:w=>p({...b,meseRiferimento:w.target.value}),disabled:_,children:[a.jsx("option",{value:"",children:"Seleziona mese"}),de.map((w,A)=>a.jsx("option",{value:A+1,children:w},A))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Anno Riferimento *"}),a.jsx("input",{type:"number",placeholder:"2025",className:"border rounded px-3 py-2 w-full",value:b.annoRiferimento||new Date().getFullYear(),onChange:w=>p({...b,annoRiferimento:w.target.value}),disabled:_})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{placeholder:"Note aggiuntive...",className:"border rounded px-3 py-2 w-full",rows:"2",value:b.note||"",onChange:w=>p({...b,note:w.target.value}),disabled:_})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:U,disabled:_,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:_?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{x(!1),p({tipo:"paga",meseRiferimento:new Date().getMonth()+1,annoRiferimento:new Date().getFullYear()}),f(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:_,children:" Annulla"})]})]}),a.jsx("div",{className:"space-y-4",children:be.length===0&&!M&&!te?a.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessun acconto registrato"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Clicca su " Nuovo Acconto" per iniziare'})]}):be.length===0?a.jsxs("div",{className:"bg-white p-8 rounded-lg text-center shadow",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessun acconto trovato con i filtri selezionati"}),a.jsx("button",{onClick:()=>{k(""),ue("")},className:"mt-3 text-blue-600 hover:underline text-sm",children:" Cancella filtri"})]}):be.map(w=>{const A=s.find(ne=>ne.id===w.lavoratore_id),I=ie(w),K=pe(w),ee=N[w.id];return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[w.tipo==="paga"&&a.jsx("button",{onClick:()=>O({...N,[w.id]:!ee}),className:"text-2xl text-blue-600 hover:text-blue-700 transition-transform",style:{transform:ee?"rotate(90deg)":"rotate(0deg)"},children:""}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-blue-600",children:A?`${A.nome} ${A.cognome}`:" Lavoratore non trovato"}),a.jsxs("p",{className:"text-sm text-gray-600",children:[w.tipo==="tfr"?" Acconto TFR":" Acconto Paga"," -"," ",de[(w.mese_riferimento||1)-1]," ",w.anno_riferimento]})]})]}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${I.color}`,children:I.label}),a.jsx("button",{onClick:()=>R(w),className:"text-blue-600 hover:text-blue-700 text-xl",children:""}),a.jsx("button",{onClick:()=>D(w),className:"text-red-600 hover:text-red-700 text-xl",children:""})]})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Importo Acconto"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",K.totale.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Data Bonifico"}),a.jsx("div",{className:"text-lg font-bold text-green-900",children:ve(w.data_bonifico)})]}),w.tipo==="paga"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[a.jsx("div",{className:"text-sm text-yellow-700 mb-1",children:"Detratto"}),a.jsxs("div",{className:"text-2xl font-bold text-yellow-900",children:[" ",K.pagato.toFixed(2)]})]}),a.jsxs("div",{className:`p-4 rounded-lg border ${K.rimanente>0?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[a.jsx("div",{className:`text-sm mb-1 ${K.rimanente>0?"text-orange-700":"text-green-700"}`,children:"Rimanente"}),a.jsxs("div",{className:`text-2xl font-bold ${K.rimanente>0?"text-orange-900":"text-green-900"}`,children:[" ",K.rimanente.toFixed(2)]})]})]})]}),w.note&&a.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4 border-l-4 border-gray-400",children:a.jsxs("p",{className:"text-sm text-gray-700",children:[a.jsx("strong",{children:" Note:"})," ",w.note]})}),w.tipo==="paga"&&ee&&a.jsxs("div",{className:"border-t pt-4 mt-4",children:[a.jsx("h4",{className:"font-semibold mb-3 text-lg",children:" Recupero Acconto - Detrazioni mensili"}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[a.jsx("h5",{className:"font-medium mb-3 text-blue-900",children:" Aggiungi Detrazione"}),a.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[a.jsx("select",{className:"border rounded px-3 py-2 bg-white",value:T,onChange:ne=>z(Number(ne.target.value)),children:de.map((ne,me)=>a.jsx("option",{value:me+1,children:ne},me))}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",placeholder:"Anno",value:L,onChange:ne=>j(Number(ne.target.value))}),a.jsx("input",{type:"number",step:"0.01",placeholder:"Importo ",className:"border rounded px-3 py-2",value:q,onChange:ne=>y(ne.target.value)}),a.jsx("button",{onClick:()=>E(w.id),className:"bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700",children:" Aggiungi"})]})]}),(w.detrazioni||[]).length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full border",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"border px-4 py-2 text-left",children:"Mese"}),a.jsx("th",{className:"border px-4 py-2 text-left",children:"Anno"}),a.jsx("th",{className:"border px-4 py-2 text-right",children:"Importo"}),a.jsx("th",{className:"border px-4 py-2 text-center",children:"Azioni"})]})}),a.jsxs("tbody",{children:[w.detrazioni.sort((ne,me)=>ne.anno!==me.anno?ne.anno-me.anno:ne.mese-me.mese).map(ne=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"border px-4 py-2",children:de[ne.mese-1]}),a.jsx("td",{className:"border px-4 py-2",children:ne.anno}),a.jsxs("td",{className:"border px-4 py-2 text-right font-mono",children:[" ",parseFloat(ne.importo).toFixed(2)]}),a.jsx("td",{className:"border px-4 py-2 text-center",children:a.jsx("button",{onClick:()=>V(w.id,ne.id),className:"text-red-600 hover:text-red-700 text-xl",children:""})})]},ne.id)),a.jsxs("tr",{className:"bg-blue-50 font-bold",children:[a.jsx("td",{colSpan:"2",className:"border px-4 py-2 text-right",children:"TOTALE DETRATTO:"}),a.jsxs("td",{className:"border px-4 py-2 text-right font-mono text-blue-900",children:[" ",K.pagato.toFixed(2)]}),a.jsx("td",{className:"border px-4 py-2"})]})]})]})}):a.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center border border-gray-200",children:[a.jsx("p",{className:"text-gray-500",children:"Nessuna detrazione registrata"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Usa il form sopra per aggiungere detrazioni mensili"})]})]})]},w.id)})})]})}function py(){const{presenze:o=[],lavoratori:s=[],cantieri:l=[],unilav:r=[],loading:d,addRecord:u,updateRecord:m,deleteRecord:x}=wt(),[g,f]=F.useState(new Date().getMonth()),[b,p]=F.useState(new Date().getFullYear()),[_,S]=F.useState(""),[N,O]=F.useState(!1),[T,z]=F.useState(!1),[L,j]=F.useState(null),[q,y]=F.useState(new Set),[M,k]=F.useState(!1),[te,ue]=F.useState({tipo:"lavoro",ore:"8",cantiere:"",note:""}),[de,ve]=F.useState({tipo:"lavoro",ore:"8",cantiere:"",note:""}),[ie,pe]=F.useState(!1),[be,H]=F.useState(""),[U,D]=F.useState(null),R=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],E=Array.from({length:10},(X,oe)=>new Date().getFullYear()-2+oe),V=[{value:"lavoro",label:"Lavoro",color:"bg-green-200 border-green-500"},{value:"malattia",label:"Malattia",color:"bg-red-200 border-red-500"},{value:"ferie",label:"Ferie",color:"bg-blue-200 border-blue-500"},{value:"festivita",label:"Festivit",color:"bg-purple-200 border-purple-500"},{value:"assenza",label:"Assenza",color:"bg-gray-300 border-gray-500"},{value:"pioggia",label:"Ore Pioggia",color:"bg-yellow-200 border-yellow-500"}];if(F.useEffect(()=>{s.length>0&&!_&&S(s[0].id)},[s]),F.useEffect(()=>{if(!_)return;const X=o.find(oe=>oe.lavoratore_id===_&&oe.anno===b&&oe.mese===g&&oe.is_nota_mensile===!0);X?(H(X.nota||""),D(X.id)):(H(""),D(null))},[_,b,g,o]),d.presenze||d.lavoratori||d.cantieri||d.unilav)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento presenze..."})]})});const w=X=>X.toLocaleDateString("it-IT",{weekday:"short",day:"2-digit",month:"2-digit"}),A=(X,oe)=>{let ge;typeof oe=="string"?ge=new Date(oe):ge=new Date(oe.getFullYear(),oe.getMonth(),oe.getDate());const De=r.filter(Me=>Me.lavoratore_id===X).filter(Me=>{const $=new Date(Me.data_inizio),fe=Me.data_fine?new Date(Me.data_fine):new Date(2099,11,31);return ge>=$&&ge<=fe});return De.length===0?null:(De.length>1&&De.sort((Me,$)=>new Date($.data_inizio)-new Date(Me.data_inizio)),De[0].cantiere_id)},I=(X,oe)=>{const ge=new Date(oe,X,1),je=[];for(;ge.getMonth()===X;)je.push(new Date(ge)),ge.setDate(ge.getDate()+1);return je},K=F.useMemo(()=>I(g,b),[g,b]),ee=(X,oe)=>{const ge=oe.toISOString().split("T")[0];return o.find(je=>je.lavoratore_id===X&&je.data===ge)},ne=X=>l.find(oe=>oe.id===X)?.nome||X,me=X=>{const oe=new Date(X.getFullYear(),X.getMonth(),1);return Math.ceil((X.getDate()+oe.getDay())/7)},ke=X=>V.find(oe=>oe.value===X),$e=X=>{if(M){P(X);return}j(X);const oe=ee(_,X);if(oe)ue({tipo:oe.tipo,ore:oe.ore?.toString()||"",orePioggia:oe.ore_pioggia?.toString()||"",cantiere:oe.cantiere_id||"",note:oe.note||""});else{const ge=A(_,X);ue({tipo:"lavoro",ore:"8",orePioggia:"",cantiere:ge||"",note:""})}O(!0)},St=async()=>{if(!L)return;pe(!0);const X=L.toISOString().split("T")[0],oe={lavoratore_id:_,data:X,tipo:te.tipo,ore:parseFloat(te.ore)||0,ore_pioggia:parseFloat(te.orePioggia)||0,cantiere_id:te.cantiere||null,note:te.note||null},ge=ee(_,L);let je;ge?je=await m("presenze",ge.id,oe):je=await u("presenze",oe),pe(!1),je.success?(O(!1),j(null),ue({tipo:"lavoro",ore:"8",orePioggia:"",cantiere:"",note:""})):alert(" Errore: "+je.error)},Q=async X=>{const oe=ee(_,X);if(!oe)return;const ge=await x("presenze",oe.id);ge.success||alert(" Errore: "+ge.error)},P=X=>{const oe=X.toISOString().split("T")[0];y(ge=>{const je=new Set(ge);return je.has(oe)?je.delete(oe):je.add(oe),je})},he=()=>{k(!0),y(new Set)},ce=()=>{k(!1),y(new Set)},we=()=>{if(q.size===0)return;const X=Array.from(q)[0],oe=A(_,X)||"";ve({tipo:"lavoro",ore:"8",orePioggia:"",cantiere:oe,note:""}),z(!0)},Ne=async()=>{pe(!0);const X=Array.from(q).map(async je=>{const De={lavoratore_id:_,data:je,tipo:de.tipo,ore:parseFloat(de.ore)||0,ore_pioggia:parseFloat(de.orePioggia)||0,cantiere_id:de.cantiere||null,note:de.note||null},Me=o.find($=>$.lavoratore_id===_&&$.data===je);return Me?await m("presenze",Me.id,De):await u("presenze",De)}),oe=await Promise.all(X);pe(!1);const ge=oe.filter(je=>!je.success);ge.length>0?alert(` ${ge.length} operazioni fallite`):alert(` ${q.size} presenze salvate!`),z(!1),k(!1),y(new Set)},Ve=()=>{const X=K.filter(oe=>oe.getDay()!==0&&oe.getDay()!==6).map(oe=>oe.toISOString().split("T")[0]);y(new Set(X))},nt=()=>{const X=K.filter(oe=>oe.getDay()===0||oe.getDay()===6).map(oe=>oe.toISOString().split("T")[0]);y(new Set(X))},pt=()=>{const X=K.filter(oe=>!ee(_,oe)).map(oe=>oe.toISOString().split("T")[0]);y(new Set(X))},Yt=async()=>{pe(!0);let X=0,oe=0;const ge=K.filter(je=>!(je.getDay()===0||je.getDay()===6||ee(_,je))).map(async je=>{const De=je.toISOString().split("T")[0];if(Z0(je))return oe++,await u("presenze",{lavoratore_id:_,data:De,tipo:"festivita",ore:0,ore_pioggia:0,cantiere_id:null,note:"Festivit"});const Me=A(_,je);return Me?(X++,await u("presenze",{lavoratore_id:_,data:De,tipo:"lavoro",ore:8,ore_pioggia:0,cantiere_id:Me,note:"Auto-compilato da UniLav"})):null}).filter(je=>je!==null);await Promise.all(ge),pe(!1),alert(` Auto-compilazione completata!

 ${X} giorni lavorativi aggiunti
 ${oe} festivit aggiunte`)},na=async()=>{pe(!0);let X;U?X=await m("notePresenze",U,{nota:be}):X=await u("notePresenze",{lavoratore_id:_,anno:b,mese:g,nota:be}),pe(!1),X.success||alert(" Errore nel salvataggio nota: "+X.error)},Je=F.useMemo(()=>{const X={oreLavoro:0,giorniLavoro:0,giorniMalattia:0,giorniFerie:0,giorniFestivita:0,giorniAssenza:0,orePioggia:0,orePermesso:0,cantieri:{}};return K.forEach(oe=>{const ge=ee(_,oe);if(ge){const je=parseFloat(ge.ore)||0,De=parseFloat(ge.ore_pioggia)||0;switch(ge.tipo){case"lavoro":X.oreLavoro+=je,X.giorniLavoro+=1,De>0&&(X.orePioggia+=De),je<8&&(X.orePermesso+=8-je),ge.cantiere_id&&(X.cantieri[ge.cantiere_id]=(X.cantieri[ge.cantiere_id]||0)+je);break;case"malattia":X.giorniMalattia+=1;break;case"ferie":X.giorniFerie+=1;break;case"festivita":X.giorniFestivita+=1;break;case"assenza":X.giorniAssenza+=1;break;case"pioggia":X.orePioggia+=je;break}}}),X},[o,_,K]);return s.length===0?a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:a.jsx("p",{className:"text-yellow-800",children:'Nessun lavoratore presente. Aggiungi prima dei lavoratori nella sezione "Lavoratori".'})}):a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Mese"}),a.jsx("select",{value:g,onChange:X=>f(Number(X.target.value)),className:"w-full px-4 py-2 border rounded-lg",children:R.map((X,oe)=>a.jsx("option",{value:oe,children:X},oe))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Anno"}),a.jsx("select",{value:b,onChange:X=>p(Number(X.target.value)),className:"w-full px-4 py-2 border rounded-lg",children:E.map(X=>a.jsx("option",{value:X,children:X},X))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Lavoratore"}),a.jsx("select",{value:_,onChange:X=>S(X.target.value),className:"w-full px-4 py-2 border rounded-lg",children:s.map(X=>a.jsxs("option",{value:X.id,children:[X.nome," ",X.cognome]},X.id))})]})]})}),a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsx("button",{onClick:Yt,disabled:ie,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:ie?" Elaborazione...":" Auto-compila da UniLav (giorni feriali + festivit)"})}),a.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:a.jsx("div",{className:"flex flex-wrap gap-3",children:M?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-lg font-semibold",children:[q.size," giorni selezionati"]}),a.jsx("button",{onClick:Ve,className:"px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Giorni Feriali"}),a.jsx("button",{onClick:nt,className:"px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Weekend"}),a.jsx("button",{onClick:pt,className:"px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Giorni Vuoti"}),a.jsx("div",{className:"flex-1"}),a.jsx("button",{onClick:we,disabled:q.size===0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300",children:"Applica"}),a.jsx("button",{onClick:ce,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Annulla"})]}):a.jsx("button",{onClick:he,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:" Inserimento Multiplo"})})}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Calendario Presenze"}),a.jsx("div",{className:"space-y-6",children:[1,2,3,4,5].map(X=>{const oe=K.filter(ge=>me(ge)===X);return oe.length===0?null:a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2 mb-2",children:a.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Settimana ",X]})}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:oe.map((ge,je)=>{const De=ee(_,ge),Me=De?ke(De.tipo):null,$=ge.getDay()===0||ge.getDay()===6,fe=ge.toISOString().split("T")[0],Te=q.has(fe),Ce=A(_,ge),lt=!!Ce;return a.jsxs("div",{className:`border-2 rounded-lg p-3 cursor-pointer transition-all ${Te?"ring-4 ring-blue-400":De?De.tipo==="lavoro"&&parseFloat(De.ore||0)<8?"bg-orange-100 border-orange-400":Me.color:$?"bg-gray-50 border-gray-200":lt?"bg-emerald-100 border-emerald-400":"bg-white border-gray-200"} ${M?"hover:ring-2 hover:ring-blue-300":"hover:shadow-md"}`,onClick:()=>$e(ge),children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:w(ge)}),De&&!M&&a.jsx("button",{onClick:Ie=>{Ie.stopPropagation(),Q(ge)},className:"text-red-500 hover:text-red-700",children:""})]}),De?a.jsxs("div",{className:"text-sm space-y-1",children:[a.jsx("div",{className:"font-medium text-gray-700",children:Me.label}),De.ore&&a.jsxs("div",{className:"text-gray-600",children:[De.ore," ore",De.tipo==="lavoro"?" lavorate":"",De.tipo==="lavoro"&&parseFloat(De.ore||0)<8&&a.jsxs("span",{className:"text-orange-600 font-semibold ml-1",children:["(-",(8-parseFloat(De.ore||0)).toFixed(1),"h)"]})]}),De.ore_pioggia&&parseFloat(De.ore_pioggia)>0&&a.jsxs("div",{className:"text-yellow-600 text-xs",children:[" ",De.ore_pioggia," ore pioggia"]}),De.cantiere_id&&a.jsx("div",{className:"text-gray-600 text-xs truncate",children:ne(De.cantiere_id)})]}):lt?a.jsxs("div",{className:"text-xs text-green-700",children:[a.jsx("div",{className:"font-medium mb-1",children:"UniLav"}),a.jsx("div",{className:"truncate",children:ne(Ce)})]}):a.jsx("div",{className:"text-xs text-gray-400",children:M?"Seleziona":"Aggiungi"})]},je)})})]},X)})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Riepilogo Mensile"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Ore Lavorate"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[Je.oreLavoro.toFixed(1)," h"]}),a.jsxs("div",{className:"text-xs text-green-600 mt-1",children:[Je.giorniLavoro," giorni"]})]}),a.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[a.jsx("div",{className:"text-sm text-red-700 mb-1",children:"Giorni Malattia"}),a.jsx("div",{className:"text-2xl font-bold text-red-900",children:Je.giorniMalattia})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Giorni Ferie"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:Je.giorniFerie})]}),a.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[a.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Festivit"}),a.jsx("div",{className:"text-2xl font-bold text-purple-900",children:Je.giorniFestivita})]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[a.jsx("div",{className:"text-sm text-gray-700 mb-1",children:"Giorni Assenza"}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Je.giorniAssenza})]}),a.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[a.jsx("div",{className:"text-sm text-yellow-700 mb-1",children:"Ore Pioggia"}),a.jsxs("div",{className:"text-2xl font-bold text-yellow-900",children:[Je.orePioggia.toFixed(1)," h"]})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Ore Permesso"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[Je.orePermesso.toFixed(1)," h"]}),a.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"ore < 8"})]})]}),Object.keys(Je.cantieri).length>0&&a.jsxs("div",{className:"mt-6",children:[a.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Dettaglio per Cantiere"}),a.jsx("div",{className:"space-y-2",children:Object.entries(Je.cantieri).map(([X,oe])=>a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[a.jsx("span",{className:"text-gray-700",children:ne(X)}),a.jsxs("span",{className:"font-semibold text-gray-900",children:[oe.toFixed(1)," ore"]})]},X))})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-3",children:" Nota Mensile"}),a.jsx("textarea",{value:be,onChange:X=>H(X.target.value),onBlur:na,placeholder:"Aggiungi una nota per questo mese...",className:"w-full border rounded-lg px-3 py-2 min-h-[100px]",disabled:ie}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:" La nota viene salvata automaticamente quando esci dal campo"})]}),a.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:a.jsx("button",{onClick:()=>{const X=s.find(Me=>Me.id===_),oe=X?`${X.cognome} ${X.nome}`:"Lavoratore",ge=R[g],je=`
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Presenze ${ge} ${b} - ${oe}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2563eb; border-bottom: 3px solid #2563eb; padding-bottom: 10px; text-align: center; }
    .info { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; text-align: center; }
    .calendario { margin: 30px 0; }
    .settimana { margin-bottom: 30px; page-break-inside: avoid; }
    .settimana-title { font-weight: bold; color: #4b5563; margin-bottom: 10px; font-size: 14px; }
    .giorni-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
    .giorno-card { border: 2px solid #d1d5db; border-radius: 8px; padding: 10px; min-height: 80px; }
    .giorno-card.lavoro { background: #dcfce7; border-color: #22c55e; }
    .giorno-card.lavoro-permesso { background: #fed7aa; border-color: #f97316; }
    .giorno-card.malattia { background: #fecaca; border-color: #ef4444; }
    .giorno-card.ferie { background: #bfdbfe; border-color: #3b82f6; }
    .giorno-card.festivita { background: #e9d5ff; border-color: #a855f7; }
    .giorno-card.assenza { background: #e5e7eb; border-color: #6b7280; }
    .giorno-card.pioggia { background: #fef08a; border-color: #eab308; }
    .giorno-card.weekend { background: #f3f4f6; }
    .giorno-header { font-weight: bold; font-size: 12px; color: #374151; margin-bottom: 5px; }
    .giorno-tipo { font-weight: 600; font-size: 13px; color: #1f2937; }
    .giorno-ore { font-size: 11px; color: #4b5563; }
    .giorno-permesso { font-size: 10px; color: #ea580c; font-weight: bold; }
    .giorno-cantiere { font-size: 10px; color: #6b7280; margin-top: 3px; }
    .riepilogo { margin-top: 40px; }
    .riepilogo h2 { color: #1f2937; font-size: 20px; margin-bottom: 20px; }
    .riepilogo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
    .riepilogo-card { border: 2px solid; border-radius: 8px; padding: 15px; }
    .riepilogo-card.lavoro { background: #dcfce7; border-color: #22c55e; }
    .riepilogo-card.malattia { background: #fecaca; border-color: #ef4444; }
    .riepilogo-card.ferie { background: #bfdbfe; border-color: #3b82f6; }
    .riepilogo-card.festivita { background: #e9d5ff; border-color: #a855f7; }
    .riepilogo-card.assenza { background: #e5e7eb; border-color: #6b7280; }
    .riepilogo-card.pioggia { background: #fef08a; border-color: #eab308; }
    .riepilogo-card.permesso { background: #fed7aa; border-color: #f97316; }
    .riepilogo-label { font-size: 12px; color: #4b5563; margin-bottom: 5px; }
    .riepilogo-valore { font-size: 24px; font-weight: bold; color: #1f2937; }
    .riepilogo-sub { font-size: 11px; color: #6b7280; margin-top: 3px; }
    .dettaglio-cantieri { margin-top: 20px; }
    .dettaglio-cantieri h3 { font-size: 16px; color: #1f2937; margin-bottom: 15px; }
    .cantiere-item { display: flex; justify-content: space-between; padding: 12px; background: #f9fafb; border-radius: 6px; margin-bottom: 8px; }
    .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 11px; border-top: 1px solid #d1d5db; padding-top: 20px; }
    @media print { .no-print { display: none; } body { margin: 0; } }
  </style>
</head>
<body>
  <button class="no-print" onclick="window.print()" style="background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">
     Stampa / Salva PDF
  </button>
  
  <h1>Presenze ${ge} ${b} - ${oe}</h1>
  
  <div class="info">
    <strong>Periodo:</strong> ${ge} ${b}<br>
    <strong>Data generazione:</strong> ${new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}
  </div>
  
  ${be?`
    <div class="nota-mensile" style="background:#fef9c3; padding:15px; border-radius:8px; border:1px solid #facc15; margin:20px 0;">
      <strong> Nota Mensile:</strong><br>
      <div style="white-space:pre-wrap; margin-top:8px; font-size:13px; color:#444;">
        ${be}
      </div>
    </div>
  `:""}

  <div class="calendario">
    ${[1,2,3,4,5].map(Me=>{const $=K.filter(Te=>me(Te)===Me);if($.length===0)return"";const fe=$.map(Te=>{const Ce=ee(_,Te),lt=Ce?ke(Ce.tipo):null,Ie=Te.getDay()===0||Te.getDay()===6,ht=w(Te),xe=parseFloat(Ce?.ore||0),Fe=Ce?.tipo==="lavoro"&&xe<8;let xa="giorno-card";Ce?Fe?xa+=" lavoro-permesso":xa+=" "+Ce.tipo:Ie&&(xa+=" weekend");let Qt='<div class="'+xa+'">';return Qt+='<div class="giorno-header">'+ht+"</div>",Ce&&(Qt+='<div class="giorno-tipo">'+lt.label+"</div>",Ce.ore&&(Qt+='<div class="giorno-ore">'+Ce.ore+" ore"+(Ce.tipo==="lavoro"?" lav.":"")+"</div>",Fe&&(Qt+='<div class="giorno-permesso">(-'+(8-xe).toFixed(1)+"h permesso)</div>")),Ce.ore_pioggia&&parseFloat(Ce.ore_pioggia)>0&&(Qt+='<div class="giorno-ore" style="color: #ca8a04;"> '+Ce.ore_pioggia+" ore pioggia</div>"),Ce.cantiere_id&&(Qt+='<div class="giorno-cantiere">'+ne(Ce.cantiere_id)+"</div>")),Qt+="</div>",Qt}).join("");return'<div class="settimana"><div class="settimana-title">Settimana '+Me+'</div><div class="giorni-grid">'+fe+"</div></div>"}).join("")}
  </div>
  
  <div class="riepilogo">
    <h2>Riepilogo Mensile</h2>
    <div class="riepilogo-grid">
      <div class="riepilogo-card lavoro">
        <div class="riepilogo-label">Ore Lavorate</div>
        <div class="riepilogo-valore">${Je.oreLavoro.toFixed(1)} h</div>
        <div class="riepilogo-sub">${Je.giorniLavoro} giorni</div>
      </div>
      <div class="riepilogo-card malattia">
        <div class="riepilogo-label">Giorni Malattia</div>
        <div class="riepilogo-valore">${Je.giorniMalattia}</div>
      </div>
      <div class="riepilogo-card ferie">
        <div class="riepilogo-label">Giorni Ferie</div>
        <div class="riepilogo-valore">${Je.giorniFerie}</div>
      </div>
      <div class="riepilogo-card festivita">
        <div class="riepilogo-label">Festivit</div>
        <div class="riepilogo-valore">${Je.giorniFestivita}</div>
      </div>
      <div class="riepilogo-card assenza">
        <div class="riepilogo-label">Giorni Assenza</div>
        <div class="riepilogo-valore">${Je.giorniAssenza}</div>
      </div>
      <div class="riepilogo-card pioggia">
        <div class="riepilogo-label">Ore Pioggia</div>
        <div class="riepilogo-valore">${Je.orePioggia.toFixed(1)} h</div>
      </div>
      <div class="riepilogo-card permesso">
        <div class="riepilogo-label">Ore Permesso</div>
        <div class="riepilogo-valore">${Je.orePermesso.toFixed(1)} h</div>
        <div class="riepilogo-sub">ore < 8</div>
      </div>
    </div>
    
    ${Object.keys(Je.cantieri).length>0?`
      <div class="dettaglio-cantieri">
        <h3>Dettaglio per Cantiere</h3>
        ${Object.entries(Je.cantieri).map(([Me,$])=>`
          <div class="cantiere-item">
            <span class="cantiere-nome">${ne(Me)}</span>
            <span class="cantiere-ore">${$.toFixed(1)} ore</span>
          </div>
        `).join("")}
      </div>
    `:""}
  </div>
  
  <div class="footer">
    <p>Gestionale Marrel S.r.l. - Report Presenze</p>
    <p>Documento generato automaticamente dal sistema</p>
  </div>
</body>
</html>
            `,De=window.open("","_blank");De.document.write(je),De.document.close()},className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-center font-semibold",children:" Esporta PDF Presenze"})}),N&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:L&&w(L)}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo"}),a.jsx("select",{value:te.tipo,onChange:X=>ue({...te,tipo:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:ie,children:V.map(X=>a.jsx("option",{value:X.value,children:X.label},X.value))})]}),(te.tipo==="lavoro"||te.tipo==="pioggia")&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:te.tipo==="lavoro"?"Ore Lavorate":"Ore"}),a.jsx("input",{type:"number",step:"0.5",value:te.ore,onChange:X=>ue({...te,ore:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"8.0",disabled:ie})]}),te.tipo==="lavoro"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ore Pioggia"}),a.jsx("input",{type:"number",step:"0.5",value:te.orePioggia||"",onChange:X=>ue({...te,orePioggia:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"0",disabled:ie})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cantiere"}),a.jsxs("select",{value:te.cantiere,onChange:X=>ue({...te,cantiere:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:ie,children:[a.jsx("option",{value:"",children:"Seleziona cantiere"}),l.map(X=>a.jsx("option",{value:X.id,children:X.nome},X.id))]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Note"}),a.jsx("textarea",{value:te.note,onChange:X=>ue({...te,note:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",rows:"3",placeholder:"Note...",disabled:ie})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:()=>O(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50",disabled:ie,children:"Annulla"}),a.jsx("button",{onClick:St,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",disabled:ie,children:ie?"...":"Salva"})]})]})}),T&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Inserimento per ",q.size," giorni"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo"}),a.jsx("select",{value:de.tipo,onChange:X=>ve({...de,tipo:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:ie,children:V.map(X=>a.jsx("option",{value:X.value,children:X.label},X.value))})]}),(de.tipo==="lavoro"||de.tipo==="pioggia")&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ore"}),a.jsx("input",{type:"number",step:"0.5",value:de.ore,onChange:X=>ve({...de,ore:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:ie})]}),de.tipo==="lavoro"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cantiere"}),a.jsxs("select",{value:de.cantiere,onChange:X=>ve({...de,cantiere:X.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:ie,children:[a.jsx("option",{value:"",children:"Seleziona cantiere"}),l.map(X=>a.jsx("option",{value:X.id,children:X.nome},X.id))]})]})]})]}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("button",{onClick:()=>z(!1),className:"flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50",disabled:ie,children:"Annulla"}),a.jsx("button",{onClick:Ne,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",disabled:ie,children:ie?"...":"Applica a tutti"})]})]})})]})}function gy(){const{movimentiContabili:o,fornitori:s,cantieri:l,loading:r,addRecord:d,updateRecord:u,deleteRecord:m,getSetting:x,setSetting:g}=wt(),f=x("saldo_iniziale","0.00"),[b,p]=F.useState(!1),[_,S]=F.useState(null),[N,O]=F.useState({tipo:"uscita",tipologiaMovimento:"bonifico",pagato:!1,modalitaUscita:"pagata"}),[T,z]=F.useState(!1),[L,j]=F.useState(""),[q,y]=F.useState(""),[M,k]=F.useState(""),[te,ue]=F.useState(""),[de,ve]=F.useState(""),[ie,pe]=F.useState(""),[be,H]=F.useState(new Date().getMonth()+1),[U,D]=F.useState(new Date().getFullYear()),[R,E]=F.useState(!1),[V,w]=F.useState(null),[A,I]=F.useState(""),[K,ee]=F.useState(!1),[ne,me]=F.useState(null),[ke,$e]=F.useState(!1),St={bonifico:{tipo:"fisso",valore:1.5},cbill:{tipo:"fisso",valore:1},f24:{tipo:"fisso",valore:0},bollo:{tipo:"fisso",valore:0},canone:{tipo:"fisso",valore:0},interessi:{tipo:"fisso",valore:0},addebito:{tipo:"fisso",valore:0},ricarica:{tipo:"fisso",valore:0},riba:{tipo:"percentuale",valore:.5},mav:{tipo:"fisso",valore:1.5},compensato:{tipo:"fisso",valore:0},f24_compensato:{tipo:"fisso",valore:0},assegno_circolare:{tipo:"fisso",valore:5},bonifico_st:{tipo:"fisso",valore:10},storno:{tipo:"fisso",valore:0},f23:{tipo:"fisso",valore:0}},Q=x("commissioni",null),[P,he]=F.useState(()=>{if(Q)try{return JSON.parse(Q)}catch{return St}return St}),ce=[{value:"bonifico",label:"Bonifico"},{value:"cbill",label:"CBILL"},{value:"f24",label:"F24"},{value:"bollo",label:"Bollo"},{value:"canone",label:"Canone"},{value:"interessi",label:"Interessi"},{value:"addebito",label:"Addebito"},{value:"ricarica",label:"Ricarica"},{value:"riba",label:"Ri.Ba"},{value:"mav",label:"MAV"},{value:"compensato",label:"Compensato"},{value:"f24_compensato",label:"F24/Compensato"},{value:"assegno_circolare",label:"Assegno circolare"},{value:"bonifico_st",label:"Bonifico ST"},{value:"storno",label:"Storno"},{value:"f23",label:"F23"}],we=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];if(r.movimentiContabili||r.fornitori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento contabilit..."})]})});const Ne=$=>{if(!$)return"-";const fe=new Date($);return isNaN(fe.getTime())?$:fe.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},Ve=($,fe)=>{const Te=P[$];return Te?Te.tipo==="percentuale"?parseFloat(fe)*parseFloat(Te.valore)/100:parseFloat(Te.valore)||0:0},nt=async()=>{if(!N.fornitoreId||!N.causale){alert(" Fornitore e causale sono obbligatori!");return}if(N.tipo!=="storno"&&!N.importo){alert(" Importo obbligatorio!");return}z(!0);const $={tipo:N.tipo,tipologia_movimento:N.tipologiaMovimento||N.tipologia_movimento,fornitore_id:N.fornitoreId||N.fornitore_id,cantiere_id:N.cantiereId||N.cantiere_id||null,causale:N.causale,importo:parseFloat(N.importo||0),commissione:parseFloat(N.commissione||0),data_movimento:N.dataMovimento||N.data_movimento||null,data_scadenza:N.dataScadenza||N.data_scadenza||null,pagato:N.pagato||!1,note:N.note||null,movimento_stornato_id:N.movimentoStornatoId||N.movimento_stornato_id||null};let fe;_?fe=await u("movimentiContabili",_,$):fe=await d("movimentiContabili",$),z(!1),fe.success?(p(!1),O({tipo:"uscita",tipologiaMovimento:"bonifico",pagato:!1,modalitaUscita:"pagata"}),S(null),alert(_?" Movimento aggiornato!":" Movimento aggiunto!")):alert(" Errore: "+fe.error)},pt=async $=>{if(!confirm(` Eliminare il movimento del ${Ne($.data_movimento||$.data_scadenza)}?

Questa azione  irreversibile!`))return;const fe=await m("movimentiContabili",$.id);fe.success?alert(" Movimento eliminato!"):alert(" Errore: "+fe.error)},Yt=$=>{O({tipo:$.tipo,tipologiaMovimento:$.tipologia_movimento,tipologia_movimento:$.tipologia_movimento,fornitoreId:$.fornitore_id,fornitore_id:$.fornitore_id,cantiereId:$.cantiere_id,cantiere_id:$.cantiere_id,causale:$.causale,importo:$.importo,commissione:$.commissione,dataMovimento:$.data_movimento,data_movimento:$.data_movimento,dataScadenza:$.data_scadenza,data_scadenza:$.data_scadenza,pagato:$.pagato,note:$.note,movimentoStornatoId:$.movimento_stornato_id,movimento_stornato_id:$.movimento_stornato_id,modalitaUscita:$.pagato?"pagata":"programmata"}),S($.id),p(!0),window.scrollTo({top:0,behavior:"smooth"})},na=async $=>{const fe=o.find(Te=>Te.id===$);if(fe.pagato){const Te=await u("movimentiContabili",$,{pagato:!1,data_movimento:null});Te.success||alert(" Errore: "+Te.error)}else w(fe),I(new Date().toISOString().split("T")[0]),E(!0)},Je=async()=>{if(!A)return alert(" Inserisci la data di pagamento");const $=await u("movimentiContabili",V.id,{pagato:!0,data_movimento:A});$.success?(E(!1),w(null),I(""),alert(" Pagamento registrato!")):alert(" Errore: "+$.error)},X=F.useMemo(()=>o.filter($=>!(L&&$.data_movimento&&$.data_movimento<L||q&&$.data_movimento&&$.data_movimento>q||M&&$.fornitore_id!==M||te&&$.cantiere_id!==te||de&&$.tipologia_movimento!==de||ie==="pagato"&&!$.pagato||ie==="non_pagato"&&$.pagato)).sort(($,fe)=>{const Te=new Date($.data_movimento||$.data_scadenza||"9999-12-31"),Ce=new Date(fe.data_movimento||fe.data_scadenza||"9999-12-31");return Te-Ce}),[o,L,q,M,te,de,ie]),oe=F.useMemo(()=>{let $=parseFloat(f);const fe=X.map(xe=>{const Fe=parseFloat(xe.importo||0)+parseFloat(xe.commissione||0);return xe.pagato&&(xe.tipologia_movimento==="storno"||xe.tipo==="entrata"?$+=Fe:$-=Fe),{...xe,saldoProgressivo:$}}),Te=X.filter(xe=>xe.tipo==="entrata"&&xe.tipologia_movimento!=="storno").reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),Ce=X.filter(xe=>xe.tipo==="uscita"&&xe.tipologia_movimento!=="storno").reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),lt=X.filter(xe=>xe.tipo==="entrata"&&xe.pagato&&xe.tipologia_movimento!=="storno").reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),Ie=X.filter(xe=>xe.tipo==="uscita"&&xe.pagato&&xe.tipologia_movimento!=="storno").reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),ht=X.filter(xe=>xe.tipologia_movimento==="storno"&&xe.pagato).reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0);return{movimentiConSaldo:fe,totaleEntrate:Te,totaleUscite:Ce,saldoReale:parseFloat(f)+lt-Ie+ht,saldoPrevisto:parseFloat(f)+Te-Ce}},[X,f]),ge=F.useMemo(()=>{const $=new Date,fe=$.getMonth(),Te=$.getFullYear(),Ce=o.filter(xe=>{const Fe=xe.data_movimento||xe.data_scadenza;if(!Fe)return!1;const xa=new Date(Fe);return xa.getMonth()===fe&&xa.getFullYear()===Te}),lt=Ce.filter(xe=>xe.tipo==="entrata"&&xe.tipologia_movimento!=="storno"&&!xe.pagato).reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),Ie=Ce.filter(xe=>xe.tipo==="uscita"&&xe.tipologia_movimento!=="storno"&&!xe.pagato).reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0),ht=Ce.filter(xe=>xe.tipologia_movimento==="storno"&&!xe.pagato).reduce((xe,Fe)=>xe+parseFloat(Fe.importo||0)+parseFloat(Fe.commissione||0),0);return oe.saldoReale+lt-Ie+ht},[o,oe.saldoReale]),je=F.useMemo(()=>{const $=new Date;return o.filter(fe=>fe.data_scadenza&&!fe.pagato&&fe.tipo==="uscita").map(fe=>({...fe,giorniMancanti:Math.ceil((new Date(fe.data_scadenza)-$)/(1e3*60*60*24))})).filter(fe=>fe.giorniMancanti>=-7&&fe.giorniMancanti<=30).sort((fe,Te)=>fe.giorniMancanti-Te.giorniMancanti)},[o]),De=()=>{const $=o.filter(ze=>{const Ze=ze.data_movimento||ze.data_scadenza;if(!Ze)return!1;const ba=new Date(Ze);return ba.getMonth()+1===be&&ba.getFullYear()===U}).sort((ze,Ze)=>{const ba=new Date(ze.data_movimento||ze.data_scadenza||"9999-12-31"),va=new Date(Ze.data_movimento||Ze.data_scadenza||"9999-12-31");return ba-va}),fe=$.filter(ze=>ze.tipo==="entrata"&&ze.tipologia_movimento!=="storno").reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),Te=$.filter(ze=>ze.tipo==="uscita"&&ze.tipologia_movimento!=="storno").reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),Ce=$.filter(ze=>ze.tipologia_movimento==="storno").reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),lt=$.filter(ze=>ze.tipo==="entrata"&&ze.pagato&&ze.tipologia_movimento!=="storno").reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),Ie=$.filter(ze=>ze.tipo==="uscita"&&ze.pagato&&ze.tipologia_movimento!=="storno").reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),ht=$.filter(ze=>ze.tipologia_movimento==="storno"&&ze.pagato).reduce((ze,Ze)=>ze+parseFloat(Ze.importo||0)+parseFloat(Ze.commissione||0),0),xe=parseFloat(f)+lt-Ie+ht,Fe=parseFloat(f)+fe-Te+Ce,xa=`
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Report Contabilit - ${we[be-1]} ${U}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; text-align: center; }
    .info { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; font-size: 11px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #3b82f6; color: white; font-weight: bold; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .entrata { background-color: #d1fae5 !important; }
    .uscita { background-color: #fee2e2 !important; }
    .totali { background: #dbeafe; padding: 15px; border-radius: 5px; margin: 20px 0; }
    .totali-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
    .totale-card { border: 2px solid; border-radius: 8px; padding: 15px; }
    .totale-card.entrate { background: #d1fae5; border-color: #10b981; }
    .totale-card.uscite { background: #fee2e2; border-color: #ef4444; }
    .totale-card.saldo-reale { background: #e0e7ff; border-color: #6366f1; }
    .totale-card.saldo-previsto { background: #fef3c7; border-color: #f59e0b; }
    .totale-label { font-size: 12px; color: #374151; margin-bottom: 5px; }
    .totale-valore { font-size: 24px; font-weight: bold; color: #1f2937; }
    .footer { margin-top: 40px; text-align: center; color: #666; font-size: 11px; border-top: 1px solid #ccc; padding-top: 20px; }
    @media print {
      .no-print { display: none; }
      body { margin: 0; }
    }
  </style>
</head>
<body>
  <button class="no-print" onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px; font-size: 14px;">
     Stampa / Salva PDF
  </button>
  
  <h1> Report Contabilit - ${we[be-1]} ${U}</h1>
  
  <div class="info">
    <strong>Azienda:</strong> Marrel S.r.l.<br>
    <strong>Periodo:</strong> ${we[be-1]} ${U}<br>
    <strong>Data generazione:</strong> ${new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}<br>
    <strong>Movimenti totali:</strong> ${$.length}
  </div>
  
  <table>
    <thead>
      <tr>
        <th>Data Movimento</th>
        <th>Tipo</th>
        <th>Tipologia</th>
        <th>Fornitore</th>
        <th>Cantiere</th>
        <th>Causale</th>
        <th>Importo</th>
        <th>Comm.</th>
        <th>Totale</th>
        <th>Scadenza</th>
        <th>Stato</th>
      </tr>
    </thead>
    <tbody>
      ${$.map(ze=>{const Ze=s.find(ya=>ya.id===ze.fornitore_id),ba=l.find(ya=>ya.id===ze.cantiere_id),va=ce.find(ya=>ya.value===ze.tipologia_movimento),Ki=parseFloat(ze.importo||0)+parseFloat(ze.commissione||0);return`
        <tr class="${ze.tipo}">
          <td>${Ne(ze.data_movimento)}</td>
          <td>${ze.tipo==="entrata"?" Entrata":" Uscita"}</td>
          <td>${va?.label||ze.tipologia_movimento}</td>
          <td>${Ze?.ragione_sociale||"-"}</td>
          <td>${ba?.nome||"-"}</td>
          <td>${ze.causale||"-"}</td>
          <td style="text-align: right;"> ${parseFloat(ze.importo||0).toFixed(2)}</td>
          <td style="text-align: right;"> ${parseFloat(ze.commissione||0).toFixed(2)}</td>
          <td style="text-align: right; font-weight: bold;"> ${Ki.toFixed(2)}</td>
          <td>${ze.tipo==="uscita"?Ne(ze.data_scadenza):"-"}</td>
          <td>${ze.pagato?" Pagato":" Da pagare"}</td>
        </tr>
        `}).join("")}
    </tbody>
  </table>
  
  <div class="totali">
    <h2 style="margin-top: 0;"> Riepilogo Mensile</h2>
    <div class="totali-grid">
      <div class="totale-card entrate">
        <div class="totale-label">Totale Entrate</div>
        <div class="totale-valore"> ${fe.toFixed(2)}</div>
      </div>
      <div class="totale-card uscite">
        <div class="totale-label">Totale Uscite</div>
        <div class="totale-valore"> ${Te.toFixed(2)}</div>
      </div>
      <div class="totale-card" style="background: #e5e7eb; border-color: #6b7280;">
        <div class="totale-label">Totale Storni</div>
        <div class="totale-valore"> ${Ce.toFixed(2)}</div>
      </div>
      <div class="totale-card saldo-reale">
        <div class="totale-label">Saldo Reale (movimenti pagati)</div>
        <div class="totale-valore"> ${xe.toFixed(2)}</div>
      </div>
      <div class="totale-card saldo-previsto">
        <div class="totale-label">Saldo Previsto (tutti i movimenti)</div>
        <div class="totale-valore"> ${Fe.toFixed(2)}</div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <p>Gestionale Marrel S.r.l. - Report Contabilit</p>
    <p>Documento generato automaticamente dal sistema</p>
  </div>
</body>
</html>
    `,Qt=window.open("","_blank");Qt.document.write(xa),Qt.document.close()},Me=()=>{const $=o.filter(Ce=>{const lt=Ce.data_movimento||Ce.data_scadenza;if(!lt)return!1;const Ie=new Date(lt);return Ie.getMonth()+1===be&&Ie.getFullYear()===U&&Ce.pagato}).sort((Ce,lt)=>{const Ie=new Date(Ce.data_movimento||Ce.data_scadenza||"9999-12-31"),ht=new Date(lt.data_movimento||lt.data_scadenza||"9999-12-31");return Ie-ht}),fe=`
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Prima Nota - ${we[be-1]} ${U}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; text-align: center; }
    .info { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; font-size: 11px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #3b82f6; color: white; font-weight: bold; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .entrata { background-color: #d1fae5 !important; }
    .uscita { background-color: #fee2e2 !important; }
    .footer { margin-top: 40px; text-align: center; color: #666; font-size: 11px; border-top: 1px solid #ccc; padding-top: 20px; }
    @media print {
      .no-print { display: none; }
      body { margin: 0; }
    }
  </style>
</head>
<body>
  <button class="no-print" onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px; font-size: 14px;">
     Stampa / Salva PDF
  </button>
  
  <h1> Prima Nota - ${we[be-1]} ${U}</h1>
  
  <div class="info">
    <strong>Azienda:</strong> Marrel S.r.l.<br>
    <strong>Periodo:</strong> ${we[be-1]} ${U}<br>
    <strong>Data generazione:</strong> ${new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}<br>
    <strong>Movimenti pagati:</strong> ${$.length}
  </div>
  
  <table>
    <thead>
      <tr>
        <th>Data Movimento</th>
        <th>Tipo</th>
        <th>Tipologia</th>
        <th>Fornitore</th>
        <th>Cantiere</th>
        <th>Causale</th>
        <th>Importo</th>
        <th>Comm.</th>
        <th>Totale</th>
      </tr>
    </thead>
    <tbody>
      ${$.map(Ce=>{const lt=s.find(Fe=>Fe.id===Ce.fornitore_id),Ie=l.find(Fe=>Fe.id===Ce.cantiere_id),ht=ce.find(Fe=>Fe.value===Ce.tipologia_movimento),xe=parseFloat(Ce.importo||0)+parseFloat(Ce.commissione||0);return`
        <tr class="${Ce.tipo}">
          <td>${Ne(Ce.data_movimento)}</td>
          <td>${Ce.tipo==="entrata"?" Entrata":" Uscita"}</td>
          <td>${ht?.label||Ce.tipologia_movimento}</td>
          <td>${lt?.ragione_sociale||"-"}</td>
          <td>${Ie?.nome||"-"}</td>
          <td>${Ce.causale||"-"}</td>
          <td style="text-align: right;"> ${parseFloat(Ce.importo||0).toFixed(2)}</td>
          <td style="text-align: right;"> ${parseFloat(Ce.commissione||0).toFixed(2)}</td>
          <td style="text-align: right; font-weight: bold;"> ${xe.toFixed(2)}</td>
        </tr>
        `}).join("")}
    </tbody>
  </table>
  
  <div class="footer">
    <p>Gestionale Marrel S.r.l. - Prima Nota</p>
    <p>Documento generato automaticamente dal sistema - Solo movimenti pagati</p>
  </div>
</body>
</html>
    `,Te=window.open("","_blank");Te.document.write(fe),Te.document.close()};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-green-50 p-6 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale Entrate"}),a.jsxs("div",{className:"text-3xl font-bold text-green-900",children:[" ",oe.totaleEntrate.toFixed(2)]})]}),a.jsxs("div",{className:"bg-red-50 p-6 rounded-lg border border-red-200",children:[a.jsx("div",{className:"text-sm text-red-700 mb-1",children:"Totale Uscite"}),a.jsxs("div",{className:"text-3xl font-bold text-red-900",children:[" ",oe.totaleUscite.toFixed(2)]})]}),a.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Saldo Reale"}),a.jsxs("div",{className:"text-3xl font-bold text-blue-900",children:[" ",oe.saldoReale.toFixed(2)]}),a.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Solo movimenti pagati"})]}),a.jsxs("div",{className:"bg-yellow-50 p-6 rounded-lg border border-yellow-200",children:[a.jsx("div",{className:"text-sm text-yellow-700 mb-1",children:"Saldo Previsto Fine Mese"}),a.jsxs("div",{className:"text-3xl font-bold text-yellow-900",children:[" ",ge.toFixed(2)]}),a.jsx("div",{className:"text-xs text-yellow-600 mt-1",children:new Date().toLocaleDateString("it-IT",{month:"long",year:"numeric"})})]})]}),je.length>0&&a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsxs("h3",{className:"font-semibold text-orange-900 mb-2",children:[" Scadenze Imminenti (",je.length,")"]}),a.jsxs("div",{className:"space-y-2",children:[je.slice(0,5).map($=>{const fe=s.find(Te=>Te.id===$.fornitore_id);return a.jsxs("div",{className:"text-sm text-orange-800 flex justify-between",children:[a.jsxs("span",{children:[fe?.ragione_sociale||"N/A"," - ",$.causale]}),a.jsxs("span",{className:"font-semibold",children:[$.giorniMancanti<0?`${Math.abs($.giorniMancanti)}gg fa`:`tra ${$.giorniMancanti}gg`," "," ",parseFloat($.importo||0).toFixed(2)]})]},$.id)}),je.length>5&&a.jsxs("div",{className:"text-xs text-orange-600 mt-2",children:["... e altre ",je.length-5," scadenze"]})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx("button",{onClick:()=>{p(!0),S(null),O({tipo:"uscita",tipologiaMovimento:"bonifico",pagato:!1,modalitaUscita:"pagata"}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuovo Movimento"}),a.jsx("button",{onClick:()=>$e(!0),className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:" Configura Commissioni"}),a.jsx("button",{onClick:De,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:" Esporta PDF"}),a.jsx("button",{onClick:Me,className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:" PDF Prima Nota"}),a.jsxs("button",{onClick:()=>ee(!0),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[" Saldo Iniziale:  ",parseFloat(f).toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("h3",{className:"font-semibold mb-3",children:" Filtri"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[a.jsx("input",{type:"date",className:"border rounded px-3 py-2 text-sm",placeholder:"Da",value:L,onChange:$=>j($.target.value)}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 text-sm",placeholder:"A",value:q,onChange:$=>y($.target.value)}),a.jsxs("select",{className:"border rounded px-3 py-2 text-sm",value:M,onChange:$=>k($.target.value),children:[a.jsx("option",{value:"",children:"Tutti i fornitori"}),s.map($=>a.jsx("option",{value:$.id,children:$.ragione_sociale},$.id))]}),a.jsxs("select",{className:"border rounded px-3 py-2 text-sm",value:te,onChange:$=>ue($.target.value),children:[a.jsx("option",{value:"",children:"Tutti i cantieri"}),l.map($=>a.jsx("option",{value:$.id,children:$.nome},$.id))]}),a.jsxs("select",{className:"border rounded px-3 py-2 text-sm",value:de,onChange:$=>ve($.target.value),children:[a.jsx("option",{value:"",children:"Tutte le tipologie"}),ce.map($=>a.jsx("option",{value:$.value,children:$.label},$.value))]}),a.jsxs("select",{className:"border rounded px-3 py-2 text-sm",value:ie,onChange:$=>pe($.target.value),children:[a.jsx("option",{value:"",children:"Tutti gli stati"}),a.jsx("option",{value:"pagato",children:"Pagati"}),a.jsx("option",{value:"non_pagato",children:"Da pagare"})]})]}),(L||q||M||te||de||ie)&&a.jsx("button",{onClick:()=>{j(""),y(""),k(""),ue(""),ve(""),pe("")},className:"mt-3 text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:" Reset Filtri"})]}),b&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[_?" Modifica":" Nuovo"," Movimento"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo Movimento *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:N.tipo||"uscita",onChange:$=>{const fe=$.target.value;O(fe==="entrata"?{...N,tipo:fe,pagato:!0,dataMovimento:new Date().toISOString().split("T")[0],dataScadenza:"",modalitaUscita:"pagata",tipologiaMovimento:"bonifico"}:fe==="storno"?{...N,tipo:fe,pagato:!1,dataMovimento:"",tipologiaMovimento:"storno",modalitaUscita:"pagata"}:{...N,tipo:fe,pagato:!1,dataMovimento:"",modalitaUscita:"pagata",tipologiaMovimento:"bonifico"})},disabled:T,children:[a.jsx("option",{value:"entrata",children:" Entrata"}),a.jsx("option",{value:"uscita",children:" Uscita"}),a.jsx("option",{value:"storno",children:" Storno"})]})]}),N.tipo==="uscita"&&N.tipologiaMovimento!=="storno"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Modalit Uscita *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:N.modalitaUscita||"pagata",onChange:$=>{const fe=$.target.value;O(fe==="pagata"?{...N,modalitaUscita:fe,pagato:!0,dataMovimento:new Date().toISOString().split("T")[0]}:{...N,modalitaUscita:fe,pagato:!1,dataMovimento:""})},disabled:T,children:[a.jsx("option",{value:"pagata",children:" Pagata subito"}),a.jsx("option",{value:"programmata",children:" Programmata (da pagare)"})]})]}),N.tipo==="entrata"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Movimento *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:N.dataMovimento||new Date().toISOString().split("T")[0],onChange:$=>O({...N,dataMovimento:$.target.value}),disabled:T}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Data registrazione entrata"})]}),N.tipo==="storno"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Storno *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:N.dataMovimento||"",onChange:$=>O({...N,dataMovimento:$.target.value,pagato:!0}),disabled:T}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Data in cui viene effettuato lo storno"})]}),N.tipo==="uscita"&&N.modalitaUscita==="pagata"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Pagamento *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:N.dataMovimento||"",onChange:$=>O({...N,dataMovimento:$.target.value,pagato:!0}),disabled:T})]}),N.tipo==="uscita"&&N.modalitaUscita==="programmata"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Scadenza *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:N.dataScadenza||"",onChange:$=>O({...N,dataScadenza:$.target.value}),disabled:T}),a.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Verr impostata la data di pagamento quando paghi"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornitore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:N.fornitoreId||"",onChange:$=>O({...N,fornitoreId:$.target.value}),disabled:T,children:[a.jsx("option",{value:"",children:"Seleziona fornitore"}),s.map($=>a.jsx("option",{value:$.id,children:$.ragione_sociale},$.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:N.cantiereId||"",onChange:$=>O({...N,cantiereId:$.target.value}),disabled:T,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map($=>a.jsx("option",{value:$.id,children:$.nome},$.id))]})]}),N.tipo!=="storno"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipologia *"}),a.jsx("select",{className:"border rounded px-3 py-2 w-full",value:N.tipologiaMovimento||"bonifico",onChange:$=>{const fe=$.target.value;O({...N,tipologiaMovimento:fe})},disabled:T,children:ce.filter($=>$.value!=="storno").map($=>a.jsx("option",{value:$.value,children:$.label},$.value))})]}),N.tipo==="storno"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Movimento da Stornare *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:N.movimentoStornatoId||"",onChange:$=>{const fe=$.target.value,Te=o.find(Ce=>Ce.id===fe);Te&&(me(Te),O({...N,movimentoStornatoId:fe,importo:Te.importo,commissione:Te.commissione||"0.00",fornitoreId:Te.fornitore_id,cantiereId:Te.cantiere_id}))},disabled:T,children:[a.jsx("option",{value:"",children:"Seleziona movimento"}),o.filter($=>$.tipologia_movimento!=="storno").map($=>{const fe=s.find(Ce=>Ce.id===$.fornitore_id),Te=parseFloat($.importo||0)+parseFloat($.commissione||0);return a.jsxs("option",{value:$.id,children:[Ne($.data_movimento)," - ",fe?.ragione_sociale||"N/A"," - ",$.causale," -  ",Te.toFixed(2)]},$.id)})]}),ne&&a.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded text-xs",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Importo:"}),"  ",parseFloat(ne.importo||0).toFixed(2)]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Commissione:"}),"  ",parseFloat(ne.commissione||0).toFixed(2)]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Totale:"}),"  ",(parseFloat(ne.importo||0)+parseFloat(ne.commissione||0)).toFixed(2)]})]})]}),N.tipo!=="storno"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:N.importo||"",onChange:$=>{const fe=$.target.value,Te=N.tipo==="uscita"?Ve(N.tipologiaMovimento,fe):0;O({...N,importo:fe,commissione:Te.toFixed(2)})},disabled:T})]}),N.tipo==="uscita"&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Commissione ()"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full bg-gray-50",readOnly:!0,value:N.commissione||"0.00"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Causale *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",value:N.causale||"",onChange:$=>O({...N,causale:$.target.value}),disabled:T})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",value:N.note||"",onChange:$=>O({...N,note:$.target.value}),disabled:T})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:nt,disabled:T,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:T?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{p(!1),O({tipo:"uscita",tipologiaMovimento:"bonifico",pagato:!1,modalitaUscita:"pagata"}),S(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:T,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("h3",{className:"font-semibold mb-3",children:" Esporta Report PDF"}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese"}),a.jsx("select",{className:"border rounded px-3 py-2",value:be,onChange:$=>H(Number($.target.value)),children:we.map(($,fe)=>a.jsx("option",{value:fe+1,children:$},fe))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Anno"}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2",value:U,onChange:$=>D(Number($.target.value))})]})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data Movimento"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Tipo"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Tipologia"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Fornitore"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Cantiere"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Causale"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Importo"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Comm."}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Totale"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Saldo"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Scad."}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Stato"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:oe.movimentiConSaldo.map($=>{const fe=s.find(Ie=>Ie.id===$.fornitore_id),Te=l.find(Ie=>Ie.id===$.cantiere_id),Ce=ce.find(Ie=>Ie.value===$.tipologia_movimento),lt=parseFloat($.importo||0)+parseFloat($.commissione||0);return a.jsxs("tr",{className:`border-t hover:bg-gray-50 ${$.tipo==="entrata"?"bg-green-50":"bg-red-50"}`,children:[a.jsx("td",{className:"px-3 py-2",children:Ne($.data_movimento)}),a.jsx("td",{className:"px-3 py-2",children:$.tipologia_movimento==="storno"?a.jsx("span",{className:"px-2 py-1 rounded text-xs bg-gray-200",children:" Storno"}):a.jsx("span",{className:`px-2 py-1 rounded text-xs ${$.tipo==="entrata"?"bg-green-200":"bg-red-200"}`,children:$.tipo==="entrata"?" Entrata":" Uscita"})}),a.jsx("td",{className:"px-3 py-2",children:Ce?.label||$.tipologia_movimento}),a.jsx("td",{className:"px-3 py-2",children:fe?.ragione_sociale||"-"}),a.jsx("td",{className:"px-3 py-2",children:Te?.nome||"-"}),a.jsxs("td",{className:"px-3 py-2 max-w-xs",children:[$.causale,$.tipologia_movimento==="storno"&&$.movimento_stornato_id&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Storno di: ",(()=>{const Ie=o.find(ht=>ht.id===$.movimento_stornato_id);return Ie?Ne(Ie.data_movimento):"N/A"})()]})]}),a.jsxs("td",{className:"px-3 py-2 text-right font-mono",children:[" ",parseFloat($.importo||0).toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right font-mono text-xs",children:[" ",parseFloat($.commissione||0).toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right font-mono font-semibold",children:[$.tipologia_movimento==="storno"?"+":"","  ",lt.toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-right font-mono font-bold",children:$.tipologia_movimento==="storno"?a.jsx("span",{className:"text-gray-400",children:"-"}):` ${$.saldoProgressivo.toFixed(2)}`}),a.jsx("td",{className:"px-3 py-2 text-center text-xs",children:$.tipo==="uscita"?Ne($.data_scadenza):"-"}),a.jsx("td",{className:"px-3 py-2 text-center",children:$.tipo==="entrata"?a.jsx("span",{className:"px-2 py-1 rounded text-xs bg-green-100 text-green-700",children:" Pagato"}):a.jsx("button",{onClick:()=>na($.id),className:`px-2 py-1 rounded text-xs ${$.pagato?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:$.pagato?" Pagato":" Da pagare"})}),a.jsxs("td",{className:"px-3 py-2 text-center",children:[a.jsx("button",{onClick:()=>Yt($),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>pt($),className:"text-red-600",children:""})]})]},$.id)})})]}),oe.movimentiConSaldo.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessun movimento registrato"}),a.jsx("p",{className:"text-sm mt-2",children:'Clicca su " Nuovo Movimento" per iniziare'})]})]}),a.jsxs(a.Fragment,{children:[ke&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Configurazione Commissioni"}),a.jsx("div",{className:"grid grid-cols-2 gap-4",children:ce.filter($=>$.value!=="storno").map($=>a.jsxs("div",{className:"border rounded p-3",children:[a.jsx("div",{className:"font-medium mb-2",children:$.label}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:P[$.value]?.tipo||"fisso",onChange:fe=>he({...P,[$.value]:{...P[$.value],tipo:fe.target.value}}),children:[a.jsx("option",{value:"fisso",children:"Fisso ()"}),a.jsx("option",{value:"percentuale",children:"Percentuale (%)"})]}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-2 py-1 text-sm flex-1",value:P[$.value]?.valore||0,onChange:fe=>he({...P,[$.value]:{...P[$.value],valore:fe.target.value}})})]})]},$.value))}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:async()=>{const $=await g("commissioni",JSON.stringify(P));$.success?(alert(" Commissioni salvate!"),$e(!1)):alert(" Errore: "+$.error)},className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Salva Configurazione"}),a.jsx("button",{onClick:()=>$e(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Chiudi"})]})]})}),R&&V&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Registra Pagamento"}),a.jsxs("div",{className:"mb-4",children:[a.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[a.jsx("strong",{children:"Fornitore:"})," ",s.find($=>$.id===V.fornitore_id)?.ragione_sociale||"N/A"]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:[a.jsx("strong",{children:"Causale:"})," ",V.causale]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[a.jsx("strong",{children:"Importo:"}),"  ",(parseFloat(V.importo||0)+parseFloat(V.commissione||0)).toFixed(2)]}),a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Data Pagamento *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:A,onChange:$=>I($.target.value)})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:Je,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:" Conferma Pagamento"}),a.jsx("button",{onClick:()=>{E(!1),w(null),I("")},className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Annulla"})]})]})}),K&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[a.jsx("h3",{className:"text-xl font-semibold mb-4",children:" Imposta Saldo Iniziale"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Il saldo iniziale rappresenta il capitale di partenza della contabilit. Verr sommato a tutti i calcoli (saldo reale e saldo previsto)."}),a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Saldo Iniziale ()"}),a.jsx("input",{id:"input-saldo-iniziale",type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",defaultValue:f,placeholder:"0.00"}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:" Inserisci il valore positivo o negativo del saldo di partenza"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:async()=>{const fe=document.getElementById("input-saldo-iniziale").value,Te=await g("saldo_iniziale",fe);Te.success?(alert(" Saldo iniziale salvato!"),ee(!1),window.location.reload()):alert(" Errore: "+Te.error)},className:"flex-1 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:" Salva"}),a.jsx("button",{onClick:()=>ee(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Annulla"})]})]})})]})]})}function xy(){const{fattureEmesse:o=[],fornitori:s=[],cantieri:l=[],loading:r,addRecord:d,updateRecord:u,deleteRecord:m}=wt(),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1),[O,T]=F.useState(!1),[z,L]=F.useState(null),[j,q]=F.useState("");if(r.fattureEmesse||r.fornitori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento fatture..."})]})});const y=D=>{if(!D)return"-";const R=new Date(D);return isNaN(R.getTime())?D:R.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},M=(D,R)=>parseFloat(D||0)*parseFloat(R||22)/100,k=(D,R)=>parseFloat(D||0)+M(D,R),te=D=>!D.acconti||D.acconti.length===0?0:D.acconti.reduce((R,E)=>R+parseFloat(E.importo||0),0),ue=D=>k(D.imponibile,D.percentuale_iva)-te(D),de=F.useMemo(()=>o.filter(D=>!(j&&D.cliente_id!==j)).sort((D,R)=>{const E=D.numero_fattura||"";return(R.numero_fattura||"").localeCompare(E,void 0,{numeric:!0,sensitivity:"base"})}),[o,j]),ve=F.useMemo(()=>{if(!j)return null;const D=o.filter(w=>w.cliente_id===j),R=D.reduce((w,A)=>w+k(A.imponibile,A.percentuale_iva),0),E=D.reduce((w,A)=>w+te(A),0),V=R-E;return{totaleEmesso:R,totaleIncassato:E,residuo:V}},[o,j]),ie=async()=>{if(!p.dataFattura||!p.numeroFattura||!p.clienteId||!p.imponibile)return alert(` Compila tutti i campi obbligatori:
- Data Fattura
- Numero Fattura
- Cliente
- Imponibile`);N(!0);const D={data_fattura:p.dataFattura,numero_fattura:p.numeroFattura,cliente_id:p.clienteId,cantiere_id:p.cantiereId||null,imponibile:parseFloat(p.imponibile),percentuale_iva:parseFloat(p.percentualeIVA||22),acconti:p.acconti||[],note:p.note||null};let R;f?R=await u("fattureEmesse",f,D):R=await d("fattureEmesse",D),N(!1),R.success?(alert(f?" Fattura aggiornata!":" Fattura creata!"),g(!1),_({percentualeIVA:22,acconti:[]}),b(null)):alert(" Errore: "+R.error)},pe=async D=>{if(!confirm(` Eliminare la fattura ${D.numero_fattura}?

Questa azione  irreversibile!`))return;const R=await m("fattureEmesse",D.id);R.success?alert(" Fattura eliminata!"):alert(" Errore: "+R.error)},be=D=>{_({dataFattura:D.data_fattura,numeroFattura:D.numero_fattura,clienteId:D.cliente_id,cantiereId:D.cantiere_id,imponibile:D.imponibile,percentualeIVA:D.percentuale_iva,acconti:D.acconti||[],note:D.note}),b(D.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},H=async(D,R,E)=>{const V=o.find(I=>I.id===D);if(!V)return;const w={id:Date.now().toString(),importo:parseFloat(R),dataIncasso:E,data:new Date().toISOString()},A=await u("fattureEmesse",D,{acconti:[...V.acconti||[],w]});A.success?(L(A.data),alert(" Acconto aggiunto!")):alert(" Errore: "+A.error)},U=async(D,R)=>{const E=o.find(w=>w.id===D);if(!E)return;const V=await u("fattureEmesse",D,{acconti:(E.acconti||[]).filter(w=>w.id!==R)});V.success?L(V.data):alert(" Errore: "+V.error)};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("button",{onClick:()=>{g(!0),b(null),_({percentualeIVA:22,acconti:[]}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuova Fattura"}),a.jsxs("select",{className:"border rounded px-3 py-2",value:j,onChange:D=>q(D.target.value),children:[a.jsx("option",{value:"",children:"Tutti i clienti"}),s.map(D=>a.jsx("option",{value:D.id,children:D.ragione_sociale},D.id))]})]}),ve&&a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Emesso"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",ve.totaleEmesso.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale Incassato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",ve.totaleIncassato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Residuo"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",ve.residuo.toFixed(2)]})]})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuova"," Fattura"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fattura *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p.dataFattura||"",onChange:D=>_({...p,dataFattura:D.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Fattura *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"es: 2025/001",value:p.numeroFattura||"",onChange:D=>_({...p,numeroFattura:D.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cliente *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.clienteId||"",onChange:D=>_({...p,clienteId:D.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Seleziona cliente"}),s.map(D=>a.jsx("option",{value:D.id,children:D.ragione_sociale},D.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.cantiereId||"",onChange:D=>_({...p,cantiereId:D.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map(D=>a.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Imponibile * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:p.imponibile||"",onChange:D=>_({...p,imponibile:D.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"IVA (%)"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:p.percentualeIVA||22,onChange:D=>_({...p,percentualeIVA:D.target.value}),disabled:S})]}),a.jsx("div",{className:"col-span-2 bg-gray-50 p-4 rounded",children:a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"IVA"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",M(p.imponibile,p.percentualeIVA).toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Totale"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[" ",k(p.imponibile,p.percentualeIVA).toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Residuo"}),a.jsxs("div",{className:"text-xl font-bold text-orange-600",children:[" ",(k(p.imponibile,p.percentualeIVA)-te(p)).toFixed(2)]})]})]})}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Note aggiuntive...",value:p.note||"",onChange:D=>_({...p,note:D.target.value}),disabled:S})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:ie,disabled:S,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({percentualeIVA:22,acconti:[]}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Numero"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Cliente"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Cantiere"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Imponibile"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"IVA"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Totale"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Incassato"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Residuo"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:de.map(D=>{const R=s.find(I=>I.id===D.cliente_id),E=l.find(I=>I.id===D.cantiere_id),V=k(D.imponibile,D.percentuale_iva),w=te(D),A=ue(D);return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2",children:y(D.data_fattura)}),a.jsx("td",{className:"px-3 py-2 font-mono",children:D.numero_fattura}),a.jsx("td",{className:"px-3 py-2",children:R?.ragione_sociale||"-"}),a.jsx("td",{className:"px-3 py-2",children:E?.nome||"-"}),a.jsxs("td",{className:"px-3 py-2 text-right",children:[" ",parseFloat(D.imponibile).toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right",children:[" ",M(D.imponibile,D.percentuale_iva).toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right font-semibold",children:[" ",V.toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right text-green-700",children:[" ",w.toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right font-semibold text-orange-700",children:[" ",A.toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-center",children:[a.jsx("button",{onClick:()=>{L(D),T(!0)},className:"text-green-600 mr-2",title:"Gestisci Acconti",children:""}),a.jsx("button",{onClick:()=>be(D),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>pe(D),className:"text-red-600",children:""})]})]},D.id)})})]}),de.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessuna fattura registrata"}),a.jsx("p",{className:"text-sm mt-2 text-gray-400",children:'Clicca su " Nuova Fattura" per iniziare'})]})]}),O&&z&&a.jsx(by,{fattura:z,onClose:()=>{T(!1),L(null)},aggiungiAcconto:H,rimuoviAcconto:U,formatDate:y,calcolaTotale:k,calcolaIncassato:te})]})}function by({fattura:o,onClose:s,aggiungiAcconto:l,rimuoviAcconto:r,formatDate:d,calcolaTotale:u,calcolaIncassato:m}){const[x,g]=F.useState(""),[f,b]=F.useState(new Date().toISOString().split("T")[0]),p=u(o.imponibile,o.percentuale_iva),_=m(o),S=p-_;return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Acconti - Fattura ",o.numero_fattura]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-blue-700",children:"Totale Fattura"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",p.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-green-700",children:"Incassato"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",_.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-orange-700",children:"Residuo"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",S.toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Registra Nuovo Acconto"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Importo ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:x,onChange:N=>g(N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Data Incasso"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:f,onChange:N=>b(N.target.value)})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{if(!x||parseFloat(x)<=0)return alert(" Inserisci un importo valido");l(o.id,x,f),g(""),b(new Date().toISOString().split("T")[0])},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full",children:" Aggiungi"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Acconti Registrati"}),(o.acconti||[]).length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-6 bg-gray-50 rounded",children:"Nessun acconto registrato"}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data Incasso"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Importo"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:o.acconti.map(N=>a.jsxs("tr",{className:"border-t",children:[a.jsx("td",{className:"px-3 py-2",children:d(N.dataIncasso)}),a.jsxs("td",{className:"px-3 py-2 text-right font-semibold",children:[" ",parseFloat(N.importo).toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-center",children:a.jsx("button",{onClick:()=>{confirm("Eliminare questo acconto?")&&r(o.id,N.id)},className:"text-red-600",children:""})})]},N.id))})]})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:s,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Chiudi"})})]})})}function vy(){const{storicoPaghe:o=[],lavoratori:s=[],cantieri:l=[],loading:r,addRecord:d,updateRecord:u,deleteRecord:m}=wt(),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1),[O,T]=F.useState(!1),[z,L]=F.useState(null),[j,q]=F.useState(""),y=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],M=[{value:"stipendio",label:"Stipendio"},{value:"paga",label:"Paga"},{value:"tfr",label:"TFR"},{value:"tredicesima",label:"13 Mensilit"},{value:"quattordicesima",label:"14 Mensilit"}],k=R=>{if(!R)return"-";const E=new Date(R);return isNaN(E.getTime())?R:E.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},te=R=>!R.bonifici||R.bonifici.length===0?0:R.bonifici.reduce((E,V)=>E+parseFloat(V.importo||0),0),ue=R=>parseFloat(R.importo||0)-te(R),de=F.useMemo(()=>o.filter(R=>!(j&&R.lavoratore_id!==j)).sort((R,E)=>E.anno!==R.anno?E.anno-R.anno:E.mese-R.mese),[o,j]),ve=F.useMemo(()=>{if(!j)return null;const R=o.filter(A=>A.lavoratore_id===j),E=R.reduce((A,I)=>A+parseFloat(I.importo||0),0),V=R.reduce((A,I)=>A+te(I),0),w=E-V;return{totaleImporti:E,totaleBonificato:V,residuo:w}},[o,j]),ie=()=>{if(de.length===0)return alert(" Nessuna paga da esportare");const E=new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),V={};de.forEach(me=>{V[me.lavoratore_id]||(V[me.lavoratore_id]=[]),V[me.lavoratore_id].push(me)}),Object.keys(V).forEach(me=>{V[me].sort((ke,$e)=>ke.anno!==$e.anno?$e.anno-ke.anno:$e.mese-ke.mese)});const w=de.reduce((me,ke)=>me+parseFloat(ke.importo||0),0),A=de.reduce((me,ke)=>me+te(ke),0),I=w-A,K=j?`Storico Paghe - ${s.find(me=>me.id===j)?.nome} ${s.find(me=>me.id===j)?.cognome}`:"Storico Paghe - Tutti i Lavoratori";let ee=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>${K}</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; font-size: 11px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; }
    h2 { color: #2563eb; font-size: 16px; margin-top: 25px; margin-bottom: 10px; background: #eff6ff; padding: 10px; border-left: 4px solid #3b82f6; }
    table { border-collapse: collapse; width: 100%; margin: 15px 0; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #3b82f6; color: white; font-weight: bold; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .text-right { text-align: right; }
    .note-cell { font-style: italic; color: #6b7280; font-size: 10px; padding-top: 4px; }
    .summary { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    .summary-box { background: white; padding: 10px; border-radius: 5px; border: 2px solid #3b82f6; }
    .summary-label { font-size: 10px; color: #1e40af; margin-bottom: 5px; }
    .summary-value { font-size: 18px; font-weight: bold; color: #1e3a8a; }
    .lavoratore-totale { background-color: #dbeafe; font-weight: bold; }
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      button { display: none !important; }
      .lavoratore-section { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
  <button onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">
     Stampa / Salva PDF
  </button>
  
  <h1> ${K}</h1>
  <p><strong>Data Stampa:</strong> ${E}</p>
  <p><strong>Numero Record:</strong> ${de.length}</p>
  
  <div class="summary">
    <div class="summary-grid">
      <div class="summary-box">
        <div class="summary-label">Totale Importi</div>
        <div class="summary-value"> ${w.toFixed(2)}</div>
      </div>
      <div class="summary-box" style="border-color: #10b981;">
        <div class="summary-label" style="color: #059669;">Totale Bonificato</div>
        <div class="summary-value" style="color: #047857;"> ${A.toFixed(2)}</div>
      </div>
      <div class="summary-box" style="border-color: #f59e0b;">
        <div class="summary-label" style="color: #d97706;">Residuo Totale</div>
        <div class="summary-value" style="color: #b45309;"> ${I.toFixed(2)}</div>
      </div>
    </div>
  </div>
`;Object.entries(V).forEach(([me,ke])=>{const $e=s.find(ce=>ce.id===me),St=$e?`${$e.nome} ${$e.cognome}`:"Lavoratore Sconosciuto",Q=ke.reduce((ce,we)=>ce+parseFloat(we.importo||0),0),P=ke.reduce((ce,we)=>ce+te(we),0),he=Q-P;ee+=`
  <div class="lavoratore-section">
    <h2> ${St}</h2>
    <p><strong>Numero Paghe:</strong> ${ke.length}</p>
    
    <table>
      <thead>
        <tr>
          <th>Periodo</th>
          <th>Tipologia</th>
          <th>Cantiere</th>
          <th class="text-right">Importo</th>
          <th class="text-right">Bonificato</th>
          <th class="text-right">Residuo</th>
          <th>Note</th>
        </tr>
      </thead>
      <tbody>
        ${ke.map(ce=>{const we=l.find(pt=>pt.id===ce.cantiere_id),Ne=M.find(pt=>pt.value===ce.tipologia),Ve=te(ce),nt=ue(ce);return`
          <tr>
            <td>${y[ce.mese-1]} ${ce.anno}</td>
            <td>${Ne?.label||ce.tipologia}</td>
            <td>${we?.nome||"-"}</td>
            <td class="text-right"> ${parseFloat(ce.importo).toFixed(2)}</td>
            <td class="text-right" style="color: #059669;"> ${Ve.toFixed(2)}</td>
            <td class="text-right" style="color: #d97706; font-weight: bold;"> ${nt.toFixed(2)}</td>
            <td>${ce.note||"-"}</td>
          </tr>
          `}).join("")}
        <tr class="lavoratore-totale">
          <td colspan="3" style="text-align: right; padding-right: 10px;">TOTALE ${St.toUpperCase()}:</td>
          <td class="text-right"> ${Q.toFixed(2)}</td>
          <td class="text-right" style="color: #059669;"> ${P.toFixed(2)}</td>
          <td class="text-right" style="color: #d97706;"> ${he.toFixed(2)}</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>
`}),ee+=`
  <div style="margin-top: 30px; padding: 10px; background: #eff6ff; border-top: 2px solid #1e40af; font-size: 9px;">
    <p>Documento generato automaticamente da Marrel S.r.l. - ${E}</p>
  </div>
</body>
</html>`;const ne=window.open("","_blank");ne?(ne.document.write(ee),ne.document.close()):alert(" Popup bloccato! Abilita i popup per questo sito.")};if(r.storicoPaghe||r.lavoratori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento storico paghe..."})]})});const pe=async()=>{if(!p.lavoratoreId||!p.tipologia||!p.mese||!p.anno||!p.importo)return alert(` Compila tutti i campi obbligatori:
- Dipendente
- Tipologia
- Mese
- Anno
- Importo`);N(!0);const R={lavoratore_id:p.lavoratoreId,mese:parseInt(p.mese),anno:parseInt(p.anno),tipologia:p.tipologia,importo:parseFloat(p.importo),cantiere_id:p.cantiereId||null,bonifici:p.bonifici||[],note:p.note||null};let E;f?E=await u("storicoPaghe",f,R):E=await d("storicoPaghe",R),N(!1),E.success?(alert(f?" Paga aggiornata!":" Paga creata!"),g(!1),_({mese:new Date().getMonth()+1,anno:new Date().getFullYear(),tipologia:"stipendio",bonifici:[]}),b(null)):alert(" Errore: "+E.error)},be=async R=>{const E=s.find(A=>A.id===R.lavoratore_id),V=E?`${E.nome} ${E.cognome}`:"questo dipendente";if(!confirm(` Eliminare la paga di ${V} - ${y[R.mese-1]} ${R.anno}?

Questa azione  irreversibile!`))return;const w=await m("storicoPaghe",R.id);w.success?alert(" Paga eliminata!"):alert(" Errore: "+w.error)},H=R=>{_({lavoratoreId:R.lavoratore_id,mese:R.mese,anno:R.anno,tipologia:R.tipologia,importo:R.importo,cantiereId:R.cantiere_id,bonifici:R.bonifici||[],note:R.note}),b(R.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},U=async(R,E,V)=>{const w=o.find(K=>K.id===R);if(!w)return;const A={id:Date.now().toString(),importo:parseFloat(E),dataBonifico:V,data:new Date().toISOString()},I=await u("storicoPaghe",R,{bonifici:[...w.bonifici||[],A]});I.success?(L(I.data),alert(" Bonifico aggiunto!")):alert(" Errore: "+I.error)},D=async(R,E)=>{const V=o.find(A=>A.id===R);if(!V)return;const w=await u("storicoPaghe",R,{bonifici:(V.bonifici||[]).filter(A=>A.id!==E)});w.success?L(w.data):alert(" Errore: "+w.error)};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{g(!0),b(null),_({mese:new Date().getMonth()+1,anno:new Date().getFullYear(),tipologia:"stipendio",bonifici:[]}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuova Paga"}),de.length>0&&a.jsx("button",{onClick:ie,className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:" Esporta PDF"})]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:j,onChange:R=>q(R.target.value),children:[a.jsx("option",{value:"",children:"Tutti i lavoratori"}),s.map(R=>a.jsxs("option",{value:R.id,children:[R.nome," ",R.cognome]},R.id))]})]}),ve&&a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Importi"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",ve.totaleImporti.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Totale Bonificato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",ve.totaleBonificato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Residuo"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",ve.residuo.toFixed(2)]})]})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuova"," Paga"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dipendente *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.lavoratoreId||"",onChange:R=>_({...p,lavoratoreId:R.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Seleziona dipendente"}),s.map(R=>a.jsxs("option",{value:R.id,children:[R.nome," ",R.cognome]},R.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipologia *"}),a.jsx("select",{className:"border rounded px-3 py-2 w-full",value:p.tipologia||"stipendio",onChange:R=>_({...p,tipologia:R.target.value}),disabled:S,children:M.map(R=>a.jsx("option",{value:R.value,children:R.label},R.value))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mese *"}),a.jsx("select",{className:"border rounded px-3 py-2 w-full",value:p.mese||new Date().getMonth()+1,onChange:R=>_({...p,mese:parseInt(R.target.value)}),disabled:S,children:y.map((R,E)=>a.jsx("option",{value:E+1,children:R},E))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Anno *"}),a.jsx("input",{type:"number",className:"border rounded px-3 py-2 w-full",value:p.anno||new Date().getFullYear(),onChange:R=>_({...p,anno:parseInt(R.target.value)}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:p.importo||"",onChange:R=>_({...p,importo:R.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.cantiereId||"",onChange:R=>_({...p,cantiereId:R.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map(R=>a.jsx("option",{value:R.id,children:R.nome},R.id))]})]}),a.jsx("div",{className:"col-span-2 bg-gray-50 p-4 rounded",children:a.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Importo Totale"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[" ",parseFloat(p.importo||0).toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Bonificato"}),a.jsxs("div",{className:"text-xl font-bold text-green-600",children:[" ",te(p).toFixed(2)]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Residuo"}),a.jsxs("div",{className:"text-xl font-bold text-orange-600",children:[" ",(parseFloat(p.importo||0)-te(p)).toFixed(2)]})]})]})}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Note aggiuntive...",value:p.note||"",onChange:R=>_({...p,note:R.target.value}),disabled:S})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:pe,disabled:S,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({mese:new Date().getMonth()+1,anno:new Date().getFullYear(),tipologia:"stipendio",bonifici:[]}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow overflow-x-auto",children:[a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Dipendente"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Periodo"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Tipologia"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Cantiere"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Importo"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Bonificato"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Residuo"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Note"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:de.map(R=>{const E=s.find(K=>K.id===R.lavoratore_id),V=l.find(K=>K.id===R.cantiere_id),w=M.find(K=>K.value===R.tipologia),A=te(R),I=ue(R);return a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2 font-semibold",children:E?`${E.nome} ${E.cognome}`:"-"}),a.jsxs("td",{className:"px-3 py-2",children:[a.jsxs("div",{className:"font-medium",children:[y[R.mese-1]," ",R.anno]}),V&&a.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[" ",V.nome]})]}),a.jsx("td",{className:"px-3 py-2",children:w?.label||R.tipologia}),a.jsx("td",{className:"px-3 py-2",children:V?.nome||"-"}),a.jsxs("td",{className:"px-3 py-2 text-right font-mono",children:[" ",parseFloat(R.importo).toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right text-green-700 font-mono",children:[" ",A.toFixed(2)]}),a.jsxs("td",{className:"px-3 py-2 text-right font-semibold text-orange-700 font-mono",children:[" ",I.toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-gray-600 italic text-xs",children:R.note||"-"}),a.jsxs("td",{className:"px-3 py-2 text-center",children:[a.jsx("button",{onClick:()=>{L(R),T(!0)},className:"text-green-600 mr-2",title:"Gestisci Bonifici",children:""}),a.jsx("button",{onClick:()=>H(R),className:"text-blue-600 mr-2",children:""}),a.jsx("button",{onClick:()=>be(R),className:"text-red-600",children:""})]})]},R.id)})})]}),de.length===0&&a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{children:"Nessuna paga registrata"}),a.jsx("p",{className:"text-sm mt-2 text-gray-400",children:'Clicca su " Nuova Paga" per iniziare'})]})]}),O&&z&&a.jsx(yy,{paga:z,lavoratori:s,mesiNomi:y,onClose:()=>{T(!1),L(null)},aggiungiBonifico:U,rimuoviBonifico:D,formatDate:k,calcolaBonificato:te})]})}function yy({paga:o,lavoratori:s,mesiNomi:l,onClose:r,aggiungiBonifico:d,rimuoviBonifico:u,formatDate:m,calcolaBonificato:x}){const[g,f]=F.useState(""),[b,p]=F.useState(new Date().toISOString().split("T")[0]),_=s.find(T=>T.id===o.lavoratore_id),S=parseFloat(o.importo||0),N=x(o),O=S-N;return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Bonifici - ",_?.nome," ",_?.cognome," - ",l[o.mese-1]," ",o.anno]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-blue-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-blue-700",children:"Importo Totale"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",S.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-green-700",children:"Bonificato"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",N.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-3 rounded",children:[a.jsx("div",{className:"text-sm text-orange-700",children:"Residuo"}),a.jsxs("div",{className:"text-xl font-bold",children:[" ",O.toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded mb-4",children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Registra Nuovo Bonifico"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Importo ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:g,onChange:T=>f(T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Data Bonifico"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:b,onChange:T=>p(T.target.value)})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:()=>{if(!g||parseFloat(g)<=0)return alert(" Inserisci un importo valido");d(o.id,g,b),f(""),p(new Date().toISOString().split("T")[0])},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full",children:" Aggiungi"})})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-3",children:"Bonifici Registrati"}),(o.bonifici||[]).length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-6 bg-gray-50 rounded",children:"Nessun bonifico registrato"}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data Bonifico"}),a.jsx("th",{className:"px-3 py-2 text-right",children:"Importo"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:o.bonifici.map(T=>a.jsxs("tr",{className:"border-t",children:[a.jsx("td",{className:"px-3 py-2",children:m(T.dataBonifico)}),a.jsxs("td",{className:"px-3 py-2 text-right font-semibold",children:[" ",parseFloat(T.importo).toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-center",children:a.jsx("button",{onClick:()=>{confirm("Eliminare questo bonifico?")&&u(o.id,T.id)},className:"text-red-600",children:""})})]},T.id))})]})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:r,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Chiudi"})})]})})}function jy(){const{dttFormulari:o=[],fornitori:s=[],cantieri:l=[],loading:r,addRecord:d,updateRecord:u,deleteRecord:m}=wt(),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1),[O,T]=F.useState(!1),[z,L]=F.useState(null),[j,q]=F.useState(""),[y,M]=F.useState(""),[k,te]=F.useState({}),ue=E=>{if(!E)return"-";const V=new Date(E);return isNaN(V.getTime())?E:V.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},de=E=>{const V=E.documenti||[];if(V.length===0)return{label:"Nessun documento",color:"bg-gray-100 text-gray-700",mancanti:0,totale:0};const w=V.filter(I=>!I.ricevuto).length,A=V.length;return w===0?{label:"Completo",color:"bg-green-100 text-green-700",mancanti:w,totale:A}:w===A?{label:"Tutto mancante",color:"bg-red-100 text-red-700",mancanti:w,totale:A}:{label:`${w}/${A} mancanti`,color:"bg-orange-100 text-orange-700",mancanti:w,totale:A}},ve=F.useMemo(()=>o.filter(E=>{if(j&&E.fornitore_id!==j)return!1;if(y){const V=de(E);if(y==="completo"&&V.mancanti>0||y==="mancante"&&V.mancanti===0)return!1}return!0}).sort((E,V)=>{const w=E.numero_fattura||"";return(V.numero_fattura||"").localeCompare(w,void 0,{numeric:!0,sensitivity:"base"})}),[o,j,y]),ie=F.useMemo(()=>{const E=ve.length;let V=0,w=0,A=0,I=0,K=0;return ve.forEach(ee=>{(ee.documenti||[]).forEach(ne=>{V++,ne.ricevuto?w++:A++,ne.tipo==="dtt"&&I++,ne.tipo==="formulario"&&K++})}),{totaleFatture:E,totaleDocumenti:V,totaleRicevuti:w,totaleMancanti:A,totaleDTT:I,totaleFormulari:K}},[ve]);if(r.dttFormulari||r.fornitori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento DTT/Formulari..."})]})});const pe=async()=>{if(!p.numeroFattura||!p.dataFattura||!p.fornitoreId)return alert(` Compila tutti i campi obbligatori:
- Numero Fattura
- Data Fattura
- Fornitore`);N(!0);const E={numero_fattura:p.numeroFattura,data_fattura:p.dataFattura,fornitore_id:p.fornitoreId,cantiere_id:p.cantiereId||null,documenti:p.documenti||[],note:p.note||null};let V;f?V=await u("dttFormulari",f,E):V=await d("dttFormulari",E),N(!1),V.success?(alert(f?" Fattura aggiornata!":" Fattura creata!"),g(!1),_({documenti:[]}),b(null)):alert(" Errore: "+V.error)},be=async E=>{if(!confirm(` Eliminare la fattura ${E.numero_fattura}?

Questa azione  irreversibile!`))return;const V=await m("dttFormulari",E.id);V.success?alert(" Fattura eliminata!"):alert(" Errore: "+V.error)},H=E=>{_({numeroFattura:E.numero_fattura,dataFattura:E.data_fattura,fornitoreId:E.fornitore_id,cantiereId:E.cantiere_id,documenti:E.documenti||[],note:E.note}),b(E.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},U=async(E,V)=>{const w=o.find(I=>I.id===E);if(!w)return;const A=await u("dttFormulari",E,{documenti:w.documenti.map(I=>I.id===V?{...I,ricevuto:!0,dataRicezione:new Date().toISOString().split("T")[0]}:I)});A.success||alert(" Errore: "+A.error)},D=async(E,V)=>{const w=o.find(I=>I.id===E);if(!w)return;const A=await u("dttFormulari",E,{documenti:w.documenti.map(I=>I.id===V?{...I,ricevuto:!1,dataRicezione:""}:I)});A.success||alert(" Errore: "+A.error)},R=async(E,V)=>{if(!confirm(" Eliminare questo documento?"))return;const w=o.find(I=>I.id===E);if(!w)return;const A=await u("dttFormulari",E,{documenti:w.documenti.filter(I=>I.id!==V)});A.success||alert(" Errore: "+A.error)};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"DTT / Formulari"}),a.jsx("button",{onClick:()=>{g(!0),b(null),_({documenti:[]}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Nuova Fattura"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("h3",{className:"font-semibold mb-3",children:" Filtri"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornitore"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:j,onChange:E=>q(E.target.value),children:[a.jsx("option",{value:"",children:"Tutti i fornitori"}),s.map(E=>a.jsx("option",{value:E.id,children:E.ragione_sociale},E.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Stato"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:y,onChange:E=>M(E.target.value),children:[a.jsx("option",{value:"",children:"Tutti gli stati"}),a.jsx("option",{value:"mancante",children:" Con documenti mancanti"}),a.jsx("option",{value:"completo",children:" Completi"})]})]})]}),(j||y)&&a.jsx("button",{onClick:()=>{q(""),M("")},className:"mt-3 text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300",children:" Reset Filtri"})]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Fatture"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:ie.totaleFatture})]}),a.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[a.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Tot. Documenti"}),a.jsx("div",{className:"text-2xl font-bold text-purple-900",children:ie.totaleDocumenti})]}),a.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[a.jsx("div",{className:"text-sm text-red-700 mb-1",children:" Mancanti"}),a.jsx("div",{className:"text-2xl font-bold text-red-900",children:ie.totaleMancanti})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:" Ricevuti"}),a.jsx("div",{className:"text-2xl font-bold text-green-900",children:ie.totaleRicevuti})]}),a.jsxs("div",{className:"bg-cyan-50 p-4 rounded-lg border border-cyan-200",children:[a.jsx("div",{className:"text-sm text-cyan-700 mb-1",children:" DTT"}),a.jsx("div",{className:"text-2xl font-bold text-cyan-900",children:ie.totaleDTT})]}),a.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:" Formulari"}),a.jsx("div",{className:"text-2xl font-bold text-orange-900",children:ie.totaleFormulari})]})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuova"," Fattura"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Fattura *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"es: 2025/001",value:p.numeroFattura||"",onChange:E=>_({...p,numeroFattura:E.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fattura *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p.dataFattura||"",onChange:E=>_({...p,dataFattura:E.target.value}),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornitore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.fornitoreId||"",onChange:E=>_({...p,fornitoreId:E.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Seleziona fornitore"}),s.map(E=>a.jsx("option",{value:E.id,children:E.ragione_sociale},E.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.cantiereId||"",onChange:E=>_({...p,cantiereId:E.target.value}),disabled:S,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map(E=>a.jsx("option",{value:E.id,children:E.nome},E.id))]})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Note"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Note aggiuntive...",value:p.note||"",onChange:E=>_({...p,note:E.target.value}),disabled:S})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:pe,disabled:S,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:S?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({documenti:[]}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:S,children:" Annulla"})]})]}),a.jsx("div",{className:"space-y-4",children:ve.length===0?a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessuna fattura registrata"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:'Clicca su " Nuova Fattura" per iniziare'})]}):ve.map(E=>{const V=s.find(I=>I.id===E.fornitore_id),w=l.find(I=>I.id===E.cantiere_id),A=de(E);return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[(E.documenti||[]).length>0&&a.jsx("button",{onClick:()=>te({...k,[E.id]:!k[E.id]}),className:"text-2xl text-blue-600 hover:text-blue-700 transition-transform",style:{transform:k[E.id]?"rotate(90deg)":"rotate(0deg)"},children:""}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("h3",{className:"text-xl font-bold text-blue-600",children:["Fattura ",E.numero_fattura]}),a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${A.color}`,children:A.label})]}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[a.jsx("span",{className:"font-medium",children:V?.ragione_sociale||"-"}),w&&a.jsxs("span",{children:["  ",w.nome]}),a.jsxs("span",{children:["  ",ue(E.data_fattura)]}),(E.documenti||[]).length>0&&!k[E.id]&&a.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold",children:A.mancanti>0?`${A.mancanti} doc. mancanti`:`${A.totale} doc. completi`})]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>{L(E),T(!0)},className:"bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm",children:" Gestisci Documenti"}),a.jsx("button",{onClick:()=>H(E),className:"text-blue-600 text-xl",children:""}),a.jsx("button",{onClick:()=>be(E),className:"text-red-600 text-xl",children:""})]})]}),(E.documenti||[]).length>0&&k[E.id]&&a.jsxs("div",{className:"border-t pt-4",children:[a.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Documenti richiesti:"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:E.documenti.map(I=>a.jsxs("div",{className:`flex items-center justify-between p-3 rounded border ${I.ricevuto?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-lg",children:I.tipo==="dtt"?"":I.tipo==="formulario"?"":""}),a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-sm",children:I.descrizione||I.numeroDocumento||"Documento senza descrizione"}),I.numeroDocumento&&I.descrizione&&a.jsx("div",{className:"text-xs text-gray-600 font-mono",children:I.numeroDocumento})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[I.ricevuto?a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-xs text-green-700 font-semibold",children:[" ",ue(I.dataRicezione)]}),a.jsx("button",{onClick:()=>D(E.id,I.id),className:"text-orange-600 hover:text-orange-700 text-sm",title:"Annulla ricezione",children:""})]}):a.jsx("button",{onClick:()=>U(E.id,I.id),className:"bg-orange-500 text-white px-2 py-1 rounded text-xs hover:bg-orange-600",title:"Conferma ricezione",children:" Conferma ricezione"}),a.jsx("button",{onClick:()=>R(E.id,I.id),className:"text-red-600 hover:text-red-700",title:"Elimina documento",children:""})]})]},I.id))})]}),E.note&&a.jsx("div",{className:"mt-4 bg-gray-50 p-3 rounded border-l-4 border-gray-400",children:a.jsxs("p",{className:"text-sm text-gray-700",children:[a.jsx("strong",{children:" Note:"})," ",E.note]})})]},E.id)})}),O&&z&&a.jsx(Ny,{fattura:z,onClose:()=>{T(!1),L(null)},updateRecord:u})]})}function Ny({fattura:o,onClose:s,updateRecord:l}){const[r,d]=F.useState("dtt"),[u,m]=F.useState(""),[x,g]=F.useState(""),f=[{value:"dtt",label:" DTT (Documento Trasporto)"},{value:"formulario",label:" Formulario Rifiuti"},{value:"altro",label:" Altro Documento"}],b=async()=>{const _={id:Date.now().toString(),tipo:r,descrizione:u,numeroDocumento:x,ricevuto:!1,dataRicezione:""},S=await l("dttFormulari",o.id,{documenti:[...o.documenti||[],_]});S.success?(m(""),g(""),alert(" Documento aggiunto!"),o.documenti=S.data.documenti):alert(" Errore: "+S.error)},p=async _=>{if(!confirm("Eliminare questo documento?"))return;const S=await l("dttFormulari",o.id,{documenti:o.documenti.filter(N=>N.id!==_)});S.success?o.documenti=S.data.documenti:alert(" Errore: "+S.error)};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Gestione Documenti - Fattura ",o.numero_fattura]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[a.jsx("h4",{className:"font-medium mb-3 text-blue-900",children:" Aggiungi Documento"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[a.jsx("select",{className:"border rounded px-3 py-2 bg-white",value:r,onChange:_=>d(_.target.value),children:f.map(_=>a.jsx("option",{value:_.value,children:_.label},_.value))}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 col-span-2",placeholder:"Descrizione documento (opzionale)",value:u,onChange:_=>m(_.target.value)})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsx("input",{type:"text",className:"border rounded px-3 py-2 col-span-2",placeholder:"Numero documento (opzionale)",value:x,onChange:_=>g(_.target.value)}),a.jsx("button",{onClick:b,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:" Aggiungi"})]})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3",children:["Documenti Registrati (",(o.documenti||[]).length,")"]}),(o.documenti||[]).length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Nessun documento registrato. Usa il form sopra per aggiungere documenti."}):a.jsx("div",{className:"space-y-2",children:o.documenti.map(_=>{const S=f.find(N=>N.value===_.tipo);return a.jsxs("div",{className:`flex items-center justify-between p-3 rounded border ${_.ricevuto?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200"}`,children:[a.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[a.jsx("span",{className:"text-xl",children:S?.label.split(" ")[0]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:_.descrizione||_.numeroDocumento||"Documento senza descrizione"}),_.numeroDocumento&&_.descrizione&&a.jsx("div",{className:"text-xs text-gray-600 font-mono",children:_.numeroDocumento})]}),_.ricevuto&&a.jsx("span",{className:"text-xs text-green-700 font-semibold",children:" Ricevuto"})]}),a.jsx("button",{onClick:()=>p(_.id),className:"text-red-600 hover:text-red-700 ml-3",children:""})]},_.id)})})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:s,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:" Chiudi"})})]})})}function _y(){const{ordiniFornitori:o=[],fornitori:s=[],cantieri:l=[],loading:r,addRecord:d,updateRecord:u,deleteRecord:m}=wt(),[x,g]=F.useState(!1),[f,b]=F.useState(null),[p,_]=F.useState({}),[S,N]=F.useState(!1),[O,T]=F.useState(null),[z,L]=F.useState(""),[j,q]=F.useState(!1),[y,M]=F.useState({}),[k,te]=F.useState(!1),[ue,de]=F.useState(null),[ve,ie]=F.useState(""),[pe,be]=F.useState(""),[H,U]=F.useState(""),[D,R]=F.useState("data-desc"),[E,V]=F.useState(!1);if(r.ordiniFornitori||r.fornitori||r.cantieri)return a.jsx("div",{className:"flex items-center justify-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento situazione fornitori..."})]})});const w=P=>{if(!P)return"-";const he=new Date(P);return isNaN(he.getTime())?P:he.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric"})},A=P=>{if(!P||P.tipo!=="fattura_diretta")return{totale:0,pagato:0,residuo:0,acconti:[]};const he=P.acconti_pagamento||[],ce=he.reduce((Ve,nt)=>Ve+parseFloat(nt.importo||0),0),we=parseFloat(P.importo||0),Ne=we-ce;return{totale:we,pagato:ce,residuo:Ne,acconti:he}},I=P=>{const he=P.fatture||[],ce=he.filter(ge=>ge.tipo==="acconto"),we=he.filter(ge=>ge.tipo==="finale"),Ne=ce.reduce((ge,je)=>ge+parseFloat(je.importo||0),0),Ve=we.reduce((ge,je)=>ge+parseFloat(je.importo||0),0),nt=ce.filter(ge=>ge.pagato).reduce((ge,je)=>ge+parseFloat(je.importo||0),0);let pt=0,Yt=nt;we.forEach(ge=>{const je=parseFloat(ge.importo||0);let De=0;(ge.accontiDettratti||[]).forEach($=>{const fe=ce.find(Te=>Te.id===$);fe&&(De+=parseFloat(fe.importo||0))});const Me=je-De;ge.pagato?Yt+=Me:pt+=Me}),we.length===0&&ce.length>0&&(pt=parseFloat(P.importo||0)-nt),he.length===0&&(pt=parseFloat(P.importo||0));let na=0;we.forEach(ge=>{(ge.accontiDettratti||[]).forEach(je=>{const De=ce.find(Me=>Me.id===je);De&&(na+=parseFloat(De.importo||0))})});const Je=parseFloat(P.importo||0),X=Ne+Ve,oe=Je-X;return{totaleAcconti:Ne,totaleFinali:Ve,totaleFatturato:X,totaleDettratto:na,saldoDaPagare:pt,residuoOrdine:oe,numeroAcconti:ce.length,numeroFinali:we.length,effettivamentePagato:Yt,accontiPagati:nt}},K=F.useMemo(()=>{let P=o.filter(he=>{if(z&&he.fornitore_id!==z||pe&&he.cantiere_id!==pe)return!1;if(ve){const ce=ve.toLowerCase();if(he.tipo==="fattura_diretta"){if(!he.numero_fattura?.toLowerCase().includes(ce))return!1}else if(!(he.fatture||[]).some(Ne=>Ne.numeroFattura?.toLowerCase().includes(ce)))return!1}if(H)if(he.tipo==="fattura_diretta"){const ce=A(he);if(H==="pagato"&&ce.residuo>0||H==="non_pagato"&&ce.residuo<=0)return!1}else{const ce=I(he);if(H==="pagato"&&ce.saldoDaPagare>0||H==="non_pagato"&&ce.saldoDaPagare<=0)return!1}return!0});return D==="data-desc"?P.sort((he,ce)=>new Date(ce.data_ordine)-new Date(he.data_ordine)):D==="data-asc"?P.sort((he,ce)=>new Date(he.data_ordine)-new Date(ce.data_ordine)):D==="importo-desc"?P.sort((he,ce)=>parseFloat(ce.importo||0)-parseFloat(he.importo||0)):D==="importo-asc"&&P.sort((he,ce)=>parseFloat(he.importo||0)-parseFloat(ce.importo||0)),P},[o,z,pe,ve,H,D]),ee=F.useMemo(()=>{let P=0,he=0,ce=0;return o.forEach(we=>{if(P+=parseFloat(we.importo||0),we.tipo==="fattura_diretta"){const Ne=A(we);he+=Ne.pagato,ce+=Ne.residuo}else{const Ne=I(we);he+=Ne.effettivamentePagato,ce+=Ne.saldoDaPagare}}),{numeroOrdini:o.length,totaleOrdini:P,totalePagato:he,saldoTotale:ce}},[o]),ne=F.useMemo(()=>{if(!z)return null;const P=o.filter(Ne=>Ne.fornitore_id===z);let he=0,ce=0,we=0;return P.forEach(Ne=>{if(he+=parseFloat(Ne.importo||0),Ne.tipo==="fattura_diretta"){const Ve=A(Ne);ce+=Ve.pagato,we+=Ve.residuo}else{const Ve=I(Ne);ce+=Ve.effettivamentePagato,we+=Ve.saldoDaPagare}}),{numeroOrdini:P.length,totaleOrdini:he,totaleAcconti:ce,saldoTotale:we}},[o,z]),me=async()=>{if(!p.numeroOrdine||!p.dataOrdine||!p.fornitoreId||!p.importo)return alert(" Compila tutti i campi obbligatori");V(!0);const P={numero_ordine:p.numeroOrdine,data_ordine:p.dataOrdine,fornitore_id:p.fornitoreId,cantiere_id:p.cantiereId||null,importo:parseFloat(p.importo),descrizione:p.descrizione||null,tipo:"ordine",fatture:p.fatture||[]};let he;f?he=await u("ordiniFornitori",f,P):he=await d("ordiniFornitori",P),V(!1),he.success?(g(!1),_({}),b(null),alert(f?" Ordine aggiornato!":" Ordine aggiunto!")):alert(" Errore: "+he.error)},ke=async()=>{if(!y.numeroFattura||!y.dataFattura||!y.fornitoreId||!y.importo)return alert(" Compila tutti i campi obbligatori");V(!0);const P={numero_ordine:`DIRETTO-${y.numeroFattura}`,data_ordine:y.dataFattura,fornitore_id:y.fornitoreId,cantiere_id:y.cantiereId||null,importo:parseFloat(y.importo),descrizione:y.descrizione||null,tipo:"fattura_diretta",numero_fattura:y.numeroFattura,data_fattura:y.dataFattura,acconti_pagamento:[]},he=await d("ordiniFornitori",P);V(!1),he.success?(q(!1),M({}),alert(" Fattura diretta aggiunta!")):alert(" Errore: "+he.error)},$e=async(P,he)=>{if(!confirm(` Eliminare l'ordine ${he}?

Questa azione  irreversibile!`))return;const ce=await m("ordiniFornitori",P);ce.success?alert(" Ordine eliminato!"):alert(" Errore: "+ce.error)},St=P=>{_({numeroOrdine:P.numero_ordine,dataOrdine:P.data_ordine,fornitoreId:P.fornitore_id,cantiereId:P.cantiere_id,importo:P.importo,descrizione:P.descrizione,fatture:P.fatture||[]}),b(P.id),g(!0),window.scrollTo({top:0,behavior:"smooth"})},Q=(P="situazione")=>{const he=z?o.filter(X=>X.fornitore_id===z):o;let ce=[];if(P==="da_saldare"?ce=he.filter(X=>X.tipo==="fattura_diretta"?A(X).residuo>0:I(X).saldoDaPagare>0):ce=he,ce.length===0){alert(" Nessun dato da esportare!");return}let we=0,Ne=0,Ve=0;ce.forEach(X=>{if(we+=parseFloat(X.importo||0),X.tipo==="fattura_diretta"){const oe=A(X);Ne+=oe.pagato,Ve+=oe.residuo}else{const oe=I(X);Ne+=oe.effettivamentePagato,Ve+=oe.saldoDaPagare}});const pt=new Date().toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Yt=P==="da_saldare"?" Fatture da Saldare":" Situazione Fornitori";let na=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>${Yt}</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; font-size: 11px; }
    h1 { color: #1e40af; border-bottom: 3px solid #1e40af; padding-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; }
    th, td { border: 1px solid #333; padding: 8px; text-align: left; }
    th { background-color: #3b82f6; color: white; }
    tr:nth-child(even) { background-color: #f3f4f6; }
    .summary { background: #eff6ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
    @media print {
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      button { display: none !important; }
    }
  </style>
</head>
<body>
  <button onclick="window.print()" style="background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 20px;">
     Stampa / Salva PDF
  </button>
  
  <h1>${Yt}</h1>
  <p><strong>Data Stampa:</strong> ${pt}</p>
  
  <div class="summary">
    <p><strong>Totale Ordini:</strong> ${ce.length}</p>
    <p><strong>Importo Totale:</strong>  ${we.toFixed(2)}</p>
    <p><strong>Gi Pagato:</strong>  ${Ne.toFixed(2)}</p>
    <p><strong>Residuo da Pagare:</strong>  ${Ve.toFixed(2)}</p>
  </div>
  
  <table>
    <thead>
      <tr>
        <th>Num. Ordine</th>
        <th>Data</th>
        <th>Fornitore</th>
        <th>Cantiere</th>
        <th>Importo</th>
        <th>Pagato</th>
        <th>Residuo</th>
      </tr>
    </thead>
    <tbody>
      ${ce.map(X=>{const oe=s.find(Me=>Me.id===X.fornitore_id),ge=l.find(Me=>Me.id===X.cantiere_id);let je=0,De=0;if(X.tipo==="fattura_diretta"){const Me=A(X);je=Me.pagato,De=Me.residuo}else{const Me=I(X);je=Me.effettivamentePagato,De=Me.saldoDaPagare}return`
        <tr>
          <td>${X.numero_ordine}</td>
          <td>${w(X.data_ordine)}</td>
          <td>${oe?.ragione_sociale||"N/A"}</td>
          <td>${ge?.nome||"-"}</td>
          <td> ${parseFloat(X.importo).toFixed(2)}</td>
          <td> ${je.toFixed(2)}</td>
          <td> ${De.toFixed(2)}</td>
        </tr>
        `}).join("")}
    </tbody>
  </table>
  
  <div style="margin-top: 30px; padding: 10px; background: #eff6ff; border-top: 2px solid #1e40af; font-size: 9px;">
    <p>Documento generato automaticamente da Marrel S.r.l. - ${pt}</p>
  </div>
</body>
</html>`;const Je=window.open("","_blank");Je?(Je.document.write(na),Je.document.close()):alert(" Popup bloccato! Abilita i popup per questo sito.")};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold",children:" Situazione Fornitori"}),a.jsx("div",{className:"flex gap-2",children:a.jsxs("select",{className:"border rounded px-4 py-2 bg-purple-600 text-white font-medium hover:bg-purple-700 cursor-pointer",onChange:P=>{P.target.value&&(Q(P.target.value),P.target.value="")},value:"",children:[a.jsx("option",{value:"",children:" Export PDF..."}),a.jsx("option",{value:"situazione",children:"Situazione Generale"}),a.jsx("option",{value:"da_saldare",children:"Fatture da Saldare"})]})})]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-3",children:[a.jsxs("select",{className:"border rounded px-3 py-2",value:z,onChange:P=>L(P.target.value),children:[a.jsx("option",{value:"",children:"Tutti i fornitori"}),s.map(P=>a.jsx("option",{value:P.id,children:P.ragione_sociale},P.id))]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:pe,onChange:P=>be(P.target.value),children:[a.jsx("option",{value:"",children:"Tutti i cantieri"}),l.map(P=>a.jsx("option",{value:P.id,children:P.nome},P.id))]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:H,onChange:P=>U(P.target.value),children:[a.jsx("option",{value:"",children:"Tutti gli stati"}),a.jsx("option",{value:"pagato",children:"Pagato"}),a.jsx("option",{value:"non_pagato",children:"Non Pagato"})]}),a.jsxs("select",{className:"border rounded px-3 py-2",value:D,onChange:P=>R(P.target.value),children:[a.jsx("option",{value:"data-desc",children:"Data (pi recente)"}),a.jsx("option",{value:"data-asc",children:"Data (pi vecchia)"}),a.jsx("option",{value:"importo-desc",children:"Importo (maggiore)"}),a.jsx("option",{value:"importo-asc",children:"Importo (minore)"})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full pl-10",placeholder:" Cerca per numero fattura...",value:ve,onChange:P=>ie(P.target.value)}),ve&&a.jsx("button",{onClick:()=>ie(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:""})]}),a.jsx("button",{onClick:()=>{q(!0),M({}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 whitespace-nowrap",children:" Fattura Diretta"}),a.jsx("button",{onClick:()=>{g(!0),b(null),_({fatture:[]}),window.scrollTo({top:0,behavior:"smooth"})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 whitespace-nowrap",children:" Nuovo Ordine"})]})]})]}),(z||pe||ve||H)&&a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 text-sm flex-wrap",children:[a.jsx("span",{className:"font-medium text-blue-900",children:"Filtri attivi:"}),z&&a.jsxs("span",{className:"bg-white px-3 py-1 rounded border border-blue-300",children:["Fornitore: ",s.find(P=>P.id===z)?.ragione_sociale]}),pe&&a.jsxs("span",{className:"bg-white px-3 py-1 rounded border border-blue-300",children:["Cantiere: ",l.find(P=>P.id===pe)?.nome]}),H&&a.jsxs("span",{className:"bg-white px-3 py-1 rounded border border-blue-300",children:["Stato: ",H==="pagato"?"Pagato":"Non Pagato"]}),ve&&a.jsxs("span",{className:"bg-white px-3 py-1 rounded border border-blue-300",children:['Numero fattura: "',ve,'"']}),a.jsxs("span",{className:"text-blue-700",children:[" ",K.length," ",K.length===1?"risultato":"risultati"]})]}),a.jsx("button",{onClick:()=>{L(""),be(""),ie(""),U("")},className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:" Cancella filtri"})]}),a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg shadow-lg border-2 border-blue-300",children:[a.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-4",children:" Riepilogo Generale"}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Ordini Totali"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:ee.numeroOrdini})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Ordini"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",ee.totaleOrdini.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Gi Pagato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",ee.totalePagato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Residuo da Pagare"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",ee.saldoTotale.toFixed(2)]})]})]})]}),ne&&a.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 p-6 rounded-lg shadow-lg border-2 border-purple-300",children:[a.jsxs("h3",{className:"text-lg font-bold text-purple-900 mb-4",children:[" Riepilogo - ",s.find(P=>P.id===z)?.ragione_sociale]}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Ordini Attivi"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:ne.numeroOrdini})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Ordini"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",ne.totaleOrdini.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Gi Pagato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",ne.totaleAcconti.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[a.jsx("div",{className:"text-sm text-orange-700 mb-1",children:"Residuo da Pagare"}),a.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:[" ",ne.saldoTotale.toFixed(2)]})]})]})]}),x&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-blue-200",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4",children:[f?" Modifica":" Nuovo"," Ordine"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Ordine *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"es: ORD-245",value:p.numeroOrdine||"",onChange:P=>_({...p,numeroOrdine:P.target.value}),disabled:E})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Ordine *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p.dataOrdine||"",onChange:P=>_({...p,dataOrdine:P.target.value}),disabled:E})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornitore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.fornitoreId||"",onChange:P=>_({...p,fornitoreId:P.target.value}),disabled:E,children:[a.jsx("option",{value:"",children:"Seleziona fornitore"}),s.map(P=>a.jsx("option",{value:P.id,children:P.ragione_sociale},P.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:p.cantiereId||"",onChange:P=>_({...p,cantiereId:P.target.value}),disabled:E,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map(P=>a.jsx("option",{value:P.id,children:P.nome},P.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo Ordine * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:p.importo||"",onChange:P=>_({...p,importo:P.target.value}),disabled:E})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Descrizione"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Descrizione ordine...",value:p.descrizione||"",onChange:P=>_({...p,descrizione:P.target.value}),disabled:E})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:me,disabled:E,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:E?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{g(!1),_({}),b(null)},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:E,children:" Annulla"})]})]}),j&&a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-2 border-green-200",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:" Nuova Fattura Diretta (senza ordine)"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Fattura *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"es: FATT-381",value:y.numeroFattura||"",onChange:P=>M({...y,numeroFattura:P.target.value}),disabled:E})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fattura *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:y.dataFattura||"",onChange:P=>M({...y,dataFattura:P.target.value}),disabled:E})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fornitore *"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:y.fornitoreId||"",onChange:P=>M({...y,fornitoreId:P.target.value}),disabled:E,children:[a.jsx("option",{value:"",children:"Seleziona fornitore"}),s.map(P=>a.jsx("option",{value:P.id,children:P.ragione_sociale},P.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantiere"}),a.jsxs("select",{className:"border rounded px-3 py-2 w-full",value:y.cantiereId||"",onChange:P=>M({...y,cantiereId:P.target.value}),disabled:E,children:[a.jsx("option",{value:"",children:"Nessun cantiere"}),l.map(P=>a.jsx("option",{value:P.id,children:P.nome},P.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:y.importo||"",onChange:P=>M({...y,importo:P.target.value}),disabled:E})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Descrizione"}),a.jsx("textarea",{className:"border rounded px-3 py-2 w-full",rows:"2",placeholder:"Descrizione fattura...",value:y.descrizione||"",onChange:P=>M({...y,descrizione:P.target.value}),disabled:E})]})]}),a.jsxs("div",{className:"flex gap-2 mt-4",children:[a.jsx("button",{onClick:ke,disabled:E,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:opacity-50",children:E?" Salvataggio...":" Salva"}),a.jsx("button",{onClick:()=>{q(!1),M({})},className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500",disabled:E,children:" Annulla"})]})]}),a.jsx("div",{className:"space-y-4",children:K.length===0?a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("p",{className:"text-gray-500",children:"Nessun ordine trovato"}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:z||pe||ve||H?"Prova a modificare i filtri":'Clicca su " Nuovo Ordine" per iniziare'})]}):K.map(P=>{const he=s.find(Ve=>Ve.id===P.fornitore_id),ce=l.find(Ve=>Ve.id===P.cantiere_id),we=P.tipo==="fattura_diretta"?null:I(P),Ne=P.tipo==="fattura_diretta"?A(P):null;return a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("h3",{className:"text-xl font-bold text-blue-600",children:[P.tipo==="fattura_diretta"?"Fattura Diretta":"Ordine"," ",P.numero_ordine.replace("DIRETTO-","")]}),P.tipo==="fattura_diretta"?a.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700",children:"Fattura Diretta"}):a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${we.residuoOrdine<=0?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:we.residuoOrdine<=0?"Completato":"In corso"})]}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[a.jsx("span",{className:"font-medium",children:he?.ragione_sociale||"-"}),ce&&a.jsxs("span",{children:["  ",ce.nome]}),a.jsxs("span",{children:["  ",w(P.data_ordine)]})]}),P.descrizione&&a.jsx("p",{className:"text-sm text-gray-500 mt-1",children:P.descrizione})]}),a.jsxs("div",{className:"flex gap-2",children:[P.tipo==="fattura_diretta"?a.jsx("button",{onClick:()=>{de(P),te(!0)},className:"bg-purple-600 text-white px-3 py-2 rounded hover:bg-purple-700 text-sm",children:" Gestisci Acconti"}):a.jsx("button",{onClick:()=>{T(P),N(!0)},className:"bg-purple-600 text-white px-3 py-2 rounded hover:bg-purple-700 text-sm",children:" Gestisci Fatture"}),a.jsx("button",{onClick:()=>St(P),className:"text-blue-600 text-xl",children:""}),a.jsx("button",{onClick:()=>$e(P.id,P.numero_ordine),className:"text-red-600 text-xl",children:""})]})]}),P.tipo==="fattura_diretta"?a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Fattura"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",Ne.totale.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded border border-green-200",children:[a.jsxs("div",{className:"text-sm text-green-700 mb-1",children:["Gi Pagato (",Ne.acconti.length," acc.)"]}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",Ne.pagato.toFixed(2)]})]}),a.jsxs("div",{className:`p-4 rounded border ${Ne.residuo>0?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm mb-1 ${Ne.residuo>0?"text-orange-700":"text-gray-700"}`,children:"Residuo da Pagare"}),a.jsxs("div",{className:`text-2xl font-bold ${Ne.residuo>0?"text-orange-900":"text-gray-900"}`,children:[" ",Ne.residuo.toFixed(2)]})]})]}):a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[a.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Totale Ordine"}),a.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[" ",parseFloat(P.importo).toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-4 rounded border border-green-200",children:[a.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Gi Pagato"}),a.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[" ",we.effettivamentePagato.toFixed(2)]})]}),a.jsxs("div",{className:`p-4 rounded border ${we.saldoDaPagare>0?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-sm mb-1 ${we.saldoDaPagare>0?"text-orange-700":"text-gray-700"}`,children:"Residuo da Pagare"}),a.jsxs("div",{className:`text-2xl font-bold ${we.saldoDaPagare>0?"text-orange-900":"text-gray-900"}`,children:[" ",we.saldoDaPagare.toFixed(2)]})]})]})]},P.id)})}),S&&O&&a.jsx(wy,{ordine:O,fornitori:s,cantieri:l,onClose:()=>{N(!1),T(null)},ordiniFornitori:o,updateRecord:u,formatDate:w,calcolaStatoOrdine:I}),k&&ue&&a.jsx(Sy,{fattura:ue,fornitori:s,cantieri:l,onClose:()=>{te(!1),de(null)},updateRecord:u,formatDate:w,calcolaAccontiFatturaDiretta:A})]})}function wy({ordine:o,fornitori:s,cantieri:l,onClose:r,updateRecord:d,formatDate:u,calcolaStatoOrdine:m}){const[x,g]=F.useState("acconto"),[f,b]=F.useState(""),[p,_]=F.useState(new Date().toISOString().split("T")[0]),[S,N]=F.useState(""),[O,T]=F.useState([]),[z,L]=F.useState(!1),j=s.find(D=>D.id===o.fornitore_id),q=l.find(D=>D.id===o.cantiere_id),y=m(o),M=(o.fatture||[]).filter(D=>D.tipo==="acconto"),k=(o.fatture||[]).filter(D=>D.tipo==="finale"),te=M.filter(D=>!k.some(E=>(E.accontiDettratti||[]).includes(D.id))),ue=O.reduce((D,R)=>{const E=M.find(V=>V.id===R);return D+(E?parseFloat(E.importo||0):0)},0),de=parseFloat(S||0)-ue,ve=async()=>{if(!f||!S)return alert(" Inserisci numero fattura e importo");L(!0);const D={id:Date.now().toString(),numeroFattura:f,dataFattura:p,importo:parseFloat(S),tipo:"acconto",pagato:!1,dataPagamento:""},R=[...o.fatture||[],D],E=await d("ordiniFornitori",o.id,{fatture:R});L(!1),E.success?(b(""),N(""),_(new Date().toISOString().split("T")[0]),alert(" Acconto aggiunto!"),r()):alert(" Errore: "+E.error)},ie=async()=>{if(!f||!S)return alert(" Inserisci numero fattura e importo");L(!0);const D={id:Date.now().toString(),numeroFattura:f,dataFattura:p,importo:parseFloat(S),tipo:"finale",accontiDettratti:O,pagato:!1,dataPagamento:""},R=[...o.fatture||[],D],E=await d("ordiniFornitori",o.id,{fatture:R});L(!1),E.success?(b(""),N(""),T([]),_(new Date().toISOString().split("T")[0]),alert(" Fattura finale aggiunta!"),r()):alert(" Errore: "+E.error)},pe=async D=>{L(!0);const R=(o.fatture||[]).filter(V=>V.id!==D),E=await d("ordiniFornitori",o.id,{fatture:R});L(!1),E.success?(alert(" Fattura eliminata!"),r()):alert(" Errore: "+E.error)},be=D=>{O.includes(D)?T(O.filter(R=>R!==D)):T([...O,D])},H=async(D,R)=>{L(!0);const E=o.fatture.map(w=>w.id===D?{...w,pagato:R,dataPagamento:R?new Date().toISOString().split("T")[0]:""}:w),V=await d("ordiniFornitori",o.id,{fatture:E});L(!1),V.success?r():alert(" Errore: "+V.error)},U=async(D,R)=>{L(!0);const E=o.fatture.map(w=>w.id===D?{...w,dataPagamento:R}:w),V=await d("ordiniFornitori",o.id,{fatture:E});L(!1),V.success||alert(" Errore: "+V.error)};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full p-6 my-8 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Gestione Fatture - Ordine ",o.numero_ordine]}),a.jsx("div",{className:"bg-gray-50 p-4 rounded mb-4",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Fornitore:"})," ",j?.ragione_sociale]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Cantiere:"})," ",q?.nome||"N/A"]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Data Ordine:"})," ",u(o.data_ordine)]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Importo Ordine:"}),"  ",parseFloat(o.importo).toFixed(2)]})]})}),a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-6",children:[a.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[a.jsx("div",{className:"text-xs text-blue-700 mb-1",children:"Totale Ordine"}),a.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[" ",parseFloat(o.importo).toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[a.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Gi Pagato"}),a.jsxs("div",{className:"text-lg font-bold text-green-900",children:[" ",y.effettivamentePagato.toFixed(2)]})]}),a.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-200",children:[a.jsx("div",{className:"text-xs text-orange-700 mb-1",children:"Residuo da Pagare"}),a.jsxs("div",{className:"text-lg font-bold text-orange-900",children:[" ",y.saldoDaPagare.toFixed(2)]})]})]}),a.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200",children:[a.jsx("h4",{className:"font-medium mb-3 text-blue-900",children:" Aggiungi Fattura"}),a.jsx("div",{className:"mb-3",children:a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"acconto",checked:x==="acconto",onChange:D=>g(D.target.value),className:"mr-2",disabled:z}),a.jsx("span",{className:"font-medium",children:"Fattura di Acconto"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",value:"finale",checked:x==="finale",onChange:D=>g(D.target.value),className:"mr-2",disabled:z}),a.jsx("span",{className:"font-medium",children:"Fattura Finale"})]})]})}),a.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Numero Fattura *"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"es: FATT-183",value:f,onChange:D=>b(D.target.value),disabled:z})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Fattura *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:p,onChange:D=>_(D.target.value),disabled:z})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo * ()"}),a.jsx("input",{type:"number",step:"0.01",className:"border rounded px-3 py-2 w-full",value:S,onChange:D=>N(D.target.value),disabled:z})]})]}),x==="finale"&&te.length>0&&a.jsxs("div",{className:"bg-white p-3 rounded border mb-3",children:[a.jsx("label",{className:"block text-sm font-medium mb-2",children:"Seleziona Acconti da Detrarre:"}),a.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:te.map(D=>a.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded",children:[a.jsx("input",{type:"checkbox",checked:O.includes(D.id),onChange:()=>be(D.id),disabled:z}),a.jsxs("span",{className:"flex-1",children:["Acconto ",D.numeroFattura," - ",u(D.dataFattura)]}),a.jsxs("span",{className:"font-semibold",children:[" ",parseFloat(D.importo).toFixed(2)]})]},D.id))}),O.length>0&&a.jsxs("div",{className:"mt-3 p-2 bg-green-50 rounded border border-green-200",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Importo Fattura:"}),a.jsxs("span",{className:"font-semibold",children:[" ",parseFloat(S||0).toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Acconti Detratti:"}),a.jsxs("span",{className:"font-semibold text-green-700",children:["-  ",ue.toFixed(2)]})]}),a.jsxs("div",{className:"flex justify-between text-sm font-bold border-t mt-1 pt-1",children:[a.jsx("span",{children:"Saldo Finale:"}),a.jsxs("span",{className:de>0?"text-orange-700":"text-green-700",children:[" ",de.toFixed(2)]})]})]})]}),a.jsx("button",{onClick:x==="acconto"?ve:ie,disabled:z,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full disabled:opacity-50",children:z?" Salvataggio...":` Aggiungi ${x==="acconto"?"Acconto":"Fattura Finale"}`})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3 text-purple-900",children:[" Acconti (",M.length,")"]}),M.length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"Nessun acconto registrato"}):a.jsx("div",{className:"space-y-2",children:M.map(D=>{const R=k.some(E=>(E.accontiDettratti||[]).includes(D.id));return a.jsxs("div",{className:`p-3 rounded border ${R?"bg-gray-50 border-gray-300 opacity-60":"bg-purple-50 border-purple-200"}`,children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:D.numeroFattura}),a.jsx("div",{className:"text-xs text-gray-600",children:u(D.dataFattura)}),R&&a.jsx("div",{className:"text-xs text-green-600 mt-1",children:" Gi detratto"})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"font-bold text-purple-900",children:[" ",parseFloat(D.importo).toFixed(2)]}),a.jsx("button",{onClick:()=>{confirm("Eliminare questo acconto?")&&pe(D.id)},disabled:z,className:"text-red-600 text-sm mt-1 disabled:opacity-50",children:""})]})]}),a.jsxs("div",{className:"border-t pt-2 space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:D.pagato||!1,onChange:E=>H(D.id,E.target.checked),disabled:z}),a.jsx("span",{className:`text-sm font-medium ${D.pagato?"text-green-700":"text-orange-700"}`,children:D.pagato?" Pagato":"Non Pagato"})]}),D.pagato&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Data Pagamento:"}),a.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-xs w-full",value:D.dataPagamento||"",onChange:E=>U(D.id,E.target.value),disabled:z})]})]})]},D.id)})})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3 text-cyan-900",children:[" Fatture Finali (",k.length,")"]}),k.length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"Nessuna fattura finale registrata"}):a.jsx("div",{className:"space-y-2",children:k.map(D=>{const R=(D.accontiDettratti||[]).map(w=>M.find(A=>A.id===w)).filter(Boolean),E=R.reduce((w,A)=>w+parseFloat(A.importo),0),V=parseFloat(D.importo)-E;return a.jsxs("div",{className:"p-3 rounded border bg-cyan-50 border-cyan-200",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:D.numeroFattura}),a.jsx("div",{className:"text-xs text-gray-600",children:u(D.dataFattura)})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"font-bold text-cyan-900",children:[" ",parseFloat(D.importo).toFixed(2)]}),a.jsx("button",{onClick:()=>{confirm("Eliminare questa fattura?")&&pe(D.id)},disabled:z,className:"text-red-600 text-sm mt-1 disabled:opacity-50",children:""})]})]}),R.length>0&&a.jsxs("div",{className:"text-xs border-t pt-2 mb-2",children:[a.jsx("div",{className:"font-medium mb-1",children:"Acconti detratti:"}),R.map(w=>a.jsxs("div",{className:"flex justify-between text-gray-600",children:[a.jsxs("span",{children:[" ",w.numeroFattura]}),a.jsxs("span",{children:["-  ",parseFloat(w.importo).toFixed(2)]})]},w.id)),a.jsxs("div",{className:"flex justify-between font-semibold border-t mt-1 pt-1",children:[a.jsx("span",{children:"Saldo da pagare:"}),a.jsxs("span",{className:V>0?"text-orange-700":"text-green-700",children:[" ",V.toFixed(2)]})]})]}),a.jsxs("div",{className:"border-t pt-2 space-y-2",children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:D.pagato||!1,onChange:w=>H(D.id,w.target.checked),disabled:z}),a.jsx("span",{className:`text-sm font-medium ${D.pagato?"text-green-700":"text-orange-700"}`,children:D.pagato?" Pagato":"Non Pagato"})]}),D.pagato&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Data Pagamento:"}),a.jsx("input",{type:"date",className:"border rounded px-2 py-1 text-xs w-full",value:D.dataPagamento||"",onChange:w=>U(D.id,w.target.value),disabled:z})]})]})]},D.id)})})]})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:r,disabled:z,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:" Chiudi"})})]})})}function Sy({fattura:o,fornitori:s,cantieri:l,onClose:r,updateRecord:d,formatDate:u,calcolaAccontiFatturaDiretta:m}){const[x,g]=F.useState(new Date().toISOString().split("T")[0]),[f,b]=F.useState(""),[p,_]=F.useState(""),[S,N]=F.useState(!1),O=s.find(q=>q.id===o.fornitore_id),T=l.find(q=>q.id===o.cantiere_id),z=m(o),L=async()=>{const q=parseFloat(f);if(!q||q<=0)return alert(" Inserisci un importo valido");if(q>z.residuo)return alert(` L'importo non pu superare il residuo di  ${z.residuo.toFixed(2)}`);N(!0);const y={id:Date.now().toString(),data:x,importo:q,nota:p},M=[...o.acconti_pagamento||[],y],k=await d("ordiniFornitori",o.id,{acconti_pagamento:M});N(!1),k.success?(b(""),_(""),g(new Date().toISOString().split("T")[0]),alert(" Acconto registrato!"),r()):alert(" Errore: "+k.error)},j=async q=>{N(!0);const y=(o.acconti_pagamento||[]).filter(k=>k.id!==q),M=await d("ordiniFornitori",o.id,{acconti_pagamento:y});N(!1),M.success?(alert(" Acconto eliminato!"),r()):alert(" Errore: "+M.error)};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full p-6 my-8 max-h-[90vh] overflow-y-auto",children:[a.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[" Gestione Acconti - Fattura ",o.numero_fattura]}),a.jsx("div",{className:"bg-gray-50 p-4 rounded mb-4",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Fornitore:"})," ",O?.ragione_sociale]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Cantiere:"})," ",T?.nome||"N/A"]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Data Fattura:"})," ",u(o.data_fattura)]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Numero:"})," ",o.numero_fattura]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6",children:[a.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[a.jsx("div",{className:"text-xs text-blue-700 mb-1",children:"Totale Fattura"}),a.jsxs("div",{className:"text-lg font-bold text-blue-900",children:[" ",z.totale.toFixed(2)]})]}),a.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[a.jsx("div",{className:"text-xs text-green-700 mb-1",children:"Gi Pagato"}),a.jsxs("div",{className:"text-lg font-bold text-green-900",children:[" ",z.pagato.toFixed(2)]})]}),a.jsxs("div",{className:`p-3 rounded border ${z.residuo>0?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,children:[a.jsx("div",{className:`text-xs mb-1 ${z.residuo>0?"text-orange-700":"text-gray-700"}`,children:"Residuo"}),a.jsxs("div",{className:`text-lg font-bold ${z.residuo>0?"text-orange-900":"text-gray-900"}`,children:[" ",z.residuo.toFixed(2)]})]})]}),z.residuo>0&&a.jsxs("div",{className:"bg-green-50 p-4 rounded-lg mb-4 border border-green-200",children:[a.jsx("h4",{className:"font-medium mb-3 text-green-900",children:" Registra Pagamento"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Data Pagamento *"}),a.jsx("input",{type:"date",className:"border rounded px-3 py-2 w-full",value:x,onChange:q=>g(q.target.value),disabled:S})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Importo * ()"}),a.jsx("input",{type:"number",step:"0.01",max:z.residuo,className:"border rounded px-3 py-2 w-full",placeholder:`Max  ${z.residuo.toFixed(2)}`,value:f,onChange:q=>b(q.target.value),disabled:S})]})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nota (opzionale)"}),a.jsx("input",{type:"text",className:"border rounded px-3 py-2 w-full",placeholder:"Es: Bonifico, Assegno n. 123...",value:p,onChange:q=>_(q.target.value),disabled:S})]}),a.jsx("button",{onClick:L,disabled:S,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full disabled:opacity-50",children:S?" Salvataggio...":" Aggiungi Pagamento"})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"font-semibold mb-3",children:["Storico Pagamenti (",z.acconti.length,")"]}),z.acconti.length===0?a.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Nessun pagamento registrato"}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left",children:"Data"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Importo"}),a.jsx("th",{className:"px-3 py-2 text-left",children:"Nota"}),a.jsx("th",{className:"px-3 py-2 text-center",children:"Azioni"})]})}),a.jsx("tbody",{children:[...z.acconti].reverse().map(q=>a.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[a.jsx("td",{className:"px-3 py-2",children:u(q.data)}),a.jsxs("td",{className:"px-3 py-2 font-semibold text-green-700",children:[" ",parseFloat(q.importo).toFixed(2)]}),a.jsx("td",{className:"px-3 py-2 text-gray-600",children:q.nota||"-"}),a.jsx("td",{className:"px-3 py-2 text-center",children:a.jsx("button",{onClick:()=>{confirm("Eliminare questo pagamento?")&&j(q.id)},disabled:S,className:"text-red-600 hover:text-red-700 disabled:opacity-50",children:""})})]},q.id))})]})})]}),a.jsx("div",{className:"flex gap-2 mt-6",children:a.jsx("button",{onClick:r,disabled:S,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:" Chiudi"})})]})})}function Cy(){const{user:o,profile:s,loading:l}=yr(),[r,d]=F.useState("dashboard"),[u,m]=F.useState(null),[x,g]=F.useState([]),[f,b]=F.useState([]),[p,_]=F.useState({}),[S,N]=F.useState({}),[O,T]=F.useState(0),z={datiCasseLavoratori:p,setDatiCasseLavoratori:_,datiCasseTotali:S,setDatiCasseTotali:N,notePresenze:x,setNotePresenze:g,noteRateizzi:f,setNoteRateizzi:b,saldoIniziale:O,setSaldoIniziale:T};return l?a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Caricamento..."})]})}):!o||!s?a.jsx(Q0,{}):a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx(K0,{esportaDati:()=>alert("Funzione temporaneamente disabilitata"),importaDati:()=>{},profile:s}),a.jsx(X0,{activeTab:r,setActiveTab:d,openDropdown:u,setOpenDropdown:m,profile:s}),a.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[r==="dashboard"&&a.jsx(W0,{...z}),r==="lavoratori"&&a.jsx(ey,{...z}),r==="unilav"&&a.jsx(ty,{...z}),r==="corsi"&&a.jsx(ay,{...z}),r==="automezzi"&&a.jsx(sy,{...z}),r==="subappaltatori"&&a.jsx(ny,{...z}),r==="cantieri"&&a.jsx(ly,{...z}),r==="fornitori"&&a.jsx(ry,{...z}),r==="sal"&&a.jsx(oy,{...z}),r==="certificazioni"&&a.jsx(cy,{...z}),r==="casse"&&a.jsx(uy,{...z}),r==="scadenzario"&&a.jsx(hy,{...z}),r==="rateizzi"&&a.jsx(my,{...z}),r==="acconti"&&a.jsx(fy,{...z}),r==="fatture-emesse"&&(s.ruolo==="admin"?a.jsx(xy,{...z}):a.jsx(Kc,{})),r==="storico-paghe"&&(s.ruolo==="admin"?a.jsx(vy,{...z}):a.jsx(Kc,{})),r==="contabilita"&&(s.ruolo==="admin"?a.jsx(gy,{...z}):a.jsx(Kc,{})),r==="dtt-formulari"&&a.jsx(jy,{...z}),r==="situazione-fornitori"&&a.jsx(_y,{...z}),r==="presenze"&&a.jsx(py,{...z})]}),a.jsx(J0,{})]})}function Kc(){return a.jsxs("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:[a.jsx("p",{className:"text-4xl mb-4",children:""}),a.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Accesso Negato"}),a.jsx("p",{className:"text-gray-600",children:"Non hai i permessi per accedere a questa sezione."}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Contatta un amministratore per richiedere l'accesso."})]})}function Ey(){return a.jsx(Y0,{children:a.jsx(V0,{children:a.jsx(Cy,{})})})}_b.createRoot(document.getElementById("root")).render(a.jsx(pb.StrictMode,{children:a.jsx(Ey,{})}));
